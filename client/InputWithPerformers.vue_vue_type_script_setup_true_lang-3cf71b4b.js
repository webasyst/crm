import{d as P,a as w,o as v,c as g,i as _,r as D,n as M,p as V,e as U,w as k,f as W,al as _e,_ as O,O as ee,Q as we,aa as ye,z as L,W as te,J as K,N as J,A as ge,am as le,a0 as X,ag as $e,aM as ie,b as R,F as T,l as re,h as Y,ap as be,g as C,ar as ue,a5 as j,k as E,at as G,H as ce,a3 as Ce,v as ne,t as q,an as de,ad as pe,aq as se,L as Ie,T as oe,q as ke,s as Fe,$ as Se,I as De}from"./main-ec0df6a4.js";import{M as Z,_ as ve}from"./MenuList-466c4134.js";import{D as fe}from"./DropDown-5d25a522.js";import{c as ae}from"./helpers-a2ed4cd9.js";import{u as xe}from"./recentContacts-b91545dc.js";import{F as Be}from"./FieldSelect-df2e3574.js";import{v as Le}from"./index-8d873219.js";import{U as We}from"./UserPic-87c13a4a.js";import{C as Ve}from"./CustomColumn-959e6ffe.js";import{a as Me}from"./index-4793d891.js";const Re={class:"collapsable-wrapper"},Pe={class:"collapsable-handler-caret"},Ae={key:0,class:"fas fa-caret-down"},Ue={key:1,class:"fas fa-caret-right"},je={key:0,class:"collapsable-content"},ze=P({__name:"CollapsibleSection",props:{colorCaret:{}},setup(d){const t=d,a=w(!1);return(e,m)=>(v(),g("div",Re,[_("a",{class:"collapsable-handler",onClick:m[0]||(m[0]=V(c=>a.value=!a.value,["prevent"]))},[_("span",null,[D(e.$slots,"name",{},void 0,!0)]),_("span",Pe,[(v(),g("span",{key:a.value?1:0,class:M(["icon",t.colorCaret||""])},[a.value?(v(),g("i",Ae)):(v(),g("i",Ue))],2))])]),U(_e,{name:"fade",mode:"out-in"},{default:k(()=>[a.value?(v(),g("div",je,[D(e.$slots,"default",{},void 0,!0)])):W("",!0)]),_:3})]))}});const Vt=O(ze,[["__scopeId","data-v-4832961f"]]),Ne=ee("inputWithPreformers",()=>{const d=w(!0),t=w([]),a=we(Me),e=ye({dealId:null}),m=L(()=>`crm.user.list?${te.stringify({...e.dealId?{can_own_deal:e.dealId}:{}})}`),{error:c,data:p}=K(m,{immediate:!1,refetch:!0}).get().json();J(p,async()=>{if(Array.isArray(p.value)){const l=ae(p.value).map(o=>o.id).join(",");if(l){const{id:o}=ge.user,r=["email"];a.value&&r.push("phone");const u=await me(`id/${l}`,r),y=u.find(n=>n.id===o);t.value=[...y?[y]:[],...u.filter(n=>n.id!==o)]}}h(e.currrentUser),d.value=!1});function i(l,o){e.currrentUser=o,t.value.length&&h(e.currrentUser),e.dealId=l}function h(l){if(l!=null&&l.id){const o=t.value.findIndex(r=>r.id===l.id);if(o!==-1){const r=t.value[o];t.value.splice(o,1),t.value.unshift(r)}else l.id&&t.value.unshift(l)}}return{setupProps:i,isFetching:d,error:c,$contacts:t}});async function me(d,t){const a=te.stringify({hash:d,fields:t}),{data:e}=await K(`crm.contact.list?${a}`).get().json();if(e.value){const{data:m}=e.value;return m}return[]}const Te=["placeholder"],Ee=["onClick"],Mt=P({__name:"InputWithRole",props:{scope:{},modelValue:{},inputClass:{default:""},right:{type:Boolean},width:{default:"200px"}},setup(d){const t=d,a=le(t,"modelValue"),e=w([]),m=w(),c=w(!1),p=L(()=>e.value.filter(l=>{var o;return(o=a.value)!=null&&o.trim()?l.toLocaleLowerCase().includes(a.value.toLocaleLowerCase()):!0})),i=X(p);$e(async()=>{const{data:l}=await K(`crm.deal.role.list?scope=${t.scope}`).get().json();Array.isArray(l.value)&&(e.value=l.value)}),ie(m,()=>{c.value=!1});function h(l){l&&(a.value=l,c.value=!1)}return(l,o)=>(v(),g("div",{ref_key:"wrapperRef",ref:m},[U(fe,{open:c.value,"disable-click-outside":!0,right:t.right,width:t.width,disabled:!0,"max-height":"195px"},{body:k(()=>[p.value.length?(v(),R(Z,{key:0},{default:k(()=>[(v(!0),g(T,null,re(p.value,(r,u)=>(v(),R(ve,{key:u},{default:k(()=>[_("a",{class:M({"tw-bg-waBackground":C(i).index.value===u}),onClick:V(y=>h(r),["prevent"])},E(r),11,Ee)]),_:2},1024))),128))]),_:1})):W("",!0)]),default:k(()=>[Y(_("input",{"onUpdate:modelValue":o[0]||(o[0]=r=>ue(a)?a.value=r:null),type:"text",class:M(["tw-w-full",t.inputClass]),placeholder:l.$t("role"),onKeyup:o[1]||(o[1]=j(r=>{h(C(i).state.value),r.target.blur()},["enter"])),onKeydown:[o[2]||(o[2]=j(V(r=>C(i).prev(),["prevent"]),["up"])),o[3]||(o[3]=j(V(r=>C(i).next(),["prevent"]),["down"]))],onFocusin:o[4]||(o[4]=r=>c.value=!0)},null,42,Te),[[be,C(a)]])]),_:1},8,["open","right","width"])],512))}}),Ke={key:0,class:"icon size-20 !tw-left-2"},qe={key:1,class:"icon text-gray"},He=_("i",{class:"fas fa-search"},null,-1),Qe=[He],Je=_("i",{class:"fas fa-times-circle"},null,-1),Xe=[Je],Ye=["placeholder","disabled"],Ge={key:2,class:"smaller text-red tw-mt-1"},Ze=["data-index","onClick"],Oe=["src"],et={class:"name"},tt={class:"email"},st={key:2,class:"tw-text-center tw-py-3 gray"},at={class:"tw-h-[5px]"},nt={class:"tw-text-center tw-py-3"},ot=_("i",{class:"spinner custom-p-12"},null,-1),lt=[ot],it=_("hr",{class:"tw-m-0"},null,-1),rt={class:"!tw-my-1"},he=P({__name:"InputWithDropDown",props:{items:{},item:{},initItemId:{},placeholder:{},isFetching:{type:Boolean},hideClear:{type:Boolean},hideIcon:{type:Boolean},inputClass:{},width:{},right:{type:Boolean},disabled:{type:Boolean},error:{type:Boolean},errorMessage:{}},emits:["input","update","clear","interseption-observer","focus","close-dropdown"],setup(d,{expose:t,emit:a}){const e=d,m=w(),c=w(),p=w(!1),i=w(e.item);let h=X(e.items);J(()=>e.items,n=>{h=X(n),J(h.index,s=>{var $,b;(b=($=m.value)==null?void 0:$.querySelector(`[data-index="${s}"]`))==null||b.scrollIntoView({behavior:"smooth",block:"nearest"})})}),G(()=>e.initItemId&&e.items.length,()=>{const n=e.items.find(s=>s.id===e.initItemId);n&&o(n)},{immediate:!0}),G(()=>!p.value,()=>{a("close-dropdown")}),ie(m,()=>{p.value=!1});function l(n){a("focus"),a("input",n.target.value),p.value=!0,Ce(()=>{var s;(s=c.value)==null||s.focus()})}function o(n){n&&(i.value={...n},a("update",i.value),p.value=!1)}function r(){i.value={id:0,name:""},a("clear")}const u=L(()=>{var n;return p.value&&((n=i.value)==null?void 0:n.name)||e.placeholder}),y=L(()=>p.value?"default-value":"value");return t({clearValue:r}),(n,s)=>(v(),R(Ve,{space:"4"},{default:k(()=>{var $,b,x,z;return[_("div",{ref_key:"wrapperRef",ref:m,class:"tw-w-full"},[!n.$slots.preview||p.value?(v(),g("div",{key:0,class:M(["state-with-inner-icon width-100",{left:!e.hideIcon}])},[e.hideIcon?W("",!0):(v(),g(T,{key:0},[($=i.value)!=null&&$.userpic?(v(),g("div",Ke,[U(We,{url:(b=i.value)==null?void 0:b.userpic,size:20},null,8,["url"])])):(v(),g("div",qe,Qe))],64)),!e.disabled&&!e.hideClear&&((x=i.value)!=null&&x.name)?(v(),g("a",{key:1,class:"icon !tw-left-auto tw-right-3 text-red hover:!tw-text-red-600 tw-rounded-full tw-bg-waBlank",onClick:s[0]||(s[0]=V(F=>r(),["prevent"]))},Xe)):W("",!0),_("input",ce({ref_key:"inputRef",ref:c,type:"search",class:["tw-w-full",e.inputClass,{"state-error":e.error}],[y.value||""]:((z=i.value)==null?void 0:z.name)||"",placeholder:u.value,disabled:e.disabled,onInput:s[1]||(s[1]=F=>a("input",F.target.value)),onKeyup:s[2]||(s[2]=j(F=>{o(C(h).state.value),F.target.blur()},["enter"])),onKeydown:[s[3]||(s[3]=j(V(F=>C(h).prev(),["prevent"]),["up"])),s[4]||(s[4]=j(V(F=>C(h).next(),["prevent"]),["down"]))],onFocus:l}),null,16,Ye)],2)):D(n.$slots,"preview",{key:1,model:i.value,showInput:l}),e.error?(v(),g("div",Ge,E(e.errorMessage),1)):W("",!0),D(n.$slots,"items",{items:e.items,onSelectItem:o,isFocus:p.value},()=>[U(fe,{"max-height":"255px",open:p.value,"disable-click-outside":!0,width:e.width||"250px",right:e.right,"disable-floating":!0},{body:k(()=>[U(Z,{class:"thin-scrollbar"},{default:k(()=>{var F;return[(F=e.items)!=null&&F.length?(v(!0),g(T,{key:0},re(e.items,(B,N)=>(v(),R(ve,{key:B.id},{default:k(()=>[_("a",{class:M(["item",{"tw-bg-waBackground":C(h).index.value===N}]),"data-index":N,onClick:V(H=>o(B),["prevent"])},[n.$slots.item?D(n.$slots,"item",{key:0,item:B}):(v(),g(T,{key:1},[_("img",{class:"userpic userpic32",src:B.userpic},null,8,Oe),_("div",null,[_("div",et,E(B.name),1),_("div",tt,E(B.email),1)])],64))],10,Ze)]),_:2},1024))),128)):!e.isFetching&&n.$slots.empty?D(n.$slots,"empty",{key:1}):e.isFetching?W("",!0):(v(),g("div",st,E(n.$t("notFound")),1)),Y(_("div",at,null,512),[[ne,!n.isFetching],[C(Le),([{isIntersecting:B}])=>{B&&a("interseption-observer")}]]),Y(_("div",nt,lt,512),[[ne,n.isFetching]])]}),_:3}),n.$slots.bottomItems?(v(),g(T,{key:0},[it,_("div",rt,[U(Z,null,{default:k(()=>[D(n.$slots,"bottomItems",{hideDropDown:()=>p.value=!1})]),_:3})])],64)):W("",!0)]),_:3},8,["open","width","right"])])],512)]}),_:3}))}});const ut=ee("inputWithCustomers",()=>{const d=w(!0),t=w([]),a=w(null),e=xe(),{recent:m,pinned:c,error:p,isFinished:i}=q(e);e.refetch();function h(u,y,n){a.value!==u?(a.value&&e.refetch(),G(()=>i.value,()=>{l(y,n)},{immediate:!0})):(t.value.length||m.value.length||c.value.length)&&o(n),a.value=u}async function l(u,y){const n=[...c.value,...m.value].map(b=>b.id),s=r(y);s&&n.unshift(s);const $=ae(n).join(",");$&&(t.value=await me(`id/${$}`,u),o(y)),d.value=!1}function o(u){if(!u)return;const y=t.value.findIndex(n=>n.id===r(u));if(y!==-1){const n=t.value[y];return t.value.splice(y,1),t.value.unshift(n),!0}else typeof u=="object"&&u.id&&t.value.unshift(u)}function r(u){return typeof u=="number"?u:typeof(u==null?void 0:u.id)=="number"?u.id:null}return{isFetching:d,error:p,$contacts:t,fetchData:h}}),ct=P({__name:"InputWithCustomers",props:{dealId:{default:0},initContactId:{default:void 0},contact:{default:()=>({id:0,name:"",userpic:"",jobtitle:"",company:"",company_contact_id:null})},withFields:{default:()=>["email"]},excludeIds:{default:()=>[]},disabled:{type:Boolean}},emits:["update"],setup(d,{expose:t,emit:a}){var N,H;const e=d,m=w(),c=w({id:e.contact.id,name:e.contact.name,userpic:e.contact.userpic,company:e.contact.company||"",email:(H=(N=e.contact)==null?void 0:N.email)!=null&&H.length?e.contact.email[0].value:""}),p=ut();p.fetchData(e.dealId,e.withFields,e.initContactId||{id:c.value.id,name:c.value.name,userpic:c.value.userpic,company:c.value.company,fields:[{id:"email",value:c.value.email?[c.value.email]:[]}]});const{$contacts:i,isFetching:h}=q(p),l=w([]),o=w(!1),r=w(""),u=w(0),y=w(0),n=w(10);x(),de(i,()=>{x()}),t({isFetchingContacts:h,clearValue:()=>{var f;return(f=m.value)==null?void 0:f.clearValue()}});const s=pe(async f=>{var I;if(u.value=0,y.value=0,!f||((I=c.value)==null?void 0:I.name)===f)x();else{let S="name.name";const Q=()=>/^[+\-0-9() ]+$/.test(f);f.includes("@")&&(S="email"),Q()&&(S="phone");const A=`crmSearch/contact_info.${S}*=${f}`;r.value!==A&&(l.value=[],l.value=await z(A))}},300),$=e.excludeIds.filter(f=>f!==e.contact.id).reduce((f,I)=>({...f,[I]:!0}),{}),b=L(()=>l.value.filter(f=>!$[f.id]).map(f=>{const I=f.fields.find(S=>S.id==="email");return{id:f.id,name:f.name,userpic:f.userpic,email:I==null?void 0:I.value[0],company:f.company}}));function x(){u.value=0,y.value=0,r.value="",l.value=[...i.value]}async function z(f){o.value=!0;const I=te.stringify({hash:f,fields:e.withFields,limit:n.value,offset:u.value}),{data:S}=await K(`crm.contact.list?${I}`).get().json();if(o.value=!1,S.value){const{data:Q,params:A}=S.value;return u.value+=A.limit||0,y.value=A.total_count||0,r.value=A.hash||"",Q}return[]}async function F(){u.value<y.value&&(l.value=[...l.value,...await z(r.value)])}function B(f){c.value=f;const I=l.value.find(S=>S.id===f.id);I&&(a("update",I),i.value.unshift(I),l.value=i.value=ae(i.value))}return(f,I)=>(v(),R(he,{ref_key:"inputWithDropDownRef",ref:m,items:b.value,item:c.value,"init-item-id":e.initContactId,placeholder:f.$t("name"),"is-fetching":C(h)||o.value,disabled:e.disabled,onInput:C(s),onUpdate:B,onInterseptionObserver:F,onCloseDropdown:x},{items:k(S=>[D(f.$slots,"items",se({isFetching:C(h)||o.value,interseptionObserver:F},S),void 0,!0)]),_:3},8,["items","item","init-item-id","placeholder","is-fetching","disabled","onInput"]))}});const Rt=O(ct,[["__scopeId","data-v-ef1ee6ea"]]),dt=ee("currencies",()=>{const d=w([]),{data:t,isFetching:a,error:e,execute:m,isFinished:c}=K("crm.currency.list").get().json(),p=L(()=>d.value.find(o=>o.is_primary)),i=L(()=>o=>d.value.find(r=>r.id===o)),h=L(()=>c.value&&!d.value.length);Ie(()=>{Array.isArray(t.value)&&(d.value=t.value)});function l(){c.value&&m()}return{currencies:d,primaryCurrency:p,isFetching:a,error:e,isFinished:c,isEmptyCurrencies:h,getCurrencyById:i,refetch:l}}),pt={key:1,class:"skeleton tw-w-full"},vt=_("button",{class:"button light-gray !tw-w-full tw-h-full"},null,-1),ft=[vt],Pt=P({__name:"SelectWithCurrencies",props:{modelValue:{}},emits:["update:modelValue"],setup(d,{emit:t}){const e=le(d,"modelValue",t),{currencies:m,isFinished:c}=q(dt()),p=L(()=>m.value.map(i=>({id:i.id,value:i.name})));return(i,h)=>C(c)?(v(),R(Be,se({key:0,modelValue:C(e),"onUpdate:modelValue":h[0]||(h[0]=l=>ue(e)?e.value=l:null)},i.$attrs,{options:p.value,class:"tw-w-full"}),null,16,["modelValue","options"])):(v(),g("div",pt,ft))}}),mt=d=>(ke("data-v-d531999c"),d=d(),Fe(),d),ht={key:0,class:"skeleton"},_t={class:"dropdown-button-content"},wt={key:0,class:"tw-mr-1"},yt={key:0},gt=mt(()=>_("i",{class:"fas fa-caret-down"},null,-1)),$t=[gt],bt=P({__name:"DropDownButton",props:{width:{default:"13.5rem"},colorClass:{default:"light-gray"},rounded:{type:Boolean},isSkeleton:{type:Boolean},mobileWFull:{type:Boolean},disabled:{type:Boolean}},setup(d){const t=d;return(a,e)=>t.isSkeleton?(v(),g("div",ht,[_("button",{class:M(["button light-gray",{rounded:t.rounded,"mobile:!tw-w-full":t.mobileWFull}]),style:oe({width:t.width,height:"2.125rem"})},null,6)])):(v(),g("button",{key:1,class:M(["button dropdown-button",t.colorClass,{rounded:t.rounded,"mobile:!tw-w-full":t.mobileWFull,"tw-cursor-default":t.disabled}]),style:oe({width:t.width})},[_("div",_t,[a.$slots.icon?(v(),g("span",wt,[D(a.$slots,"icon",{},void 0,!0)])):W("",!0),_("span",{class:M(["tw-truncate tw-text-left",{"tw-opacity-50":t.disabled}])},[D(a.$slots,"title",{},void 0,!0)],2)]),t.disabled?W("",!0):(v(),g("div",yt,$t))],6))}});const At=O(bt,[["__scopeId","data-v-d531999c"]]),Ut=P({__name:"InputWithPerformers",props:{dealId:{default:0},excludeIds:{default:()=>[]},contact:{}},emits:["update"],setup(d,{emit:t}){var y,n;const a=d,e=w({id:a.contact.id,name:a.contact.name,userpic:a.contact.userpic,email:(n=(y=a.contact)==null?void 0:y.email)!=null&&n.length?a.contact.email[0].value:""}),m=w([]),c=Ne();c.setupProps(a.dealId,{id:e.value.id,name:e.value.name,userpic:e.value.userpic,fields:[{id:"email",value:e.value.email?[e.value.email]:[]}]});const{isFetching:p,$contacts:i}=q(c);r(),de(i,()=>r());const h=pe(async s=>{var $;!s||(($=e.value)==null?void 0:$.name)===s?r():m.value=[...i.value].filter(b=>b.name.toLocaleLowerCase().includes(s.toLocaleLowerCase()))},300),l=a.excludeIds.filter(s=>s!==a.contact.id).reduce((s,$)=>({...s,[$]:!0}),{}),o=L(()=>m.value.filter(s=>!l[s.id]).map(s=>{const $=s.fields.find(x=>x.id==="email"),b=s.fields.find(x=>x.id==="phone");return{id:s.id,name:s.name,userpic:s.userpic,email:$==null?void 0:$.value[0],phone:b==null?void 0:b.value[0]}}));function r(){m.value=[...i.value]}function u(s){e.value=s,t("update",{id:s.id,name:s.name,userpic:s.userpic})}return(s,$)=>(v(),R(he,{items:o.value,item:e.value,placeholder:s.$t("name"),"is-fetching":C(p),onInput:C(h),onUpdate:u,onCloseDropdown:r},Se({items:k(b=>[D(s.$slots,"items",se({isFetching:C(p),interseptionObserver:()=>null},b))]),_:2},[s.$slots.preview?{name:"preview",fn:k(b=>[D(s.$slots,"preview",ce(De(b)))]),key:"0"}:void 0]),1032,["items","item","placeholder","is-fetching","onInput"]))}});export{Vt as C,At as D,Rt as I,Mt as _,Ut as a,Pt as b,dt as u};
