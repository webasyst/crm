import{d as V,h as _,aZ as le,b4 as ie,Q as D,r as te,j as F,H as ce,l as H,S as M,U as re,o as p,i as U,w as A,a as s,c as y,e as ue,an as de,M as fe,aO as Y,ai as j,b5 as pe,Z as ve,ah as me,am as _e,k as X,v as G,u as I,a9 as K,s as ae,x as se,_ as ne,I as he,af as ye,b6 as be,aw as W,a3 as we,m as ge,F as q,q as Q,b as ke,A as ee,p as O,Y as Te,n as z}from"./main-46836c41.js";import{D as Ce}from"./DropdownModal-8fb9742c.js";import{u as $e}from"./useSortable-69b2c6e6.js";import{D as Se}from"./DropDown-2ad3ed01.js";import{b as Ie}from"./index-0f68ab4c.js";const lt=V({__name:"ComponentActivator",setup(m){const o=_(!1),a=le(ie()),c=D(a,v=>{v&&(o.value=!0,c())});return(v,l)=>o.value?te(v.$slots,"default",{key:0}):F("",!0)}}),xe=["onClick"],Ne={key:0},Ee=s("i",{class:"fas fa-spinner fa-spin"},null,-1),Re=[Ee],Ae={key:1},De=s("i",{class:"fas fa-plus"},null,-1),Be=[De],it=V({__name:"TabsAddEntityButton",props:{entityType:{},entityId:{},additionalActions:{}},setup(m,{expose:o}){const a=m,{t:c}=ce();let v=null;const l=_([]),h=_([]),w=H(()=>l.value.concat(h.value));D(()=>a.entityId,u=>{C(),v=u},{immediate:v!==a.entityId}),D(()=>a.additionalActions,u=>{u&&l.value.push(...u)},{deep:!0,immediate:!!a.additionalActions&&!!a.additionalActions.length});const r=_(!1),g=_(!1),b=_(!1);D([()=>a.entityType,()=>a.entityId],()=>{l.value=l.value.filter(u=>!("html"in u)),r.value=!1,g.value=!1,b.value=!1});function C(){h.value=[],l.value=[{label:c("addNote"),classIcon:"fas fa-sticky-note",clickHandler:()=>{M.replace({name:`${a.entityType}NotesTab`,query:{focus:"1"}})}},{label:c("addFile"),classIcon:"fas fa-paperclip",clickHandler:()=>{M.replace({name:`${a.entityType}FilesTab`}).then(()=>{re(de).emit()})}},{label:c("addReminder"),classIcon:"fas fa-check-circle",clickHandler:()=>{M.replace({name:`${a.entityType}RemindersTab`,query:{focus:"1"}})}},{label:c("addInvoice"),classIcon:"fas fa-file-invoice-dollar",clickHandler:()=>{M.replace({name:`${a.entityType}InvoicesTab`,query:{is_new:"1"}})}}]}function B(){if(!b.value&&a.entityType==="contact"){g.value=!0;const u=H(()=>`crm.contact.ui.actions?id=${a.entityId}`),{data:k,error:S}=fe(u,{immediate:!0}).get().json(),L=()=>{g.value=!1,b.value=!0,r.value=!0};Y(k,async T=>{if(T.plus_dropdown){const x=[];if(!(T!=null&&T.plus_dropdown))return;T.plus_dropdown.forEach(N=>{x.push({html:N})}),h.value.push(...x)}await j(),L()}),Y(S,()=>{L()})}}return o({callAction:u=>{const k=l.value.find(S=>"id"in S&&S.id===u);k&&"clickHandler"in k&&k.clickHandler()}}),(u,k)=>(p(),U(Ce,{key:`${a.entityType}_${a.entityId}`,items:w.value,"fallback-on-open":!0,"prevent-open":a.entityType==="contact",open:r.value},{default:A(()=>[s("button",{class:"button circle",onClick:ue(B,["prevent"])},[g.value?(p(),y("span",Ne,Re)):(p(),y("span",Ae,Be))],8,xe)]),_:1},8,["items","prevent-open","open"]))}}),oe=m=>(ae("data-v-8af80abb"),m=m(),se(),m),Le={class:"tw-sticky tw-left-0 tw-z-10"},Oe=oe(()=>s("span",{class:"icon size-16"},[s("i",{class:"fas fa-chevron-left"})],-1)),He=[Oe],Me=oe(()=>s("span",{class:"icon size-16"},[s("i",{class:"fas fa-chevron-left"})],-1)),ze=[Me],Fe=V({__name:"HorizontalScrollContainer",props:{step:{default:90},fadeColor:{default:"var(--background-color-blank)"}},setup(m){const o=m;pe(w=>({ba883736:w.fadeColor}));const a=_(null),c=_(!1),v=_(0),{x:l,arrivedState:h}=ve(a,{behavior:"smooth"});return me(a,w=>{const r=w[0];v.value=r.target.clientHeight,c.value=r.target.scrollWidth>r.target.clientWidth}),_e(()=>{a.value&&(v.value=a.value.clientHeight,c.value=a.value.scrollWidth>a.value.clientWidth)}),D(c,()=>{h.right=!1}),(w,r)=>(p(),y("div",{ref_key:"scrollableRef",ref:a,class:"tw-relative tw-overflow-x-scroll tw-scrollbar-hide"},[s("div",Le,[X(s("div",{class:"arr -tw-left-2",style:K({height:`${v.value}px`}),onClick:r[0]||(r[0]=g=>l.value-=o.step)},He,4),[[G,c.value&&I(l)>0]]),X(s("div",{class:"arr tw-right-0 tw-rotate-180",style:K({height:`${v.value}px`}),onClick:r[1]||(r[1]=g=>l.value+=o.step)},ze,4),[[G,c.value&&!I(h).right]])]),te(w.$slots,"default")],512))}});const Ue=ne(Fe,[["__scopeId","data-v-8af80abb"]]),J=m=>(ae("data-v-331aa62f"),m=m(),se(),m),Ve=J(()=>s("div",{class:"skeleton-line"},null,-1)),We=[Ve],qe=["data-id"],Qe=["href","onClick"],Ye={key:0,class:"count"},je={key:0,class:"nowrap tw-ml-1 tw-py-3"},Je=J(()=>s("span",{class:"icon size-16 text-light-gray"},[s("i",{class:"fas fa-chevron-down"})],-1)),Ze=["data-id"],Pe=["href","onClick"],Xe=["title"],Ge={key:0,class:"count tw-flex-none"},Ke=J(()=>s("canvas",{id:"tabs-canvas",class:"hidden"},null,-1)),et=V({__name:"TabList",props:{entityType:{},value:{},isFetching:{type:Boolean},fadeColor:{}},setup(m){const o=m,a=he(Ie),c=_(null),v=_(null),l=_(null),h=_(null),{width:w}=ye(h),{tabsOrder:r,tabsOrderMap:g}=be(o.entityType),b=_(new Map),C=H(()=>[...o.value].sort((e,d)=>g.value[e.routeName]-g.value[d.routeName])),B=H(()=>C.value.filter(e=>b.value.get(e.routeName))),u=H(()=>b.value.size>0?C.value.filter(e=>!b.value.get(e.routeName)):[]),k=()=>{for(const e of C.value)b.value.set(e.routeName,!0)},S=(e,d)=>{const f=document.getElementById("tabs-canvas");if(f){const t=f.getContext("2d");if(t)return t.font=d,t.measureText(e).width}return 0},L=e=>{const f="1rem sans-serif",t="0.75em sans-serif";let i=0;for(let n=0;n<e.length;n++)i+=24,i+=S(e[n].name,f),e[n].count&&(i+=S(String(e[n].count),t));return i-24};async function T(e=!1){if(!h.value)return;const d=[...C.value],f=()=>{var n;let i=l.value?80:0;return v.value&&(i=v.value.offsetWidth+20),e&&((n=l.value)==null?void 0:n.children.length)===1?0:i},t=f();if(!(L(d)<h.value.clientWidth-t))for(let i=0;i<C.value.length;i++){const n=d.pop();if(b.value.set(n==null?void 0:n.routeName,!1),await j(),L(d)<h.value.clientWidth-(e?t:f()))break}}D(()=>o.value,()=>{if(!o.value.length)return;Y(()=>o.isFetching,async()=>{r.value.length||o.value.forEach(d=>{r.value.push(d.routeName)}),k(),await j(),T()},{immediate:!o.isFetching})},{immediate:!!o.value,deep:!0});let x,N;W(B,e=>{c.value&&e.length&&(x=Z(c.value,e))},{immediate:!0,debounce:250}),W(u,e=>{l.value&&e.length&&(N=Z(l.value,e))},{immediate:!0,debounce:250}),W(w,(e,d)=>{e>d&&N&&k(),T(e>d)},{debounce:200}),we(()=>{x&&x.stop(),N&&N.stop()});function Z(e,d){return $e(e,d,{handle:".handle",group:"tabs",animation:150,forceFallback:!0,fallbackOnBody:!0,fallbackTolerance:5,delay:150,delayOnTouchOnly:!0,onStart:()=>{document.querySelectorAll("iframe").forEach(f=>{f.classList.add("tw-pointer-events-none")})},onEnd:f=>{var E,R;document.querySelectorAll("iframe").forEach($=>{$.classList.remove("tw-pointer-events-none")});const{id:t}=f.item.dataset;typeof t=="string"&&(f.to.classList.contains("tabs-dropdown-list")?b.value.set(t,!1):f.to.classList.contains("tabs-main-list")&&b.value.set(t,!0));const i=[...((E=c.value)==null?void 0:E.children)||[],...((R=l.value)==null?void 0:R.children)||[]].map($=>$.dataset.id),n=[...r.value];for(let $=0;$<n.length;$++){const P=n[$];i.includes(P)||i.splice($,0,P)}r.value=i,setTimeout(T)}})}return(e,d)=>{const f=ge("router-link");return p(),y("div",{ref_key:"tabsListRef",ref:h,class:"tabs-list tw-flex-auto tw-overflow-hidden tw-mx-2"},[(p(),U(Te(I(a)?Ue:"div"),{"fade-color":o.fadeColor||"var(--background-color)",class:"tw-select-none md:tw-flex"},{default:A(()=>[(p(),y("ul",{key:JSON.stringify(B.value),ref_key:"mainUlRef",ref:c,class:"tabs tabs-main-list overflow-arrows tw-flex-none"},[o.isFetching?(p(),y(q,{key:0},Q(7,t=>s("li",{key:t,class:"skeleton tw-w-16"},We)),64)):(p(!0),y(q,{key:1},Q(I(a)?C.value:B.value,t=>(p(),U(f,{key:t.routeName,to:{name:t.routeName},replace:"",custom:""},{default:A(({isActive:i,href:n,navigate:E})=>[s("li",{class:z([{selected:i,handle:!I(a)},"tab-item"]),"data-id":t.routeName},[s("a",{href:n,class:z(e.$constant.parentAppDisableRouterClass),onClick:R=>E(R).then(()=>typeof t.onClick=="function"?t.onClick():null)},[s("span",null,[ee(O(t.name)+" ",1),t.count?(p(),y("span",Ye,O(t.count),1)):F("",!0)])],10,Qe)],10,qe)]),_:2},1032,["to"]))),128))])),!I(a)&&u.value.length?(p(),y("div",je,[ke(Se,{"fallback-on-open":!0,hover:!0,"strategy-fixed":!0},{body:A(()=>[(p(),y("ul",{key:JSON.stringify(u.value),ref_key:"dropdownUlRef",ref:l,class:"menu tabs-dropdown-list"},[(p(!0),y(q,null,Q(u.value,t=>(p(),U(f,{key:t.routeName,to:{name:t.routeName},replace:"",custom:""},{default:A(({isActive:i,href:n,navigate:E})=>[s("li",{class:z([{selected:i,handle:!I(a)},"tab-item"]),"data-id":t.routeName},[s("a",{href:n,class:z([e.$constant.parentAppDisableRouterClass,"!tw-py-3"]),onClick:R=>E(R).then(()=>typeof t.onClick=="function"?t.onClick():null)},[s("span",{title:t.name,class:"tw-truncate"},O(t.name),9,Xe),t.count?(p(),y("span",Ge,O(t.count),1)):F("",!0)],10,Pe)],10,Ze)]),_:2},1032,["to"]))),128))]))]),default:A(()=>[s("button",{ref_key:"dropdownButtonRef",ref:v,class:"button light-gray transparent rounded custom-px-4"},[Je,ee(" "+O(e.$t("more")),1)],512)]),_:1})])):F("",!0),Ke]),_:1},8,["fade-color"]))],512)}}});const ct=ne(et,[["__scopeId","data-v-331aa62f"]]);export{ct as T,it as _,lt as a};
