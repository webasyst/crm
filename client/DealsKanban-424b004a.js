import{aX as is,d as ne,l as xt,o as m,c as I,a as u,b as ct,n as M,r as Ne,j as ut,F as ie,q as Pe,p as Et,i as Oe,k as Vt,u as N,a9 as ns,aY as rs,az as as,t as os,h as gt,$ as ls,aj as cs,ao as us,aZ as hs,v as we,e as ee,w as se,aR as fs,ab as Wt,a_ as ds,ax as vs,ak as ps,G as ms}from"./main-2290994d.js";import{_ as _s,c as Ts,b as gs,d as Es,a as ys}from"./DealsItemResponsible.vue_vue_type_style_index_0_lang-03e36101.js";import{W as Is}from"./WaSpinner-299938a2.js";import{v as Cs}from"./index-0b6b9def.js";import{i as ws}from"./currency-format-433ea0a4.js";import{v as Ss}from"./vTooltip-95186f83.js";import{u as Ns}from"./dealFields-e5577c1a.js";import{u as Ps}from"./dealStageChanger-141c6214.js";import{_ as Os}from"./SortableList.vue_vue_type_script_setup_true_lang-c14f94b7.js";import"./ChipsList-0fe31c28.js";import"./UserPic-f44f080b.js";import"./index-6e4a059f.js";import"./dayjs-910ec40d.js";import"./emit-692c947e.js";import"./alert-f02e40a8.js";import"./ButtonSubmit-4410c58d.js";import"./FieldSelect-bea6b277.js";import"./useSortable-a183a608.js";var be={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(st){(function(a,W,ht,c){var R=["","webkit","Moz","MS","ms","o"],_=W.createElement("div"),U="function",P=Math.round,x=Math.abs,yt=Date.now;function ft(t,e,s){return setTimeout(nt(t,s),e)}function V(t,e,s){return Array.isArray(t)?(L(t,s[e],s),!0):!1}function L(t,e,s){var i;if(t)if(t.forEach)t.forEach(e,s);else if(t.length!==c)for(i=0;i<t.length;)e.call(s,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(s,t[i],i,t)}function it(t,e,s){var i="DEPRECATED METHOD: "+e+`
`+s+` AT 
`;return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=a.console&&(a.console.warn||a.console.log);return o&&o.call(a.console,i,r),t.apply(this,arguments)}}var O;typeof Object.assign!="function"?O=function(e){if(e===c||e===null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==c&&n!==null)for(var r in n)n.hasOwnProperty(r)&&(s[r]=n[r])}return s}:O=Object.assign;var dt=it(function(e,s,i){for(var n=Object.keys(s),r=0;r<n.length;)(!i||i&&e[n[r]]===c)&&(e[n[r]]=s[n[r]]),r++;return e},"extend","Use `assign`."),vt=it(function(e,s){return dt(e,s,!0)},"merge","Use `assign`.");function C(t,e,s){var i=e.prototype,n;n=t.prototype=Object.create(i),n.constructor=t,n._super=i,s&&O(n,s)}function nt(t,e){return function(){return t.apply(e,arguments)}}function rt(t,e){return typeof t==U?t.apply(e&&e[0]||c,e):t}function j(t,e){return t===c?e:t}function J(t,e,s){L(at(e),function(i){t.addEventListener(i,s,!1)})}function q(t,e,s){L(at(e),function(i){t.removeEventListener(i,s,!1)})}function $(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function w(t,e){return t.indexOf(e)>-1}function at(t){return t.trim().split(/\s+/g)}function F(t,e,s){if(t.indexOf&&!s)return t.indexOf(e);for(var i=0;i<t.length;){if(s&&t[i][s]==e||!s&&t[i]===e)return i;i++}return-1}function pt(t){return Array.prototype.slice.call(t,0)}function It(t,e,s){for(var i=[],n=[],r=0;r<t.length;){var o=e?t[r][e]:t[r];F(n,o)<0&&i.push(t[r]),n[r]=o,r++}return s&&(e?i=i.sort(function(E,S){return E[e]>S[e]}):i=i.sort()),i}function l(t,e){for(var s,i,n=e[0].toUpperCase()+e.slice(1),r=0;r<R.length;){if(s=R[r],i=s?s+n:e,i in t)return i;r++}return c}var d=1;function T(){return d++}function b(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||a}var f=/mobile|tablet|ip(ad|hone|od)|android/i,v="ontouchstart"in a,Q=l(a,"PointerEvent")!==c,Ct=v&&f.test(navigator.userAgent),tt="touch",wt="pen",mt="mouse",qt="kinect",_t=25,g=1,z=2,h=4,y=8,G=1,St=2,Nt=4,Pt=8,Ot=16,H=St|Nt,ot=Pt|Ot,re=H|ot,ae=["x","y"],Lt=["clientX","clientY"];function A(t,e){var s=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(i){rt(t.options.enable,[t])&&s.handler(i)},this.init()}A.prototype={handler:function(){},init:function(){this.evEl&&J(this.element,this.evEl,this.domHandler),this.evTarget&&J(this.target,this.evTarget,this.domHandler),this.evWin&&J(b(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&q(this.element,this.evEl,this.domHandler),this.evTarget&&q(this.target,this.evTarget,this.domHandler),this.evWin&&q(b(this.element),this.evWin,this.domHandler)}};function Ae(t){var e,s=t.options.inputClass;return s?e=s:Q?e=zt:Ct?e=Rt:v?e=Gt:e=Mt,new e(t,De)}function De(t,e,s){var i=s.pointers.length,n=s.changedPointers.length,r=e&g&&i-n===0,o=e&(h|y)&&i-n===0;s.isFirst=!!r,s.isFinal=!!o,r&&(t.session={}),s.eventType=e,xe(t,s),t.emit("hammer.input",s),t.recognize(s),t.session.prevInput=s}function xe(t,e){var s=t.session,i=e.pointers,n=i.length;s.firstInput||(s.firstInput=oe(e)),n>1&&!s.firstMultiple?s.firstMultiple=oe(e):n===1&&(s.firstMultiple=!1);var r=s.firstInput,o=s.firstMultiple,p=o?o.center:r.center,E=e.center=le(i);e.timeStamp=yt(),e.deltaTime=e.timeStamp-r.timeStamp,e.angle=$t(p,E),e.distance=kt(p,E),Le(s,e),e.offsetDirection=ue(e.deltaX,e.deltaY);var S=ce(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=S.x,e.overallVelocityY=S.y,e.overallVelocity=x(S.x)>x(S.y)?S.x:S.y,e.scale=o?Re(o.pointers,i):1,e.rotation=o?Me(o.pointers,i):0,e.maxPointers=s.prevInput?e.pointers.length>s.prevInput.maxPointers?e.pointers.length:s.prevInput.maxPointers:e.pointers.length,ke(s,e);var X=t.element;$(e.srcEvent.target,X)&&(X=e.srcEvent.target),e.target=X}function Le(t,e){var s=e.center,i=t.offsetDelta||{},n=t.prevDelta||{},r=t.prevInput||{};(e.eventType===g||r.eventType===h)&&(n=t.prevDelta={x:r.deltaX||0,y:r.deltaY||0},i=t.offsetDelta={x:s.x,y:s.y}),e.deltaX=n.x+(s.x-i.x),e.deltaY=n.y+(s.y-i.y)}function ke(t,e){var s=t.lastInterval||e,i=e.timeStamp-s.timeStamp,n,r,o,p;if(e.eventType!=y&&(i>_t||s.velocity===c)){var E=e.deltaX-s.deltaX,S=e.deltaY-s.deltaY,X=ce(i,E,S);r=X.x,o=X.y,n=x(X.x)>x(X.y)?X.x:X.y,p=ue(E,S),t.lastInterval=e}else n=s.velocity,r=s.velocityX,o=s.velocityY,p=s.direction;e.velocity=n,e.velocityX=r,e.velocityY=o,e.direction=p}function oe(t){for(var e=[],s=0;s<t.pointers.length;)e[s]={clientX:P(t.pointers[s].clientX),clientY:P(t.pointers[s].clientY)},s++;return{timeStamp:yt(),pointers:e,center:le(e),deltaX:t.deltaX,deltaY:t.deltaY}}function le(t){var e=t.length;if(e===1)return{x:P(t[0].clientX),y:P(t[0].clientY)};for(var s=0,i=0,n=0;n<e;)s+=t[n].clientX,i+=t[n].clientY,n++;return{x:P(s/e),y:P(i/e)}}function ce(t,e,s){return{x:e/t||0,y:s/t||0}}function ue(t,e){return t===e?G:x(t)>=x(e)?t<0?St:Nt:e<0?Pt:Ot}function kt(t,e,s){s||(s=ae);var i=e[s[0]]-t[s[0]],n=e[s[1]]-t[s[1]];return Math.sqrt(i*i+n*n)}function $t(t,e,s){s||(s=ae);var i=e[s[0]]-t[s[0]],n=e[s[1]]-t[s[1]];return Math.atan2(n,i)*180/Math.PI}function Me(t,e){return $t(e[1],e[0],Lt)+$t(t[1],t[0],Lt)}function Re(t,e){return kt(e[0],e[1],Lt)/kt(t[0],t[1],Lt)}var Ue={mousedown:g,mousemove:z,mouseup:h},Fe="mousedown",He="mousemove mouseup";function Mt(){this.evEl=Fe,this.evWin=He,this.pressed=!1,A.apply(this,arguments)}C(Mt,A,{handler:function(e){var s=Ue[e.type];s&g&&e.button===0&&(this.pressed=!0),s&z&&e.which!==1&&(s=h),this.pressed&&(s&h&&(this.pressed=!1),this.callback(this.manager,s,{pointers:[e],changedPointers:[e],pointerType:mt,srcEvent:e}))}});var Ye={pointerdown:g,pointermove:z,pointerup:h,pointercancel:y,pointerout:y},Xe={2:tt,3:wt,4:mt,5:qt},he="pointerdown",fe="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(he="MSPointerDown",fe="MSPointerMove MSPointerUp MSPointerCancel");function zt(){this.evEl=he,this.evWin=fe,A.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}C(zt,A,{handler:function(e){var s=this.store,i=!1,n=e.type.toLowerCase().replace("ms",""),r=Ye[n],o=Xe[e.pointerType]||e.pointerType,p=o==tt,E=F(s,e.pointerId,"pointerId");r&g&&(e.button===0||p)?E<0&&(s.push(e),E=s.length-1):r&(h|y)&&(i=!0),!(E<0)&&(s[E]=e,this.callback(this.manager,r,{pointers:s,changedPointers:[e],pointerType:o,srcEvent:e}),i&&s.splice(E,1))}});var We={touchstart:g,touchmove:z,touchend:h,touchcancel:y},Ve="touchstart",qe="touchstart touchmove touchend touchcancel";function de(){this.evTarget=Ve,this.evWin=qe,this.started=!1,A.apply(this,arguments)}C(de,A,{handler:function(e){var s=We[e.type];if(s===g&&(this.started=!0),!!this.started){var i=$e.call(this,e,s);s&(h|y)&&i[0].length-i[1].length===0&&(this.started=!1),this.callback(this.manager,s,{pointers:i[0],changedPointers:i[1],pointerType:tt,srcEvent:e})}}});function $e(t,e){var s=pt(t.touches),i=pt(t.changedTouches);return e&(h|y)&&(s=It(s.concat(i),"identifier",!0)),[s,i]}var ze={touchstart:g,touchmove:z,touchend:h,touchcancel:y},Ge="touchstart touchmove touchend touchcancel";function Rt(){this.evTarget=Ge,this.targetIds={},A.apply(this,arguments)}C(Rt,A,{handler:function(e){var s=ze[e.type],i=Be.call(this,e,s);i&&this.callback(this.manager,s,{pointers:i[0],changedPointers:i[1],pointerType:tt,srcEvent:e})}});function Be(t,e){var s=pt(t.touches),i=this.targetIds;if(e&(g|z)&&s.length===1)return i[s[0].identifier]=!0,[s,s];var n,r,o=pt(t.changedTouches),p=[],E=this.target;if(r=s.filter(function(S){return $(S.target,E)}),e===g)for(n=0;n<r.length;)i[r[n].identifier]=!0,n++;for(n=0;n<o.length;)i[o[n].identifier]&&p.push(o[n]),e&(h|y)&&delete i[o[n].identifier],n++;if(p.length)return[It(r.concat(p),"identifier",!0),p]}var Ke=2500,ve=25;function Gt(){A.apply(this,arguments);var t=nt(this.handler,this);this.touch=new Rt(this.manager,t),this.mouse=new Mt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}C(Gt,A,{handler:function(e,s,i){var n=i.pointerType==tt,r=i.pointerType==mt;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)Ze.call(this,s,i);else if(r&&je.call(this,i))return;this.callback(e,s,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ze(t,e){t&g?(this.primaryTouch=e.changedPointers[0].identifier,pe.call(this,e)):t&(h|y)&&pe.call(this,e)}function pe(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var s={x:e.clientX,y:e.clientY};this.lastTouches.push(s);var i=this.lastTouches,n=function(){var r=i.indexOf(s);r>-1&&i.splice(r,1)};setTimeout(n,Ke)}}function je(t){for(var e=t.srcEvent.clientX,s=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var n=this.lastTouches[i],r=Math.abs(e-n.x),o=Math.abs(s-n.y);if(r<=ve&&o<=ve)return!0}return!1}var me=l(_.style,"touchAction"),_e=me!==c,Te="compute",ge="auto",Bt="manipulation",lt="none",bt="pan-x",At="pan-y",Ut=Qe();function Kt(t,e){this.manager=t,this.set(e)}Kt.prototype={set:function(t){t==Te&&(t=this.compute()),_e&&this.manager.element.style&&Ut[t]&&(this.manager.element.style[me]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return L(this.manager.recognizers,function(e){rt(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),Je(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,s=t.offsetDirection;if(this.manager.session.prevented){e.preventDefault();return}var i=this.actions,n=w(i,lt)&&!Ut[lt],r=w(i,At)&&!Ut[At],o=w(i,bt)&&!Ut[bt];if(n){var p=t.pointers.length===1,E=t.distance<2,S=t.deltaTime<250;if(p&&E&&S)return}if(!(o&&r)&&(n||r&&s&H||o&&s&ot))return this.preventSrc(e)},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};function Je(t){if(w(t,lt))return lt;var e=w(t,bt),s=w(t,At);return e&&s?lt:e||s?e?bt:At:w(t,Bt)?Bt:ge}function Qe(){if(!_e)return!1;var t={},e=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(s){t[s]=e?a.CSS.supports("touch-action",s):!0}),t}var Ft=1,D=2,Tt=4,et=8,B=et,Dt=16,Y=32;function K(t){this.options=O({},this.defaults,t||{}),this.id=T(),this.manager=null,this.options.enable=j(this.options.enable,!0),this.state=Ft,this.simultaneous={},this.requireFail=[]}K.prototype={defaults:{},set:function(t){return O(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(V(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=Ht(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return V(t,"dropRecognizeWith",this)?this:(t=Ht(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(V(t,"requireFailure",this))return this;var e=this.requireFail;return t=Ht(t,this),F(e,t)===-1&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(V(t,"dropRequireFailure",this))return this;t=Ht(t,this);var e=F(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,s=this.state;function i(n){e.manager.emit(n,t)}s<et&&i(e.options.event+Ee(s)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),s>=et&&i(e.options.event+Ee(s))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Y},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Y|Ft)))return!1;t++}return!0},recognize:function(t){var e=O({},t);if(!rt(this.options.enable,[this,e])){this.reset(),this.state=Y;return}this.state&(B|Dt|Y)&&(this.state=Ft),this.state=this.process(e),this.state&(D|Tt|et|Dt)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}};function Ee(t){return t&Dt?"cancel":t&et?"end":t&Tt?"move":t&D?"start":""}function ye(t){return t==Ot?"down":t==Pt?"up":t==St?"left":t==Nt?"right":""}function Ht(t,e){var s=e.manager;return s?s.get(t):t}function k(){K.apply(this,arguments)}C(k,K,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return e===0||t.pointers.length===e},process:function(t){var e=this.state,s=t.eventType,i=e&(D|Tt),n=this.attrTest(t);return i&&(s&y||!n)?e|Dt:i||n?s&h?e|et:e&D?e|Tt:D:Y}});function Yt(){k.apply(this,arguments),this.pX=null,this.pY=null}C(Yt,k,{defaults:{event:"pan",threshold:10,pointers:1,direction:re},getTouchAction:function(){var t=this.options.direction,e=[];return t&H&&e.push(At),t&ot&&e.push(bt),e},directionTest:function(t){var e=this.options,s=!0,i=t.distance,n=t.direction,r=t.deltaX,o=t.deltaY;return n&e.direction||(e.direction&H?(n=r===0?G:r<0?St:Nt,s=r!=this.pX,i=Math.abs(t.deltaX)):(n=o===0?G:o<0?Pt:Ot,s=o!=this.pY,i=Math.abs(t.deltaY))),t.direction=n,s&&i>e.threshold&&n&e.direction},attrTest:function(t){return k.prototype.attrTest.call(this,t)&&(this.state&D||!(this.state&D)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=ye(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}});function Zt(){k.apply(this,arguments)}C(Zt,k,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[lt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&D)},emit:function(t){if(t.scale!==1){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}});function jt(){K.apply(this,arguments),this._timer=null,this._input=null}C(jt,K,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ge]},process:function(t){var e=this.options,s=t.pointers.length===e.pointers,i=t.distance<e.threshold,n=t.deltaTime>e.time;if(this._input=t,!i||!s||t.eventType&(h|y)&&!n)this.reset();else if(t.eventType&g)this.reset(),this._timer=ft(function(){this.state=B,this.tryEmit()},e.time,this);else if(t.eventType&h)return B;return Y},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===B&&(t&&t.eventType&h?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=yt(),this.manager.emit(this.options.event,this._input)))}});function Jt(){k.apply(this,arguments)}C(Jt,k,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[lt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&D)}});function Qt(){k.apply(this,arguments)}C(Qt,k,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:H|ot,pointers:1},getTouchAction:function(){return Yt.prototype.getTouchAction.call(this)},attrTest:function(t){var e=this.options.direction,s;return e&(H|ot)?s=t.overallVelocity:e&H?s=t.overallVelocityX:e&ot&&(s=t.overallVelocityY),this._super.attrTest.call(this,t)&&e&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&x(s)>this.options.velocity&&t.eventType&h},emit:function(t){var e=ye(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}});function Xt(){K.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}C(Xt,K,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Bt]},process:function(t){var e=this.options,s=t.pointers.length===e.pointers,i=t.distance<e.threshold,n=t.deltaTime<e.time;if(this.reset(),t.eventType&g&&this.count===0)return this.failTimeout();if(i&&n&&s){if(t.eventType!=h)return this.failTimeout();var r=this.pTime?t.timeStamp-this.pTime<e.interval:!0,o=!this.pCenter||kt(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,!o||!r?this.count=1:this.count+=1,this._input=t;var p=this.count%e.taps;if(p===0)return this.hasRequireFailures()?(this._timer=ft(function(){this.state=B,this.tryEmit()},e.interval,this),D):B}return Y},failTimeout:function(){return this._timer=ft(function(){this.state=Y},this.options.interval,this),Y},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==B&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Z(t,e){return e=e||{},e.recognizers=j(e.recognizers,Z.defaults.preset),new te(t,e)}Z.VERSION="2.0.7",Z.defaults={domEvents:!1,touchAction:Te,enable:!0,inputTarget:null,inputClass:null,preset:[[Jt,{enable:!1}],[Zt,{enable:!1},["rotate"]],[Qt,{direction:H}],[Yt,{direction:H},["swipe"]],[Xt],[Xt,{event:"doubletap",taps:2},["tap"]],[jt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ts=1,Ie=2;function te(t,e){this.options=O({},Z.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=Ae(this),this.touchAction=new Kt(this,this.options.touchAction),Ce(this,!0),L(this.options.recognizers,function(s){var i=this.add(new s[0](s[1]));s[2]&&i.recognizeWith(s[2]),s[3]&&i.requireFailure(s[3])},this)}te.prototype={set:function(t){return O(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?Ie:ts},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var s,i=this.recognizers,n=e.curRecognizer;(!n||n&&n.state&B)&&(n=e.curRecognizer=null);for(var r=0;r<i.length;)s=i[r],e.stopped!==Ie&&(!n||s==n||s.canRecognizeWith(n))?s.recognize(t):s.reset(),!n&&s.state&(D|Tt|et)&&(n=e.curRecognizer=s),r++}},get:function(t){if(t instanceof K)return t;for(var e=this.recognizers,s=0;s<e.length;s++)if(e[s].options.event==t)return e[s];return null},add:function(t){if(V(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(V(t,"remove",this))return this;if(t=this.get(t),t){var e=this.recognizers,s=F(e,t);s!==-1&&(e.splice(s,1),this.touchAction.update())}return this},on:function(t,e){if(t!==c&&e!==c){var s=this.handlers;return L(at(t),function(i){s[i]=s[i]||[],s[i].push(e)}),this}},off:function(t,e){if(t!==c){var s=this.handlers;return L(at(t),function(i){e?s[i]&&s[i].splice(F(s[i],e),1):delete s[i]}),this}},emit:function(t,e){this.options.domEvents&&es(t,e);var s=this.handlers[t]&&this.handlers[t].slice();if(!(!s||!s.length)){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<s.length;)s[i](e),i++}},destroy:function(){this.element&&Ce(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ce(t,e){var s=t.element;if(s.style){var i;L(t.options.cssProps,function(n,r){i=l(s.style,r),e?(t.oldCssProps[i]=s.style[i],s.style[i]=n):s.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={})}}function es(t,e){var s=W.createEvent("Event");s.initEvent(t,!0,!0),s.gesture=e,e.target.dispatchEvent(s)}O(Z,{INPUT_START:g,INPUT_MOVE:z,INPUT_END:h,INPUT_CANCEL:y,STATE_POSSIBLE:Ft,STATE_BEGAN:D,STATE_CHANGED:Tt,STATE_ENDED:et,STATE_RECOGNIZED:B,STATE_CANCELLED:Dt,STATE_FAILED:Y,DIRECTION_NONE:G,DIRECTION_LEFT:St,DIRECTION_RIGHT:Nt,DIRECTION_UP:Pt,DIRECTION_DOWN:Ot,DIRECTION_HORIZONTAL:H,DIRECTION_VERTICAL:ot,DIRECTION_ALL:re,Manager:te,Input:A,TouchAction:Kt,TouchInput:Rt,MouseInput:Mt,PointerEventInput:zt,TouchMouseInput:Gt,SingleTouchInput:de,Recognizer:K,AttrRecognizer:k,Tap:Xt,Pan:Yt,Swipe:Qt,Pinch:Zt,Rotate:Jt,Press:jt,on:J,off:q,each:L,merge:vt,extend:dt,assign:O,inherit:C,bindFn:nt,prefixed:l});var ss=typeof a<"u"?a:typeof self<"u"?self:{};ss.Hammer=Z,typeof c=="function"&&c.amd?c(function(){return Z}):st.exports?st.exports=Z:a[ht]=Z})(window,document,"Hammer")})(be);var bs=be.exports;const As=is(bs),Ds={class:"list-item small"},xs={class:"list-item__top"},Ls={key:0,class:"list-item__row"},ks={key:0,class:"list-item__row list-item__custom"},Ms={class:"tw-flex-1 gray"},Rs={class:"tw-flex-1 break-word"},Us={key:1,class:"list-item__row list-item__custom"},Fs=u("div",{class:"tw-flex-1 gray"}," ID ",-1),Hs={class:"tw-flex-1"},Ys={key:2,class:"list-item__row"},Xs={key:3,class:"list-item__row"},Ws=ne({__name:"DealsKanbanListItem",props:{deal:{},useColumnsIds:{},useColumnsLabels:{},isSelected:{type:Boolean},isFetchingDrop:{type:Boolean},disableInteractions:{type:Boolean}},setup(st){const a=st,W=["user","last_action"],ht=xt(()=>a.useColumnsIds.filter(c=>!W.includes(c)).map(c=>{var _,U;const R=(U=(_=a.deal)==null?void 0:_.fields)==null?void 0:U.find(P=>P.id===c);return{id:c,name:a.useColumnsLabels[c],value:(R==null?void 0:R.value)||null}}));return(c,R)=>(m(),I("div",{class:M(["list-item__wrapper",{"is-overlay":a.isFetchingDrop}])},[u("div",Ds,[u("div",xs,[ct(_s,{deal:a.deal,"use-link":!0,class:M(["tw-w-0 tw-flex-auto",{"tw-pointer-events-none":a.disableInteractions}])},null,8,["deal","class"]),u("div",{class:M(["list-item__checkbox",{"!tw-opacity-100":a.isSelected}])},[Ne(c.$slots,"checkbox")],2)]),a.deal.contact?(m(),I("div",Ls,[ct(Ts,{user:a.deal.contact,class:"tw-flex-auto tw-w-0"},null,8,["user"])])):ut("",!0),(m(!0),I(ie,null,Pe(ht.value,_=>{var U,P;return m(),I(ie,{key:_.id},[!["tags","amount","id"].includes(_.id)&&(_.value||_.value===0)?(m(),I("div",ks,[u("div",Ms,Et(_.name),1),u("div",Rs,Et(_.value),1)])):_.id==="id"?(m(),I("div",Us,[Fs,u("div",Hs,Et(a.deal.id),1)])):_.id==="amount"&&(a.deal.original_amount||a.deal.amount)?(m(),I("div",Ys,[ct(gs,{deal:a.deal},null,8,["deal"])])):_.id==="tags"?(m(),I("div",Xs,[u("div",{class:M(["tw-grid tw-grid-flow-col tw-gap-2 tw-w-full",{"tw-w-full":(P=(U=a.deal)==null?void 0:U.tags)==null?void 0:P.length}])},[ct(Es,{tags:a.deal.tags},null,8,["tags"])],2)])):ut("",!0)],64)}),128)),ct(ys,{class:"tw-absolute tw-bottom-3 tw-right-3",deal:a.deal},null,8,["deal"])]),a.isFetchingDrop?(m(),Oe(Is,{key:0,class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2"})):ut("",!0)],2))}});const Vs={class:"deals-kanban__list-header-wrapper"},qs={class:"deals-kanban__list-header"},$s={class:"deals-kanban__list-header__name"},zs={class:"deals-kanban__list-header__count"},Gs={key:0,class:"hint tw-mt-0.5"},Bs={class:"deals-kanban__list-items hide-scrollbar"},Ks={key:0,class:"tw-absolute tw-left-1/2 tw-top-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2"},Zs=u("div",{class:"spinner tw-p-5"},null,-1),js=[Zs],Js={key:1,class:"tw-w-full tw-text-center tw-py-4 tw-flex-none"},Qs=u("div",{class:"spinner tw-p-5"},null,-1),ti=[Qs],ei=ne({__name:"DealsKanbanList",props:{column:{}},setup(st){const a=st;return(W,ht)=>(m(),I("div",{class:M(["deals-kanban__list",{"is-overlay":!a.column.isLazyLoad&&a.column.isFetching}])},[u("div",Vs,[u("div",qs,[Vt((m(),I("h3",$s,[u("span",{class:"badge",style:ns({background:a.column.stage.color})},Et(a.column.stage.name),5)])),[[N(Ss),a.column.stage.name,void 0,{"top-start":!0,500:!0}]]),u("div",zs,Et(a.column.stage.deal_count),1)]),a.column.stage.currency_id&&typeof a.column.stage.deal_total_amount=="number"?(m(),I("div",Gs,Et(N(ws)(a.column.stage.currency_id,a.column.stage.deal_total_amount)),1)):ut("",!0)]),u("div",Bs,[Ne(W.$slots,"listItem",{deals:a.column.deals}),!a.column.isLazyLoad&&a.column.isFetching?(m(),I("div",Ks,js)):ut("",!0),a.column.hasMoreDeals?Vt((m(),I("div",Js,ti)),[[N(Cs),([{isIntersecting:c}])=>{c&&a.column.fetchNextPage()}]]):ut("",!0)])],2))}});const si={class:"deals-kanban__wrapper"},ii=u("i",{class:"fas fa-chevron-left"},null,-1),ni=[ii],ri=u("i",{class:"fas fa-chevron-right"},null,-1),ai=[ri],oi=["onClick"],li=["checked"],ci=u("span",{class:"!tw-h-[1rem] !tw-w-[1rem]"},[u("span",{class:"icon"},[u("i",{class:"fas fa-check"})])],-1),ui={key:0,class:"tw-h-full tw-w-full tw-flex tw-items-center"},hi=u("div",{class:"spinner tw-p-10 tw-mx-auto"},null,-1),fi=[hi],Se="deals-kanban__list",Di=ne({__name:"DealsKanban",setup(st){const a=`.${Se}`,W=rs(),ht=as(),c=Ns(),{bulkSelectToggle:R,findColumnByStageId:_}=W,{columnsDeals:U,isCachedFunnels:P,bulkSelectIds:x,isFetching:yt}=os(W),ft=xt(()=>!!x.value.length),V=xt(()=>U.value.length>1),L=xt(()=>c.fields.reduce((l,d)=>(l[d.id]=d.name,l),{})),it=gt(null),O=gt(!1),{x:dt,arrivedState:vt}=ls(it,{behavior:"smooth",throttle:100});cs(it,l=>{const d=l[0];O.value=d.target.scrollWidth>d.target.clientWidth});const C=xt(()=>O.value&&!vt.right);let nt;us(()=>{nt=new As(document.getElementById("deals-kanban"))});function rt(l){var f;const T=Array.from(((f=it.value)==null?void 0:f.querySelectorAll(a))||[]).map(v=>v.offsetLeft),b=l==="next"?T.find(v=>v>dt.value+1):T.reverse().find(v=>v<dt.value);dt.value=b??0}const j=gt(),J=[],q=gt(null),$=gt(null),w=gt(new Map),at=hs(l=>{rt(l)},700),F=()=>{j.value&&[...j.value.children].forEach(l=>{l.classList.remove("!tw-bg-waHighlighted")})},pt={sort:!1,scroll:!1,filter:".disabled",fallbackOnBody:!0,revertOnSpill:!0,delay:150,delayOnTouchOnly:!0,dragClass:"!tw-opacity-90",group:{name:"kanban",pull:"clone",revertClone:!0},onStart(l){document.body.classList.add("tw-overflow-hidden"),l.clone.classList.add("tw-hidden");const d=l.from.closest(a);j.value&&[...j.value.children].forEach(T=>{T!==d&&J.push(fs(T,"mouseleave",F))}),nt.on("panleft panright",T=>{const f=document.body.clientWidth/2,v=T.center.x,Q=parseFloat(((f-v)/f).toFixed(2));Q>.35&&at("prev"),Q<-.6&&at("next")})},onChange(l){F(),l.to.closest(a).classList.add("!tw-bg-waHighlighted")},onAdd(l){const d={dealId:l.item.dataset.id,fromStageId:l.from.dataset.stageId,toStageId:l.to.dataset.stageId},T=Wt.object({dealId:Wt.coerce.number().min(1),fromStageId:Wt.string(),toStageId:Wt.string()}),{oldIndex:b,newIndex:f}=l,v=async()=>{ms(l.from,l.item,b),l.clone.remove(),d.dealId?It("warning"):(q.value=null,$.value=null,w.value.clear())},Q=T.safeParse(d);if(!Q.success){console.error(Q.error),v();return}(async()=>{const{dealId:Ct,fromStageId:tt,toStageId:wt}=Q.data;if($.value=Ct,w.value.set(Ct,"pending"),tt===wt){v();return}const mt=_(Number(tt)),qt=_(Number(wt));if(typeof b=="number"){q.value=Ct;const _t=ds(mt.deals[b]),{changeOpenStage:g,onSuccess:z,onError:h,onCancel:y}=Ps(_t);z(()=>{setTimeout(async()=>{const{deal:G}=vs();(G==null?void 0:G.id)===_t.value.id&&(G.stage_id=_t.value.stage_id),l.clone.remove(),typeof f=="number"&&qt.deals.splice(f,0,_t.value),mt.deals.splice(b,1),await ps(),It("success")},150)}),h(v),y(v),await g({stage_id:+wt}),q.value=null}})()},onEnd(){document.body.classList.remove("tw-overflow-hidden"),nt.off("panleft panright"),F(),J.forEach(l=>l()),J.length=0}};function It(l){$.value&&(w.value.set($.value,l),setTimeout(()=>$.value=null,100)),setTimeout(()=>w.value.clear(),800)}return(l,d)=>(m(),I("div",si,[u("div",{id:"deals-kanban",ref_key:"scrollableContainerRef",ref:it,class:M(["deals-kanban tw-select-none",{"overflow-soft-hide-x":C.value,"tw-pointer-events-none":$.value||N(yt)}])},[u("div",{class:M(["tw-absolute tw-top-1 tw-left-0 tw-w-full tw-z-30",{"md:tw-hidden":!O.value,"mobile:tw-hidden":!V.value}])},[Vt(u("div",{class:M([{"tw-opacity-30":N(vt).left},"col-nav -tw-left-6 mobile:-tw-left-5"]),onClick:d[0]||(d[0]=ee(T=>rt("prev"),["prevent"]))},ni,2),[[we,!N(vt).left]]),u("div",{class:M([{"tw-opacity-30":N(vt).right},"col-nav -tw-right-5 mobile:-tw-right-4"]),onClick:d[1]||(d[1]=ee(T=>rt("next"),["prevent"]))},ai,2)],2),u("div",{ref_key:"listsRef",ref:j,class:"deals-kanban__lists overflow-soft-hide-y"},[(m(!0),I(ie,null,Pe(N(U),T=>Vt((m(),Oe(ei,{key:T.stage.id,column:T,class:M(Se)},{listItem:se(({deals:b})=>[ct(Os,{list:b,"min-length":-1,"ext-options":pt,"item-key":"id","data-stage-id":T.stage.id,class:"tw-w-full tw-flex-1"},{default:se(({item:f})=>[ct(Ws,{deal:f,"use-columns-ids":N(ht).fields,"use-columns-labels":L.value,"is-selected":N(x).includes(f.id),"is-fetching-drop":q.value===f.id,"disable-interactions":ft.value,class:M([V.value?"handle":"disabled",{[`animation-bg-pulse ${w.value.get(f.id)}`]:w.value.has(f.id)?w.value.get(f.id)!=="pending":!1}]),onClick:v=>ft.value&&N(R)(f.id,v.shiftKey)},{checkbox:se(()=>[u("span",{class:"wa-checkbox",onClick:ee(v=>N(R)(f.id,v.shiftKey),["stop"])},[u("input",{type:"checkbox",checked:N(x).includes(f.id)},null,8,li),ci],8,oi)]),_:2},1032,["deal","use-columns-ids","use-columns-labels","is-selected","is-fetching-drop","disable-interactions","class","onClick"])]),_:2},1032,["list","data-stage-id"])]),_:2},1032,["column"])),[[we,N(P)]])),128)),N(P)?ut("",!0):(m(),I("div",ui,fi))],512)],2)]))}});export{Di as default};
