import{d as M,h as _,ai as G,R as T,D as q,aW as ee,l as x,o as w,i as D,w as k,a as b,c as $,F as R,b as E,j as B,e as L,a2 as te,al as W,n as K,r as V,p as U,ak as ce,u as g,q as se,k as H,v as O,aF as ae,at as X,f as de,ae as Y,P as j,_ as pe,a6 as Z,t as z,bk as ne,aD as ie,ao as fe,aE as ve,aq as le,N as me,aT as he,B as ye,aQ as we,O as _e,a3 as ge}from"./main-2290994d.js";import{D as oe,M as J,_ as re}from"./DropDown-9065f982.js";import{u as be}from"./recentContacts-a3525f5f.js";import{F as Ce}from"./FieldSelect-bea6b277.js";import{v as $e}from"./index-0b6b9def.js";import{v as Ie}from"./vTooltip-95186f83.js";import{U as ke}from"./UserPic-f44f080b.js";import{C as Fe}from"./CustomColumn-c63128eb.js";const Se={key:0,class:"icon size-20 !tw-left-2"},xe={key:1,class:"icon text-gray"},De=b("i",{class:"fas fa-search"},null,-1),Ve=[De],Be=b("i",{class:"fas fa-times-circle"},null,-1),Le=[Be],Re=["placeholder","disabled"],We={key:2,class:"smaller text-red tw-mt-1"},Me=["data-index","onClick"],Pe=["src"],Ae={class:"name"},Ue={class:"email"},je={key:1,class:"tw-text-center tw-py-3 gray"},Ne={class:"tw-h-[5px]"},Ee={class:"tw-text-center tw-py-3"},He=b("i",{class:"spinner custom-p-12"},null,-1),Te=[He],qe=b("hr",{class:"tw-m-0"},null,-1),Ke={class:"!tw-my-1"},ue=M({__name:"InputWithDropDownAndClear",props:{items:{},item:{},initItemId:{},placeholder:{},isFetching:{type:Boolean},hideClear:{type:Boolean},hideIcon:{type:Boolean},inputClass:{},width:{},right:{type:Boolean},disabled:{type:Boolean},errorMessage:{}},emits:["input","update","clear","interseption-observer","focus","close-dropdown"],setup(h,{expose:n,emit:i}){const e=h,m=_(),v=_(),r=_(!1),l=_(e.item);let t=G(e.items);T(()=>e.items,s=>{t=G(s),T(t.index,f=>{var F,S;(S=(F=m.value)==null?void 0:F.querySelector(`[data-index="${f}"]`))==null||S.scrollIntoView({behavior:"smooth",block:"nearest"})})}),q(()=>e.initItemId&&e.items.length,()=>{const s=e.items.find(f=>f.id===e.initItemId);s&&a(s)},{immediate:!0}),q(()=>!r.value,()=>{i("close-dropdown")}),ee(m,()=>{r.value=!1});function o(s){i("focus"),i("input",s.target.value),r.value=!0,ce(()=>{var f;(f=v.value)==null||f.focus()})}function a(s){if(s){if(s.is_editable===!1)return;l.value={...s},i("update",l.value),r.value=!1}}function p(){l.value={id:0,name:""},i("clear")}const u=x(()=>{var s;return r.value&&((s=l.value)==null?void 0:s.name)||e.placeholder}),c=x(()=>r.value?"default-value":"value");return n({clearValue:p}),(s,f)=>(w(),D(Fe,{space:"4"},{default:k(()=>{var F,S,N,P;return[b("div",{ref_key:"wrapperRef",ref:m,class:"tw-w-full"},[!s.$slots.preview||r.value?(w(),$("div",{key:0,class:K(["state-with-inner-icon width-100",{left:!e.hideIcon}])},[e.hideIcon?B("",!0):(w(),$(R,{key:0},[(F=l.value)!=null&&F.userpic?(w(),$("div",Se,[E(ke,{url:(S=l.value)==null?void 0:S.userpic,size:20},null,8,["url"])])):(w(),$("div",xe,Ve))],64)),!e.disabled&&!e.hideClear&&((N=l.value)!=null&&N.name)?(w(),$("a",{key:1,class:"icon !tw-left-auto tw-right-3 hover:!tw-text-red-600 tw-rounded-full tw-bg-waBlank",onClick:f[0]||(f[0]=L(I=>p(),["prevent"]))},Le)):B("",!0),b("input",te({ref_key:"inputRef",ref:v,type:"search",class:["tw-w-full",e.inputClass,{"state-error":e.errorMessage}],[c.value||""]:((P=l.value)==null?void 0:P.name)||"",placeholder:u.value,disabled:e.disabled,onInput:f[1]||(f[1]=I=>i("input",I.target.value)),onKeyup:f[2]||(f[2]=W(I=>{a(g(t).state.value),I.target.blur()},["enter"])),onKeydown:[f[3]||(f[3]=W(L(I=>g(t).prev(),["prevent"]),["up"])),f[4]||(f[4]=W(L(I=>g(t).next(),["prevent"]),["down"]))],onFocus:o}),null,16,Re)],2)):V(s.$slots,"preview",{key:1,model:l.value,showInput:o}),e.errorMessage?(w(),$("div",We,U(e.errorMessage),1)):B("",!0),V(s.$slots,"items",{items:e.items,onSelectItem:a,isFocus:r.value},()=>[E(oe,{"max-height":"255px",open:r.value,"disable-click-outside":!0,width:e.width||"250px",right:e.right,"disable-floating":!0},{body:k(()=>{var I;return[e.isFetching||l.value.name||(I=e.items)!=null&&I.length?(w(),D(J,{key:0,class:"thin-scrollbar"},{default:k(()=>{var d;return[(d=e.items)!=null&&d.length?(w(!0),$(R,{key:0},se(e.items,(y,C)=>(w(),D(re,{key:y.id},{default:k(()=>[H((w(),$("a",{class:K(["item",{"tw-bg-waBackground":g(t).index.value===C,"tw-opacity-50":y.is_editable===!1}]),"data-index":C,onClick:L(A=>a(y),["prevent"])},[s.$slots.item?V(s.$slots,"item",{key:0,item:y}):(w(),$(R,{key:1},[b("img",{class:"userpic userpic32",src:y.userpic},null,8,Pe),b("div",null,[b("div",Ae,U(y.name),1),b("div",Ue,U(y.email),1)])],64))],10,Me)),[[g(Ie),y.is_editable===!1?{content:s.$t("contactEditAccessDenied"),trigger:"click",autoHideDelay:2500}:""]])]),_:2},1024))),128)):e.isFetching?B("",!0):(w(),$(R,{key:1},[s.$slots.empty?V(s.$slots,"empty",{key:0}):(w(),$("div",je,U(s.$t("notFound")),1))],64)),H(b("div",Ne,null,512),[[O,!s.isFetching],[g($e),([{isIntersecting:y}])=>{y&&i("interseption-observer")}]]),H(b("div",Ee,Te,512),[[O,s.isFetching]])]}),_:3})):B("",!0),s.$slots.bottomItems?(w(),$(R,{key:1},[qe,b("div",Ke,[E(J,null,{default:k(()=>[V(s.$slots,"bottomItems",{hideDropDown:()=>r.value=!1})]),_:3})])],64)):B("",!0)]}),_:3},8,["open","width","right"])])],512)]}),_:3}))}});const ze=M({__name:"InputSearchContacts",props:{contacts:{default:void 0},contact:{default:()=>({id:0,name:"",userpic:"",jobtitle:"",company:"",company_contact_id:null})},initContactId:{default:void 0},withFields:{default:()=>["email"]},excludeIds:{default:()=>[]},disabled:{type:Boolean},disableNotEditable:{type:Boolean},isFetching:{type:Boolean,default:void 0},additionalHash:{default:void 0}},emits:["update"],setup(h,{expose:n,emit:i}){var P,I;const e=h,m=_(),v=_({id:e.contact.id,name:e.contact.name,userpic:e.contact.userpic,company:e.contact.company||"",email:(I=(P=e.contact)==null?void 0:P.email)!=null&&I.length?e.contact.email[0].value:""}),r=_([]),l=_(!1),t=_(""),o=_(0),a=_(0),p=_(10);f(),T(()=>e.contacts,()=>{f()}),n({clearValue:()=>{var d;return(d=m.value)==null?void 0:d.clearValue()}});const u=ae(async d=>{var y;if(o.value=0,a.value=0,!d||((y=v.value)==null?void 0:y.name)===d)f();else{let C="name.name";d.includes("@")?C="email":/^[+\-0-9() ]+$/.test(d)&&(C="phone");const A=`crmSearch/${e.additionalHash?`${e.additionalHash}&`:""}contact_info.${C}*=${de(d)}`;t.value!==A&&(r.value=[],r.value=await F(A))}},300),c=e.excludeIds.filter(d=>d!==e.contact.id).reduce((d,y)=>({...d,[y]:!0}),{}),s=x(()=>r.value.filter(d=>!c[d.id]).map(d=>{const y=d.fields.find(C=>C.id==="email");return{id:d.id,name:d.name,userpic:d.userpic,email:y==null?void 0:y.value[0],company:d.company,is_editable:d.is_editable}}));function f(){o.value=0,a.value=0,t.value="",e.contacts&&(r.value=[...e.contacts])}async function F(d){l.value=!0;const y=Y.stringify({hash:d,fields:[...e.withFields,...e.disableNotEditable?["is_editable"]:[]],limit:p.value,offset:o.value}),{data:C}=await j(`crm.contact.list?${y}`).get().json();if(l.value=!1,C.value){const{data:A,params:Q}=C.value;return o.value+=Q.limit||0,a.value=Q.total_count||0,t.value=Q.hash||"",A}return[]}async function S(){o.value<a.value&&(r.value=[...r.value,...await F(t.value)])}function N(d){v.value=d;const y=r.value.find(C=>C.id===d.id);y&&i("update",y)}return(d,y)=>(w(),D(ue,{ref_key:"inputWithDropDownRef",ref:m,items:s.value,item:v.value,"init-item-id":e.initContactId,placeholder:d.$t("name"),"is-fetching":l.value||d.isFetching,disabled:e.disabled,onInput:g(u),onUpdate:N,onInterseptionObserver:S,onCloseDropdown:f},{items:k(C=>[V(d.$slots,"items",X({isFetching:l.value||d.isFetching,interseptionObserver:S},C),void 0,!0)]),_:3},8,["items","item","init-item-id","placeholder","is-fetching","disabled","onInput"]))}});const Qe=pe(ze,[["__scopeId","data-v-f0e353f2"]]),Ge=Z("inputWithCustomers",()=>{const h=_(!0),n=_([]),i=_(null),e=be(),{recent:m,pinned:v,error:r,isFinished:l}=z(e);e.refetch();function t(u,c,s){u===null||i.value!==u?(i.value&&e.refetch(),q(()=>l.value,()=>{o(c,s)},{immediate:!0})):(n.value.length||m.value.length||v.value.length)&&a(s),i.value=u}async function o(u,c){const s=[...v.value,...m.value].map(S=>S.id),f=p(c);f&&s.unshift(f);const F=ne(s).join(",");F&&(n.value=await Je(`id/${F}`,u),a(c)),h.value=!1}function a(u){if(!u)return;const c=n.value.findIndex(s=>s.id===p(u));if(c!==-1){const s=n.value[c];return n.value.splice(c,1),n.value.unshift(s),!0}else typeof u=="object"&&u.id&&n.value.unshift(u)}function p(u){return typeof u=="number"?u:typeof(u==null?void 0:u.id)=="number"?u.id:null}return{isFetching:h,error:r,$contacts:n,fetchData:t}});async function Je(h,n){const i=Y.stringify({hash:h,fields:n}),{data:e}=await j(`crm.contact.list?${i}`).get().json();if(e.value){const{data:m}=e.value;return m}return[]}const Xe=["placeholder"],Ye=["onClick"],dt=M({__name:"InputWithRole",props:{scope:{},modelValue:{},inputClass:{default:""},placeholder:{default:""},right:{type:Boolean},width:{default:"200px"}},setup(h){const n=h,i=ie(n,"modelValue"),e=_([]),m=_(),v=_(!1),r=x(()=>e.value.filter(o=>{var a;return(a=i.value)!=null&&a.trim()?o.toLocaleLowerCase().includes(i.value.toLocaleLowerCase()):!0})),l=G(r);fe(async()=>{const{data:o}=await j(`crm.deal.role.list?scope=${n.scope}`).get().json();Array.isArray(o.value)&&(e.value=o.value)}),ee(m,()=>{v.value=!1});function t(o){o&&(i.value=o,v.value=!1)}return(o,a)=>(w(),$("div",{ref_key:"wrapperRef",ref:m},[E(oe,{open:v.value,"disable-click-outside":!0,right:n.right,width:n.width,disabled:!0,"max-height":"195px"},{body:k(()=>[r.value.length?(w(),D(J,{key:0},{default:k(()=>[(w(!0),$(R,null,se(r.value,(p,u)=>(w(),D(re,{key:u},{default:k(()=>[b("a",{class:K({"tw-bg-waBackground":g(l).index.value===u}),onClick:L(c=>t(p),["prevent"])},U(p),11,Ye)]),_:2},1024))),128))]),_:1})):B("",!0)]),default:k(()=>[H(b("input",{"onUpdate:modelValue":a[0]||(a[0]=p=>le(i)?i.value=p:null),type:"text",class:K(["tw-w-full",n.inputClass]),placeholder:n.placeholder,onKeyup:a[1]||(a[1]=W(p=>{t(g(l).state.value),p.target.blur()},["enter"])),onKeydown:[a[2]||(a[2]=W(L(p=>g(l).prev(),["prevent"]),["up"])),a[3]||(a[3]=W(L(p=>g(l).next(),["prevent"]),["down"]))],onFocusin:a[4]||(a[4]=p=>v.value=!0)},null,42,Xe),[[ve,g(i)]])]),_:1},8,["open","right","width"])],512))}}),pt=M({__name:"InputWithCustomers",props:{dealId:{},initContactId:{},contact:{},withFields:{},excludeIds:{},disabled:{type:Boolean}},emits:["update"],setup(h,{expose:n,emit:i}){var a,p;const e=h,m=_(),v=Ge(),r=e.contact?{id:e.contact.id,name:e.contact.name,userpic:e.contact.userpic,company:e.contact.company?e.contact.company:"",fields:[{id:"email",value:(p=(a=e.contact)==null?void 0:a.email)!=null&&p.length?[e.contact.email[0].value]:[]}]}:e.initContactId;v.fetchData(e.dealId||null,e.withFields||[],r);const{$contacts:l,isFetching:t}=z(v);n({isFetchingContacts:t,clearValue:()=>{var u;return(u=m.value)==null?void 0:u.clearValue()}});function o(u){i("update",u),l.value.unshift(u),l.value=ne(l.value)}return(u,c)=>(w(),D(Qe,{ref_key:"inputSearchContactsRef",ref:m,contact:e.contact,"init-contact-id":e.initContactId,"with-fields":e.withFields,"exclude-ids":e.excludeIds,disabled:e.disabled,contacts:g(l),"is-fetching":g(t),onUpdate:o},null,8,["contact","init-contact-id","with-fields","exclude-ids","disabled","contacts","is-fetching"]))}}),Ze=Z("currencies",()=>{const h=_([]),{data:n,isFetching:i,error:e,execute:m,isFinished:v}=j("crm.currency.list").get().json(),r=x(()=>h.value.find(a=>a.is_primary)),l=x(()=>a=>h.value.find(p=>p.id===a)),t=x(()=>v.value&&!h.value.length);me(()=>{Array.isArray(n.value)&&(h.value=n.value)});function o(){v.value&&m()}return{currencies:h,primaryCurrency:r,isFetching:i,error:e,isFinished:v,isEmptyCurrencies:t,getCurrencyById:l,refetch:o}}),Oe={key:1,class:"skeleton tw-w-full"},et=b("button",{class:"button light-gray !tw-w-full tw-h-full"},null,-1),tt=[et],ft=M({__name:"SelectWithCurrencies",props:{modelValue:{}},emits:["update:modelValue"],setup(h,{emit:n}){const e=ie(h,"modelValue",n),{currencies:m,primaryCurrency:v,isFinished:r}=z(Ze()),l=x(()=>m.value.map(t=>({id:t.id,value:t.name})));return q(()=>{var t;return(t=v.value)==null?void 0:t.id},t=>{e.value||(e.value=t)},{immediate:!0}),(t,o)=>g(r)?(w(),D(Ce,X({key:0,modelValue:g(e),"onUpdate:modelValue":o[0]||(o[0]=a=>le(e)?e.value=a:null)},t.$attrs,{options:l.value,required:"",class:"tw-w-full"}),null,16,["modelValue","options"])):(w(),$("div",Oe,tt))}}),st=Z("inputWithPreformers",()=>{const h=_(!0),n=_([]),i=he({}),e=x(()=>`crm.user.list?${Y.stringify({...i.dealId?{can_own_deal:i.dealId}:{}})}`),{error:m,data:v}=j(e,{immediate:!1,refetch:!0}).get().json();T(v,t=>{if(Array.isArray(t)){const{id:o}=ye.user,a=t.find(p=>p.id===o);n.value=[...a?[a]:[],...t.filter(p=>p.id!==o)]}l(i.currrentUser),h.value=!1});function r(t,o){i.dealId=t,i.currrentUser=o,n.value.length&&l(i.currrentUser)}function l(t){if(t!=null&&t.id){const o=n.value.findIndex(a=>a.id===t.id);if(o!==-1){const a=n.value[o];n.value.splice(o,1),n.value.unshift(a)}else t.id&&n.value.unshift(t)}}return{setupProps:r,isFetching:h,error:m,$contacts:n}}),vt=M({__name:"InputWithPerformers",props:{dealId:{default:0},excludeIds:{default:()=>[]},contact:{}},emits:["update"],setup(h,{emit:n}){const i=h,e=_(i.contact),m=_([]),v=st();v.setupProps(i.dealId,{...e.value});const{isFetching:r,$contacts:l}=z(v);p(),we(l,()=>p());const t=ae(async c=>{var s;!c||((s=e.value)==null?void 0:s.name)===c?p():m.value=[...l.value].filter(f=>f.name.toLocaleLowerCase().includes(c.toLocaleLowerCase()))},300),o=i.excludeIds.filter(c=>c!==i.contact.id).reduce((c,s)=>({...c,[s]:!0}),{}),a=x(()=>m.value.filter(c=>!o[c.id]));function p(){m.value=[...l.value]}function u(c){e.value=c,n("update",{id:c.id,name:c.name,userpic:c.userpic})}return(c,s)=>(w(),D(ue,{items:a.value,item:e.value,placeholder:c.$t("name"),"is-fetching":g(r),onInput:g(t),onUpdate:u,onCloseDropdown:p},_e({items:k(f=>[V(c.$slots,"items",X({isFetching:g(r),interseptionObserver:()=>null},f))]),_:2},[c.$slots.preview?{name:"preview",fn:k(f=>[V(c.$slots,"preview",te(ge(f)))]),key:"0"}:void 0]),1032,["items","item","placeholder","is-fetching","onInput"]))}});export{Qe as I,pt as _,dt as a,vt as b,ft as c,Ze as u};
