import{d as T,h as p,Q as B,P as $,l as x,R as N,V as A,ag as E,u as o,o as n,i as L,c,a9 as M,b as m,w as r,A as y,p as h,e as w,O as P,a as g,k as V,v as z,W as F,ae as O,s as R,x as j,_ as Q}from"./main-2290994d.js";import{v as U}from"./index-0b6b9def.js";import{I as b}from"./IconButton-aa8f99d3.js";import{_ as W}from"./DealsListTable.vue_vue_type_style_index_0_lang-767309a3.js";import{S as q}from"./SkeletonList-1c6858f7.js";import"./DealsItemResponsible.vue_vue_type_style_index_0_lang-03e36101.js";import"./vTooltip-95186f83.js";import"./ChipsList-0fe31c28.js";import"./UserPic-f44f080b.js";import"./index-6e4a059f.js";import"./dayjs-910ec40d.js";import"./currency-format-433ea0a4.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-1445a600.js";import"./date-18c3b35b.js";import"./EmptyList-239f0622.js";import"./CustomColumn-c63128eb.js";const G=s=>(R("data-v-30880bdc"),s=s(),j(),s),H={key:1,class:"tab-body__container !tw-pt-0"},J={key:1,class:"tw-mt-2"},K={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},X=G(()=>g("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1)),Y=[X],Z={class:"align-center"},f=20,tt=T({__name:"ContactTabsDeals",props:{contactId:{}},emits:["add-entity"],setup(s,{emit:_}){const k=s,D=["id","stage_id","name","states","create_datetime","amount","user","tags","last_action"],e=p({contact_id:k.contactId,fields:["last_action"],limit:f,offset:0,_:Date.now()}),i=p(0),a=p([]),{updateCounterByRouteName:I}=B(),{data:C,isFetching:v}=$(x(()=>`crm.deal.list?${O.stringify(e.value)}`),{immediate:!0,refetch:!0}).get().json();N(C,t=>{t&&(t.params.offset>0?a.value=[...a.value||[],...t.data]:a.value=t.data,i.value=t.params.total_count,e.value.offset=t.params.offset,I("contactDealsTab",i.value))}),A(F).on(()=>{e.value._=Date.now()});function S(){e.value.offset+f>=i.value||(e.value.offset+=f)}const d=E();return d.fetch(),(t,l)=>!o(d).funnelsMap||o(v)&&e.value.offset===0?(n(),L(q,{key:0,class:"tab-body__container","row-height":"130px"})):(n(),c("div",H,[t.$route.meta.menuItemType!=="frame"&&a.value.length?(n(),c("div",{key:0,class:"tw-sticky tw-py-1 tw-bg-waBlank tw-z-10",style:M({top:"calc(var(--header-height))"})},[m(b,{icon:"plus",onClick:l[0]||(l[0]=w(u=>_("add-entity","addDeal"),["prevent"]))},{default:r(()=>[y(h(t.$t("addDeal")),1)]),_:1})],4)):(n(),c("div",J)),m(W,{"tile-view":!0,deals:a.value,"funnels-map":o(d).funnelsMap,"use-columns-ids":D},P({lazy:r(()=>[V((n(),c("div",K,Y)),[[z,a.value.length<i.value],[o(U),([{isIntersecting:u}])=>{u&&!o(v)&&S()}]])]),_:2},[t.$route.meta.menuItemType!=="frame"?{name:"bottomEmptyList",fn:r(()=>[g("div",Z,[m(b,{icon:"plus",onClick:l[1]||(l[1]=w(u=>_("add-entity","addDeal"),["prevent"]))},{default:r(()=>[y(h(t.$t("addDeal")),1)]),_:1})])]),key:"0"}:void 0]),1032,["deals","funnels-map"])]))}});const yt=Q(tt,[["__scopeId","data-v-30880bdc"]]);export{yt as default};
