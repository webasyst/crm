import{d as M,h as _,aU as le,a$ as ie,R as A,r as te,j as B,H as re,b0 as D,o as p,i as O,w as I,a,c as h,e as ce,l as z,X as ue,aJ as W,ae as J,b1 as de,Q as fe,ad as pe,ai as ve,k as G,v as K,u as C,a3 as Z,s as se,x as ae,_ as ne,I as _e,aa as me,b2 as he,ar as U,Y as ye,m as be,F as V,q,b as we,A as ee,p as N,P as ge,n as L}from"./main-82f77a11.js";import{D as ke}from"./DropdownModal-9ee3af32.js";import{u as Te}from"./useSortable-19b28137.js";import{D as $e}from"./DropDown-79d42973.js";import{b as Ce}from"./index-ca686fb1.js";const nt=M({__name:"ComponentActivator",setup(v){const s=_(!1),n=le(ie()),r=A(n,c=>{c&&(s.value=!0,r())});return(c,u)=>s.value?te(c.$slots,"default",{key:0}):B("",!0)}}),Se=["onClick"],xe={key:0},Ie=a("i",{class:"fas fa-spinner fa-spin"},null,-1),Ne=[Ie],Re={key:1},Ee=a("i",{class:"fas fa-plus"},null,-1),De=[Ee],ot=M({__name:"TabsAddEntityButton",props:{entityType:{},entityId:{}},setup(v){const s=v,{t:n}=re(),r=_([{label:n("addNote"),classIcon:"fas fa-sticky-note",clickHandler:()=>{D.push({name:`${s.entityType}NotesTab`,query:{focus:"1"}})}},{label:n("addFile"),classIcon:"fas fa-paperclip",clickHandler:()=>{D.push({name:`${s.entityType}FilesTab`,query:{focus:"1"}})}},{label:n("addReminder"),classIcon:"fas fa-check-circle",clickHandler:()=>{D.push({name:`${s.entityType}RemindersTab`,query:{focus:"1"}})}},{label:n("addInvoice"),classIcon:"fas fa-file-invoice-dollar",clickHandler:()=>{D.push({name:`${s.entityType}InvoicesTab`,query:{is_new:"1"}})}}]),c=_(!1),u=_(!1),m=_(!1);A([()=>s.entityType,()=>s.entityId],()=>{r.value=r.value.filter(l=>!("html"in l)),c.value=!1,u.value=!1,m.value=!1});const y=()=>{if(!m.value&&s.entityType==="contact"){u.value=!0;const l=z(()=>`crm.contact.ui.actions?id=${s.entityId}`),{data:T,error:b}=ue(l,{immediate:!0}).get().json(),w=()=>{u.value=!1,m.value=!0,c.value=!0};W(T,async g=>{if(g.plus_dropdown){const $=[];if(!(g!=null&&g.plus_dropdown))return;g.plus_dropdown.forEach(R=>{$.push({html:R})}),r.value.push(...$)}await J(),w()}),W(b,()=>{w()})}};return(l,T)=>(p(),O(ke,{key:`${s.entityType}_${s.entityId}`,items:r.value,"fallback-on-open":!0,"prevent-open":s.entityType==="contact",open:c.value},{default:I(()=>[a("button",{class:"button circle",onClick:ce(y,["prevent"])},[u.value?(p(),h("span",xe,Ne)):(p(),h("span",Re,De))],8,Se)]),_:1},8,["items","prevent-open","open"]))}}),oe=v=>(se("data-v-8af80abb"),v=v(),ae(),v),Le={class:"tw-sticky tw-left-0 tw-z-10"},Be=oe(()=>a("span",{class:"icon size-16"},[a("i",{class:"fas fa-chevron-left"})],-1)),Oe=[Be],ze=oe(()=>a("span",{class:"icon size-16"},[a("i",{class:"fas fa-chevron-left"})],-1)),Me=[ze],Ae=M({__name:"HorizontalScrollContainer",props:{step:{default:90},fadeColor:{default:"var(--background-color-blank)"}},setup(v){const s=v;de(y=>({ba883736:y.fadeColor}));const n=_(null),r=_(!1),c=_(0),{x:u,arrivedState:m}=fe(n,{behavior:"smooth"});return pe(n,y=>{const l=y[0];c.value=l.target.clientHeight,r.value=l.target.scrollWidth>l.target.clientWidth}),ve(()=>{n.value&&(c.value=n.value.clientHeight,r.value=n.value.scrollWidth>n.value.clientWidth)}),A(r,()=>{m.right=!1}),(y,l)=>(p(),h("div",{ref_key:"scrollableRef",ref:n,class:"tw-relative tw-overflow-x-scroll tw-scrollbar-hide"},[a("div",Le,[G(a("div",{class:"arr -tw-left-2",style:Z({height:`${c.value}px`}),onClick:l[0]||(l[0]=T=>u.value-=s.step)},Oe,4),[[K,r.value&&C(u)>0]]),G(a("div",{class:"arr tw-right-0 tw-rotate-180",style:Z({height:`${c.value}px`}),onClick:l[1]||(l[1]=T=>u.value+=s.step)},Me,4),[[K,r.value&&!C(m).right]])]),te(y.$slots,"default")],512))}});const He=ne(Ae,[["__scopeId","data-v-8af80abb"]]),Q=v=>(se("data-v-e8ce25f8"),v=v(),ae(),v),Fe=Q(()=>a("div",{class:"skeleton-line"},null,-1)),Ue=[Fe],Ve=["data-id"],qe=["href","onClick"],We={key:0,class:"count"},Je={key:0,class:"nowrap tw-ml-1 tw-py-3"},Qe=Q(()=>a("span",{class:"icon size-16 text-light-gray"},[a("i",{class:"fas fa-chevron-down"})],-1)),je=["data-id"],Pe=["href","onClick"],Xe=["title"],Ye={key:0,class:"count tw-flex-none"},Ge=Q(()=>a("canvas",{id:"tabs-canvas",class:"hidden"},null,-1)),Ke=M({__name:"TabList",props:{entityType:{},value:{},isFetching:{type:Boolean},fadeColor:{}},setup(v){const s=v,n=_e(Ce),r=_(null),c=_(null),u=_(null),m=_(null),{width:y}=me(m),{tabsOrder:l,tabsOrderMap:T}=he(s.entityType),b=_(new Map),w=z(()=>[...s.value].sort((e,d)=>T.value[e.routeName]-T.value[d.routeName])),g=z(()=>w.value.filter(e=>b.value.get(e.routeName))),$=z(()=>b.value.size>0?w.value.filter(e=>!b.value.get(e.routeName)):[]),R=()=>{for(const e of w.value)b.value.set(e.routeName,!0)},j=(e,d)=>{const f=document.getElementById("tabs-canvas");if(f){const t=f.getContext("2d");if(t)return t.font=d,t.measureText(e).width}return 0},P=e=>{const f="1rem sans-serif",t="0.75em sans-serif";let i=0;for(let o=0;o<e.length;o++)i+=24,i+=j(e[o].name,f),e[o].count&&(i+=j(String(e[o].count),t));return i-24};async function H(e=!1){if(!m.value)return;const d=[...w.value],f=()=>{var o;let i=u.value?80:0;return c.value&&(i=c.value.offsetWidth+20),e&&((o=u.value)==null?void 0:o.children.length)===1?0:i},t=f();if(!(P(d)<m.value.clientWidth-t))for(let i=0;i<w.value.length;i++){const o=d.pop();if(b.value.set(o==null?void 0:o.routeName,!1),await J(),P(d)<m.value.clientWidth-(e?t:f()))break}}A(()=>s.value,()=>{if(!s.value.length)return;W(()=>s.isFetching,async()=>{l.value.length||s.value.forEach(d=>{l.value.push(d.routeName)}),R(),await J(),H()},{immediate:!s.isFetching})},{immediate:!!s.value,deep:!0});let F,E;U(g,e=>{r.value&&e.length&&(F=X(r.value,e))},{immediate:!0,debounce:250}),U($,e=>{u.value&&e.length&&(E=X(u.value,e))},{immediate:!0,debounce:250}),U(y,(e,d)=>{e>d&&E&&R(),H(e>d)},{debounce:200}),ye(()=>{F&&F.stop(),E&&E.stop()});function X(e,d){return Te(e,d,{handle:".handle",group:"tabs",animation:150,forceFallback:!0,fallbackOnBody:!0,fallbackTolerance:5,delay:150,delayOnTouchOnly:!0,onStart:()=>{document.querySelectorAll("iframe").forEach(f=>{f.classList.add("tw-pointer-events-none")})},onEnd:f=>{var S,x;document.querySelectorAll("iframe").forEach(k=>{k.classList.remove("tw-pointer-events-none")});const{id:t}=f.item.dataset;typeof t=="string"&&(f.to.classList.contains("tabs-dropdown-list")?b.value.set(t,!1):f.to.classList.contains("tabs-main-list")&&b.value.set(t,!0));const i=[...((S=r.value)==null?void 0:S.children)||[],...((x=u.value)==null?void 0:x.children)||[]].map(k=>k.dataset.id),o=[...l.value];for(let k=0;k<o.length;k++){const Y=o[k];i.includes(Y)||i.splice(k,0,Y)}l.value=i,setTimeout(H)}})}return(e,d)=>{const f=be("router-link");return p(),h("div",{ref_key:"tabsListRef",ref:m,class:"tabs-list tw-flex-auto tw-overflow-hidden tw-mx-2"},[(p(),O(ge(C(n)?He:"div"),{"fade-color":s.fadeColor||"var(--background-color)",class:"tw-select-none md:tw-flex"},{default:I(()=>[(p(),h("ul",{key:JSON.stringify(g.value),ref_key:"mainUlRef",ref:r,class:"tabs tabs-main-list overflow-arrows tw-flex-none"},[s.isFetching?(p(),h(V,{key:0},q(7,t=>a("li",{key:t,class:"skeleton tw-w-16"},Ue)),64)):(p(!0),h(V,{key:1},q(C(n)?w.value:g.value,t=>(p(),O(f,{key:t.routeName,to:{name:t.routeName},replace:"",custom:""},{default:I(({isActive:i,href:o,navigate:S})=>[a("li",{class:L([{selected:i,handle:!C(n)},"tab-item"]),"data-id":t.routeName},[a("a",{href:o,class:L(e.$constant.parentAppDisableRouterClass),onClick:x=>S(x).then(()=>typeof t.onClick=="function"?t.onClick():null)},[a("span",null,[ee(N(t.name)+" ",1),t.count?(p(),h("span",We,N(t.count),1)):B("",!0)])],10,qe)],10,Ve)]),_:2},1032,["to"]))),128))])),!C(n)&&$.value.length?(p(),h("div",Je,[we($e,{"fallback-on-open":!0,hover:!0,"strategy-fixed":!0},{body:I(()=>[(p(),h("ul",{key:JSON.stringify($.value),ref_key:"dropdownUlRef",ref:u,class:"menu tabs-dropdown-list"},[(p(!0),h(V,null,q($.value,t=>(p(),O(f,{key:t.routeName,to:{name:t.routeName},replace:"",custom:""},{default:I(({isActive:i,href:o,navigate:S})=>[a("li",{class:L([{selected:i,handle:!C(n)},"tab-item"]),"data-id":t.routeName},[a("a",{href:o,class:L([e.$constant.parentAppDisableRouterClass,"!tw-py-3"]),onClick:x=>S(x).then(()=>typeof t.onClick=="function"?t.onClick():null)},[a("span",{title:t.name,class:"tw-truncate"},N(t.name),9,Xe),t.count?(p(),h("span",Ye,N(t.count),1)):B("",!0)],10,Pe)],10,je)]),_:2},1032,["to"]))),128))]))]),default:I(()=>[a("button",{ref_key:"dropdownButtonRef",ref:c,class:"button light-gray transparent rounded custom-px-4"},[Qe,ee(" "+N(e.$t("more")),1)],512)]),_:1})])):B("",!0),Ge]),_:1},8,["fade-color"]))],512)}}});const lt=ne(Ke,[["__scopeId","data-v-e8ce25f8"]]);export{lt as T,ot as _,nt as a};
