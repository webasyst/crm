import{d as S,o as n,c as v,i,r as E,b as g,f as H,n as M,_ as I,H as K,F as O,l as R,g as e,w as m,m as U,k as j,aC as q,t as L,av as G,a as J,A as Q,am as W,ab as X,e as C,p as Y,B as Z,au as ee}from"./main-e63d6b61.js";import{a as se,_ as te}from"./DealsListTable.vue_vue_type_style_index_0_lang-53239539.js";import{U as x}from"./UserPic-e63dca94.js";import{h as oe,u as ae}from"./longTouch-2a1e2d51.js";import{_ as ne}from"./LazyLoadingWithProgress.vue_vue_type_script_setup_true_lang-98bfe3bd.js";import{E as ie}from"./EmptyList-8c2bab53.js";import"./DealsItemAmount.vue_vue_type_style_index_0_lang-8085fe51.js";import"./ChipsList-f1962714.js";import"./index-6448b8a4.js";import"./dayjs-e48e80eb.js";import"./currency-format-68c1cc9d.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-ea671b34.js";import"./date-1329a0ed.js";import"./SkeletonList-7e0e4de7.js";import"./index-48d220da.js";import"./CustomColumn-72664405.js";const le=["data-id"],re={key:0},ce=S({__name:"DealsListHeaderCell",props:{id:{},sortable:{type:Boolean},sort:{}},emits:["toggleSort"],setup(h,{emit:f}){const t=h;return(s,l)=>{var r,c;return n(),v("div",{"data-id":s.id,class:"deal-list__head"},[i("div",{class:M(["deal-head__inner",[t.sortable?"tw-cursor-pointer":"tw-cursor-default"]]),onClick:l[0]||(l[0]=k=>t.sortable&&f("toggleSort"))},[E(s.$slots,"default",{},void 0,!0),t.sortable&&((r=t.sort)==null?void 0:r.sort)===s.id?(n(),v("span",re,[((c=t.sort)==null?void 0:c.asc)===0?(n(),g(x,{key:0,size:14,"fa-icon":"sort-down"})):(n(),g(x,{key:1,size:14,"fa-icon":"sort-up"}))])):H("",!0)],2)],8,le)}}});const de=I(ce,[["__scopeId","data-v-721af1f4"]]),ue={class:"deals-list__header"},me=S({__name:"DealsListHeaders",props:{useColumnsIds:{},sort:{}},emits:["toggleSort"],setup(h,{emit:f}){const t=h,{t:s}=K(),r=[{id:"checkbox",name:"",sortable:!1},{id:"stage_id",name:s("stage"),sortable:!0},{id:"name",name:s("deal"),sortable:!0},{id:"states",name:"",sortable:!1},{id:"create_datetime",name:s("createDatetime"),sortable:!0},{id:"amount",name:s("amount"),sortable:!0},{id:"user_name",name:s("responsible"),sortable:!0},{id:"tags",name:s("tags"),sortable:!1},{id:"last_action",name:s("lastAction"),sortable:!0}].filter(c=>t.useColumnsIds.includes(c.id));return(c,k)=>(n(),v("div",ue,[(n(!0),v(O,null,R(e(r),d=>(n(),g(de,{id:d.id,key:d.id,sortable:d.sortable,sort:t.sort,onToggleSort:p=>f("toggleSort",d.id)},{default:m(()=>[U(j(d.name),1)]),_:2},1032,["id","sortable","sort","onToggleSort"]))),128))]))}});const _e=I(me,[["__scopeId","data-v-67293c18"]]),fe=["onClick"],pe=["checked"],ge=i("span",{class:"!tw-h-[1rem] !tw-w-[1rem]"},[i("span",{class:"icon"},[i("i",{class:"fas fa-check"})])],-1),he=i("div",{class:"icon size-80"},[i("i",{class:"fas fa-funnel-dollar"})],-1),Pe=S({__name:"DealsList",setup(h){const f=["checkbox","stage_id","name","states","create_datetime","amount","user_name","tags","last_action"],t=q(),{init:s,bulkSelectToggle:l}=t,{deals:r,isFetching:c,isRefreshPage:k,fetchNextPage:d,previousFetchParams:p,toggleSort:F,sort:N,bulkSelectIds:y}=L(t),{isFetching:w,funnels:D}=L(G()),T=J(!1),P=Q(()=>{var o;if(!((o=Z.rights)!=null&&o.is_admin)||w.value)return!1;const _=Object.values(ee().filterParams).filter(b=>b!==void 0);return D.value.length===1&&(_.length===0||_.length===1&&_[0]===D.value[0].id)}),{onTouchstart:B,onTouchend:$}=ae();return W(s),(_,o)=>{var b;return n(),g(te,{deals:e(r),"use-columns-ids":f,"is-fetching":e(k)||e(w),"is-first-fetching":!((b=e(p))!=null&&b.offset),class:"tw-mt-6 mobile:-tw-ml-2 mobile:-tw-mr-2"},X({headers:m(({useColumnsIds:a})=>[C(_e,{"use-columns-ids":a,sort:e(N),onToggleSort:e(F)},null,8,["use-columns-ids","sort","onToggleSort"])]),listItem:m(({deal:a,useColumnsIds:V,isMobile:z,navigate:A})=>[C(se,{deal:a,"use-columns-ids":V,"is-selected":e(y).includes(a.id),"is-mobile":z,onClick:u=>{e(y).length?e(l)(a.id,u.shiftKey):A()},onTouchstart:u=>e(B)(u,()=>e(l)(a.id,!1)),onTouchend:e($),onTouchmove:e($),onContextmenu:o[0]||(o[0]=u=>e(oe)()&&u.preventDefault())},{checkbox:m(()=>[i("span",{class:"wa-checkbox tw-mr-2",onClick:Y(u=>e(l)(a.id,u.shiftKey),["stop"])},[i("input",{type:"checkbox",checked:e(y).includes(a.id)},null,8,pe),ge],8,fe)]),_:2},1032,["deal","use-columns-ids","is-selected","is-mobile","onClick","onTouchstart","onTouchend","onTouchmove"])]),lazy:m(()=>[e(p)?(n(),g(ne,{key:0,"entity-type":"deals","count-loaded":e(r).length,"limit-load":e(p).limit,total:e(p).total_count,class:"tw-my-4",onVIntersectionObserver:o[1]||(o[1]=()=>{e(c)||e(d)()})},null,8,["count-loaded","limit-load","total"])):H("",!0)]),_:2},[!T.value&&P.value?{name:"emptyList",fn:m(()=>[C(ie,{title:_.$t("soonManyProfitableDeals"),message:_.$t("infoHowAddDeal"),"notice-id":"deals/infoHowAddDeal",onCloseNotice:o[2]||(o[2]=a=>T.value=!0)},{default:m(()=>[he]),_:1},8,["title","message"])]),key:"0"}:void 0]),1032,["deals","is-fetching","is-first-fetching"])}}});export{Pe as default};
