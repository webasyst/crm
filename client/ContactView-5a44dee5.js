import{d as j,h as S,o as m,i as $,L as Q,w as l,a as e,p as h,e as D,A as Y,b as s,c as A,j as V,T as J,M as K,t as T,N as W,O,l as F,P as X,H as G,Q as Z,R as q,S as L,U as M,F as x,u as i,n as H,r as ee,V as te,W as ae,B as C,_ as z,y as oe,m as se,k,v as I,X as ne,Y as ie,s as le,x as ce}from"./main-46836c41.js";import{_ as re}from"./ViewWithSidebar.vue_vue_type_style_index_0_lang-cb3bd771.js";import{u as de}from"./FormSegmentUpdate.vue_vue_type_script_setup_true_lang-959b0928.js";import B from"./IframeView-19d2dace.js";import{_ as ue,T as me,a as E}from"./TabList-10483305.js";import{_ as pe}from"./ContactsList.vue_vue_type_script_setup_true_lang-c5c17fa7.js";import{_ as fe}from"./ErrorDummy.vue_vue_type_script_setup_true_lang-98a593a7.js";import{I as ve}from"./InputWithPerformers.vue_vue_type_script_setup_true_lang-07dbcaf8.js";import{F as N}from"./FieldCheckbox-618a9e12.js";import{_ as _e}from"./FormContactUpdate.vue_vue_type_script_setup_true_lang-a9fe6f34.js";import he from"./FormDealAdd-7842b6de.js";import{_ as be}from"./ContactInfo.vue_vue_type_script_setup_true_lang-723dde8f.js";import"./CustomColumn-c8c73188.js";import"./InputWithContacts.vue_vue_type_script_setup_true_lang-5a82d5a8.js";import"./UserPic-951b6ea8.js";import"./DropDown-2ad3ed01.js";import"./index-dbd22bf6.js";import"./validation-b14de04c.js";import"./iframeObserver-4dc3c410.js";import"./index-0f68ab4c.js";import"./DropdownModal-8fb9742c.js";import"./object_hash-770ac6b3.js";import"./useSortable-69b2c6e6.js";import"./SkeletonList-3dd02ff1.js";import"./LazyLoadingWithProgress.vue_vue_type_script_setup_true_lang-ee6b87e3.js";import"./EmptyList-5f0d3ac0.js";import"./ContactsListItems-f8df4621.js";import"./ChipsList-9ead41c5.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-6989a3b9.js";import"./dayjs-a1477631.js";import"./vTooltip-9ea5107e.js";import"./WaDialogOpener.vue_vue_type_script_setup_true_lang-49fe8b50.js";import"./FormAddTag.vue_vue_type_script_setup_true_lang-46537099.js";import"./WaSpinner-f3419042.js";import"./DropdownAddTags.vue_vue_type_script_setup_true_lang-02e057ea.js";import"./DropdownIncludeSegment.vue_vue_type_script_setup_true_lang-36941be2.js";import"./InputWithUsers.vue_vue_type_script_setup_true_lang-609436aa.js";import"./recentContacts-3e5f8df1.js";import"./FieldSelect-19a80dbd.js";import"./fields-e10d6cd3.js";import"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-c3cfd939.js";import"./SortableList.vue_vue_type_script_setup_true_lang-f84f3915.js";import"./TextAreaAutoresize-21a4dcce.js";import"./DropDownButton-49606824.js";import"./ButtonSubmit-c3bae343.js";import"./imageUrlToBase64-bf4bcddf.js";import"./TagsCloud.vue_vue_type_script_setup_true_lang-e5b75374.js";import"./emit-c388f0d7.js";import"./CustomField-e832abeb.js";import"./ButtonFavorites.vue_vue_type_script_setup_true_lang-5290af9e.js";const ye={class:"tw-flex tw-gap-x-1 tw-mt-2 tw-mb-6"},$e=["disabled","onClick"],we=e("span",{class:"tw-mr-1"},[e("i",{class:"fas fa-plus-circle"})],-1),Ce={key:0,class:"fields"},Se={class:"field"},ge={class:"name"},ke={class:"value"},Ie={class:"field"},Te={class:"name"},Ee={class:"value"},Ae={class:"field"},Ve={class:"name"},Fe={class:"value"},Be=["disabled","onClick"],Ne={class:"text-red"},De=j({__name:"FormContactAddEmployee",props:{toCompany:{},onSuccess:{type:Function}},emits:["close"],setup(p,{emit:c}){const f=p,b=S(),d=S(!1),o=S(null),v=S("");function a(t){var n,u;if(!t)return o.value=null,null;d.value=!1,o.value={id:t.id,name:t.name,jobtitle:t.jobtitle||"",company:t.company||"",email:((n=t.fields.find(w=>w.id==="email"))==null?void 0:n.value[0])??"",phone:((u=t.fields.find(w=>w.id==="phone"))==null?void 0:u.value[0])??""}}function _(){var t;d.value=!0,o.value=null,(t=b.value)==null||t.clearValue()}async function g(){if(v.value="",!o.value)return;const{error:t}=await K(`crm.contact.patch?id=${o.value.id}`).patch(JSON.stringify([{field:"company",value:f.toCompany.name},{field:"company_contact_id",value:f.toCompany.id},{field:"jobtitle",value:o.value.jobtitle}]));t.value||(c("close"),r()),v.value=t.value}function r(){typeof f.onSuccess=="function"&&f.onSuccess()}return(t,n)=>(m(),$(_e,{"hide-form":!d.value,"to-company":f.toCompany,onClose:n[2]||(n[2]=u=>c("close")),onSuccess:r},Q({header:l(()=>[Y(h(t.$t("addEmployee")),1)]),topBody:l(()=>[s(ve,{ref_key:"inputSearchContactsRef",ref:b,width:"320px","additional-hash":"contact_info.company.blank=1&contact_info.contact_type.person=1",placeholder:t.$t("searchByNameEmailPhone"),"with-fields":["email","phone","jobtitle"],"disable-not-editable":!0,onUpdate:a,onClear:n[0]||(n[0]=u=>a(null))},null,8,["additional-hash","placeholder"]),e("div",ye,[e("span",null,h(t.$t("or")),1),e("a",{class:"tw-font-semibold",disabled:d.value,onClick:D(_,["prevent"])},[we,e("span",null,h(t.$t("addNew")),1)],8,$e)]),s(J,{name:"fade",mode:"out-in"},{default:l(()=>[o.value?(m(),A("div",Ce,[e("div",Se,[e("div",ge,h(t.$t("jobTitle")),1),e("div",ke,[s(N,{modelValue:o.value.jobtitle,"onUpdate:modelValue":n[1]||(n[1]=u=>o.value.jobtitle=u),type:"text"},null,8,["modelValue"])])]),e("div",Ie,[e("div",Te,h(t.$t("phone")),1),e("div",Ee,[s(N,{"model-value":o.value.phone,type:"text",disabled:""},null,8,["model-value"])])]),e("div",Ae,[e("div",Ve,h(t.$t("email")),1),e("div",Fe,[s(N,{"model-value":o.value.email,type:"email",disabled:""},null,8,["model-value"])])])])):V("",!0)]),_:1})]),error:l(()=>[e("span",Ne,h(v.value),1)]),_:2},[o.value?{name:"submit",fn:l(()=>[e("button",{class:"button",disabled:!o.value,onClick:D(g,["prevent"])},h(t.$t("save")),9,Be)]),key:"0"}:void 0]),1032,["hide-form","to-company"]))}}),je={class:"tw-flex tw-flex-col tw-min-h-full md:tw-border-0 md:tw-border-solid md:tw-border-l md:tw-border-l-waBorder"},Pe=j({__name:"ContactTabs",props:{contactId:{}},setup(p){var w;const c=p,{contactId:f,isFetching:b,tabs:d}=T(W()),{contact:o,isFetching:v,error:a,statusCode:_}=T(O()),g=F(()=>b.value||v.value),r=F(()=>[403,404].includes(Number(_.value))&&a.value?a.value:null),t=S();X(()=>{f.value=c.contactId});const{t:n}=G(),u=S([]);return Z(()=>{var y;return(y=o.value)==null?void 0:y.id},()=>{var y;if(u.value=[],u.value.push({id:"addDeal",label:n("addDeal"),classIcon:"fas fa-funnel-dollar",clickHandler:()=>q(he,{contactId:c.contactId,disableNavigateToDeal:!0,onAdded:()=>{L.replace({name:"contactDealsTab"}),M(te).emit()}}).show()}),(y=o.value)!=null&&y.details.is_company){const R={id:o.value.id,name:o.value.main.name};u.value.push({id:"addEmployee",label:n("addEmployee"),classIcon:"fas fa-user-plus",clickHandler:()=>q(De,{toCompany:R,onSuccess:()=>{L.replace({name:"contactEmployeesTab"}),M(ae).emit()}}).show()})}},{immediate:String((w=o.value)==null?void 0:w.id)===c.contactId}),(y,R)=>{var U;return m(),A("div",je,[e("div",{class:H([{"mobile:!tw-hidden":r.value},"tabs-container bordered-bottom"])},[r.value?V("",!0):(m(),A(x,{key:0},[i(C).webView?V("",!0):(m(),$(ue,{key:0,ref_key:"tabsAddEntityButtonRef",ref:t,"entity-type":"contact","entity-id":c.contactId,"additional-actions":u.value,class:"tw-ml-4 tw-mr-3"},null,8,["entity-id","additional-actions"])),s(me,{"entity-type":"contact",value:i(d),"is-fetching":g.value},null,8,["value","is-fetching"])],64))],2),e("div",{class:H(["tw-relative tw-flex-auto tw-bg-waBlank tw-min-h-[340px]",{"tw-p-4 tw-pb-0":["contactHistoryTab","contactInvoicesTab"].includes(String(y.$route.name))}])},[r.value?(m(),$(fe,{key:0,code:i(_),message:r.value},null,8,["code","message"])):ee(y.$slots,"default",{key:1,addEntity:(U=t.value)==null?void 0:U.callAction},void 0,!0)],2)])}}});const Re=z(Pe,[["__scopeId","data-v-2293f73a"]]),P=p=>(le("data-v-c6f876a3"),p=p(),ce(),p),Ue={key:0,class:"sidebarHeader"},qe={class:"tw-overflow-hidden"},Le=P(()=>e("i",{class:"fas fa-arrow-left"},null,-1)),Me={class:"tw-truncate"},He=P(()=>e("i",{class:"fas fa-list-ul black"},null,-1)),Oe=[He],ze=P(()=>e("i",{class:"fas fa-times black"},null,-1)),Qe=[ze],Ye={class:"sidebarContainer"},Je={class:"sidebarList"},Ke={class:"sidebarInfo"},We=j({__name:"ContactView",props:{contactId:{}},setup(p){const c=p,f=F(()=>({context_contact_id:c.contactId})),{previousFetchParams:b}=T(oe()),{showSidebar:d}=T(de()),{contact:o}=T(O()),v=F(()=>{var a;return(a=o.value)!=null&&a.main&&Array.isArray(o.value.main.email)&&!o.value.main.email.length?"&noemail=1":""});return(a,_)=>{const g=se("RouterView");return m(),$(re,null,{sidebar:l(()=>{var r;return[i(C).webView?V("",!0):(m(),A("div",Ue,[e("div",qe,[e("a",{class:"tw-flex tw-space-x-3 tw-items-center black",onClick:_[0]||(_[0]=D(()=>{var t,n;a.$router.push(`/contact/${((n=(t=i(b))==null?void 0:t.hash)==null?void 0:n.replace("import/","import/result/").replace("crmSearch/","search/result/"))??""}`)},["prevent"]))},[Le,e("span",Me,h((r=i(b))!=null&&r.hash?i(b).title:a.$t("allContacts")),1)])]),e("button",{class:"circle transparent",onClick:_[1]||(_[1]=t=>d.value=!i(d))},[k(e("span",null,Oe,512),[[I,!i(d)]]),k(e("span",null,Qe,512),[[I,i(d)]])])])),e("div",Ye,[e("div",Je,[s(E,null,{default:l(()=>[s(pe,{"fetch-params":f.value,"hide-header":!0,"active-contact-id":c.contactId},null,8,["fetch-params","active-contact-id"])]),_:1})]),e("div",Ke,[s(be,{"contact-id":c.contactId},null,8,["contact-id"])])])]}),default:l(()=>[s(Re,{"contact-id":c.contactId},{default:l(({addEntity:r})=>[s(g,null,{default:l(({Component:t})=>[(m(),$(ne,null,[(m(),$(ie(t),{key:a.$route.fullPath,onAddEntity:r},null,40,["onAddEntity"]))],1024)),k(e("div",null,[s(E,null,{default:l(()=>[s(B,{src:`${i(C).baseUrl}call/?iframe=1&contact=${a.$route.params.id}${a.$route.query.focus?"&focus=1":""}`},null,8,["src"])]),_:1})],512),[[I,a.$route.name==="contactCallsTab"]]),k(e("div",null,[s(E,null,{default:l(()=>[(m(),$(B,{key:String(a.$route.query.conversationId)+v.value,"is-pre-fetching":!i(o),src:a.$route.query.conversationId?`${i(C).baseUrl}message/conversation/${a.$route.query.conversationId}/?iframe=1&contact=${a.$route.params.id}${v.value}`:`${i(C).baseUrl}message/?iframe=1&contact=${a.$route.params.id}${a.$route.query.focus?"&focus=1":""}${v.value}`,"disable-resize":!0,"fixed-height-mobile":!0},null,8,["is-pre-fetching","src"]))]),_:1})],512),[[I,a.$route.name==="contactMessagesTab"]]),k(e("div",null,[s(E,null,{default:l(()=>[s(B,{src:`${i(C).baseUrl}reminder/all/?iframe=1&contact=${a.$route.params.id}${a.$route.query.focus?"&focus=1":""}`},null,8,["src"])]),_:1})],512),[[I,a.$route.name==="contactRemindersTab"]])]),_:2},1024)]),_:1},8,["contact-id"])]),_:1})}}});const Yt=z(We,[["__scopeId","data-v-c6f876a3"]]);export{Yt as default};
