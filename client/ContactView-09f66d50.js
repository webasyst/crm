import{d as V,t as T,L as x,M as J,u as a,o as i,c as d,b as n,w as r,F as I,q as M,p,i as $,a as e,j as E,A as K,e as D,B as k,h as S,N as Z,T as G,O as ee,P as te,l as U,H as ae,Q as se,R as oe,S as z,U as Q,V as Y,n as q,r as ne,W as ie,X as le,_ as X,y as ce,m as re,k as A,v as B,Y as de,Z as ue,$ as me,s as pe,x as _e}from"./main-d7f03521.js";import{_ as fe}from"./ViewWithSidebar.vue_vue_type_style_index_0_lang-364116fe.js";import{u as ve}from"./FormSegmentUpdate.vue_vue_type_script_setup_true_lang-2a942c20.js";import W from"./IframeView-f8660ec0.js";import{T as he,_ as we,a as be,b as P}from"./TabList-8d2eb9e4.js";import{_ as $e}from"./ContactsList.vue_vue_type_script_setup_true_lang-cc167d84.js";import{_ as ye,a as ge}from"./ContactInfo.vue_vue_type_script_setup_true_lang-cdfc041a.js";import{U as ke}from"./UserPic-c11efadd.js";import{E as Ce}from"./EmptyList-ca1e10b8.js";import{C as j}from"./CustomField-aefbde99.js";import{C as F}from"./CustomColumn-83646d88.js";import{_ as Ie}from"./ErrorDummy.vue_vue_type_script_setup_true_lang-2e2d0418.js";import{I as Se}from"./InputWithPerformers.vue_vue_type_script_setup_true_lang-47aeec90.js";import{F as L}from"./FieldCheckbox-2a93227f.js";import{_ as Te}from"./FormContactUpdate.vue_vue_type_script_setup_true_lang-9d372261.js";import Ee from"./FormDealAdd-d9b7ad91.js";import"./InputWithContacts.vue_vue_type_script_setup_true_lang-941f63e0.js";import"./DropDown-7a0f8902.js";import"./index-dc17eb5d.js";import"./validation-c851d981.js";import"./iframeObserver-7b20ae08.js";import"./index-884c82be.js";import"./DropdownModal-9b06143e.js";import"./object_hash-44c1703e.js";import"./useSortable-eb883c7d.js";import"./SkeletonList-27785815.js";import"./LazyLoadingWithProgress.vue_vue_type_script_setup_true_lang-37f08611.js";import"./ContactsListItems-524bb343.js";import"./ChipsList-ee14164a.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-d7adf9ef.js";import"./dayjs-8b9f8f59.js";import"./vTooltip-95186f83.js";import"./WaDialogOpener.vue_vue_type_script_setup_true_lang-3fb68752.js";import"./FormFields.vue_vue_type_script_setup_true_lang-461a1a71.js";import"./WaSpinner-49827d4a.js";import"./DropdownAddTags.vue_vue_type_script_setup_true_lang-fb37638e.js";import"./WaDialogLoading.vue_vue_type_script_setup_true_lang-5cab029d.js";import"./DropdownIncludeSegment.vue_vue_type_script_setup_true_lang-adb969f2.js";import"./InputWithUsers.vue_vue_type_script_setup_true_lang-7a9acbb7.js";import"./ButtonSubmit-bbd5ca4e.js";import"./imageUrlToBase64-bf4bcddf.js";import"./TagsCloud.vue_vue_type_script_setup_true_lang-11109664.js";import"./emit-b4342586.js";import"./TextAreaAutoresize-64fc87cf.js";import"./recentContacts-8eea64ba.js";import"./ButtonFavorites.vue_vue_type_script_setup_true_lang-2d595162.js";import"./FieldSelect-ae6f0f9b.js";import"./fields-39e1f9f0.js";import"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-953db84b.js";import"./SortableList.vue_vue_type_script_setup_true_lang-43da3720.js";import"./DropDownButton-b07233c5.js";const Ae={key:0,class:"tw-bg-waBackground tw-p-4 tw-min-h-[4rem]"},Be={key:1,class:"tw-bg-waBackground tw-p-4 tw-min-h-[4rem]"},Fe=e("span",{class:"icon size-32"},[e("i",{class:"fas fa-user-slash"})],-1),Ve={key:2,class:"state-error-hint tw-bg-waBackground tw-p-4 tw-min-h-[4rem]"},Ne={class:"tw-flex tw-items-center tw-gap-2 tw-py-0.5 tw-ml-4 tw-mr-12"},Me={class:"bold text-ellipsis"},Pe={class:"tw-bg-waBackground tw-p-4 tw-pt-0 tw-min-h-[4rem]"},De=V({__name:"WidgetContactInfo",props:{contactId:{}},setup(f){const c=f,{fetchId:u,contact:m,isFetching:_,error:s,statusCode:h,contact:w}=T(x());return J(()=>{u.value=c.contactId}),(o,y)=>{var v;return a(_)||((v=a(s))==null?void 0:v.code)===20?(i(),d("div",Ae,[n(F,{space:"4"},{default:r(()=>[(i(),d(I,null,M(2,t=>n(F,{key:t,space:"2"},{default:r(()=>[(i(),d(I,null,M(2,l=>n(j,{key:l,skeleton:!0})),64))]),_:2},1024)),64))]),_:1})])):[403,404].includes(Number(a(h)))?(i(),d("div",Be,[n(Ce,{message:""},{default:r(()=>[Fe]),_:1})])):a(s)?(i(),d("div",Ve,p(a(s)),1)):a(m)&&"id"in a(m)?(i(),d(I,{key:3},[a(w)?(i(),$(he,{key:0,"disable-animation":!0,class:"-tw-mt-12 tw-pb-2"},{default:r(()=>{var t;return[e("div",Ne,[n(ke,{url:(t=a(w).userpic)==null?void 0:t.thumb,size:32},null,8,["url"]),e("span",Me,p(a(w).main.name),1)])]}),_:1})):E("",!0),e("div",Pe,[n(F,{space:"4",align:"center"},{default:r(()=>[n(F,{space:"2",align:"center",class:"width-100"},{default:r(()=>[n(ye,{small:!0,"disable-edit":!0,class:"tw-flex-1 tw-max-w-[5rem]"}),n(j,{value:`${a(m).main.title??""} ${a(m).main.name}`.trim(),class:"bold black tw-text-center break-words md:tw-text-left group-hover/link:tw-text-waAccent"},null,8,["value"])]),_:1}),n(F,{space:"2"},{default:r(()=>[(i(!0),d(I,null,M(new Array("email","phone"),t=>(i(),d(I,null,[(i(!0),d(I,null,M(a(m).main[t],l=>(i(),$(j,{key:l.value,value:l,type:t,"contact-id":c.contactId,class:"tw-text-sm"},null,8,["value","type","contact-id"]))),128))],64))),256))]),_:1})]),_:1})])],64)):E("",!0)}}}),Ue={class:"align-center"},Re={class:"small"},We=e("i",{class:"fas fa-star text-yellow"},null,-1),je={class:"custom-my-16"},Le=["href"],qe=["onClick"],xe=V({__name:"PremiumBlock",setup(f){const c=()=>{document.documentElement.dispatchEvent(new Event("spa:hideWidget"))};return(u,m)=>(i(),d("div",Ue,[e("p",Re,[We,K(" "+p(u.$t("only_premium")),1)]),e("div",je,[e("a",{class:"button yellow rounded",href:`${a(k).baseUrl}upgrade/`,target:"_blank"},p(u.$t("whats_in_premium")),9,Le)]),e("div",null,[e("button",{class:"button nobuttom rounded gray",type:"button",onClick:D(c,["prevent"])},p(u.$t("not_now_thanks")),9,qe)])]))}}),He={class:"tw-flex tw-gap-x-1 tw-mt-2 tw-mb-6"},Oe=["disabled","onClick"],ze=e("span",{class:"tw-mr-1"},[e("i",{class:"fas fa-plus-circle"})],-1),Qe={key:0,class:"fields"},Ye={class:"field"},Je={class:"name"},Ke={class:"value"},Xe={class:"field"},Ze={class:"name"},Ge={class:"value"},et={class:"field"},tt={class:"name"},at={class:"value"},st=["disabled","onClick"],ot={class:"text-red"},nt=V({__name:"FormContactAddEmployee",props:{toCompany:{},onSuccess:{type:Function}},emits:["close"],setup(f,{emit:c}){const u=f,m=S(),_=S(!1),s=S(null),h=S("");function w(t){var l,b;if(!t)return s.value=null,null;_.value=!1,s.value={id:t.id,name:t.name,jobtitle:t.jobtitle||"",company:t.company||"",email:((l=t.fields.find(C=>C.id==="email"))==null?void 0:l.value[0])??"",phone:((b=t.fields.find(C=>C.id==="phone"))==null?void 0:b.value[0])??""}}function o(){var t;_.value=!0,s.value=null,(t=m.value)==null||t.clearValue()}async function y(){if(h.value="",!s.value)return;const{error:t}=await ee(`crm.contact.patch?id=${s.value.id}`).patch(JSON.stringify([{field:"company",value:u.toCompany.name},{field:"company_contact_id",value:u.toCompany.id},{field:"jobtitle",value:s.value.jobtitle}]));t.value||(c("close"),v()),h.value=t.value}function v(){typeof u.onSuccess=="function"&&u.onSuccess()}return(t,l)=>(i(),$(Te,{"hide-form":!_.value,"to-company":u.toCompany,onClose:l[2]||(l[2]=b=>c("close")),onSuccess:v},Z({header:r(()=>[K(p(t.$t("addEmployee")),1)]),topBody:r(()=>[n(Se,{ref_key:"inputSearchContactsRef",ref:m,width:"320px","additional-hash":"contact_info.company.blank=1&contact_info.contact_type.person=1",placeholder:t.$t("searchByNameEmailPhone"),"with-fields":["email","phone","jobtitle"],"disable-not-editable":!0,onUpdate:w,onClear:l[0]||(l[0]=b=>w(null))},null,8,["additional-hash","placeholder"]),e("div",He,[e("span",null,p(t.$t("or")),1),e("a",{class:"tw-font-semibold",disabled:_.value,onClick:D(o,["prevent"])},[ze,e("span",null,p(t.$t("addNew")),1)],8,Oe)]),n(G,{name:"fade",mode:"out-in"},{default:r(()=>[s.value?(i(),d("div",Qe,[e("div",Ye,[e("div",Je,p(t.$t("jobTitle")),1),e("div",Ke,[n(L,{modelValue:s.value.jobtitle,"onUpdate:modelValue":l[1]||(l[1]=b=>s.value.jobtitle=b),type:"text"},null,8,["modelValue"])])]),e("div",Xe,[e("div",Ze,p(t.$t("phone")),1),e("div",Ge,[n(L,{"model-value":s.value.phone,type:"text",disabled:""},null,8,["model-value"])])]),e("div",et,[e("div",tt,p(t.$t("email")),1),e("div",at,[n(L,{"model-value":s.value.email,type:"email",disabled:""},null,8,["model-value"])])])])):E("",!0)]),_:1})]),error:r(()=>[e("span",ot,p(h.value),1)]),_:2},[s.value?{name:"submit",fn:r(()=>[e("button",{class:"button",disabled:!s.value,onClick:D(y,["prevent"])},p(t.$t("save")),9,st)]),key:"0"}:void 0]),1032,["hide-form","to-company"]))}}),it={class:"tw-flex tw-flex-col tw-min-h-full md:tw-border-0 md:tw-border-solid md:tw-border-l md:tw-border-l-waBorder"},lt={key:1,class:"custom-p-16 custom-mt-8"},ct=V({__name:"ContactTabs",props:{contactId:{}},setup(f){var O;const c=f,{contactId:u,isFetching:m,tabs:_}=T(te()),{contact:s,isFetching:h,error:w,statusCode:o}=T(x()),y=U(()=>m.value||h.value),v=U(()=>[403,404].includes(Number(o.value))&&w.value?w.value:null),t=S();J(()=>{u.value=c.contactId});const{t:l}=ae(),b=se(),C=S([]);return oe(()=>{var g;return(g=s.value)==null?void 0:g.id},()=>{var g,R;if(C.value=[],(g=k.rights)!=null&&g.deal&&!b.meta.isWidgetMode&&C.value.push({id:"addDeal",label:l("addDeal"),classIcon:"fas fa-briefcase",clickHandler:()=>z(Ee,{contactId:c.contactId,disableNavigateToDeal:!0,onAdded:()=>{Q.replace({name:"contactDealsTab"}),Y(ie).emit()}}).show()}),(R=s.value)!=null&&R.details.is_company){const N={id:s.value.id,name:s.value.main.name};C.value.push({id:"addEmployee",label:l("addEmployee"),classIcon:"fas fa-user-plus",clickHandler:()=>z(nt,{toCompany:N,onSuccess:()=>{Q.replace({name:"contactEmployeesTab"}),Y(le).emit()}}).show()})}},{immediate:String((O=s.value)==null?void 0:O.id)===c.contactId}),(g,R)=>{var N;return i(),d("div",it,[e("div",{class:q([{"mobile:!tw-hidden":v.value},"tabs-container bordered-bottom"])},[v.value?E("",!0):(i(),d(I,{key:0},[a(k).webView?E("",!0):(i(),$(we,{key:0,ref_key:"tabsAddEntityButtonRef",ref:t,"entity-type":"contact","entity-id":c.contactId,"additional-actions":C.value,class:"tw-ml-4 tw-mr-3"},null,8,["entity-id","additional-actions"])),n(be,{"entity-type":"contact",value:a(_),"is-fetching":y.value},null,8,["value","is-fetching"])],64))],2),e("div",{class:q(["tw-relative tw-flex-auto tw-bg-waBlank tw-min-h-[340px]",{"tw-p-4 tw-pb-0":["contactHistoryTab","contactInvoicesTab"].includes(String(g.$route.name))}])},[v.value?(i(),$(Ie,{key:0,code:a(o),message:v.value},null,8,["code","message"])):g.$route.meta.isWidgetMode&&!a(k).is_premium?(i(),d("div",lt,[n(xe)])):ne(g.$slots,"default",{key:2,addEntity:(N=t.value)==null?void 0:N.callAction},void 0,!0)],2)])}}});const rt=X(ct,[["__scopeId","data-v-3219c20d"]]),H=f=>(pe("data-v-34c21c5e"),f=f(),_e(),f),dt={key:0,class:"sidebarHeader"},ut={class:"tw-overflow-hidden"},mt=H(()=>e("i",{class:"fas fa-arrow-left"},null,-1)),pt={class:"tw-truncate"},_t=H(()=>e("i",{class:"fas fa-list-ul black"},null,-1)),ft=[_t],vt=H(()=>e("i",{class:"fas fa-times black"},null,-1)),ht=[vt],wt={class:"sidebarContainer"},bt={class:"sidebarList"},$t={class:"sidebarInfo"},yt=V({__name:"ContactView",props:{contactId:{},isWidgetMode:{type:Boolean}},setup(f){const c=f,u=U(()=>({context_contact_id:c.contactId})),{previousFetchParams:m}=T(ce()),{showSidebar:_}=T(ve()),{contact:s}=T(x()),h=U(()=>{var o;return(o=s.value)!=null&&o.main&&Array.isArray(s.value.main.email)&&!s.value.main.email.length?"&noemail=1":""}),w=()=>{c.isWidgetMode&&setTimeout(()=>{window.scrollTo({top:me(),left:0,behavior:"smooth"})},50)};return(o,y)=>{const v=re("RouterView");return i(),$(fe,null,{sidebar:r(()=>{var t;return[c.isWidgetMode?(i(),$(De,{key:0,"contact-id":c.contactId},null,8,["contact-id"])):(i(),d(I,{key:1},[a(k).webView?E("",!0):(i(),d("div",dt,[e("div",ut,[e("a",{class:"tw-flex tw-space-x-3 tw-items-center black",onClick:y[0]||(y[0]=D(()=>{var l,b;o.$router.push(`/contact/${((b=(l=a(m))==null?void 0:l.hash)==null?void 0:b.replace("import/","import/result/").replace("crmSearch/","search/result/"))??""}`)},["prevent"]))},[mt,e("span",pt,p((t=a(m))!=null&&t.hash?a(m).title:o.$t("allContacts")),1)])]),e("button",{class:"circle transparent",onClick:y[1]||(y[1]=l=>_.value=!a(_))},[A(e("span",null,ft,512),[[B,!a(_)]]),A(e("span",null,ht,512),[[B,a(_)]])])])),e("div",wt,[e("div",bt,[n(P,null,{default:r(()=>[n($e,{"fetch-params":u.value,"hide-header":!0,"active-contact-id":c.contactId},null,8,["fetch-params","active-contact-id"])]),_:1})]),e("div",$t,[n(ge,{"contact-id":c.contactId},null,8,["contact-id"])])])],64))]}),default:r(()=>[n(rt,{"contact-id":c.contactId},{default:r(({addEntity:t})=>[n(v,null,{default:r(({Component:l})=>[(i(),$(de,null,[(i(),$(ue(l),{key:o.$route.fullPath,onAddEntity:t},null,40,["onAddEntity"]))],1024)),A(e("div",null,[n(P,null,{default:r(()=>[n(W,{src:`${a(k).baseUrl}call/?iframe=1&contact=${o.$route.params.id}${o.$route.query.focus?"&focus=1":""}`},null,8,["src"])]),_:1})],512),[[B,o.$route.name==="contactCallsTab"]]),A(e("div",null,[n(P,null,{default:r(()=>[(i(),$(W,{key:String(o.$route.query.conversationId)+h.value,"is-pre-fetching":!a(s),src:o.$route.query.conversationId?`${a(k).baseUrl}message/conversation/${o.$route.query.conversationId}/?iframe=1&contact=${o.$route.params.id}${h.value}`:`${a(k).baseUrl}message/?iframe=1&contact=${o.$route.params.id}${o.$route.query.focus?"&focus=1":""}${h.value}`,"disable-resize":!0,"fixed-height-mobile":!o.$route.meta.isWidgetMode,class:q(o.$route.meta.isWidgetMode?"mobile:tw-min-h-[calc(100vh-6.5rem)] supports-[height:1dvh]:mobile:tw-min-h-[calc(100dvh-6.5rem)]":""),onLoaded:w},null,8,["is-pre-fetching","src","fixed-height-mobile","class"]))]),_:1})],512),[[B,o.$route.name==="contactMessagesTab"]]),A(e("div",null,[n(P,null,{default:r(()=>[n(W,{src:`${a(k).baseUrl}reminder/all/?iframe=1&contact=${o.$route.params.id}${o.$route.query.focus?"&focus=1":""}`},null,8,["src"])]),_:1})],512),[[B,o.$route.name==="contactRemindersTab"]])]),_:2},1024)]),_:1},8,["contact-id"])]),_:1})}}});const ba=X(yt,[["__scopeId","data-v-34c21c5e"]]);export{ba as default};
