import{d as R,o as t,c as o,n as g,i as s,H as se,a as k,X as E,A as Q,ag as te,ah as ae,N as oe,e as u,w as c,F as C,l as I,g as d,m as N,k as i,b as h,p as m,f as z,B as le,q as ne,s as ce,T as ie,_ as re}from"./main-14ee4927.js";import{U as V}from"./UserPic-88a434b2.js";import{S as ue}from"./SkeletonList-eb58974a.js";import{E as de}from"./EmptyList-32476ed0.js";import{_ as _e}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-2d6d5100.js";import{f as pe}from"./imageUrlToBase64-bf4bcddf.js";import{d as P}from"./dayjs-733f6bc6.js";import{d as U}from"./downloadFile-07c60fdd.js";import{M as S,D as B,_ as b}from"./DropDown-3d660bad.js";import{D as q}from"./DropDownButton-4f1c8b7b.js";import"./CustomColumn-9af7d856.js";import"./index-927b8924.js";const ve={key:0},he=s("i",{class:"fas fa-file-pdf"},null,-1),me=[he],ye={key:1},fe=s("i",{class:"fas fa-file-word"},null,-1),ke=[fe],xe={key:2},we=s("i",{class:"fas fa-file-excel"},null,-1),$e=[we],be={key:3},ge=s("i",{class:"fas fa-file-powerpoint"},null,-1),Fe=[ge],Ce={key:4},ze=s("i",{class:"fas fa-file-csv"},null,-1),Le=[ze],Te={key:5},De=s("i",{class:"fas fa-file-archive"},null,-1),Ie=[De],Ae={key:6},Se=s("i",{class:"fas fa-file-code"},null,-1),Be=[Se],Me={key:7},je=s("i",{class:"fas fa-file-image"},null,-1),Ee=[je],Ne={key:8},Ve=s("i",{class:"fas fa-file-video"},null,-1),Pe=[Ve],Ue={key:9},qe=s("i",{class:"fas fa-file-audio"},null,-1),Ge=[qe],He={key:10},Ke=s("i",{class:"fas fa-file-alt"},null,-1),Oe=[Ke],Xe=R({__name:"FileIcon",props:{ext:{},class:{}},setup(x){const r=x;return(M,w)=>(t(),o("span",{class:g(r==null?void 0:r.class)},[r.ext==="pdf"?(t(),o("span",ve,me)):["doc","docx","odt"].includes(r.ext)?(t(),o("span",ye,ke)):r.ext==="xls"||r.ext==="xlsx"?(t(),o("span",xe,$e)):r.ext==="ppt"||r.ext==="pptx"?(t(),o("span",be,Fe)):r.ext==="csv"?(t(),o("span",Ce,Le)):["gz","zip","arj","rar","tar","7z","bz"].includes(r.ext)?(t(),o("span",Te,Ie)):["htm","html","php","js","css","style","vue","cpp","java","kt","conf","sh"].includes(r.ext)?(t(),o("span",Ae,Be)):["bmp","tiff","gif","png","jpg","webp","jpeg"].includes(r.ext)?(t(),o("span",Me,Ee)):["mp4","avi","mkv"].includes(r.ext)?(t(),o("span",Ne,Pe)):["mp3","ogg"].includes(r.ext)?(t(),o("span",Ue,Ge)):(t(),o("span",He,Oe))],2))}}),y=x=>(ne("data-v-62aa81ab"),x=x(),ce(),x),Je={class:"article wider"},Qe={class:"article-body custom-pt-0"},Re={class:"flexbox middle wrap space-16"},We=["onClick"],Ye=["onClick"],Ze=["onClick"],es=y(()=>s("hr",{class:"custom-mb-0"},null,-1)),ss=["onClick"],ts={key:1},as=y(()=>s("i",{class:"fas fa-users"},null,-1)),os=[as],ls=["onClick"],ns=y(()=>s("div",{class:"icon"},[s("i",{class:"fas fa-users"})],-1)),cs=["onClick"],is={class:"icon"},rs=["disabled"],us={key:0},ds=y(()=>s("i",{class:"fas fa-plus"},null,-1)),_s=[ds],ps={key:1,class:"spinner"},vs={key:0},hs={key:1,class:"tw-mt-0 tw-p-4"},ms={key:0},ys={key:0,class:"flexbox wrap space-16"},fs=["onClick"],ks={class:"align-center wide"},xs=["href","onClick"],ws=["src"],$s={key:1,class:"largest"},bs={class:"details custom-pt-0"},gs={class:"flexbox space-8 middle full-width"},Fs=["title"],Cs=["href","onClick"],zs={class:"text-ellipsis semibold opacity-90"},Ls={class:"black"},Ts=y(()=>s("a",{class:"tw-text-waText hover:tw-text-waText tw-opacity-50 custom-pl-12"},[s("i",{class:"fas fa-ellipsis-v"})],-1)),Ds={class:"box",style:{"overflow-wrap":"break-word"}},Is=y(()=>s("hr",{class:"custom-mb-8"},null,-1)),As={key:0,class:"small flexbox space-8 custom-mb-4 custom-mx-12"},Ss=["title"],Bs={class:"small flexbox space-8 custom-mb-4 custom-mx-12"},Ms=y(()=>s("div",{class:"icon size-16"},null,-1)),js={class:"small"},Es=["onClick"],Ns=y(()=>s("div",{class:"icon size-16"},[s("i",{class:"fas fa-trash-alt"})],-1)),Vs={class:"small"},Ps={key:0,class:"small"},Us={class:"smaller flexbox full-width wrap space-16 custom-mb-8"},qs={key:0},Gs={key:1},Hs={key:2},Ks=y(()=>s("div",{class:"icon size-80"},[s("i",{class:"fas fa-file"})],-1)),Os=R({__name:"FilesTab",props:{entityType:{},entityId:{},focusInput:{type:Boolean}},setup(x){const r=x,M=`${r.entityType}_id`,{t:w}=se(),p=k("ALL"),G=new Map([["ALL",w("allSources")],["FILE",w("fromFiles")],["MESSAGE",w("fromMessages")],["NOTE",w("fromNotes")]]),v=k(0),_=k(0),L=k([]),A=k(new Map),T=k(new Map),H=k([]),D=k(!1),$=E(`crm.file.list?${M}=${r.entityId}&thumb_size=256`).get().json(),W=Q(()=>D.value),j=Q(()=>L.value.filter(a=>(p.value==="ALL"||a.source_type===p.value)&&O(a,v.value)&&X(a,_.value))),{open:K,onChange:Y}=te(),O=(a,n)=>{var e;return n===0||n===-1&&!(a!=null&&a.deal)||((e=a==null?void 0:a.deal)==null?void 0:e.id)===n},X=(a,n)=>{var e;return n===0||((e=a==null?void 0:a.creator)==null?void 0:e.id)===n},f=(a,n=v.value,e=_.value)=>!!L.value.find(l=>(a==="ALL"||l.source_type===a)&&O(l,n)&&X(l,e));ae(()=>{r.focusInput&&K()}),oe(()=>{Array.isArray($.data.value)&&(L.value=$.data.value,A.value=L.value.reduce((a,n)=>!(n!=null&&n.deal)||a.has(n.deal.id)?a:a.set(n.deal.id,n.deal.name),new Map),T.value=L.value.reduce((a,n)=>!(n!=null&&n.creator)||a.has(n.creator.id)?a:a.set(n.creator.id,n.creator),new Map))}),Y(a=>{a&&Z(Array.from(a))});async function Z(a){a&&(D.value=!0,await Promise.all(Array.from(a).map(async n=>{const e=await pe(n);if(e){const{error:l}=await E("crm.file.add").post({file:e,file_name:n.name,[M]:r.entityId});if(l.value)return Promise.reject(l.value)}})),await $.execute(),D.value=!1)}async function ee(a){const{show:n,hide:e}=ie(_e,{message:w("confirmDeleteFile"),buttonText:w("delete"),onSubmit:async()=>{const{error:l}=await E(`crm.file.delete?id=${a}`).delete();l.value||$.execute(),e()}});n()}return(a,n)=>(t(),o("div",Je,[s("div",Qe,[s("div",{class:g(["tw-sticky tw-bg-waBlank tw-z-20 tw-p-4",{"files-tab__panel":r.entityType==="contact"}])},[s("div",Re,[u(B,null,{body:c(({hide:e})=>[u(S,null,{default:c(()=>[(t(!0),o(C,null,I(d(G),([l,F])=>(t(),h(b,{key:l},{default:c(()=>[s("a",{onClick:m(J=>{f(l)&&(p.value=l,e())},["prevent"])},[s("span",{class:g({gray:!f(l)})},i(F),3)],8,We)]),_:2},1024))),128))]),_:2},1024)]),default:c(()=>[u(q,{small:!0},{title:c(()=>[N(i(d(G).get(p.value)),1)]),_:1})]),_:1}),A.value.size>0?(t(),h(B,{key:0},{body:c(({hide:e})=>[u(S,null,{default:c(()=>[(t(),h(b,{key:0},{default:c(()=>[s("a",{onClick:m(l=>{v.value=0,e()},["prevent"])},[s("span",null,i(a.$t("allDeals")),1)],8,Ye)]),_:2},1024)),(t(),h(b,{key:-1},{default:c(()=>[s("a",{onClick:m(l=>{f(p.value,-1,_.value)&&(v.value=-1,e())},["prevent"])},[s("span",{class:g({gray:!f(p.value,-1,_.value)})},i(a.$t("withoutDeal")),3)],8,Ze)]),_:2},1024)),es,(t(!0),o(C,null,I(A.value,([l,F])=>(t(),h(b,{key:l},{default:c(()=>[s("a",{onClick:m(J=>{f(p.value,l,_.value)&&(v.value=l,e())},["prevent"])},[s("span",{class:g({gray:!f(p.value,l,_.value)})},i(F),3)],8,ss)]),_:2},1024))),128))]),_:2},1024)]),default:c(()=>[u(q,{small:!0},{title:c(()=>[N(i(v.value===0?a.$t("allDeals"):v.value===-1?a.$t("withoutDeal"):A.value.get(v.value)),1)]),_:1})]),_:1})):z("",!0),T.value.size>1?(t(),h(B,{key:1},{body:c(({hide:e})=>[u(S,null,{default:c(()=>[(t(),h(b,{key:0},{default:c(()=>[s("a",{onClick:m(l=>{_.value=0,e()},["prevent"])},[ns,s("span",null,i(a.$t("allAuthors")),1)],8,ls)]),_:2},1024)),(t(!0),o(C,null,I(T.value,([l,F])=>(t(),h(b,{key:l},{default:c(()=>[s("a",{onClick:m(J=>{f(p.value,v.value,l)&&(_.value=l,e())},["prevent"])},[s("div",is,[u(V,{size:10,url:F.userpic},null,8,["url"])]),s("span",{class:g({gray:!f(p.value,v.value,l)})},i(F.name),3)],8,cs)]),_:2},1024))),128))]),_:2},1024)]),default:c(()=>[u(q,{small:!0},{icon:c(()=>{var e;return[_.value>0?(t(),h(V,{key:0,size:16,url:(e=T.value.get(_.value))==null?void 0:e.userpic},null,8,["url"])):(t(),o("span",ts,os))]}),title:c(()=>{var e;return[N(i(_.value===0?a.$t("allAuthors"):(e=T.value.get(_.value))==null?void 0:e.name),1)]}),_:1})]),_:1})):z("",!0),["ALL","FILES"].includes(p.value)&&[0,-1].includes(v.value)?(t(),o("button",{key:2,class:"tw-flex-none circle nobutton",disabled:W.value,onClick:n[0]||(n[0]=()=>{D.value||d(K)()})},[D.value?(t(),o("div",ps)):(t(),o("span",us,_s))],8,rs)):z("",!0)]),H.value.length?(t(),o("div",vs,[(t(!0),o(C,null,I(H.value,(e,l)=>(t(),o("div",{key:l},i(e),1))),128))])):z("",!0)],2),!j.value.length&&d($).isFetching.value?(t(),h(ue,{key:0,class:"tw-max-w-3xl tw-px-4"})):(t(),o("div",hs,[d($).error.value?(t(),o("div",ms,i(d($).error.value),1)):(t(),o(C,{key:1},[j.value.length?(t(),o("div",ys,[(t(!0),o(C,null,I(j.value,e=>(t(),o("figure",{key:e.id,class:"card"},[s("div",{class:"image flexbox middle full-width cursor-pointer",onClick:m(l=>d(U)(e.url,e.id,e.name),["prevent"])},[s("div",ks,[s("a",{class:g(["js-disable-router",{"wa-gallery-image":!!(e!=null&&e.thumb_url)}]),href:e.url,onClick:m(l=>d(U)(e.url,e.id,e.name),["prevent"])},[e!=null&&e.thumb_url&&!d(le).webView?(t(),o("img",{key:0,src:e.thumb_url},null,8,ws)):(t(),o("span",$s,[u(Xe,{ext:e.ext,class:"large"},null,8,["ext"])]))],10,xs)])],8,fs),s("div",bs,[s("div",gs,[s("h5",{class:"small text-ellipsis wide custom-mt-16",title:e.name},[s("a",{class:"flexbox js-disable-router",href:e.url,style:{color:"var(--text-color)"},onClick:m(l=>d(U)(e.url,e.id,e.name),["prevent"])},[s("span",zs,i(e.name.replace(/\.[^/.]+$/,"")),1),s("span",Ls,"."+i(e.ext),1)],8,Cs)],8,Fs),u(B,{right:!0,"enable-correct-top":!0,width:"250px"},{body:c(({hide:l})=>[s("div",Ds,i(e.name),1),Is,e.creator?(t(),o("div",As,[u(V,{size:16,url:e.creator.userpic},null,8,["url"]),s("span",{class:"small tw-truncate",title:e.creator.name},i(e.creator.name),9,Ss)])):z("",!0),s("div",Bs,[Ms,s("div",js,i(d(P)(e.create_datetime).format("LLL")),1)]),u(S,null,{default:c(()=>[u(b,null,{default:c(()=>[s("a",{onClick:m(()=>{ee(e.id),l()},["prevent"])},[Ns,s("span",Vs,i(a.$t("deleteFile")),1)],8,Es)]),_:2},1024)]),_:2},1024)]),default:c(()=>[Ts]),_:2},1024)]),e!=null&&e.comment?(t(),o("p",Ps,i(e.comment),1)):z("",!0),s("div",Us,[e.size>1048576?(t(),o("span",qs,i((e.size/1048576).toFixed(1))+" MB",1)):e.size>1024?(t(),o("span",Gs,i((e.size/1024).toFixed(1))+" KB",1)):(t(),o("span",Hs,i(e.size)+" B",1)),s("span",null,i(d(P)(e.create_datetime).format(d(P)(e.create_datetime).isToday()?"LT":"L")),1)])])]))),128))])):(t(),h(de,{key:1,message:a.$t("notFoundFiles")},{default:c(()=>[Ks]),_:1},8,["message"]))],64))]))])]))}});const lt=re(Os,[["__scopeId","data-v-62aa81ab"]]);export{lt as default};
