import{d as R,o as t,c as o,n as g,a as s,H as se,h as k,X as N,l as Q,ag as te,ah as ae,ai as oe,N as le,b as d,w as c,F,q as D,u,A as V,p as i,i as m,e as h,j as z,B as ne,s as ce,x as ie,T as re,_ as ue}from"./main-82f77a11.js";import{U as P}from"./UserPic-92d000dd.js";import{S as de}from"./SkeletonList-40d3d5be.js";import{E as _e}from"./EmptyList-1155962a.js";import{_ as pe}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-356df894.js";import{f as ve}from"./imageUrlToBase64-bf4bcddf.js";import{d as U}from"./dayjs-82f63efd.js";import{d as j}from"./downloadFile-377fc47d.js";import{M as A,D as M,_ as b}from"./DropDown-79d42973.js";import{D as q}from"./DropDownButton-cbddcefc.js";import"./CustomColumn-096f9d5b.js";import"./index-0a4f4028.js";const me={key:0},he=s("i",{class:"fas fa-file-pdf"},null,-1),ye=[he],we={key:1},ke=s("i",{class:"fas fa-file-word"},null,-1),xe=[ke],$e={key:2},fe=s("i",{class:"fas fa-file-excel"},null,-1),be=[fe],ge={key:3},Ce=s("i",{class:"fas fa-file-powerpoint"},null,-1),Fe=[Ce],ze={key:4},Le=s("i",{class:"fas fa-file-csv"},null,-1),Ee=[Le],Te={key:5},De=s("i",{class:"fas fa-file-archive"},null,-1),Ie=[De],je={key:6},Ae=s("i",{class:"fas fa-file-code"},null,-1),Me=[Ae],Se={key:7},Be=s("i",{class:"fas fa-file-image"},null,-1),Ne=[Be],Ve={key:8},Pe=s("i",{class:"fas fa-file-video"},null,-1),Ue=[Pe],qe={key:9},Ge=s("i",{class:"fas fa-file-audio"},null,-1),He=[Ge],Ke={key:10},Oe=s("i",{class:"fas fa-file-alt"},null,-1),Xe=[Oe],Je=R({__name:"FileIcon",props:{ext:{},class:{}},setup(x){const r=x;return(S,$)=>(t(),o("span",{class:g(r==null?void 0:r.class)},[r.ext==="pdf"?(t(),o("span",me,ye)):["doc","docx","odt"].includes(r.ext)?(t(),o("span",we,xe)):r.ext==="xls"||r.ext==="xlsx"?(t(),o("span",$e,be)):r.ext==="ppt"||r.ext==="pptx"?(t(),o("span",ge,Fe)):r.ext==="csv"?(t(),o("span",ze,Ee)):["gz","zip","arj","rar","tar","7z","bz"].includes(r.ext)?(t(),o("span",Te,Ie)):["htm","html","php","js","css","style","vue","cpp","java","kt","conf","sh"].includes(r.ext)?(t(),o("span",je,Me)):["bmp","tiff","gif","png","jpg","webp","jpeg"].includes(r.ext)?(t(),o("span",Se,Ne)):["mp4","avi","mkv"].includes(r.ext)?(t(),o("span",Ve,Ue)):["mp3","ogg"].includes(r.ext)?(t(),o("span",qe,He)):(t(),o("span",Ke,Xe))],2))}}),y=x=>(ce("data-v-8c1e1856"),x=x(),ie(),x),Qe={class:"article wider"},Re={class:"article-body custom-pt-0"},We={class:"flexbox middle wrap space-16"},Ye=["onClick"],Ze=["onClick"],es=["onClick"],ss=y(()=>s("hr",{class:"custom-mb-0"},null,-1)),ts=["onClick"],as={key:1},os=y(()=>s("i",{class:"fas fa-users"},null,-1)),ls=[os],ns=["onClick"],cs=y(()=>s("div",{class:"icon"},[s("i",{class:"fas fa-users"})],-1)),is=["onClick"],rs={class:"icon"},us=["disabled"],ds={key:0},_s=y(()=>s("i",{class:"fas fa-plus"},null,-1)),ps=[_s],vs={key:1,class:"spinner"},ms={key:0},hs={key:1,class:"tw-mt-0 tw-p-4"},ys={key:0},ws={key:0,class:"flexbox wrap space-16 js-wa-gallery"},ks=["onClick"],xs={class:"align-center wide"},$s=["href","data-preview","onClick"],fs=["src"],bs={key:1,class:"largest"},gs={class:"details custom-pt-0"},Cs={class:"flexbox space-8 middle full-width"},Fs=["title"],zs=["href","onClick"],Ls={class:"text-ellipsis semibold opacity-90"},Es={class:"black"},Ts=y(()=>s("a",{class:"tw-text-waText hover:tw-text-waText tw-opacity-50 custom-pl-12"},[s("i",{class:"fas fa-ellipsis-v"})],-1)),Ds={class:"box",style:{"overflow-wrap":"break-word"}},Is=y(()=>s("hr",{class:"custom-mb-8"},null,-1)),js={key:0,class:"small flexbox space-8 custom-mb-4 custom-mx-12"},As=["title"],Ms={class:"small flexbox space-8 custom-mb-4 custom-mx-12"},Ss=y(()=>s("div",{class:"icon size-16"},null,-1)),Bs={class:"small"},Ns=["href","onClick"],Vs=y(()=>s("div",{class:"icon size-16"},[s("i",{class:"fas fa-file-download"})],-1)),Ps={class:"small"},Us=["onClick"],qs=y(()=>s("div",{class:"icon size-16"},[s("i",{class:"fas fa-trash-alt"})],-1)),Gs={class:"small"},Hs={key:0,class:"small"},Ks={class:"smaller flexbox full-width wrap space-16 custom-mb-8"},Os={key:0},Xs={key:1},Js={key:2},Qs=y(()=>s("div",{class:"icon size-80"},[s("i",{class:"fas fa-file"})],-1)),Rs=R({__name:"FilesTab",props:{entityType:{},entityId:{},focusInput:{type:Boolean}},setup(x){const r=x,S=`${r.entityType}_id`,{t:$}=se(),p=k("ALL"),G=new Map([["ALL",$("allSources")],["FILE",$("fromFiles")],["MESSAGE",$("fromMessages")],["NOTE",$("fromNotes")]]),v=k(0),_=k(0),L=k([]),I=k(new Map),E=k(new Map),H=k([]),T=k(!1),f=N(`crm.file.list?${S}=${r.entityId}&thumb_size=256&preview_size=512`).get().json(),W=Q(()=>T.value),B=Q(()=>L.value.filter(a=>(p.value==="ALL"||a.source_type===p.value)&&O(a,v.value)&&X(a,_.value))),{open:K,onChange:Y}=te(),O=(a,n)=>{var e;return n===0||n===-1&&!(a!=null&&a.deal)||((e=a==null?void 0:a.deal)==null?void 0:e.id)===n},X=(a,n)=>{var e;return n===0||((e=a==null?void 0:a.creator)==null?void 0:e.id)===n},w=(a,n=v.value,e=_.value)=>!!L.value.find(l=>(a==="ALL"||l.source_type===a)&&O(l,n)&&X(l,e));ae(()=>{r.focusInput&&K()}),oe(()=>{window.document.documentElement.dispatchEvent(new Event("wa-gallery-load"))}),le(()=>{Array.isArray(f.data.value)&&(L.value=f.data.value,I.value=L.value.reduce((a,n)=>!(n!=null&&n.deal)||a.has(n.deal.id)?a:a.set(n.deal.id,n.deal.name),new Map),E.value=L.value.reduce((a,n)=>!(n!=null&&n.creator)||a.has(n.creator.id)?a:a.set(n.creator.id,n.creator),new Map))}),Y(a=>{a&&Z(Array.from(a))});async function Z(a){a&&(T.value=!0,await Promise.all(Array.from(a).map(async n=>{const e=await ve(n);if(e){const{error:l}=await N("crm.file.add").post({file:e,file_name:n.name,[S]:r.entityId});if(l.value)return Promise.reject(l.value)}})),await f.execute(),T.value=!1,window.document.documentElement.dispatchEvent(new CustomEvent("wa-gallery-load",{detail:{timeout:500}})))}async function ee(a){const{show:n,hide:e}=re(pe,{message:$("confirmDeleteFile"),buttonText:$("delete"),onSubmit:async()=>{const{error:l}=await N(`crm.file.delete?id=${a}`).delete();l.value||(f.execute(),window.document.documentElement.dispatchEvent(new CustomEvent("wa-gallery-load",{detail:{timeout:500}}))),e()}});n()}return(a,n)=>(t(),o("div",Qe,[s("div",Re,[s("div",{class:g(["tw-sticky tw-bg-waBlank tw-z-20 tw-p-4",{"files-tab__panel":r.entityType==="contact"}])},[s("div",We,[d(M,null,{body:c(({hide:e})=>[d(A,null,{default:c(()=>[(t(!0),o(F,null,D(u(G),([l,C])=>(t(),m(b,{key:l},{default:c(()=>[s("a",{onClick:h(J=>{w(l)&&(p.value=l,e())},["prevent"])},[s("span",{class:g({gray:!w(l)})},i(C),3)],8,Ye)]),_:2},1024))),128))]),_:2},1024)]),default:c(()=>[d(q,{small:!0},{title:c(()=>[V(i(u(G).get(p.value)),1)]),_:1})]),_:1}),I.value.size>0?(t(),m(M,{key:0},{body:c(({hide:e})=>[d(A,null,{default:c(()=>[(t(),m(b,{key:0},{default:c(()=>[s("a",{onClick:h(l=>{v.value=0,e()},["prevent"])},[s("span",null,i(a.$t("allDeals")),1)],8,Ze)]),_:2},1024)),(t(),m(b,{key:-1},{default:c(()=>[s("a",{onClick:h(l=>{w(p.value,-1,_.value)&&(v.value=-1,e())},["prevent"])},[s("span",{class:g({gray:!w(p.value,-1,_.value)})},i(a.$t("withoutDeal")),3)],8,es)]),_:2},1024)),ss,(t(!0),o(F,null,D(I.value,([l,C])=>(t(),m(b,{key:l},{default:c(()=>[s("a",{onClick:h(J=>{w(p.value,l,_.value)&&(v.value=l,e())},["prevent"])},[s("span",{class:g({gray:!w(p.value,l,_.value)})},i(C),3)],8,ts)]),_:2},1024))),128))]),_:2},1024)]),default:c(()=>[d(q,{small:!0},{title:c(()=>[V(i(v.value===0?a.$t("allDeals"):v.value===-1?a.$t("withoutDeal"):I.value.get(v.value)),1)]),_:1})]),_:1})):z("",!0),E.value.size>1?(t(),m(M,{key:1},{body:c(({hide:e})=>[d(A,null,{default:c(()=>[(t(),m(b,{key:0},{default:c(()=>[s("a",{onClick:h(l=>{_.value=0,e()},["prevent"])},[cs,s("span",null,i(a.$t("allAuthors")),1)],8,ns)]),_:2},1024)),(t(!0),o(F,null,D(E.value,([l,C])=>(t(),m(b,{key:l},{default:c(()=>[s("a",{onClick:h(J=>{w(p.value,v.value,l)&&(_.value=l,e())},["prevent"])},[s("div",rs,[d(P,{size:10,url:C.userpic},null,8,["url"])]),s("span",{class:g({gray:!w(p.value,v.value,l)})},i(C.name),3)],8,is)]),_:2},1024))),128))]),_:2},1024)]),default:c(()=>[d(q,{small:!0},{icon:c(()=>{var e;return[_.value>0?(t(),m(P,{key:0,size:16,url:(e=E.value.get(_.value))==null?void 0:e.userpic},null,8,["url"])):(t(),o("span",as,ls))]}),title:c(()=>{var e;return[V(i(_.value===0?a.$t("allAuthors"):(e=E.value.get(_.value))==null?void 0:e.name),1)]}),_:1})]),_:1})):z("",!0),["ALL","FILES"].includes(p.value)&&[0,-1].includes(v.value)?(t(),o("button",{key:2,class:"tw-flex-none circle nobutton",disabled:W.value,onClick:n[0]||(n[0]=()=>{T.value||u(K)()})},[T.value?(t(),o("div",vs)):(t(),o("span",ds,ps))],8,us)):z("",!0)]),H.value.length?(t(),o("div",ms,[(t(!0),o(F,null,D(H.value,(e,l)=>(t(),o("div",{key:l},i(e),1))),128))])):z("",!0)],2),!B.value.length&&u(f).isFetching.value?(t(),m(de,{key:0,class:"tw-max-w-3xl tw-px-4"})):(t(),o("div",hs,[u(f).error.value?(t(),o("div",ys,i(u(f).error.value),1)):(t(),o(F,{key:1},[B.value.length?(t(),o("div",ws,[(t(!0),o(F,null,D(B.value,e=>(t(),o("figure",{key:e.id,class:"card"},[s("div",{class:"image flexbox middle full-width cursor-pointer",onClick:h(l=>!(e!=null&&e.thumb_url)&&u(j)(e.url,e.id,e.name),["prevent"])},[s("div",xs,[s("a",{class:g({"js-wa-gallery-image":!!(e!=null&&e.thumb_url),"js-disable-router":!0}),href:e.url,"data-preview":e==null?void 0:e.preview_url,onClick:h(l=>!(e!=null&&e.thumb_url)&&u(j)(e.url,e.id,e.name),["prevent"])},[e!=null&&e.thumb_url&&!u(ne).webView?(t(),o("img",{key:0,src:e.thumb_url},null,8,fs)):(t(),o("span",bs,[d(Je,{ext:e.ext,class:"large"},null,8,["ext"])]))],10,$s)])],8,ks),s("div",gs,[s("div",Cs,[s("h5",{class:"small text-ellipsis wide custom-mt-16",title:e.name},[s("a",{class:"flexbox js-disable-router",href:e.url,style:{color:"var(--text-color)"},onClick:h(l=>u(j)(e.url,e.id,e.name),["prevent"])},[s("span",Ls,i(e.name.replace(/\.[^/.]+$/,"")),1),s("span",Es,"."+i(e.ext),1)],8,zs)],8,Fs),d(M,{right:!0,"enable-correct-top":!0,width:"250px"},{body:c(({hide:l})=>[s("div",Ds,i(e.name),1),Is,e.creator?(t(),o("div",js,[d(P,{size:16,url:e.creator.userpic},null,8,["url"]),s("span",{class:"small tw-truncate",title:e.creator.name},i(e.creator.name),9,As)])):z("",!0),s("div",Ms,[Ss,s("div",Bs,i(u(U)(e.create_datetime).format("LLL")),1)]),d(A,null,{default:c(()=>[d(b,null,{default:c(()=>[s("a",{class:"js-disable-router",href:e.url,onClick:h(()=>{u(j)(e.url,e.id,e.name),l()},["prevent"])},[Vs,s("span",Ps,i(a.$t("downloadFile")),1)],8,Ns),s("a",{onClick:h(()=>{ee(e.id),l()},["prevent"])},[qs,s("span",Gs,i(a.$t("deleteFile")),1)],8,Us)]),_:2},1024)]),_:2},1024)]),default:c(()=>[Ts]),_:2},1024)]),e!=null&&e.comment?(t(),o("p",Hs,i(e.comment),1)):z("",!0),s("div",Ks,[e.size>1048576?(t(),o("span",Os,i((e.size/1048576).toFixed(1))+" MB",1)):e.size>1024?(t(),o("span",Xs,i((e.size/1024).toFixed(1))+" KB",1)):(t(),o("span",Js,i(e.size)+" B",1)),s("span",null,i(u(U)(e.create_datetime).format(u(U)(e.create_datetime).isToday()?"LT":"L")),1)])])]))),128))])):(t(),m(_e,{key:1,message:a.$t("notFoundFiles")},{default:c(()=>[Qs]),_:1},8,["message"]))],64))]))])]))}});const rt=ue(Rs,[["__scopeId","data-v-8c1e1856"]]);export{rt as default};
