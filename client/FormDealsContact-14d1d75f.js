import{d as x,h as p,O as y,l as F,R as A,V as _,au as B,ag as T,o as n,c as v,a as s,p as h,b as N,w,A as O,e as b,u as i,i as D,k as E,v as L,av as M,aw as $,s as R,x as V,ae as P,_ as Y}from"./main-d7f03521.js";import{v as j}from"./index-dc17eb5d.js";import{_ as z}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-3fb68752.js";import U from"./FormDealAdd-d9b7ad91.js";import{S as q}from"./SkeletonList-27785815.js";import{_ as G}from"./DealsListTable.vue_vue_type_style_index_0_lang-e29cdb4c.js";import"./fields-39e1f9f0.js";import"./FieldCheckbox-2a93227f.js";import"./FieldSelect-ae6f0f9b.js";import"./CustomColumn-83646d88.js";import"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-953db84b.js";import"./SortableList.vue_vue_type_script_setup_true_lang-43da3720.js";import"./useSortable-eb883c7d.js";import"./InputWithContacts.vue_vue_type_script_setup_true_lang-941f63e0.js";import"./UserPic-c11efadd.js";import"./DropDown-7a0f8902.js";import"./InputWithPerformers.vue_vue_type_script_setup_true_lang-47aeec90.js";import"./recentContacts-8eea64ba.js";import"./vTooltip-95186f83.js";import"./dayjs-8b9f8f59.js";import"./index-884c82be.js";import"./emit-b4342586.js";import"./WaSpinner-49827d4a.js";import"./TextAreaAutoresize-64fc87cf.js";import"./DropDownButton-b07233c5.js";import"./ButtonSubmit-bbd5ca4e.js";import"./DealsItemResponsible.vue_vue_type_style_index_0_lang-e6f98522.js";import"./ChipsList-ee14164a.js";import"./currency-format-a8df1195.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-d7adf9ef.js";import"./date-fb01f223.js";import"./EmptyList-ca1e10b8.js";const C=a=>(R("data-v-46071ffd"),a=a(),V(),a),H={class:"form-deals-contact tw-p-4"},J=["onClick"],K=C(()=>s("span",{class:"icon tw-mr-1"},[s("i",{class:"fas fa-plus-circle"})],-1)),Q={class:"tw-mt-3 tw-h-full"},W={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},X=C(()=>s("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1)),Z=[X],m=20,tt=x({__name:"FormDealsContact",props:{contactId:{}},setup(a){const u=a,I=["id","stage_id","name","states","create_datetime","amount","user"],e=p(null),r=p(0),o=p({contact_id:u.contactId,limit:m,offset:0}),{data:g,isFetching:S,execute:f}=y(F(()=>`crm.deal.list?${P.stringify(o.value)}`),{refetch:!0}).get().json();f(),A(g,t=>{t&&(t.params.offset>0?e.value=[...e.value||[],...t.data]:e.value=t.data,r.value=t.params.total_count,o.value.offset=t.params.offset)}),_(M).on(t=>{e.value&&B(t,e.value)}),_($).on(()=>{d()});function k(){o.value.offset+m>=r.value||(o.value.offset+=m)}function d(){e.value=null,o.value.offset===0?f():o.value.offset=0}const c=T();return c.fetch(),(t,et)=>(n(),v("div",H,[s("h3",null,h(t.$t("Deals")),1),N(z,{component:U,"component-props":{contactId:u.contactId,disableNavigateToDeal:!0,onAdded:d}},{default:w(({open:l})=>[s("button",{class:"button",onClick:b(l,["prevent"])},[K,O(" "+h(t.$t("newDeal")),1)],8,J)]),_:1},8,["component-props"]),s("div",Q,[i(c).funnelsMap&&e.value?(n(),D(G,{key:0,deals:e.value,"use-columns-ids":I,"navigate-route-name":"dealByContactFrame","funnels-map":i(c).funnelsMap},{lazy:w(()=>[E((n(),v("div",W,Z)),[[L,e.value.length<r.value],[i(j),([{isIntersecting:l}])=>{l&&!i(S)&&k()}]])]),_:1},8,["deals","funnels-map"])):(n(),D(q,{key:1,"row-height":"100px"}))])]))}});const Et=Y(tt,[["__scopeId","data-v-46071ffd"]]);export{Et as default};
