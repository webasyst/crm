import{d as I,A as u,o as t,c as l,F as C,e as v,i as a,k as g,b as T,h as z,g as _,m as W,n as y,v as E,p as V,r as x,f as o,a as N,I as O,O as U,ac as Y,ap as j,D as H,j as P,a2 as Q,l as X,w as R}from"./main-07d84941.js";import{_ as q,a as G,b as J,c as K,d as Z}from"./DealsItemAmount.vue_vue_type_style_index_0_lang-3bd2ae6b.js";import{d as ee}from"./dayjs-ec756e3b.js";import{v as te}from"./vTooltip-05cbcfb0.js";import{U as S}from"./UserPic-6b99ec27.js";import{_ as se}from"./ContactsListItemAction.vue_vue_type_style_index_0_lang-ab9b3926.js";import{d as le}from"./date-36998e6d.js";import{b as ie}from"./index-00e882cb.js";import{S as ae}from"./SkeletonList-6c298ef0.js";import{E as oe}from"./EmptyList-3dbbfbca.js";const ne={key:0,class:"deals-item-stage__closed"},de={class:"deals-item-stage__text"},ce={class:"deals-item-stage__text"},re={class:"deals-item-stage__closed-datetime"},me={key:1,class:"deals-item-stage__open"},_e={key:1,class:"icon size-12 tw-flex",style:{color:"var(--deal-color-gray-primary)"}},ue=a("i",{class:"fas fa-info-circle"},null,-1),pe=[ue],ve={class:"deals-item-stage__text"},fe=I({__name:"DealsListItemStage",props:{deal:{},closed:{type:Boolean},isMobile:{type:Boolean},fontNormal:{type:Boolean}},setup(w){const e=w,i=u(()=>ee(e.deal.closed_datetime)),p=u(()=>i.value.isYesterday()),c=u(()=>i.value.isToday()),r=u(()=>i.value.format("HH:mm")),m=u(()=>i.value.format("L")),b=u(()=>e.isMobile?14:10);return(f,A)=>{var L,s;return t(),l("div",{class:y(["deals-item-stage",e.fontNormal||e.isMobile?"tw-font-normal":"tw-font-semibold",{"deals-item-stage--mobile":e.isMobile}])},[e.closed?(t(),l("div",ne,[e.deal.status_id==="WON"?(t(),l(C,{key:0},[v(S,{size:b.value,"fa-icon":"flag-checkered","icon-color":e.deal.stage.color},null,8,["size","icon-color"]),a("div",de,g(f.$t("won")),1)],64)):(t(),l(C,{key:1},[v(S,{size:b.value,"fa-icon":"ban","icon-color":e.deal.stage.color},null,8,["size","icon-color"]),a("div",ce,g(f.$t("lost")),1)],64)),a("span",re,g(p.value?`${f.$t("yesterday")} ${r.value}`:c.value?`${f.$t("today")} ${r.value}`:m.value),1)])):(t(),l("div",me,[(L=e.deal.stage)!=null&&L.color?(t(),T(S,{key:0,"disable-rounded":"","bg-color":e.deal.stage.color,size:b.value},null,8,["bg-color","size"])):(t(),l("span",_e,pe)),z((t(),l("div",ve,[W(g(e.deal.stage?e.deal.stage.color?e.deal.stage.name:f.$t("stageDeleted"):f.$t("funnelDeleted")),1)])),[[_(te),(s=e.deal.stage)==null?void 0:s.name,void 0,{"top-start":!0,500:!0}]])]))],2)}}});const he={class:"deals-item-last_action"},ye={ref:"lastActionRef",class:"deals-item-last_action__inner",style:{"min-width":"170px"}},we=I({__name:"DealsListItemLastAction",props:{lastAction:{},truncateText:{type:Boolean},disableTooltip:{type:Boolean}},setup(w){const e=w;return(i,p)=>(t(),l("div",he,[a("div",ye,[v(se,{action:e.lastAction,"truncate-text":e.truncateText,"disable-line-clamp":!0,"disable-tooltip":e.disableTooltip},null,8,["action","truncate-text","disable-tooltip"])],512)]))}}),ge={key:1,class:"deal-list__item item-stage_id"},be={key:2,class:"deal-list__item item-name"},$e={key:3,class:"deal-list__item item-states"},ke={key:4,class:"deal-list__item item-create_datetime"},xe={class:"deals-item-create_datetime mobile:tw-text-[var(--deal-color-gray-secondary)] mobile:tw-text-[13px]"},Ce={key:0,class:"gray tw-mr-1"},Te={class:"md:tw-contents tw-col-span-2 tw-flex tw-flex-row-reverse tw-items-center tw-justify-between"},Le={key:0,class:"deal-list__item item-amount"},Ve={key:1,class:"deal-list__item item-user_name"},Ie={key:6,class:"deal-list__item item-last_action"},Me=I({__name:"DealsListItem",props:{deal:{},useColumnsIds:{},isSelected:{type:Boolean},isMobile:{type:Boolean},isTileView:{type:Boolean}},setup(w){const e=w,i=u(()=>r=>e.useColumnsIds.includes(r)),p=u(()=>e.deal.status_id!=="OPEN"),c=u(()=>le(e.deal.create_datetime));return(r,m)=>(t(),l("div",{class:y(["deal-list__row",{highlighted:e.isSelected,"deal-list__row--deal-closed":p.value}])},[i.value("checkbox")?z((t(),l("div",{key:0,class:"deal-list__item deal-list__item--not-opacity",onClick:m[0]||(m[0]=V(()=>{},["stop"]))},[x(r.$slots,"checkbox")],512)),[[E,!e.isMobile]]):o("",!0),i.value("stage_id")?(t(),l("div",ge,[v(fe,{deal:e.deal,closed:p.value,"is-mobile":e.isMobile,"font-normal":e.isTileView},null,8,["deal","closed","is-mobile","font-normal"])])):o("",!0),i.value("name")?(t(),l("div",be,[v(q,{deal:e.deal,"use-userpic":!e.isMobile&&!e.isTileView,"disable-tootltip":e.isMobile||e.isTileView,size:e.isMobile||e.isTileView?"15px":null},null,8,["deal","use-userpic","disable-tootltip","size"])])):o("",!0),i.value("states")?(t(),l("div",$e,[v(G,{deal:e.deal},null,8,["deal"])])):o("",!0),i.value("create_datetime")?(t(),l("div",ke,[a("div",xe,[e.isTileView?(t(),l("span",Ce,g(r.$t("created")),1)):o("",!0),a("span",{class:y({"tw-lowercase":e.isTileView})},g(c.value),3)])])):o("",!0),a("div",Te,[i.value("amount")?(t(),l("div",Le,[v(J,{deal:e.deal,size:e.isTileView?"base":e.isMobile?"lg":void 0,"swap-icon":e.isMobile,"big-icon":e.isMobile},null,8,["deal","size","swap-icon","big-icon"])])):o("",!0),i.value("user_name")?(t(),l("div",Ve,[e.deal.user?(t(),T(K,{key:0,user:e.deal.user,"align-right":e.isTileView,"default-color":e.isMobile||e.isTileView,"disable-tootltip":e.isMobile},null,8,["user","align-right","default-color","disable-tootltip"])):o("",!0)])):o("",!0)]),i.value("tags")&&!e.isMobile?(t(),l("div",{key:5,class:"deal-list__item deal-list__item--not-opacity item-tags",onClick:m[1]||(m[1]=V(()=>{},["prevent"]))},[v(Z,{tags:e.deal.tags,"disable-overflow-soft":e.isTileView,small:e.isTileView},null,8,["tags","disable-overflow-soft","small"])])):o("",!0),i.value("last_action")&&!e.isMobile?(t(),l("div",Ie,["last_action"in e.deal?(t(),T(we,{key:0,"last-action":e.deal.last_action,"truncate-text":e.isTileView,"disable-tooltip":e.isTileView},null,8,["last-action","truncate-text","disable-tooltip"])):o("",!0)])):o("",!0)],2))}});const Se={class:"deals-list__wrapper"},ze=a("i",{class:"fas fa-chevron-left"},null,-1),Ae=[ze],De=a("i",{class:"fas fa-chevron-right"},null,-1),Be=[De],Ne={class:"tw-sticky tw-top-0 tw-left-1/2 tw-w-fit -tw-translate-x-1/2"},Re={key:1,class:"deals-list__skeleton-body tw-h-full md:tw-pt-3"},Ee=a("div",{class:"icon size-80"},[a("i",{class:"fas fa-funnel-dollar"})],-1),qe=I({__name:"DealsListTable",props:{deals:{},useColumnsIds:{},isFetching:{type:Boolean},isFirstFetching:{type:Boolean},navigateRouteName:{},tileView:{type:Boolean}},setup(w){const e=w,i=N(null),p=N(!1),c=O(ie),{x:r,arrivedState:m}=U(i,{throttle:200}),b=u(()=>!c.value&&p.value&&!m.right);Y(i,s=>{const n=s[0];p.value=n.target.scrollWidth>n.target.clientWidth}),j(()=>e.isFetching,s=>{if(!s){const n=i.value;n&&(p.value=n.scrollWidth>n.clientWidth)}},{debounce:500}),H(()=>e.isFirstFetching&&e.isFetching,()=>{var s;(s=i.value)==null||s.scrollTo({top:0})});function f(s){var B;const $=Array.from(((B=i.value)==null?void 0:B.querySelectorAll(".deal-list__row:last-of-type > *"))||[]),d=$.map(h=>h.offsetLeft),k=$.length-1,D=d[k]+350,M=$[k].offsetWidth;if(M>D){let h=D;for(;h<M;)d.push(h),h+=350;d.push(M)}const F=s==="next"?d.find(h=>h>r.value+1):d.reverse().find(h=>h<r.value-1);r.value=F??d[2]}const A={checkbox:"minmax(40px, 40px)",stage_id:"minmax(230px, 2fr)",name:"minmax(240px, 2fr)",states:"minmax(100px, 0.5fr)",create_datetime:"minmax(135px, 1fr)",amount:"minmax(150px, 1fr)",tags:"minmax(180px, 1.33fr)",user_name:"minmax(250px, 2fr)",last_action:"minmax(auto, 100%)"},L=u(()=>{let s="";return e.useColumnsIds.forEach(n=>{s+=A[n]+" "}),s});return(s,n)=>{const $=P("RouterLink");return t(),l("div",Se,[a("div",{class:y(["deals-list",{"deals-list--mobile":_(c),"deals-list--tiles":!_(c)&&e.tileView,"refresh-list":e.deals.length&&e.isFetching}])},[s.deals.length?(t(),l("div",{key:0,ref_key:"scrollableContainerRef",ref:i,class:y(["deals-list__table-wrapper",{"overflow-soft-hide-x":b.value}])},[a("div",{class:"deals-list__table",style:Q({"--deals-list-row-grid-template-columns":L.value})},[!e.tileView&&!_(c)?(t(),l(C,{key:0},[a("div",{class:y([{"tw-hidden":!p.value},"tw-absolute tw-top-1 tw-left-0 tw-w-full tw-z-30"])},[z(a("div",{class:y([{"tw-opacity-30":_(m).left},"col-nav col-nav--left tw-left-0"]),onClick:n[0]||(n[0]=V(d=>f("prev"),["prevent"]))},Ae,2),[[E,!_(m).left]]),a("div",{class:y([{"tw-opacity-30":_(m).right},"col-nav col-nav--right tw-right-0"]),onClick:n[1]||(n[1]=V(d=>f("next"),["prevent"]))},Be,2)],2),x(s.$slots,"headers",{useColumnsIds:s.useColumnsIds})],64)):o("",!0),(t(!0),l(C,null,X(e.deals,d=>(t(),T($,{key:d.id,to:{name:e.navigateRouteName||"deal",params:{id:d.id}},custom:""},{default:R(({navigate:k})=>[x(s.$slots,"listItem",{deal:d,isMobile:!!_(c),useColumnsIds:s.useColumnsIds,navigate:k},()=>[v(Me,{deal:d,"use-columns-ids":s.useColumnsIds,"is-mobile":!!_(c),"is-tile-view":!_(c)&&e.tileView,onClick:k},null,8,["deal","use-columns-ids","is-mobile","is-tile-view","onClick"])])]),_:2},1032,["to"]))),128))],4),a("div",Ne,[x(s.$slots,"lazy")])],2)):o("",!0),e.isFetching?(t(),l("div",Re,[v(ae,{"row-height":_(c)?"108px":"38px"},null,8,["row-height"])])):o("",!0),!e.isFetching&&e.deals.length===0?(t(),l(C,{key:2},[s.$slots.emptyList?x(s.$slots,"emptyList",{key:0}):(t(),T(oe,{key:1,message:s.$t("noDeals")},{default:R(()=>[Ee]),_:1},8,["message"]))],64)):o("",!0)],2)])}}});export{qe as _,Me as a};
