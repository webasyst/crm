import{v as re}from"./index-824b3191.js";import{S as de}from"./SkeletonList-7258d9b0.js";import{_ as ue}from"./LazyLoadingWithProgress.vue_vue_type_script_setup_true_lang-2b9243c9.js";import{E as G}from"./EmptyList-c3da84c8.js";import{C as me,_ as pe}from"./ContactsListItems-2449c47a.js";import{D as K}from"./DropDown-a179a782.js";import{d as I,Q as le,C as Q,j as X,o as i,b as k,w as s,m as P,k as r,i as e,g as t,p as $,e as o,W as Y,f as S,n as E,t as x,y as H,R as L,A as T,c as b,N as _e,S as fe,T as he,B as U,a as J,H as ve,U as ne,V as ge,l as oe,F as W,X as $e,Y as we,P as ke,h as Ce}from"./main-49799bbb.js";import{_ as w,M as F}from"./MenuList-7aba2312.js";import{_ as q}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-2cbf507f.js";import{_ as ce,a as be,u as ye}from"./FormSegmentUpdate.vue_vue_type_script_setup_true_lang-377ab6f1.js";import{_ as Se,a as Fe}from"./FormContactDelete.vue_vue_type_script_setup_true_lang-843bf35b.js";import{_ as Ie}from"./FormContactChangeResponsible.vue_vue_type_script_setup_true_lang-1fbb6fc6.js";import{_ as Ae}from"./DropdownIncludeSegment.vue_vue_type_script_setup_true_lang-29e8aae6.js";import{_ as Pe}from"./FormAddTag.vue_vue_type_script_setup_true_lang-6664f8c9.js";import{F as Z}from"./FieldCheckbox-3d76d976.js";import{u as Re}from"./useSortable-2cae4f7d.js";import{C as De}from"./CustomColumn-69543086.js";const Ve=["disabled","onClick"],Le=e("br",null,null,-1),xe=e("br",null,null,-1),Be=I({__name:"FormSegmentDelete",props:{segment:{}},emits:["close"],setup(y,{emit:c}){const m=y,_=le(),{isFetching:a,error:u,execute:h}=Q().deleteSegment(m.segment.id);async function d(){await h()&&(_.push({name:"contacts"}),c("close"))}return(n,l)=>{const f=X("i18n-t");return i(),k(Y,{onClose:l[0]||(l[0]=R=>c("close"))},{header:s(()=>[P(r(n.$t("deleteSegment")),1)]),submit:s(()=>[e("button",{class:"button",disabled:t(a),onClick:$(d,["prevent"])},r(n.$t("delete")),9,Ve)]),error:s(()=>[P(r(t(u)),1)]),default:s(()=>[o(f,{tag:"p",keypath:"segmentDeleteMessage"},{newline:s(()=>[Le,xe]),_:1})]),_:1})}}}),Te=["onClick"],Ue=["onClick"],He=["onClick"],Oe=I({__name:"DropdownSegment",props:{segment:{}},setup(y){const c=y,{isFetching:m,execute:_}=Q().toggleSegmentArchive(c.segment.id);return(a,u)=>{const h=X("RouterLink");return i(),k(F,null,{default:s(()=>[o(w,null,{default:s(()=>[o(q,{component:ce,"component-props":{segment:c.segment}},{default:s(({open:d})=>[e("a",{onClick:$(d,["prevent"])},r(a.$t("mainSettings")),9,Te)]),_:1},8,["component-props"])]),_:1}),a.segment.type==="category"?(i(),k(w,{key:0},{default:s(()=>[o(q,{component:be,"component-props":{segment:c.segment}},{default:s(({open:d})=>[e("a",{onClick:$(d,["prevent"])},r(a.$t("addContactsToSegment")),9,Ue)]),_:1},8,["component-props"])]),_:1})):S("",!0),a.segment.type==="search"?(i(),k(w,{key:1},{default:s(()=>{var d;return[o(h,{class:E(a.$constant.parentAppDisableRouterClass),to:{name:"updateSegmentFilter",params:{id:a.segment.id,searchHash:(d=a.segment.hash)==null?void 0:d.replace("crmSearch/","")}}},{default:s(()=>[P(r(a.$t("updateSegmentFilter")),1)]),_:1},8,["class","to"])]}),_:1})):S("",!0),o(w,null,{default:s(()=>[e("a",{onClick:u[0]||(u[0]=$(()=>{t(m)||t(_)()},["prevent"]))},r(a.$t(a.segment.archived?"fromArchive":"toArchive")),1)]),_:1}),o(w,null,{default:s(()=>[o(q,{component:Be,"component-props":{segment:c.segment}},{default:s(({open:d})=>[e("a",{onClick:$(d,["prevent"])},r(a.$t("deleteSegment")),9,He)]),_:1},8,["component-props"])]),_:1})]),_:1})}}}),ze=I({__name:"DropdownSearch",setup(y){var _,a;const{previousFetchParams:c}=x(H()),{show:m}=L(ce,{initialType:"search",initialName:(_=c.value)==null?void 0:_.title,initialHash:(a=c.value)==null?void 0:a.hash});return(u,h)=>{const d=X("RouterLink");return i(),k(F,null,{default:s(()=>[o(w,null,{default:s(()=>{var n,l;return[o(d,{to:{name:"detailedSearch",params:{searchHash:(l=(n=t(c))==null?void 0:n.hash)==null?void 0:l.replace("crmSearch/","")}},class:E(u.$constant.parentAppDisableRouterClass)},{default:s(()=>[P(r(u.$t("updateSearchConditions")),1)]),_:1},8,["to","class"])]}),_:1}),o(w,null,{default:s(()=>[e("a",{onClick:h[0]||(h[0]=$((...n)=>t(m)&&t(m)(...n),["prevent"]))},r(u.$t("saveAsFilter")),1)]),_:1})]),_:1})}}}),Me={class:"tw-flex tw-items-center tw-space-x-2 tw-flex-auto tw-w-1/2"},Ne=["title"],je=e("button",{class:"circle light-gray"},[e("i",{class:"fas fa-pen"})],-1),qe=I({__name:"ContactsListTitle",setup(y){const{getSegmentByHash:c}=Q(),{previousFetchParams:m}=x(H()),_=T(()=>{var u;return(u=m.value)!=null&&u.hash?c(m.value.hash):null}),a=T(()=>{var u,h;return _.value?_.value.is_editable?Oe:null:(h=(u=m.value)==null?void 0:u.hash)!=null&&h.includes("crmSearch/")?ze:null});return(u,h)=>{var d,n,l,f;return i(),b("div",Me,[e("div",{class:"tw-text-xl tw-font-bold tw-truncate",title:((d=_.value)==null?void 0:d.name)??((n=t(m))==null?void 0:n.title)},r(((l=_.value)==null?void 0:l.name)??((f=t(m))==null?void 0:f.title)),9,Ne),a.value?(i(),k(K,{key:0},{body:s(()=>[(i(),k(_e(a.value),fe(he({segment:_.value})),null,16))]),default:s(()=>[je]),_:1})):S("",!0)])}}}),Ee=["src"],ie=I({__name:"FormContactsExportCSV",props:{contactIds:{},hash:{},checkedCount:{}},setup(y){const c=y;return(m,_)=>(i(),k(Y,{"hide-buttons":!0},{default:s(()=>[e("iframe",{src:`${t(U).baseUrl}?module=contactOperation&action=export${c.contactIds?`&ids=${c.contactIds.join(",")}`:c.hash?`&hash=${encodeURIComponent(c.hash)}`:""}&checked_count=${c.checkedCount}`,frameborder:"0",class:"tw-w-full",style:{height:"400px"}},null,8,Ee)]),_:1}))}}),Je=["disabled","onClick"],We={style:{height:"320px","overflow-y":"auto"}},Qe=I({__name:"FormContactAddToSegment",props:{contactIds:{}},emits:["close"],setup(y,{emit:c}){const m=y,_=Q(),a=J(),u=J();async function h(){a.value&&(u.value=_.includeContactsToSegment(a.value,m.contactIds),await u.value.execute(),u.value.error||c("close"))}return(d,n)=>(i(),k(Y,{"use-cancel-as-button-label":!0,onClose:n[1]||(n[1]=l=>c("close"))},{header:s(()=>[P(r(d.$t("addToSegment")),1)]),submit:s(()=>{var l;return[e("button",{disabled:!!((l=u.value)!=null&&l.isFetching)||!a.value,onClick:$(h,["prevent"])},r(d.$t("save")),9,Je)]}),error:s(()=>{var l;return[P(r((l=u.value)==null?void 0:l.error),1)]}),default:s(()=>[e("div",We,[o(Ae,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=l=>a.value=l)},null,8,["modelValue"])])]),_:1}))}}),Xe=["data-id"],Ye=e("div",{class:"handle tw-flex tw-justify-center tw-w-4"},[e("i",{class:"fas fa-grip-vertical gray"})],-1),Ge={class:"small"},Ke={class:"small"},Ze=I({__name:"FormContactsFields",emits:["close"],setup(y,{emit:c}){const{t:m}=ve(),_=["name","lastname","firstname","middlename"],a=[{id:"last_action",name:m("lastAction"),value:"",sort:0},{id:"create_datetime",name:m("createDate"),value:"",sort:0},{id:"tags",name:m("tags"),value:"",sort:0}],{data:u,isFetching:h,error:d}=ne("crm.field.list?scope=contact").get().json(),n=H(),{previousFetchParams:l}=x(n),f=J([]),R=T(()=>{var g;return(g=f.value)==null?void 0:g.filter(v=>v.value).sort((v,p)=>v.sort<0?1:v.sort-p.sort)}),D=T(()=>{var g;return(g=f.value)==null?void 0:g.filter(v=>!v.value)}),V=J(null);ge(()=>{Array.isArray(u.value)&&(f.value=[...a,...u.value.filter(g=>!_.includes(g.id))].reduce((g,v)=>{var z,M;const{id:p,name:C}=v,O=((M=(z=l.value)==null?void 0:z.fields)==null?void 0:M.indexOf(p))??-1;if(g.push({id:p,name:C,value:O>-1?"1":"",sort:O}),"fields"in v){const j=v.fields.map(A=>{var se,ae;const ee=`${v.id}:${A.id}`,te=((ae=(se=l.value)==null?void 0:se.fields)==null?void 0:ae.indexOf(ee))??-1;return{id:ee,name:`${v.name} â€“ ${A.name}`,value:te>-1?"1":"",sort:te}});g.push(...j)}return g},[]))});function N(){Re(V,R,{animation:150,handle:".handle"})}function B(){var g;n.fields=Array.from(((g=V.value)==null?void 0:g.querySelectorAll("[data-id]"))||[]).map(v=>v.getAttribute("data-id")??""),n.updateFetchParams(),ne("crm.user.settings.save").patch({contact_list_columns:n.fields.map(v=>({field:v,width:"m"}))}),c("close")}return(g,v)=>(i(),k(Y,{onClose:v[0]||(v[0]=p=>c("close"))},{header:s(()=>[P(r(g.$t("selectFields")),1)]),submit:s(()=>[f.value?(i(),b("button",{key:0,class:"button",onClick:B},r(g.$t("save")),1)):S("",!0)]),default:s(()=>[o(Se,{"is-fetching":t(h),error:t(d)},{default:s(()=>[o(De,{space:"4",class:"fields-list"},{default:s(()=>[e("div",{ref_key:"sortableRef",ref:V,class:"tw-bg-waBlank tw-z-20 tw-pb-4 tw-border-0 tw-border-solid tw-border-b tw-border-b-waBorder",onVnodeMounted:N},[(i(!0),b(W,null,oe(R.value,p=>(i(),b("div",{key:p.id,"data-id":p.id,class:"tw-flex tw-items-center tw-space-x-2 tw-mb-1"},[Ye,o(Z,{modelValue:p.value,"onUpdate:modelValue":C=>p.value=C},{default:s(()=>[e("span",Ge,r(p.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])],8,Xe))),128))],512),e("div",null,[(i(!0),b(W,null,oe(D.value,p=>(i(),b("div",{key:p.id,class:"tw-flex tw-items-center tw-space-x-2 tw-mb-1"},[o(Z,{modelValue:p.value,"onUpdate:modelValue":C=>p.value=C},{default:s(()=>[e("span",Ke,r(p.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1})]),_:1},8,["is-fetching","error"])]),_:1}))}}),et=["onClick"],tt=e("div",{class:"icon"},[e("i",{class:"fas fa-table"})],-1),st=e("div",{class:"icon"},[e("i",{class:"fas fa-exchange-alt"})],-1),at=["href"],nt=e("div",{class:"icon"},[e("i",{class:"fas fa-upload"})],-1),ot=e("div",{class:"icon"},[e("i",{class:"fas fa-download"})],-1),lt=I({__name:"DropdownSettings",setup(y){const{previousFetchParams:c}=x(H());return(m,_)=>{const a=X("RouterLink");return i(),k(F,null,{default:s(()=>{var u;return[o(w,null,{default:s(()=>[o(q,{component:Ze},{default:s(({open:h})=>[e("a",{onClick:$(h,["prevent"])},[tt,e("span",null,r(m.$t("customizeColumns")),1)],8,et)]),_:1})]),_:1}),(u=t(U).rights)!=null&&u.is_admin?(i(),b(W,{key:0},[o(w,null,{default:s(()=>[o(a,{to:{name:"mergeDuplicates"}},{default:s(()=>[st,e("span",null,r(m.$t("mergeDuplicates")),1)]),_:1})]),_:1}),o(w,null,{default:s(()=>[e("a",{href:`${t(U).baseUrl}contact/import/`},[nt,e("span",null,r(m.$t("importContacts")),1)],8,at)]),_:1})],64)):S("",!0),o(w,null,{default:s(()=>[e("a",{onClick:_[0]||(_[0]=$(h=>{var d,n;return t(L)(ie,{hash:(d=t(c))==null?void 0:d.hash,checkedCount:((n=t(c))==null?void 0:n.total_count)??0}).show()},["prevent"]))},[ot,e("span",null,r(m.$t("export")),1)])]),_:1})]}),_:1})}}}),ct={key:0,class:"tw-flex tw-space-x-2"},it={class:"tw-relative"},rt={class:"light-gray small tw-flex tw-items-center tw-space-x-2"},dt=e("i",{class:"fas fa-caret-down"},null,-1),ut=["onClick"],mt=e("hr",{class:"tw-m-0"},null,-1),pt=["onClick"],_t=e("span",{class:"icon"},[e("i",{class:"fas fa-folder-open"})],-1),ft=["onClick"],ht=e("span",{class:"icon"},[e("i",{class:"fas fa-hashtag"})],-1),vt=["disabled","onClick"],gt=e("span",{class:"icon"},[e("i",{class:"fas fa-users"})],-1),$t=["onClick"],wt=e("span",{class:"icon"},[e("i",{class:"fas fa-user-circle"})],-1),kt=["onClick"],Ct=e("span",{class:"icon"},[e("i",{class:"fas fa-download"})],-1),bt=["onClick"],yt=e("span",{class:"icon"},[e("i",{class:"fas fa-trash-alt"})],-1),St=e("i",{class:"fas fa-times"},null,-1),Ft=[St],It={key:1,class:"tw-flex tw-space-x-2"},At=e("i",{class:"fas fa-check-square"},null,-1),Pt={class:"light-gray small"},Rt=e("i",{class:"fas fa-ellipsis-h"},null,-1),Dt=e("i",{class:"fas fa-caret-down"},null,-1),Vt=I({__name:"ContactsListControls",setup(y){const c=le(),{contacts:m,bulkSelectMode:_,bulkSelectIds:a,lastRouteLocation:u}=x(H()),h=T(()=>JSON.stringify(a.value)===JSON.stringify(m.value.map(n=>n.id)));$e(()=>{_.value=!1}),we((n,l)=>{u.value=l!=null&&l.name?{name:l.name,params:l.params,query:l.query}:null});function d(){const n=m.value.map(l=>l.id);a.value=h.value?[]:n}return(n,l)=>t(_)?(i(),b("div",ct,[e("div",it,[o(K,{right:!0,"disable-click-outside":!0},{body:s(({hide:f})=>{var R;return[o(F,null,{default:s(()=>[o(w,null,{default:s(()=>[e("a",{onClick:$(d,["prevent"])},[o(Z,{"model-value":h.value?"1":""},{default:s(()=>[P(r(n.$t("selectAll")),1)]),_:1},8,["model-value"])],8,ut)]),_:1})]),_:1}),mt,e("div",{class:E({"tw-opacity-40 tw-pointer-events-none":!t(a).length})},[o(F,null,{default:s(()=>[o(w,null,{default:s(()=>[e("a",{onClick:$(D=>{t(L)(Qe,{contactIds:t(a)}).show(),f()},["prevent"])},[_t,e("span",null,r(n.$t("addToSegment")),1)],8,pt)]),_:2},1024)]),_:2},1024),o(F,null,{default:s(()=>[o(w,null,{default:s(()=>[e("a",{onClick:$(D=>{t(L)(Pe,{entityType:"contact",entityIds:t(a)}).show(),f()},["prevent"])},[ht,e("span",null,r(n.$t("tags")),1)],8,ft)]),_:2},1024)]),_:2},1024),(R=t(U).rights)!=null&&R.is_admin?(i(),k(F,{key:0},{default:s(()=>[o(w,null,{default:s(()=>[e("a",{disabled:t(a).length<2,onClick:$(()=>{t(c).push({name:"merge",query:{ids:t(a).join(",")}}),f()},["prevent"])},[gt,e("span",null,r(n.$t("merge")),1)],8,vt)]),_:2},1024)]),_:2},1024)):S("",!0),o(F,null,{default:s(()=>[o(w,null,{default:s(()=>[e("a",{onClick:$(D=>{t(L)(Ie,{contactIds:t(a)}).show(),f()},["prevent"])},[wt,e("span",null,r(n.$t("addResponsible")),1)],8,$t)]),_:2},1024)]),_:2},1024),o(F,null,{default:s(()=>[o(w,null,{default:s(()=>[e("a",{onClick:$(D=>{t(L)(ie,{contactIds:t(a),checkedCount:t(a).length}).show(),f()},["prevent"])},[Ct,e("span",null,r(n.$t("export")),1)],8,kt)]),_:2},1024)]),_:2},1024),o(F,null,{default:s(()=>[o(w,null,{default:s(()=>[e("a",{onClick:$(D=>{t(L)(Fe,{contactIds:t(a),disableContactsPageRedirect:!0}).show(),f()},["prevent"])},[yt,e("span",null,r(n.$t("delete")),1)],8,bt)]),_:2},1024)]),_:2},1024)],2)]}),default:s(()=>[e("button",rt,[e("span",null,r(n.$t("selected")),1),e("span",{class:E(["badge smaller",t(a).length?"tw-bg-waAccent":"gray"])},r(t(a).length),3),dt])]),_:1})]),e("button",{class:"light-gray small",onClick:l[0]||(l[0]=$(f=>_.value=!1,["prevent"]))},Ft)])):(i(),b("div",It,[e("button",{class:"light-gray small tw-flex tw-items-center tw-space-x-2",onClick:l[1]||(l[1]=$(f=>_.value=!0,["prevent"]))},[At,e("span",null,r(n.$t("select")),1)]),o(K,{right:!0},{body:s(()=>[o(lt)]),default:s(()=>[e("button",Pt,[Rt,P("Â Â "+r(n.$t("settings"))+"Â Â ",1),Dt])]),_:1})]))}}),Lt={key:0,class:"tw-p-4"},xt={class:"tw-flex tw-items-center tw-space-x-4 tw-justify-between tw-h-8"},Bt={key:0,class:"skeleton tw-w-48"},Tt=e("div",{class:"skeleton-line",style:{height:"2.2rem"}},null,-1),Ut=[Tt],Ht={key:2,class:"tw-flex-none tw-ml-auto tw-hidden md:tw-flex"},Ot={class:"md:tw-hidden"},zt=e("i",{class:"fas fa-sliders-h black"},null,-1),Mt=[zt],Nt={key:1,class:"tw-p-4 tw-flex-auto tw-min-h-[80vh]"},jt={key:2},qt=e("div",{class:"icon size-80"},[e("i",{class:"fas fa-user-friends"})],-1),Et=e("div",{class:"icon size-80"},[e("i",{class:"fas fa-user-friends"})],-1),Jt={key:0,class:"tw-text-center tw-py-4"},Wt=e("div",{class:"spinner custom-p-16"},null,-1),Qt=[Wt],Xt=e("div",{class:"icon size-80"},[e("i",{class:"fas fa-user-friends"})],-1),ps=I({__name:"ContactsList",props:{fetchParams:{},hideHeader:{type:Boolean},activeContactId:{}},setup(y){const c=y,m=H(),{fetchNextPage:_,fetchPrevPage:a,updateFetchParams:u,bulkSelectToggle:h}=m,{contacts:d,prevOffset:n,fetchParams:l,previousFetchParams:f,bulkSelectMode:R,bulkSelectIds:D,isFetching:V,isFinished:N,error:B}=x(m),{showSidebar:g}=x(ye()),v=T(()=>{var p;return(((p=f.value)==null?void 0:p.columns)||[]).filter(C=>C.id!=="name")});return ke(()=>c.fetchParams,u,{immediate:!0}),(p,C)=>(i(),k(pe,{breakpoint:["md","lg"],"trigger-class":["tw-group/md-contacts","tw-group/lg-contacts"],class:"tw-flex tw-flex-col tw-h-full tw-bg-waBlank"},{default:s(()=>{var O,z,M,j;return[p.hideHeader?S("",!0):(i(),b("div",Lt,[e("div",xt,[t(V)&&!t(l).offset||((O=t(B))==null?void 0:O.code)===20?(i(),b("div",Bt,Ut)):(i(),k(qe,{key:1})),t(d).length?(i(),b("div",Ht,[o(Vt)])):S("",!0),e("div",Ot,[e("button",{class:"circle transparent",onClick:C[0]||(C[0]=A=>g.value=!t(g))},Mt)])])])),t(V)&&!t(l).offset&&(!c.activeContactId||!t(n))||((z=t(B))==null?void 0:z.code)===20?(i(),b("div",Nt,[o(de)])):t(B)?(i(),b("div",jt,r(t(B)),1)):t(N)&&!t(d).length?(i(),b(W,{key:3},[p.$route.name==="myContacts"?(i(),k(G,{key:0,title:p.$t("hereMyContacts"),message:p.$t("infoHowAssignResponsible")},{default:s(()=>[qt]),_:1},8,["title","message"])):(i(),k(G,{key:1,message:p.$t("noContacts")},{default:s(()=>[Et]),_:1},8,["message"]))],64)):t(d).length&&t(f)?(i(),k(me,{key:4,contacts:t(d),"header-columns":v.value,"fetch-params":t(l),sort:t(f).sort,"active-contact-id":c.activeContactId,"context-contact-id":(M=p.fetchParams)==null?void 0:M.context_contact_id,"prev-offset":t(n),"bulk-select-mode":t(R),"bulk-select-ids":t(D),onBulkSelectToggle:C[2]||(C[2]=A=>t(h)(...A)),onUpdateFetchParams:C[3]||(C[3]=A=>t(u)(A))},{lazyloadUp:s(()=>[t(n)>0?Ce((i(),b("div",Jt,Qt)),[[t(re),([{isIntersecting:A}])=>{A&&!t(V)&&t(a)()}]]):S("",!0)]),lazyloadDown:s(()=>[o(ue,{"entity-type":"contacts","count-loaded":t(d).length,"limit-load":t(f).limit,total:t(f).total_count,class:"tw-my-4",onVIntersectionObserver:C[1]||(C[1]=()=>{t(V)||t(_)()})},null,8,["count-loaded","limit-load","total"])]),_:1},8,["contacts","header-columns","fetch-params","sort","active-contact-id","context-contact-id","prev-offset","bulk-select-mode","bulk-select-ids"])):S("",!0),t(N)&&((j=t(U).rights)!=null&&j.is_admin)&&p.$route.name==="contacts"&&t(d).length===1&&t(d)[0].id===t(U).user.id?(i(),k(G,{key:5,title:p.$t("hereContactsFromApps"),message:p.$t("infoHowAddContactOrImportContacts"),"notice-id":"contacts/infoHowAddContactOrImportContacts"},{default:s(()=>[Xt]),_:1},8,["title","message"])):S("",!0)]}),_:1}))}});export{ps as _};
