import{d as M,l as h,o as s,c as t,F as b,b as m,a as c,p as y,i as k,k as T,u as o,n as w,A as H,j as r,r as $,v as N,e as L,O as te,w as F,q as P,h as z,B as A,I as le,$ as ae,aj as ie,ay as j,ao as oe,m as ne,a9 as de,Z as re}from"./main-2290994d.js";import{_ as U,a as q,b as Q,c as X,d as Z}from"./DealsItemResponsible.vue_vue_type_style_index_0_lang-03e36101.js";import{d as ce}from"./dayjs-910ec40d.js";import{v as ue}from"./vTooltip-95186f83.js";import{U as V}from"./UserPic-f44f080b.js";import{_ as _e}from"./ContactsListItemAction.vue_vue_type_style_index_0_lang-1445a600.js";import{d as me}from"./date-18c3b35b.js";import{c as pe}from"./index-6e4a059f.js";import{S as fe}from"./SkeletonList-1c6858f7.js";import{E as ve}from"./EmptyList-239f0622.js";const he={key:0,class:"deals-item-stage__closed"},ye={class:"deals-item-stage__text"},ge={class:"deals-item-stage__text"},we={class:"deals-item-stage__closed-datetime"},$e={key:1,class:"deals-item-stage__open"},be={key:1,class:"icon size-12 tw-flex",style:{color:"var(--deal-color-gray-primary)"}},ke=c("i",{class:"fas fa-info-circle"},null,-1),Ce=[ke],xe={key:2,class:"gray small tw-ml-1"},W=14,G=M({__name:"DealsListItemStage",props:{deal:{},closed:{type:Boolean},funnel:{},isMobile:{type:Boolean},largeIcon:{type:Boolean},fontNormal:{type:Boolean}},setup(v){const e=v,u=h(()=>ce(e.deal.closed_datetime)),n=h(()=>u.value.isYesterday()),d=h(()=>u.value.isToday()),a=h(()=>u.value.format("HH:mm")),l=h(()=>u.value.format("L"));return(_,I)=>{var C,R,B,S;return s(),t("div",{class:w(["deals-item-stage",e.fontNormal?"tw-font-normal":"tw-font-semibold",{"deals-item-stage--mobile":e.isMobile}])},[e.closed?(s(),t("div",he,[e.deal.status_id==="WON"?(s(),t(b,{key:0},[m(V,{size:W,"fa-icon":"flag-checkered","icon-color":e.deal.stage.color},null,8,["icon-color"]),c("div",ye,y(_.$t("won")),1)],64)):(s(),t(b,{key:1},[m(V,{size:W,"fa-icon":"ban","icon-color":e.deal.stage.color},null,8,["icon-color"]),c("div",ge,y(_.$t("lost")),1)],64)),c("span",we,y(n.value?`${_.$t("yesterday")} ${a.value}`:d.value?`${_.$t("today")} ${a.value}`:l.value),1)])):(s(),t("div",$e,[e.deal.funnel?(s(),k(V,{key:0,"icon-class":e.deal.funnel.icon||"fas fa-briefcase","icon-color":((C=e.deal.stage)==null?void 0:C.color)||e.deal.funnel.color,size:W},null,8,["icon-class","icon-color"])):(s(),t("span",be,Ce)),T((s(),t("div",{class:w(["deals-item-stage__text",{"text-gray":!((R=e.deal.stage)!=null&&R.color)}])},[H(y(e.deal.stage?e.deal.stage.color?e.deal.stage.name:_.$t("stageDeleted"):_.$t("funnelDeleted")),1)],2)),[[o(ue),(B=e.deal.stage)==null?void 0:B.name,void 0,{"top-start":!0,500:!0}]]),(S=_.funnel)!=null&&S.is_archived?(s(),t("span",xe,y(_.$t("archived")),1)):r("",!0)]))],2)}}});const J=M({__name:"DealsListItemLastAction",props:{lastAction:{},disableTooltip:{type:Boolean}},setup(v){const e=v;return(u,n)=>(s(),k(_e,{action:e.lastAction,"disable-tooltip":e.disableTooltip,"single-line":!0},null,8,["action","disable-tooltip"]))}}),Le={class:"deals-item-create_datetime mobile:tw-text-[var(--deal-color-gray-secondary)] mobile:tw-text-[13px]"},K=M({__name:"DealsListItemDate",props:{value:{}},setup(v){const e=v,u=h(()=>me(e.value));return(n,d)=>(s(),t("div",Le,[$(n.$slots,"default",{valueFormatted:u.value},()=>[H(y(u.value),1)])]))}}),Me={key:1,class:"deal-list__item item-stage_id"},Ie={key:2,class:"deal-list__item item-name"},Se={key:3,class:"deal-list__item item-states"},De={key:4,class:"deal-list__item item-create_datetime"},Te={class:"gray tw-mr-1"},Re={class:"tw-lowercase"},Be={class:"md:tw-contents tw-col-span-2 tw-flex tw-flex-row-reverse tw-items-center tw-justify-between"},Ae={key:0,class:"deal-list__item item-amount"},Ne={key:1,class:"deal-list__item item-user_name"},Ee={key:6,class:"deal-list__item item-last_action !tw-whitespace-normal"},ze=M({__name:"DealsListRowTile",props:{deal:{},useColumnsIds:{},isMobile:{type:Boolean},customColumnsIds:{},isSelected:{type:Boolean},funnelsMap:{}},setup(v){const e=v,u=h(()=>e.deal.status_id!=="OPEN"),n=e.useColumnsIds.reduce((d,a)=>(d[a]=!0,d),{});return(d,a)=>(s(),t("div",{class:w(["deal-list__row",{highlighted:e.isSelected,"deal-list__row--deal-closed":u.value}])},[o(n).checkbox?T((s(),t("div",{key:0,class:"deal-list__item deal-list__item--not-opacity",onClick:a[0]||(a[0]=L(()=>{},["stop"]))},[$(d.$slots,"checkbox")],512)),[[N,!1]]):r("",!0),o(n).stage_id?(s(),t("div",Me,[m(G,{deal:e.deal,closed:u.value,"is-mobile":e.isMobile,funnel:e.funnelsMap&&e.funnelsMap[e.deal.funnel_id],"font-normal":!0},null,8,["deal","closed","is-mobile","funnel"])])):r("",!0),o(n).name?(s(),t("div",Ie,[m(U,{deal:e.deal,"use-userpic":!1,"disable-tootltip":!0,"text-size":"15px","show-id":o(n).id},null,8,["deal","show-id"])])):r("",!0),o(n).states?(s(),t("div",Se,[m(q,{deal:e.deal},null,8,["deal"])])):r("",!0),o(n).create_datetime?(s(),t("div",De,[m(K,{value:e.deal.create_datetime},te({_:2},[e.isMobile?void 0:{name:"default",fn:F(({valueFormatted:l})=>[c("span",Te,y(d.$t("created")),1),c("span",Re,y(l),1)]),key:"0"}]),1032,["value"])])):r("",!0),c("div",Be,[o(n).amount?(s(),t("div",Ae,[m(Q,{deal:e.deal,size:e.isMobile?"lg":"base","row-reverse":e.isMobile,"large-icon":e.isMobile},null,8,["deal","size","row-reverse","large-icon"])])):r("",!0),o(n).user?(s(),t("div",Ne,[e.deal.user?(s(),k(X,{key:0,user:e.deal.user,"align-right":!e.isMobile,"default-color":!0,"disable-tootltip":e.isMobile},null,8,["user","align-right","disable-tootltip"])):r("",!0)])):r("",!0)]),o(n).tags&&!e.isMobile?(s(),t("div",{key:5,class:"deal-list__item deal-list__item--not-opacity item-tags",onClick:a[1]||(a[1]=L(()=>{},["prevent"]))},[m(Z,{tags:e.deal.tags,"disable-overflow-soft":!0,small:!0},null,8,["tags"])])):r("",!0),o(n).last_action?(s(),t("div",Ee,[!e.isMobile&&"last_action"in e.deal?(s(),k(J,{key:0,"last-action":e.deal.last_action,"disable-tooltip":!0},null,8,["last-action"])):r("",!0)])):r("",!0)],2))}});const Ve={key:1,class:"deal-list__item item-stage_id"},We={key:2,class:"deal-list__item item-name"},Fe={key:3,class:"deal-list__item item-states"},Oe={key:4,class:"deal-list__item item-create_datetime"},Ye={key:5,class:"deal-list__item item-amount"},je={key:6,class:"deal-list__item item-user_name"},He={key:8,class:"deal-list__item item-last_action !tw-whitespace-normal"},Pe={key:10,class:"deal-list__item"},Ue={class:"tw-truncate"},qe=M({__name:"DealsListRow",props:{deal:{},useColumnsIds:{},isSelected:{type:Boolean},isMobile:{type:Boolean},funnelsMap:{}},setup(v){const e=v,u=h(()=>e.deal.status_id!=="OPEN"),n=h(()=>(e.useColumnsIds||[]).map(d=>{var l,_;const a=(_=(l=e.deal)==null?void 0:l.fields)==null?void 0:_.find(I=>I.id===d);return{id:d,value:(a==null?void 0:a.value)||null}}));return(d,a)=>(s(),t("div",{class:w(["deal-list__row",{highlighted:e.isSelected,"deal-list__row--deal-closed":u.value}])},[(s(!0),t(b,null,P(n.value,l=>(s(),t(b,{key:l.id},[l.id==="checkbox"?T((s(),t("div",{key:0,class:"deal-list__item deal-list__item--not-opacity",onClick:a[0]||(a[0]=L(()=>{},["stop"]))},[$(d.$slots,"checkbox")],512)),[[N,!e.isMobile]]):l.id==="stage_id"?(s(),t("div",Ve,[m(G,{deal:e.deal,closed:u.value,funnel:e.funnelsMap&&e.funnelsMap[e.deal.funnel_id]},null,8,["deal","closed","funnel"])])):l.id==="name"?(s(),t("div",We,[m(U,{deal:e.deal,"use-userpic":!0,"show-id":e.isMobile&&e.useColumnsIds.some(_=>_==="id")},null,8,["deal","show-id"])])):l.id==="states"?(s(),t("div",Fe,[m(q,{deal:e.deal},null,8,["deal"])])):l.id==="create_datetime"?(s(),t("div",Oe,[m(K,{value:e.deal.create_datetime},null,8,["value"])])):l.id==="amount"?(s(),t("div",Ye,[m(Q,{deal:e.deal},null,8,["deal"])])):l.id==="user"?(s(),t("div",je,[e.deal.user?(s(),k(X,{key:0,user:e.deal.user},null,8,["user"])):r("",!0)])):l.id==="tags"?(s(),t("div",{key:7,class:"deal-list__item deal-list__item--not-opacity item-tags",onClick:a[1]||(a[1]=L(()=>{},["prevent"]))},[m(Z,{tags:e.deal.tags},null,8,["tags"])])):l.id==="last_action"?(s(),t("div",He,["last_action"in e.deal?(s(),k(J,{key:0,"last-action":e.deal.last_action},null,8,["last-action"])):r("",!0)])):l.id==="id"?T((s(),t("div",{key:9,class:"deal-list__item"},y(e.deal.id),513)),[[N,!e.isMobile]]):(s(),t("div",Pe,[c("div",Ue,y(l.value),1)]))],64))),128))],2))}});const Qe={class:"deals-list__wrapper"},Xe=c("i",{class:"fas fa-chevron-left"},null,-1),Ze=[Xe],Ge=c("i",{class:"fas fa-chevron-right"},null,-1),Je=[Ge],Ke={class:"tw-sticky tw-top-0 tw-left-1/2 tw-w-fit -tw-translate-x-1/2"},es={key:1,class:"deals-list__skeleton-body tw-h-full md:tw-pt-3"},ss=c("div",{class:"icon size-80"},[c("i",{class:"fas fa-briefcase"})],-1),_s=M({__name:"DealsListTable",props:{deals:{},useColumnsIds:{},customColumnsIds:{},isFetching:{type:Boolean},isFirstFetching:{type:Boolean},navigateRouteName:{},tileView:{type:Boolean},funnelsMap:{}},setup(v){const e=v,u={s:"8rem",m:"12rem",l:"20rem"},n={checkbox:"minmax(40px, 40px)",stage_id:"minmax(230px, 2fr)",name:"minmax(240px, 2fr)",states:"minmax(100px, 0.5fr)",create_datetime:"minmax(135px, 1fr)",amount:"minmax(150px, 1fr)",tags:"minmax(180px, 1.33fr)",user_name:"minmax(250px, 2fr)",last_action:`minmax(${u.l}, 100%)`},d=z(null),a=z(!1),l=A.webView?z(!0):le(pe),{x:_,y:I,arrivedState:C,measure:R}=ae(d,{throttle:200}),B=h(()=>!l.value&&a.value&&!C.right);ie(d,i=>{const f=i[0];a.value=f.target.scrollWidth>f.target.clientWidth}),j(()=>e.isFetching,i=>{if(!i){const f=d.value;f&&(a.value=f.scrollWidth>f.clientWidth),R()}},{debounce:500}),j(I,i=>{A.scrollY=i},{debounce:250}),oe(()=>{A.scrollY!==void 0&&!e.isFetching&&e.deals.length>0&&(I.value=A.scrollY)});function S(i){var Y;const x=Array.from(((Y=d.value)==null?void 0:Y.querySelectorAll(".deal-list__row:last-of-type > *"))||[]),p=x.map(g=>g.offsetLeft),D=x.length-1,O=p[D]+350,E=x[D].offsetWidth;if(E>O){let g=O;for(;g<E;)p.push(g),g+=350;p.push(E)}const se=i==="next"?p.find(g=>g>_.value+1):p.reverse().find(g=>g<_.value-1);_.value=se??p[2]}const ee=h(()=>{let i="";return e.useColumnsIds.forEach(f=>{const x=`minmax(${u.m}, 100%)`,p=n[f]??x;i+=`${p} `}),i});return(i,f)=>{const x=ne("RouterLink");return s(),t("div",Qe,[c("div",{class:w(["deals-list",{"deals-list--mobile":o(l),"deals-list--tiles":!o(l)&&e.tileView,"refresh-list":e.deals.length&&e.isFetching}])},[i.deals.length?(s(),t("div",{key:0,ref_key:"scrollableContainerRef",ref:d,class:w(["deals-list__table-wrapper",{"overflow-soft-hide-x":B.value}])},[c("div",{class:"deals-list__table",style:de({"--deals-list-row-grid-template-columns":ee.value})},[!e.tileView&&!o(l)?(s(),t(b,{key:0},[c("div",{class:w([{"tw-hidden":!a.value},"tw-absolute tw-top-1 tw-left-0 tw-w-full tw-z-30"])},[T(c("div",{class:w([{"tw-opacity-30":o(C).left},"col-nav col-nav--left tw-left-0"]),onClick:f[0]||(f[0]=L(p=>S("prev"),["prevent"]))},Ze,2),[[N,!o(C).left]]),c("div",{class:w([{"tw-opacity-30":o(C).right},"col-nav col-nav--right tw-right-0"]),onClick:f[1]||(f[1]=L(p=>S("next"),["prevent"]))},Je,2)],2),$(i.$slots,"headers",{useColumnsIds:i.useColumnsIds})],64)):r("",!0),(s(!0),t(b,null,P(e.deals,p=>(s(),k(x,{key:p.id,to:{name:e.navigateRouteName||"deal",params:{id:p.id}},custom:""},{default:F(({navigate:D})=>[$(i.$slots,"listItem",{deal:p,isMobile:o(l),isTile:e.tileView,useColumnsIds:i.useColumnsIds,customColumnsIds:e.customColumnsIds,navigate:D},()=>[(s(),k(re(e.tileView?ze:qe),{deal:p,"is-mobile":o(l),"use-columns-ids":i.useColumnsIds,"custom-columns-ids":e.customColumnsIds,"funnels-map":i.funnelsMap,onClick:D},null,8,["deal","is-mobile","use-columns-ids","custom-columns-ids","funnels-map","onClick"]))])]),_:2},1032,["to"]))),128))],4),c("div",Ke,[$(i.$slots,"lazy")])],2)):r("",!0),e.isFetching?(s(),t("div",es,[m(fe,{"row-height":o(l)?"108px":"38px"},null,8,["row-height"])])):r("",!0),!e.isFetching&&e.deals.length===0?(s(),t(b,{key:2},[i.$slots.emptyList?$(i.$slots,"emptyList",{key:0}):(s(),t(b,{key:1},[m(ve,{message:i.$t("noDeals")},{default:F(()=>[ss]),_:1},8,["message"]),$(i.$slots,"bottomEmptyList")],64))],64)):r("",!0)],2)])}}});export{_s as _,ze as a,qe as b};
