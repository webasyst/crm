import{d as $,o as t,b,c as n,k as e,r as W,H as D,x as I,M as L,$ as M,a2 as _,g as a,w as p,m as c,i as l,F as d,p as N,e as C,f as P,l as k}from"./main-ad3d4b2a.js";import{U as x}from"./UserPic-e76d468d.js";import{W as V}from"./WaSpinner-8364792b.js";import{W as R}from"./WaDialog-48ef549a.js";const j={key:1},U=$({__name:"WaDialogLoading",props:{isFetching:{type:Boolean},error:{}},setup(g){const h=g;return(i,v)=>h.isFetching?(t(),b(V,{key:0})):h.error?(t(),n("div",j,e(i.error),1)):W(i.$slots,"default",{key:2})}}),z=["disabled","onClick"],A={key:0},E={class:"text-orange"},H={class:"tw-flex tw-flex-auto tw-w-1/2 tw-space-x-2 tw-items-center"},T={class:"tw-truncate"},q={class:"tw-flex-none"},G={class:"tw-whitespace-nowrap"},X=$({__name:"FormContactDelete",props:{contactIds:{},disableContactsPageRedirect:{type:Boolean}},emits:["close"],setup(g,{emit:h}){const i=g,v=D(),f=I(),m=f.deleteContacts(i.contactIds),o=L(`crm.contact.links?${M.stringify({id:i.contactIds})}`).get().json();async function F(){var s;if(o.error.value){o.execute();return}if(await m.execute()&&(h("close"),!i.disableContactsPageRedirect)){let u=null;if((s=f.fetchParams.hash)!=null&&s.startsWith("segment/")){const r=f.fetchParams.hash.match(/segment\/(\d+)/);r!=null&&r.length&&(u=r[1])}v.push(u?{name:"segment",params:{id:u}}:{name:"contacts"})}}return(s,u)=>(t(),b(R,{onClose:u[0]||(u[0]=r=>h("close"))},_({header:p(()=>[c(e(s.$t("deleteContacts",i.contactIds.length)),1)]),submit:p(()=>[l("button",{disabled:a(o).isFetching.value||a(m).isFetching.value,onClick:N(F,["prevent"])},[a(o).isFetching.value?(t(),n(d,{key:0},[c(e(s.$t("checkingLinks")),1)],64)):a(o).error.value?(t(),n(d,{key:1},[c(e(s.$t("recheckLinks")),1)],64)):a(m).isFetching.value?(t(),n(d,{key:2},[c(e(s.$t("deleting")),1)],64)):(t(),n(d,{key:3},[c(e(s.$t("deleteAnyway")),1)],64))],8,z)]),default:p(()=>[C(U,{"is-fetching":a(o).isFetching.value,error:a(o).error.value},_({_:2},[a(o).data.value&&"linked_contacts"in a(o).data.value?{name:"default",fn:p(()=>[l("p",null,e(s.$t("deleteContactsMessage1")),1),a(o).data.value.linked_contacts.length?(t(),n("p",A,[l("strong",E,e(s.$t("importantNote")),1),c(" "+e(s.$t("deleteContactsMessage2"))+" "+e(s.$t("deleteContactsMessage3")),1)])):P("",!0),(t(!0),n(d,null,k(a(o).data.value.linked_contacts,r=>(t(),n("div",{key:r.id},[(t(!0),n(d,null,k(r.links,(w,S)=>(t(),n("div",{key:S},[(t(!0),n(d,null,k(w.roles,(y,B)=>(t(),n("div",{key:B,class:"tw-flex tw-space-x-2 tw-justify-between tw-py-1 bordered-bottom tw-text-sm"},[l("div",H,[C(x,{url:r.userpic,size:16},null,8,["url"]),l("div",T,e(r.name),1),l("div",q,e(w.app)+"/"+e(y.role),1)]),l("div",G,e(s.$t("links",y.count)),1)]))),128))]))),128))]))),128))]),key:"0"}:void 0]),1032,["is-fetching","error"])]),_:2},[a(m).isFetching.value?void 0:{name:"error",fn:p(()=>[c(e(a(m).error.value),1)]),key:"0"}]),1024))}});export{U as _,X as a};
