import{d as I,o as l,c as r,r as w,f as C,i as c,F as T,l as x,n as m,_ as P,j,b as S,$ as F,w as h,k as L,e as g,h as J,m as H,g as f,a0 as K,a as B,N as M,A as $,J as V,a1 as G,a2 as Q,p as N,a3 as X,q as Y,s as Z}from"./main-ec0df6a4.js";import{U as tt}from"./UserPic-87c13a4a.js";import{C as et,a as st}from"./ChipsList-64240846.js";import{_ as ot}from"./ContactsListItemAction.vue_vue_type_script_setup_true_lang-37a8a184.js";import{v as at}from"./vTooltip-c8fe82a0.js";const ct={key:0,class:"tw-flex tw-items-center tw-w-4 !tw-pr-0"},nt={class:"item__userpic"},lt={class:"item__username"},it=I({__name:"ContactsListRow",props:{columns:{},columnsWidths:{},isHeader:{type:Boolean},isSelected:{type:Boolean},isHighlighted:{type:Boolean},isBulkSelectMode:{type:Boolean},withLastAction:{type:Boolean}},setup(s){const e=s;return(t,i)=>(l(),r("div",{class:m(["item",{header:e.isHeader,selected:e.isSelected,"with-last-action":e.withLastAction,highlighted:e.isHighlighted}])},[e.isBulkSelectMode?(l(),r("div",ct,[w(t.$slots,"checkbox",{},void 0,!0)])):C("",!0),c("div",nt,[w(t.$slots,"userpic",{},void 0,!0)]),c("div",lt,[w(t.$slots,"name",{},void 0,!0)]),(l(!0),r(T,null,x(e.columns||[],a=>(l(),r("div",{key:a.id,class:m([`width-${e.columnsWidths[a.id]??"m"}`,{"item__last-action":a.id==="last_action",item__secondary:a.id!=="last_action"}])},[w(t.$slots,a.id,{},void 0,!0)],2))),128))],2))}});const q=P(it,[["__scopeId","data-v-4289916d"]]),dt={class:"wa-checkbox"},rt=["checked"],ut=c("span",null,[c("span",{class:"icon"},[c("i",{class:"fas fa-check"})])],-1),ht={class:"tw-truncate tw-leading-none tw-py-2 semibold"},mt={key:0,class:"fas fa-eye-slash gray"},_t={class:"tw-truncate"},pt=I({__name:"ContactsListItem",props:{contact:{},columns:{},columnsWidths:{},bulkSelectIds:{},isBulkSelectMode:{type:Boolean},selected:{type:Boolean}},setup(s){const e=s;return(t,i)=>{const a=j("RouterLink");return l(),S(q,{columns:e.columns,"columns-widths":e.columnsWidths,"is-bulk-select-mode":e.isBulkSelectMode,"is-selected":e.selected,"is-highlighted":(e.bulkSelectIds||[]).includes(e.contact.id),"with-last-action":!!e.contact.last_action},F({checkbox:h(()=>[c("span",dt,[c("input",{type:"checkbox",checked:(e.bulkSelectIds||[]).includes(e.contact.id)},null,8,rt),ut])]),userpic:h(()=>[g(tt,{url:e.contact.userpic,size:32},null,8,["url"])]),name:h(()=>[J((l(),r("div",ht,[H(L(e.contact.name),1)])),[[f(at),e.contact.name,void 0,{right:!0,500:!0}]]),e.contact.acl==="own"?(l(),r("i",mt)):C("",!0)]),last_action:h(()=>[e.contact.last_action?(l(),S(ot,{key:0,"contact-id":e.contact.id,action:e.contact.last_action},null,8,["contact-id","action"])):C("",!0)]),tags:h(()=>[g(et,{nowrap:!0},{default:h(()=>[(l(!0),r(T,null,x(e.contact.tags,o=>(l(),S(st,{key:o.id,class:"small"},{default:h(()=>[g(a,{to:{name:"tag",params:{id:o.id}},class:m(t.$constant.parentAppDisableRouterClass)},{default:h(()=>[H(L(o.name),1)]),_:2},1032,["to","class"])]),_:2},1024))),128))]),_:1})]),_:2},[x(e.contact.fields.filter(o=>!["name","last_action","tags"].includes(o.id)),o=>({name:o.id,fn:h(()=>[c("div",_t,L(Array.isArray(o.value)?o.value.filter(p=>p).join(", "):o.value),1)])}))]),1032,["columns","columns-widths","is-bulk-select-mode","is-selected","is-highlighted","with-last-action"])}}}),ft={class:"tw-group tw-flex tw-items-center tw-space-x-2 tw-justify-between tw-w-full"},wt=["title"],vt={key:0,class:"icon"},kt=c("i",{class:"fas fa-sort-amount-down"},null,-1),yt=[kt],gt={key:1,class:"icon"},Ct=c("i",{class:"fas fa-sort-amount-down-alt"},null,-1),bt=[Ct],St={key:1,class:"tw-flex tw-items-center tw-space-x-2"},$t=c("i",{class:"fas fa-arrow-left"},null,-1),xt=[$t],It=c("i",{class:"fas fa-arrow-right"},null,-1),Wt=[It],Lt=I({__name:"ContactsListHeaderCell",props:{id:{},name:{},sort:{},width:{}},emits:["changeWidth","toggleAsc"],setup(s,{emit:e}){const t=s;return(i,a)=>(l(),r("div",ft,[c("div",{class:m(["tw-truncate semibold tw-uppercase tw-text-sm tw-h-6 tw-leading-7",{gray:t.id!==t.sort.field}]),title:t.name},L(t.name),11,wt),c("div",{class:m(["tw-flex group-hover:tw-flex tw-flex-auto tw-items-center tw-space-x-2",{"tw-hidden":t.id!==t.sort.field}])},[t.id!=="tags"?(l(),r("div",{key:0,class:m(["tw-cursor-pointer hover:tw-opacity-100",{"tw-opacity-30":t.id!==t.sort.field}]),onClick:a[0]||(a[0]=o=>e("toggleAsc",t.sort.field===t.id?t.sort.asc?0:1:0))},[t.sort.field!==t.id||t.sort.asc||0?(l(),r("span",vt,yt)):(l(),r("span",gt,bt))],2)):C("",!0),["name","last_action"].includes(t.id)?C("",!0):(l(),r("div",St,[c("div",{class:m(["tw-cursor-pointer",{"tw-opacity-30":t.width==="s"}]),onClick:a[1]||(a[1]=()=>{t.width!=="s"&&e("changeWidth","prev")})},xt,2),c("div",{class:m(["tw-cursor-pointer",{"tw-opacity-30":t.width==="l"}]),onClick:a[2]||(a[2]=()=>{t.width!=="l"&&e("changeWidth","next")})},Wt,2)]))],2)]))}}),Bt=I({__name:"ContactsListHeader",props:{columns:{},columnsWidths:{}},setup(s){const e=s;return(t,i)=>(l(),S(q,{columns:e.columns,"columns-widths":e.columnsWidths,"is-header":!0},F({_:2},[x([{id:"name",name:"name"},...e.columns||[]],a=>({name:a.id,fn:h(()=>[w(t.$slots,"default",{colId:a.id,colName:a.name,colWidth:e.columnsWidths[a.id]})])}))]),1032,["columns","columns-widths"]))}}),O=K(["s","m","l"]),A=B(),v=B({});let R=!1;M(()=>{var s;return(s=A.value)==null?void 0:s.fields},s=>{s&&(v.value=Object.fromEntries(s.map(e=>{var t,i;return[e,v.value[e]??((i=(t=$.contact_list_columns)==null?void 0:t.find(a=>a.field===e))==null?void 0:i.width)??"m"]})))},{immediate:!0});M([()=>{var s;return(s=A.value)==null?void 0:s.sort},()=>{var s;return(s=A.value)==null?void 0:s.asc}],async([s,e])=>{var t;if(!R){const{response:i}=await V("crm.user.settings.save").patch({contact_list_sort:{field:s,asc:e}});(t=i.value)!=null&&t.ok&&typeof s=="string"&&($.contact_list_sort={field:s,asc:!!e})}});async function At(s,e){var t,i;if(O.state.value=v.value[s],v.value[s]=O[e](),!R){const{response:a}=await V("crm.user.settings.save").patch({contact_list_columns:Object.entries(v.value).map(([o,p])=>({field:o,width:p}))});(t=a.value)!=null&&t.ok&&((i=$.contact_list_columns)==null||i.forEach((o,p)=>{o.field===s&&$.contact_list_columns&&($.contact_list_columns[p].width=v.value[s])}))}}function Tt(s,e=!1){return A.value=s,R=e,{columnsWidths:v,changeWidth:At}}const D=s=>(Y("data-v-2b365177"),s=s(),Z(),s),Mt=D(()=>c("i",{class:"fas fa-chevron-left"},null,-1)),Rt=[Mt],zt=D(()=>c("i",{class:"fas fa-chevron-right"},null,-1)),Et=[zt],Ht=I({__name:"ContactsListItems",props:{contacts:{},headerColumns:{},sort:{},fetchParams:{},disableSyncSettings:{type:Boolean},bulkSelectIds:{},activeContactId:{},contextContactId:{},prevOffset:{},bulkSelectMode:{type:Boolean}},emits:["updateFetchParams","bulkSelectToggle"],setup(s,{emit:e}){const t=s,{columnsWidths:i,changeWidth:a}=Tt(t.fetchParams,t.disableSyncSettings),o=B(null),p=B(!1),{x:W,arrivedState:z}=G(o,{throttle:200});Q(o,d=>{const n=d[0];p.value=n.target.scrollWidth>n.target.clientWidth}),M(()=>t.prevOffset,async()=>{var n;const d=(n=o.value)==null?void 0:n.querySelector("[data-id]");if(d){const k=d.offsetTop;await X(),o.value&&(o.value.scrollTop=d.offsetTop-k)}});async function U(){var n;const d=t.contextContactId||t.activeContactId;d&&o.value&&(o.value.scrollTop=((n=o.value.querySelector(`[data-id="${d}"]`))==null?void 0:n.offsetTop)??0)}function E(d){var y;const n=Array.from(((y=o.value)==null?void 0:y.querySelectorAll(".header > div"))||[]).map(_=>_.offsetLeft),k=n.splice(3),u=d==="next"?k.find(_=>_>W.value+n[2]):k.reverse().find(_=>_<W.value+n[2]);W.value=(u??n[2])-n[2]}return(d,n)=>{const k=j("router-link");return t.contacts.length?(l(),r("div",{key:0,ref_key:"scrollableContainerRef",ref:o,class:m(["tw-overflow-x-auto tw-scrollbar-hide",{isStuck:f(W)>1}]),onVnodeMounted:U},[c("div",{class:m([{"tw-hidden":!p.value},"tw-sticky tw-top-1 tw-left-0 tw-w-full tw-z-30"])},[c("div",{class:m([{"tw-opacity-30":f(z).left},"col-nav tw-left-0"]),onClick:n[0]||(n[0]=N(u=>E("prev"),["prevent"]))},Rt,2),c("div",{class:m([{"tw-opacity-30":f(z).right},"col-nav tw-right-0"]),onClick:n[1]||(n[1]=N(u=>E("next"),["prevent"]))},Et,2)],2),g(Bt,{columns:d.headerColumns,"columns-widths":f(i)},{default:h(({colId:u,colName:y,colWidth:_})=>[g(Lt,{id:u,name:y,width:_,sort:t.sort,onChangeWidth:b=>f(a)(u,b),onToggleAsc:b=>e("updateFetchParams",{sort:u,asc:b})},null,8,["id","name","width","sort","onChangeWidth","onToggleAsc"])]),_:1},8,["columns","columns-widths"]),w(d.$slots,"lazyloadUp",{},void 0,!0),(l(!0),r(T,null,x(t.contacts,u=>(l(),S(k,{key:u.id,to:{name:"contact",params:{id:u.id}},custom:""},{default:h(({isActive:y,navigate:_})=>[g(pt,{contact:u,columns:t.headerColumns,"columns-widths":f(i),"bulk-select-ids":t.bulkSelectIds,"is-bulk-select-mode":t.bulkSelectMode,selected:y,"data-id":u.id,onClick:b=>{t.bulkSelectMode?e("bulkSelectToggle",[u.id,b.shiftKey]):_()}},null,8,["contact","columns","columns-widths","bulk-select-ids","is-bulk-select-mode","selected","data-id","onClick"])]),_:2},1032,["to"]))),128)),w(d.$slots,"lazyloadDown",{},void 0,!0)],2)):C("",!0)}}});const Vt=P(Ht,[["__scopeId","data-v-2b365177"]]);export{Vt as C};
