import{d as x,h as p,P as y,l as F,R as A,V as _,au as B,ag as T,o as n,c as v,a as s,p as h,b as N,w,A as b,e as E,u as i,i as D,k as L,v as M,av as O,aw as $,s as P,x as R,ae as V,_ as Y}from"./main-2290994d.js";import{v as j}from"./index-0b6b9def.js";import{_ as z}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-41c5f744.js";import U from"./FormDealAdd-b94d94c2.js";import{S as q}from"./SkeletonList-1c6858f7.js";import{_ as G}from"./DealsListTable.vue_vue_type_style_index_0_lang-767309a3.js";import"./fields-7ab6f7f6.js";import"./FieldCheckbox-4d368f68.js";import"./FieldSelect-bea6b277.js";import"./CustomColumn-c63128eb.js";import"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-67ac0b87.js";import"./SortableList.vue_vue_type_script_setup_true_lang-c14f94b7.js";import"./useSortable-a183a608.js";import"./InputWithContacts.vue_vue_type_script_setup_true_lang-3e53fea1.js";import"./UserPic-f44f080b.js";import"./DropDown-9065f982.js";import"./InputWithPerformers.vue_vue_type_script_setup_true_lang-ca873d3d.js";import"./recentContacts-a3525f5f.js";import"./vTooltip-95186f83.js";import"./dayjs-910ec40d.js";import"./index-6e4a059f.js";import"./emit-692c947e.js";import"./WaSpinner-299938a2.js";import"./TextAreaAutoresize-55461952.js";import"./DropDownButton-495429ba.js";import"./ButtonSubmit-4410c58d.js";import"./DealsItemResponsible.vue_vue_type_style_index_0_lang-03e36101.js";import"./ChipsList-0fe31c28.js";import"./currency-format-433ea0a4.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-1445a600.js";import"./date-18c3b35b.js";import"./EmptyList-239f0622.js";const C=a=>(P("data-v-46071ffd"),a=a(),R(),a),H={class:"form-deals-contact tw-p-4"},J=["onClick"],K=C(()=>s("span",{class:"icon tw-mr-1"},[s("i",{class:"fas fa-plus-circle"})],-1)),Q={class:"tw-mt-3 tw-h-full"},W={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},X=C(()=>s("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1)),Z=[X],m=20,tt=x({__name:"FormDealsContact",props:{contactId:{}},setup(a){const u=a,I=["id","stage_id","name","states","create_datetime","amount","user"],e=p(null),r=p(0),o=p({contact_id:u.contactId,limit:m,offset:0}),{data:g,isFetching:S,execute:f}=y(F(()=>`crm.deal.list?${V.stringify(o.value)}`),{refetch:!0}).get().json();f(),A(g,t=>{t&&(t.params.offset>0?e.value=[...e.value||[],...t.data]:e.value=t.data,r.value=t.params.total_count,o.value.offset=t.params.offset)}),_(O).on(t=>{e.value&&B(t,e.value)}),_($).on(()=>{d()});function k(){o.value.offset+m>=r.value||(o.value.offset+=m)}function d(){e.value=null,o.value.offset===0?f():o.value.offset=0}const c=T();return c.fetch(),(t,et)=>(n(),v("div",H,[s("h3",null,h(t.$t("Deals")),1),N(z,{component:U,"component-props":{contactId:u.contactId,disableNavigateToDeal:!0,onAdded:d}},{default:w(({open:l})=>[s("button",{class:"button",onClick:E(l,["prevent"])},[K,b(" "+h(t.$t("newDeal")),1)],8,J)]),_:1},8,["component-props"]),s("div",Q,[i(c).funnelsMap&&e.value?(n(),D(G,{key:0,deals:e.value,"use-columns-ids":I,"navigate-route-name":"dealByContactFrame","funnels-map":i(c).funnelsMap},{lazy:w(()=>[L((n(),v("div",W,Z)),[[M,e.value.length<r.value],[i(j),([{isIntersecting:l}])=>{l&&!i(S)&&k()}]])]),_:1},8,["deals","funnels-map"])):(n(),D(q,{key:1,"row-height":"100px"}))])]))}});const Lt=Y(tt,[["__scopeId","data-v-46071ffd"]]);export{Lt as default};
