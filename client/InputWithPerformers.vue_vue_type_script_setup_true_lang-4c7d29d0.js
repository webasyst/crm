import{$ as O,a as y,t as H,D as E,bc as ne,a8 as ee,X as T,d as A,ax as le,A as S,ac as J,am as he,aR as oe,o as w,c as b,e as N,w as C,b as M,F as K,l as ie,f as V,h as Q,ay as we,g,i as _,an as ue,n as R,ah as U,p as W,k as P,R as Y,U as re,r as x,ae as ye,v as se,aL as ce,az as de,ao as te,x as _e,_ as pe,N as ge,a3 as ae,m as be,q as $e,s as Ie,aO as ke,B as Ce,ab as Fe,V as De}from"./main-e63d6b61.js";import{M as Z,D as fe,_ as me}from"./DropDown-b752b133.js";import{u as xe}from"./recentContacts-2c7dd6f4.js";import{F as Se}from"./FieldSelect-d021e2ab.js";import{v as Be}from"./index-48d220da.js";import{U as Ve}from"./UserPic-e63dca94.js";import{C as Le}from"./CustomColumn-72664405.js";const We=O("inputWithCustomers",()=>{const p=y(!0),t=y([]),n=y(null),e=xe(),{recent:h,pinned:r,error:f,isFinished:u}=H(e);e.refetch();function a(d,i,s){n.value!==d?(n.value&&e.refetch(),E(()=>u.value,()=>{o(i,s)},{immediate:!0})):(t.value.length||h.value.length||r.value.length)&&l(s),n.value=d}async function o(d,i){const s=[...r.value,...h.value].map(B=>B.id),m=c(i);m&&s.unshift(m);const F=ne(s).join(",");F&&(t.value=await Re(`id/${F}`,d),l(i)),p.value=!1}function l(d){if(!d)return;const i=t.value.findIndex(s=>s.id===c(d));if(i!==-1){const s=t.value[i];return t.value.splice(i,1),t.value.unshift(s),!0}else typeof d=="object"&&d.id&&t.value.unshift(d)}function c(d){return typeof d=="number"?d:typeof(d==null?void 0:d.id)=="number"?d.id:null}return{isFetching:p,error:f,$contacts:t,fetchData:a}});async function Re(p,t){const n=ee.stringify({hash:p,fields:t}),{data:e}=await T(`crm.contact.list?${n}`).get().json();if(e.value){const{data:h}=e.value;return h}return[]}const Me=["placeholder"],Pe=["onClick"],kt=A({__name:"InputWithRole",props:{scope:{},modelValue:{},inputClass:{default:""},placeholder:{default:""},right:{type:Boolean},width:{default:"200px"}},setup(p){const t=p,n=le(t,"modelValue"),e=y([]),h=y(),r=y(!1),f=S(()=>e.value.filter(o=>{var l;return(l=n.value)!=null&&l.trim()?o.toLocaleLowerCase().includes(n.value.toLocaleLowerCase()):!0})),u=J(f);he(async()=>{const{data:o}=await T(`crm.deal.role.list?scope=${t.scope}`).get().json();Array.isArray(o.value)&&(e.value=o.value)}),oe(h,()=>{r.value=!1});function a(o){o&&(n.value=o,r.value=!1)}return(o,l)=>(w(),b("div",{ref_key:"wrapperRef",ref:h},[N(fe,{open:r.value,"disable-click-outside":!0,right:t.right,width:t.width,disabled:!0,"max-height":"195px"},{body:C(()=>[f.value.length?(w(),M(Z,{key:0},{default:C(()=>[(w(!0),b(K,null,ie(f.value,(c,d)=>(w(),M(me,{key:d},{default:C(()=>[_("a",{class:R({"tw-bg-waBackground":g(u).index.value===d}),onClick:W(i=>a(c),["prevent"])},P(c),11,Pe)]),_:2},1024))),128))]),_:1})):V("",!0)]),default:C(()=>[Q(_("input",{"onUpdate:modelValue":l[0]||(l[0]=c=>ue(n)?n.value=c:null),type:"text",class:R(["tw-w-full",t.inputClass]),placeholder:t.placeholder,onKeyup:l[1]||(l[1]=U(c=>{a(g(u).state.value),c.target.blur()},["enter"])),onKeydown:[l[2]||(l[2]=U(W(c=>g(u).prev(),["prevent"]),["up"])),l[3]||(l[3]=U(W(c=>g(u).next(),["prevent"]),["down"]))],onFocusin:l[4]||(l[4]=c=>r.value=!0)},null,42,Me),[[we,g(n)]])]),_:1},8,["open","right","width"])],512))}}),Ue={key:0,class:"icon size-20 !tw-left-2"},Ae={key:1,class:"icon text-gray"},je=_("i",{class:"fas fa-search"},null,-1),ze=[je],Ne=_("i",{class:"fas fa-times-circle"},null,-1),Ke=[Ne],Te=["placeholder","disabled"],qe={key:2,class:"smaller text-red tw-mt-1"},Ee=["data-index","onClick"],He=["src"],Xe={class:"name"},Ge={class:"email"},Je={key:2,class:"tw-text-center tw-py-3 gray"},Qe={class:"tw-h-[5px]"},Ye={class:"tw-text-center tw-py-3"},Ze=_("i",{class:"spinner custom-p-12"},null,-1),Oe=[Ze],et=_("hr",{class:"tw-m-0"},null,-1),tt={class:"!tw-my-1"},ve=A({__name:"InputWithDropDown",props:{items:{},item:{},initItemId:{},placeholder:{},isFetching:{type:Boolean},hideClear:{type:Boolean},hideIcon:{type:Boolean},inputClass:{},width:{},right:{type:Boolean},disabled:{type:Boolean},errorMessage:{}},emits:["input","update","clear","interseption-observer","focus","close-dropdown"],setup(p,{expose:t,emit:n}){const e=p,h=y(),r=y(),f=y(!1),u=y(e.item);let a=J(e.items);Y(()=>e.items,s=>{a=J(s),Y(a.index,m=>{var F,B;(B=(F=h.value)==null?void 0:F.querySelector(`[data-index="${m}"]`))==null||B.scrollIntoView({behavior:"smooth",block:"nearest"})})}),E(()=>e.initItemId&&e.items.length,()=>{const s=e.items.find(m=>m.id===e.initItemId);s&&l(s)},{immediate:!0}),E(()=>!f.value,()=>{n("close-dropdown")}),oe(h,()=>{f.value=!1});function o(s){n("focus"),n("input",s.target.value),f.value=!0,ye(()=>{var m;(m=r.value)==null||m.focus()})}function l(s){s&&(u.value={...s},n("update",u.value),f.value=!1)}function c(){u.value={id:0,name:""},n("clear")}const d=S(()=>{var s;return f.value&&((s=u.value)==null?void 0:s.name)||e.placeholder}),i=S(()=>f.value?"default-value":"value");return t({clearValue:c}),(s,m)=>(w(),M(Le,{space:"4"},{default:C(()=>{var F,B,L,j;return[_("div",{ref_key:"wrapperRef",ref:h,class:"tw-w-full"},[!s.$slots.preview||f.value?(w(),b("div",{key:0,class:R(["state-with-inner-icon width-100",{left:!e.hideIcon}])},[e.hideIcon?V("",!0):(w(),b(K,{key:0},[(F=u.value)!=null&&F.userpic?(w(),b("div",Ue,[N(Ve,{url:(B=u.value)==null?void 0:B.userpic,size:20},null,8,["url"])])):(w(),b("div",Ae,ze))],64)),!e.disabled&&!e.hideClear&&((L=u.value)!=null&&L.name)?(w(),b("a",{key:1,class:"icon !tw-left-auto tw-right-3 text-red hover:!tw-text-red-600 tw-rounded-full tw-bg-waBlank",onClick:m[0]||(m[0]=W(I=>c(),["prevent"]))},Ke)):V("",!0),_("input",re({ref_key:"inputRef",ref:r,type:"search",class:["tw-w-full",e.inputClass,{"state-error":e.errorMessage}],[i.value||""]:((j=u.value)==null?void 0:j.name)||"",placeholder:d.value,disabled:e.disabled,onInput:m[1]||(m[1]=I=>n("input",I.target.value)),onKeyup:m[2]||(m[2]=U(I=>{l(g(a).state.value),I.target.blur()},["enter"])),onKeydown:[m[3]||(m[3]=U(W(I=>g(a).prev(),["prevent"]),["up"])),m[4]||(m[4]=U(W(I=>g(a).next(),["prevent"]),["down"]))],onFocus:o}),null,16,Te)],2)):x(s.$slots,"preview",{key:1,model:u.value,showInput:o}),e.errorMessage?(w(),b("div",qe,P(e.errorMessage),1)):V("",!0),x(s.$slots,"items",{items:e.items,onSelectItem:l,isFocus:f.value},()=>[N(fe,{"max-height":"255px",open:f.value,"disable-click-outside":!0,width:e.width||"250px",right:e.right,"disable-floating":!0},{body:C(()=>[N(Z,{class:"thin-scrollbar"},{default:C(()=>{var I;return[(I=e.items)!=null&&I.length?(w(!0),b(K,{key:0},ie(e.items,(D,z)=>(w(),M(me,{key:D.id},{default:C(()=>[_("a",{class:R(["item",{"tw-bg-waBackground":g(a).index.value===z}]),"data-index":z,onClick:W(X=>l(D),["prevent"])},[s.$slots.item?x(s.$slots,"item",{key:0,item:D}):(w(),b(K,{key:1},[_("img",{class:"userpic userpic32",src:D.userpic},null,8,He),_("div",null,[_("div",Xe,P(D.name),1),_("div",Ge,P(D.email),1)])],64))],10,Ee)]),_:2},1024))),128)):!e.isFetching&&s.$slots.empty?x(s.$slots,"empty",{key:1}):e.isFetching?V("",!0):(w(),b("div",Je,P(s.$t("notFound")),1)),Q(_("div",Qe,null,512),[[se,!s.isFetching],[g(Be),([{isIntersecting:D}])=>{D&&n("interseption-observer")}]]),Q(_("div",Ye,Oe,512),[[se,s.isFetching]])]}),_:3}),s.$slots.bottomItems?(w(),b(K,{key:0},[et,_("div",tt,[N(Z,null,{default:C(()=>[x(s.$slots,"bottomItems",{hideDropDown:()=>f.value=!1})]),_:3})])],64)):V("",!0)]),_:3},8,["open","width","right"])])],512)]}),_:3}))}});const st=A({__name:"InputWithCustomers",props:{dealId:{default:0},initContactId:{default:void 0},contact:{default:()=>({id:0,name:"",userpic:"",jobtitle:"",company:"",company_contact_id:null})},withFields:{default:()=>["email"]},excludeIds:{default:()=>[]},disabled:{type:Boolean}},emits:["update"],setup(p,{expose:t,emit:n}){var z,X;const e=p,h=y(),r=y({id:e.contact.id,name:e.contact.name,userpic:e.contact.userpic,company:e.contact.company||"",email:(X=(z=e.contact)==null?void 0:z.email)!=null&&X.length?e.contact.email[0].value:""}),f=We();f.fetchData(e.dealId,e.withFields,e.initContactId||{id:r.value.id,name:r.value.name,userpic:r.value.userpic,company:r.value.company,fields:[{id:"email",value:r.value.email?[r.value.email]:[]}]});const{$contacts:u,isFetching:a}=H(f),o=y([]),l=y(!1),c=y(""),d=y(0),i=y(0),s=y(10);L(),ce(u,()=>{L()}),t({isFetchingContacts:a,clearValue:()=>{var v;return(v=h.value)==null?void 0:v.clearValue()}});const m=de(async v=>{var $;if(d.value=0,i.value=0,!v||(($=r.value)==null?void 0:$.name)===v)L();else{let k="name.name";v.includes("@")?k="email":/^[+\-0-9() ]+$/.test(v)&&(k="phone");const q=`crmSearch/contact_info.${k}*=${_e(v)}`;c.value!==q&&(o.value=[],o.value=await j(q))}},300),F=e.excludeIds.filter(v=>v!==e.contact.id).reduce((v,$)=>({...v,[$]:!0}),{}),B=S(()=>o.value.filter(v=>!F[v.id]).map(v=>{const $=v.fields.find(k=>k.id==="email");return{id:v.id,name:v.name,userpic:v.userpic,email:$==null?void 0:$.value[0],company:v.company}}));function L(){d.value=0,i.value=0,c.value="",o.value=[...u.value]}async function j(v){l.value=!0;const $=ee.stringify({hash:v,fields:e.withFields,limit:s.value,offset:d.value}),{data:k}=await T(`crm.contact.list?${$}`).get().json();if(l.value=!1,k.value){const{data:q,params:G}=k.value;return d.value+=G.limit||0,i.value=G.total_count||0,c.value=G.hash||"",q}return[]}async function I(){d.value<i.value&&(o.value=[...o.value,...await j(c.value)])}function D(v){r.value=v;const $=o.value.find(k=>k.id===v.id);$&&(n("update",$),u.value.unshift($),o.value=u.value=ne(u.value))}return(v,$)=>(w(),M(ve,{ref_key:"inputWithDropDownRef",ref:h,items:B.value,item:r.value,"init-item-id":e.initContactId,placeholder:v.$t("name"),"is-fetching":g(a)||l.value,disabled:e.disabled,onInput:g(m),onUpdate:D,onInterseptionObserver:I,onCloseDropdown:L},{items:C(k=>[x(v.$slots,"items",te({isFetching:g(a)||l.value,interseptionObserver:I},k),void 0,!0)]),_:3},8,["items","item","init-item-id","placeholder","is-fetching","disabled","onInput"]))}});const Ct=pe(st,[["__scopeId","data-v-25fc7d43"]]),at=O("currencies",()=>{const p=y([]),{data:t,isFetching:n,error:e,execute:h,isFinished:r}=T("crm.currency.list").get().json(),f=S(()=>p.value.find(l=>l.is_primary)),u=S(()=>l=>p.value.find(c=>c.id===l)),a=S(()=>r.value&&!p.value.length);ge(()=>{Array.isArray(t.value)&&(p.value=t.value)});function o(){r.value&&h()}return{currencies:p,primaryCurrency:f,isFetching:n,error:e,isFinished:r,isEmptyCurrencies:a,getCurrencyById:u,refetch:o}}),nt={key:1,class:"skeleton tw-w-full"},lt=_("button",{class:"button light-gray !tw-w-full tw-h-full"},null,-1),ot=[lt],Ft=A({__name:"SelectWithCurrencies",props:{modelValue:{}},emits:["update:modelValue"],setup(p,{emit:t}){const e=le(p,"modelValue",t),{currencies:h,primaryCurrency:r,isFinished:f}=H(at()),u=S(()=>h.value.map(a=>({id:a.id,value:a.name})));return E(()=>{var a;return(a=r.value)==null?void 0:a.id},a=>{e.value||(e.value=a)},{immediate:!0}),(a,o)=>g(f)?(w(),M(Se,te({key:0,modelValue:g(e),"onUpdate:modelValue":o[0]||(o[0]=l=>ue(e)?e.value=l:null)},a.$attrs,{options:u.value,required:"",class:"tw-w-full"}),null,16,["modelValue","options"])):(w(),b("div",nt,ot))}}),it=p=>($e("data-v-5aafb8a6"),p=p(),Ie(),p),ut={key:0,class:"skeleton"},rt={class:"dropdown-button-content"},ct={key:0,class:"tw-mr-1"},dt=["title"],pt={key:0},ft=it(()=>_("i",{class:"fas fa-caret-down"},null,-1)),mt=[ft],vt=A({__name:"DropDownButton",props:{title:{default:""},width:{default:"13.5rem"},colorClass:{default:"light-gray"},rounded:{type:Boolean},isSkeleton:{type:Boolean},mobileWFull:{type:Boolean},disabled:{type:Boolean},small:{type:Boolean}},setup(p){const t=p;return(n,e)=>t.isSkeleton?(w(),b("div",ut,[_("button",{class:R(["button light-gray",{rounded:t.rounded,"mobile:!tw-w-full":t.mobileWFull,small:t.small}]),style:ae({width:t.width,height:"2.125rem"})},null,6)])):(w(),b("button",{key:1,class:R(["button dropdown-button",t.colorClass,{rounded:t.rounded,"mobile:!tw-w-full":t.mobileWFull,"tw-cursor-default":t.disabled,small:t.small}]),style:ae({width:t.width})},[_("div",rt,[n.$slots.icon?(w(),b("span",ct,[x(n.$slots,"icon",{},void 0,!0)])):V("",!0),_("span",{title:t.title,class:R(["tw-truncate tw-text-left",{"tw-opacity-50":t.disabled}])},[x(n.$slots,"title",{},()=>[be(P(t.title),1)],!0)],10,dt)]),t.disabled?V("",!0):(w(),b("div",pt,mt))],6))}});const Dt=pe(vt,[["__scopeId","data-v-5aafb8a6"]]),ht=O("inputWithPreformers",()=>{const p=y(!0),t=y([]),n=ke({}),e=S(()=>`crm.user.list?${ee.stringify({...n.dealId?{can_own_deal:n.dealId}:{}})}`),{error:h,data:r}=T(e,{immediate:!1,refetch:!0}).get().json();Y(r,a=>{if(Array.isArray(a)){const{id:o}=Ce.user,l=a.find(c=>c.id===o);t.value=[...l?[l]:[],...a.filter(c=>c.id!==o)]}u(n.currrentUser),p.value=!1});function f(a,o){n.dealId=a,n.currrentUser=o,t.value.length&&u(n.currrentUser)}function u(a){if(a!=null&&a.id){const o=t.value.findIndex(l=>l.id===a.id);if(o!==-1){const l=t.value[o];t.value.splice(o,1),t.value.unshift(l)}else a.id&&t.value.unshift(a)}}return{setupProps:f,isFetching:p,error:h,$contacts:t}}),xt=A({__name:"InputWithPerformers",props:{dealId:{default:0},excludeIds:{default:()=>[]},contact:{}},emits:["update"],setup(p,{emit:t}){const n=p,e=y(n.contact),h=y([]),r=ht();r.setupProps(n.dealId,{...e.value});const{isFetching:f,$contacts:u}=H(r);c(),ce(u,()=>c());const a=de(async i=>{var s;!i||((s=e.value)==null?void 0:s.name)===i?c():h.value=[...u.value].filter(m=>m.name.toLocaleLowerCase().includes(i.toLocaleLowerCase()))},300),o=n.excludeIds.filter(i=>i!==n.contact.id).reduce((i,s)=>({...i,[s]:!0}),{}),l=S(()=>h.value.filter(i=>!o[i.id]));function c(){h.value=[...u.value]}function d(i){e.value=i,t("update",{id:i.id,name:i.name,userpic:i.userpic})}return(i,s)=>(w(),M(ve,{items:l.value,item:e.value,placeholder:i.$t("name"),"is-fetching":g(f),onInput:g(a),onUpdate:d,onCloseDropdown:c},Fe({items:C(m=>[x(i.$slots,"items",te({isFetching:g(f),interseptionObserver:()=>null},m))]),_:2},[i.$slots.preview?{name:"preview",fn:C(m=>[x(i.$slots,"preview",re(De(m)))]),key:"0"}:void 0]),1032,["items","item","placeholder","is-fetching","onInput"]))}});export{Dt as D,Ct as I,kt as _,xt as a,Ft as b,at as u};
