import{d as w,t as D,z as R,o as l,b as m,w as u,e as b,m as B,k,i as s,p as y,f as S,c as $,l as N,g as p,F as I,n as L,B as Y,a2 as ae,ak as le,P as A,h as M,v as U,q as G,s as X,_ as J,a as E,A as Z,H as O,S as ne,I as W,r as ee,al as oe,Y as ie,j as re,am as ue,G as ce,an as de}from"./main-ad3d4b2a.js";import{u as _e,c as P,d as se,T as pe,e as fe,L as q,Q as me}from"./tags-66e0142b.js";import{U as F}from"./UserPic-e76d468d.js";import{M as z,_ as V}from"./MenuList-d27c7173.js";import{D as T}from"./InputWithPerformers.vue_vue_type_script_setup_true_lang-c5140a20.js";import{D as H}from"./DropDown-6640089d.js";import{C as ve,a as he}from"./ChipsList-007889bd.js";import{u as te}from"./funnels-5e77cb0b.js";import{Q as be}from"./index-38eb481c.js";import{D as ke}from"./DropdownModal-ddc95c01.js";import{W as $e}from"./WaSpinner-8364792b.js";import{W as ge}from"./WaDialog-48ef549a.js";import{_ as ye}from"./FormAddTag.vue_vue_type_script_setup_true_lang-f31d1ef2.js";import{F as we}from"./FieldCheckbox-ea76a60e.js";import{e as Ce}from"./emit-32ce2ce5.js";import{_ as Se}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-55644d30.js";import De from"./FormDealAdd-07de8d3e.js";import{_ as Fe}from"./DealNavigateBack.vue_vue_type_script_setup_true_lang-5146d9b0.js";import"./helpers-c0c14d27.js";import"./recentContacts-6dcec390.js";import"./FieldSelect-fbb8732d.js";import"./index-f0757591.js";import"./CustomColumn-d0d2dfb9.js";import"./DropdownAddTags.vue_vue_type_script_setup_true_lang-3dd59e88.js";import"./FieldString-77b19497.js";import"./fields-00e92370.js";import"./dialog-55612c15.js";import"./dayjs-e01b34a2.js";import"./ButtonSubmit-66512fc6.js";const Ie=["onClick"],Ve={class:"tw-p-2"},Re=["onClick"],Be=s("i",{class:"fas fa-hashtag"},null,-1),Te={class:"tw-flex-auto tw-truncate"},Ne={class:"count tw-mt-0.5"},Le=w({__name:"DropdownTags",setup(v){const c=_e(),{tags:t}=D(c),d=P(),{filterParams:n,firstDeal:f}=D(d),h=R(()=>{var g,_;if(typeof n.value.tag=="number"){const i=t.value.find(e=>e.id===n.value.tag);return!i&&((_=(g=f.value)==null?void 0:g.tags)!=null&&_.length)?f.value.tags.find(e=>e.id===n.value.tag):i}});return(g,_)=>(l(),m(H,{width:"270px"},{default:u(()=>[b(T,{small:!0,width:"9rem"},{icon:u(()=>[b(F,{size:14,"fa-icon":"hashtag"})]),title:u(()=>[B(k(h.value?h.value.name:g.$t("Tags")),1)]),_:1})]),body:u(({hide:i})=>[h.value?(l(),m(z,{key:0},{default:u(()=>[b(V,null,{default:u(()=>[s("a",{onClick:y(e=>{p(d).deleteFilterParam("tag"),i()},["prevent"])},[s("span",null,k(g.$t("showAll")),1)],8,Ie)]),_:2},1024)]),_:2},1024)):S("",!0),s("div",Ve,[b(ve,null,{default:u(()=>[(l(!0),$(I,null,N(p(t),e=>{var a;return l(),m(he,{key:e.id,class:L(["small",{selected:((a=h.value)==null?void 0:a.id)===e.id}])},{default:u(()=>[s("a",{onClick:y(o=>{p(d).updateFilterParams({tag:e.id}),i()},["prevent"])},[Be,s("span",Te,k(e.name),1),s("span",Ne,k(e.count),1)],8,Re)]),_:2},1032,["class"])}),128))]),_:2},1024)])]),_:1}))}}),Pe=["onClick"],xe=["onClick"],Ae={class:"icon small"},Ee={class:"count"},ze=s("hr",{class:"tw-m-0"},null,-1),He=["onClick"],Me={class:"icon small"},Ue=w({__name:"DropdownStages",setup(v){const{t:c}=Y(),{selectedFunnel:t}=D(te()),d=P(),{filterParams:n,firstDeal:f}=D(d),h=R(()=>{var e;return t.value&&((e=t.value.stages)!=null&&e.length)?t.value.stages:[]}),g=R(()=>h.value.length),_=R(()=>{var e,a;return[{id:"won",name:c("wons"),color:((e=t.value)==null?void 0:e.color)||"",icon:"flag-checkered"},{id:"lost",name:c("losts"),color:((a=t.value)==null?void 0:a.color)||"",icon:"ban"}]}),i=R(()=>{var e,a,o;switch(typeof((e=n.value)==null?void 0:e.stage)){case"number":if(g.value)return h.value.find(r=>r.id===n.value.stage);if((a=f.value)!=null&&a.stage)return{...(o=f.value)==null?void 0:o.stage,icon:null};break;case"string":return _.value.find(r=>r.id===n.value.stage)}});return(e,a)=>(l(),m(H,{disabled:!g.value},ae({default:u(()=>[b(T,{small:!0,disabled:!g.value},{icon:u(()=>[i.value?(l(),$(I,{key:0},[i.value.icon?(l(),m(F,{key:i.value.color,size:10,"fa-icon":i.value.icon,"icon-color":i.value.color},null,8,["fa-icon","icon-color"])):(l(),m(F,{key:i.value.id,size:10,"disable-rounded":"","bg-color":i.value.color},null,8,["bg-color"]))],64)):S("",!0)]),title:u(()=>[B(k(i.value?i.value.name:e.$t("allStages")),1)]),_:1},8,["disabled"])]),_:2},[g.value?{name:"body",fn:u(({hide:o})=>[b(z,null,{default:u(()=>[(l(),m(V,{key:"all"},{default:u(()=>[s("a",{onClick:y(r=>{p(d).deleteFilterParam("stage"),o()},["prevent"])},[s("span",null,k(e.$t("allStages")),1)],8,Pe)]),_:2},1024)),(l(!0),$(I,null,N(h.value,r=>(l(),m(V,{key:r.id},{default:u(()=>[s("a",{onClick:y(C=>{p(d).updateFilterParams({stage:r.id}),o()},["prevent"])},[s("div",Ae,[b(F,{size:10,"disable-rounded":"","bg-color":r.color},null,8,["bg-color"])]),s("span",null,k(r.name),1),s("span",Ee,k(r.deal_count),1)],8,xe)]),_:2},1024))),128)),ze,(l(!0),$(I,null,N(_.value,r=>(l(),m(V,{key:r.id},{default:u(()=>[s("a",{onClick:y(C=>{p(d).updateFilterParams({stage:r.id}),o()},["prevent"])},[s("div",Me,[(l(),m(F,{key:r.color,size:10,"fa-icon":r.icon,"icon-color":r.color},null,8,["fa-icon","icon-color"]))]),s("span",null,k(r.name),1)],8,He)]),_:2},1024))),128))]),_:2},1024)]),key:"0"}:void 0]),1032,["disabled"]))}}),Oe=s("i",{class:"fas fa-user-slash"},null,-1),Qe=s("i",{class:"fas fa-users"},null,-1),je=["onClick"],We=s("div",{class:"icon"},[s("i",{class:"fas fa-users"})],-1),qe=["onClick"],Ke=s("div",{class:"icon"},[s("i",{class:"fas fa-user-slash"})],-1),Ye=["onClick"],Ge={class:"icon"},Xe={class:"count"},Je=w({__name:"DropdownResponsibles",setup(v){const c=le(),{responsibles:t}=D(c),d=P(),{filterParams:n}=D(d),f=R(()=>{if(typeof n.value.user_id=="number")return c.getResponsibleById(n.value.user_id)}),h=R(()=>{var _;return((_=n.value)==null?void 0:_.user_id)===0});function g(_){_==="all"?d.deleteFilterParam("user_id"):d.updateFilterParams({user_id:_})}return(_,i)=>(l(),m(H,null,{default:u(()=>[f.value?(l(),m(T,{key:0,small:!0},{icon:u(()=>[b(F,{size:16,url:f.value.responsible.userpic},null,8,["url"])]),title:u(()=>[B(k(f.value.responsible.name),1)]),_:1})):h.value?(l(),m(T,{key:1,small:!0},{icon:u(()=>[Oe]),title:u(()=>[B(k(_.$t("noResponsible")),1)]),_:1})):(l(),m(T,{key:2,small:!0},{icon:u(()=>[Qe]),title:u(()=>[B(k(_.$t("allResponsibles")),1)]),_:1}))]),body:u(({hide:e})=>[b(z,null,{default:u(()=>[(l(),m(V,{key:"all"},{default:u(()=>[s("a",{onClick:y(a=>{g("all"),e()},["prevent"])},[We,s("span",null,k(_.$t("allResponsibles")),1)],8,je)]),_:2},1024)),(l(),m(V,{key:0},{default:u(()=>[s("a",{onClick:y(a=>{g(0),e()},["prevent"])},[Ke,s("span",null,k(_.$t("noResponsible")),1)],8,qe)]),_:2},1024)),(l(!0),$(I,null,N(p(t),a=>(l(),m(V,{key:a.responsible.id},{default:u(()=>[s("a",{onClick:y(o=>{g(a.responsible.id),e()},["prevent"])},[s("div",Ge,[b(F,{size:10,url:a.responsible.userpic},null,8,["url"])]),s("span",null,k(a.responsible.name),1),s("span",Xe,k(a.count),1)],8,Ye)]),_:2},1024))),128))]),_:2},1024)]),_:1}))}}),Ze=["onClick"],es=["onClick"],ss={class:"icon"},ts={class:"count"},as=w({__name:"DropdownFunnels",props:{hideOptionAll:{type:Boolean}},setup(v){const c=v,t=te();t.withCount();const{funnels:d,selectedFunnel:n,isFinished:f}=D(t),h=P(),{filterParams:g,firstDeal:_}=D(h);A(()=>[_.value,g.value.funnel,f.value],([,e,a])=>{var o;a&&(typeof e=="number"?(n.value=t.getFunnelById(e),!n.value&&((o=_.value)!=null&&o.funnel)&&(n.value={..._.value.funnel,stages:[_.value.stage]})):n.value=void 0)},{immediate:!0});function i(e,a){var o;e==="all"?h.updateFilterParams({funnel:void 0,stage:void 0}):h.updateFilterParams({funnel:e,...((o=g.value)==null?void 0:o.funnel)!==e?{stage:void 0}:{}}),typeof a=="function"&&a()}return(e,a)=>(l(),m(H,null,{default:u(()=>[b(T,{small:!0},{icon:u(()=>[p(n)?(l(),m(F,{key:p(n).id,size:12,"fa-icon":"filter","icon-color":p(n).color},null,8,["icon-color"])):S("",!0)]),title:u(()=>[B(k(p(n)?p(n).name:e.$t("allFunnels")),1)]),_:1})]),body:u(({hide:o})=>[b(z,null,{default:u(()=>[c.hideOptionAll?S("",!0):(l(),m(V,{key:"all"},{default:u(()=>[s("a",{onClick:y(r=>i("all",o),["prevent"])},[s("span",null,k(e.$t("allFunnels")),1)],8,Ze)]),_:2},1024)),(l(!0),$(I,null,N(p(d),r=>(l(),m(V,{key:r.id},{default:u(()=>[s("a",{onClick:y(C=>i(r.id,o),["prevent"])},[s("div",ss,[b(F,{size:10,"fa-icon":"filter","icon-color":r.color},null,8,["icon-color"])]),s("span",null,k(r.name),1),s("span",ts,k(r.deal_count),1)],8,es)]),_:2},1024))),128))]),_:2},1024)]),_:1}))}}),ls=v=>(G("data-v-8a90c6f1"),v=v(),X(),v),ns={class:"deals-header__filters-wrapper"},os={class:"deals-header__filters"},is=ls(()=>s("i",{class:"fas fa-times-circle text-gray"},null,-1)),rs=[is],us={key:0,class:"skeleton deals-header__filters"},cs=w({__name:"DealsHeaderFilters",props:{hideStages:{type:Boolean},hasFilters:{type:Boolean},showSkeleton:{type:Boolean},isKanban:{type:Boolean}},emits:["clear"],setup(v,{emit:c}){const t=v;return(d,n)=>(l(),$("div",ns,[M(s("div",os,[b(as,{"hide-option-all":t.isKanban},null,8,["hide-option-all"]),t.hideStages?S("",!0):(l(),m(Ue,{key:0})),b(Je),b(Le),t.hasFilters?(l(),$("button",{key:1,class:"deals-header__filters-clear button small nobutton light-gray",onClick:n[0]||(n[0]=f=>c("clear"))},rs)):S("",!0)],512),[[U,!t.showSkeleton]]),t.showSkeleton?(l(),$("div",us,[(l(!0),$(I,null,N(t.hideStages?3:4,f=>(l(),$("span",{key:f,class:"skeleton-line deals-header__filters-skeleton"}))),128))])):S("",!0)]))}});const ds=J(cs,[["__scopeId","data-v-8a90c6f1"]]),_s=["disabled","onClick"],ps={class:"tw-flex tw-items-center tw-gap-2"},fs={class:"icon"},ms=w({__name:"ActionButtonList",props:{items:{},space:{}},setup(v){const c=v;return(t,d)=>(l(),$("div",{class:L(`tw-flex tw-gap-${c.space||0}`)},[(l(!0),$(I,null,N(c.items,(n,f)=>(l(),$(I,{key:f},[n.hide?S("",!0):(l(),$("button",{key:0,disabled:n.disableClick,class:"light-gray",onClick:h=>!n.disableClick&&n.clickHandler()},[s("div",ps,[s("span",fs,[s("i",{class:L(["fas",n.classIcon])},null,2)]),s("span",null,k(n.label),1)])],8,_s))],64))),128))],2))}}),vs=["src"],hs=w({__name:"FormDealExportCSV",props:{ids:{}},setup(v){const c=v,t=E(!0),d={height:"400px",width:"100%"};return(n,f)=>(l(),m(ge,{"hide-buttons":!0},{default:u(()=>[t.value?(l(),m($e,{key:0,style:d})):S("",!0),M(s("iframe",{src:`${p(Z).baseUrl}?module=deal&action=export&ids=${c.ids.join(",")}`,style:d,frameborder:"0",onLoad:f[0]||(f[0]=h=>t.value=!1)},null,40,vs),[[U,!t.value]])]),_:1}))}}),bs={class:"deals-header__edit small"},ks={class:"deals-header__edit-selected-deals"},$s={class:"tw-hidden xl:tw-inline-block tw-mr-2"},gs={class:"badge user tw-bg-waAccent tw-min-w-[0.5rem] tw-justify-center"},ys={class:"deals-header__edit-buttons"},ws=s("span",{class:"icon"},[s("i",{class:"fas fa-times-circle"})],-1),Cs={class:"tw-hidden xl:tw-inline-block tw-ml-2"},Ss=w({__name:"DealsHeaderBulkEdit",setup(v){const c=O(),{t}=Y(),d=P(),{countChecked:n,isAllChecked:f,bulkSelectIds:h}=D(d),g=ne(be),_=E(f.value?"1":""),i=E([{label:t("export"),classIcon:"fas fa-download",clickHandler:()=>{W(hs,{ids:h.value}).show()}},{label:t("merge"),classIcon:"fas fa-users",hide:!0,clickHandler:()=>c.push({name:"dealMerge",query:{ids:h.value.join(",")}})},{label:t("changeResponsible"),classIcon:"fas fa-user-check",hide:!0,clickHandler:()=>({})},{label:t("changeFunnelOrStage"),classIcon:"fas fa-exchange-alt",hide:!0,clickHandler:()=>({})},{label:t("Tags"),classIcon:"fas fa-hashtag",clickHandler:()=>W(ye,{entityType:"deal",entityIds:h.value}).show()},{label:t("close"),classIcon:"fas fa-flag-checkered",hide:!0,clickHandler:()=>({})}]);A(n,a=>{i.value[1].hide=a<2},{immediate:!0}),A(f,a=>{a?_.value="1":_.value="",(n.value===0||a)&&e(a)});function e(a){d.toggleChecked(a)}return(a,o)=>(l(),$("div",bs,[s("div",ks,[b(we,{modelValue:_.value,"onUpdate:modelValue":o[0]||(o[0]=r=>_.value=r),size:16,onChange:o[1]||(o[1]=r=>e(!!r))},{default:u(()=>[s("span",$s,k(a.$t("selected")),1),s("span",gs,k(p(n)),1)]),_:1},8,["modelValue"])]),s("div",ys,[p(g)?(l(),m(ke,{key:0,items:i.value},{default:u(()=>[b(T,{width:"8rem"},{title:u(()=>[B(k(a.$t("actions")),1)]),_:1})]),_:1},8,["items"])):(l(),m(ms,{key:1,class:"deals-header__edit-actions",items:i.value,space:"2"},null,8,["items"])),s("button",{type:"button",class:"button outlined gray small",onClick:o[2]||(o[2]=y(r=>e(!1),["prevent"]))},[ws,s("span",Cs,k(a.$t("cancel")),1)])])]))}});const Q=v=>(G("data-v-c3b60b56"),v=v(),X(),v),Ds={class:"filters-button"},Fs={key:0,class:"tw-p-2"},Is=Q(()=>s("i",{class:"fas fa-spinner wa-animation-spin"},null,-1)),Vs=[Is],Rs=Q(()=>s("i",{class:"fas fa-filter"},null,-1)),Bs=[Rs],Ts={key:2,class:"icon size-8 rounded filters-button__has"},Ns=Q(()=>s("i",{class:"fas fa-circle text-red circle"},null,-1)),Ls=[Ns],Ps=w({__name:"DealsFiltersControlButton",props:{modelValue:{type:Boolean},hasFilters:{type:Boolean},loading:{type:Boolean}},emits:["update:modelValue"],setup(v,{emit:c}){const t=v;return(d,n)=>(l(),$("span",Ds,[t.loading?(l(),$("div",Fs,Vs)):(l(),$("button",{key:1,class:L(["button circle blank !tw-shadow-none",{"filters-button--active":t.modelValue}]),onClick:n[0]||(n[0]=y(f=>c("update:modelValue",!t.modelValue),["prevent"]))},Bs,2)),!t.loading&&t.hasFilters?(l(),$("span",Ts,Ls)):S("",!0)]))}});const xs=J(Ps,[["__scopeId","data-v-c3b60b56"]]),K=w({__name:"ToggleListItem",props:{modelValue:{},value:{}},emits:["update:modelValue"],setup(v,{emit:c}){return(t,d)=>(l(),$("span",{class:L({selected:t.modelValue===t.value}),onClick:d[0]||(d[0]=n=>c("update:modelValue",t.value))},[ee(t.$slots,"default")],2))}}),As=w({__name:"ToggleList",props:{size:{},rounded:{type:Boolean}},setup(v){const c=v;return(t,d)=>(l(),$("div",{class:L(["toggle",c.size,c.rounded?"rounded":""])},[ee(t.$slots,"default")],2))}}),Es={class:"deals-header"},zs={class:"deals-header__inner"},Hs={key:0,class:"deals-header__heading--native"},Ms={key:1,class:"deals-header__heading--web tw-flex tw-space-x-4 tw-items-center"},Us={class:"tw-mb-2"},Os=["title","onClick","onVnodeMounted"],Qs=s("i",{class:"fas fa-plus"},null,-1),js=[Qs],Ws=s("i",{class:"fas fa-columns"},null,-1),qs=s("i",{class:"fas fa-list-ul"},null,-1),Ks=w({__name:"DealsHeader",setup(v){const c=P(),{hasFilters:t,countChecked:d}=D(c),{currentView:n,isKanban:f}=D(se()),h=O(),g=E(!1),_=h.currentRoute.value.path==="/deal/new/";function i(e){n.value!==e&&(n.value=e,h.push({name:pe[e],query:h.currentRoute.value.query}).then(()=>c.changeTabView()))}return(e,a)=>(l(),$("div",Es,[p(d)?(l(),m(Ss,{key:0})):S("",!0),M(s("div",zs,[p(Z).webView?(l(),$("div",Hs,[b(Fe)])):(l(),$("div",Ms,[s("div",Us,[s("h1",null,k(e.$t("Deals")),1)]),b(Se,{component:De,"component-props":{funnelId:p(c).filterParams.funnel,..._&&e.$route.query.contact?{contactId:e.$route.query.contact}:{},onAdded:p(Ce)}},{default:u(({open:o})=>[s("button",{title:e.$t("newDeal"),class:"circle",onClick:y(o,["prevent"]),onVnodeMounted:r=>_&&o()},js,8,Os)]),_:1},8,["component-props"]),p(n)?(l(),m(As,{key:0,rounded:""},{default:u(()=>[b(K,{"model-value":p(n),value:"kanban","onUpdate:modelValue":a[0]||(a[0]=o=>i(o))},{default:u(()=>[Ws]),_:1},8,["model-value"]),b(K,{"model-value":p(n),value:"list","onUpdate:modelValue":a[1]||(a[1]=o=>i(o))},{default:u(()=>[qs]),_:1},8,["model-value"])]),_:1})):S("",!0)])),b(xs,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=o=>g.value=o),class:"deals-header__filters-button tw-hidden","has-filters":p(t),loading:!p(c).filtersIsLoaded},null,8,["modelValue","has-filters","loading"]),s("div",{class:L(["deals-header__filters-container",{"deals-header__filters-container--hide":!g.value}])},[b(ds,{"has-filters":p(t),"hide-stages":p(f),"show-skeleton":!p(c).filtersIsLoaded,"is-kanban":p(f),onClear:p(c).clearFilters},null,8,["has-filters","hide-stages","show-skeleton","is-kanban","onClear"])],2)],512),[[U,!p(d)]])]))}});const Ys={class:"deals blank box contentbox"},St=w({__name:"DealsView",props:{routeName:{},routeQuery:{}},setup(v){const c=v,t=O(),d=se(),n=P(),f=fe();if(t.currentRoute.value.path!=="/deal/new/"&&(h(c.routeName,c.routeQuery),c.routeName!=="deals")){const i=_(c.routeQuery).filters();n.updateOrClearFilterParams(i);const e=_(c.routeQuery).sortList();f.updateSort(e)}A([()=>n.filterParams,()=>f.sort],([i,e])=>{g({...i,...e.sort===q.sort&&e.asc===q.asc?{}:e})},{immediate:!0,deep:!0}),oe((i,e)=>{i.name==="deals"&&e.meta.menuItemType==="deals"?setTimeout(()=>h(e.name,e.query,!0)):i.name!==e.name&&(d.changeRouteTab(i.name),n.$resetDeals())}),ie(de).on(n.reinitView);function h(i,e,a){const o=a?t.replace:t.push,r=d.changeRouteTab(i);o({name:r,query:e})}function g(i){const e={};for(const[a,o]of Object.entries(i))me.includes(a)&&o!==null&&(e[a]=o);t.replace({name:t.currentRoute.value.name&&t.currentRoute.value.name!=="deals"?t.currentRoute.value.name:d.lastRouteNameTab,query:e})}function _(i){const e=(r,C)=>{if(r=String(r),C!=null&&C.includes(r))return r;const x=Number(r);return isNaN(x)?null:x},a=r=>typeof r=="string"?r:null,o={};return{filters(){if(!Object.keys(i).length)return o;const r=a(i.funnel);r&&(o.funnel=e(r));const C=a(i.stage);C&&(o.stage=e(C,["won","lost"]));const x=a(i.tag);x&&(o.tag=e(x));const j=a(i.user_id);return j&&(o.user_id=e(j)),o},sortList(){if(!Object.keys(i).length)return o;const r=a(i.sort);r&&(o.sort=r);const C=a(i.asc);return C&&(o.asc=e(C)?1:0),o}}}return(i,e)=>{const a=re("router-view");return l(),$("div",Ys,[b(Ks),b(a,null,{default:u(({Component:o})=>[b(ue,{name:"fade",mode:"out-in"},{default:u(()=>[(l(),m(ce(o)))]),_:2},1024)]),_:1})])}}});export{St as default};
