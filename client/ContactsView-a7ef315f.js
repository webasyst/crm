import{_ as ae}from"./ViewWithSidebar.vue_vue_type_style_index_0_lang-d2df5d92.js";import{_ as M,o as e,c as a,r as K,d as I,u as ie,a as A,b as g,w as m,e as p,f as $,n as R,g as c,h as Q,v as re,i as t,t as x,j as O,k as y,F as v,l as V,m as F,p as z,q as U,s as j,x as ce,y as le,z as W,A as P,B as H,C as X,D as de,E as ue,G as _e,H as me,I as pe,J as he,K as fe}from"./main-07d84941.js";import{u as ge}from"./recentContacts-f5cbf16b.js";import{U as T}from"./UserPic-6b99ec27.js";import{M as Y,_ as Z}from"./MenuList-1948b71a.js";import{C as q}from"./CustomColumn-36c752a1.js";import{u as ye,_ as ve}from"./FormSegmentUpdate.vue_vue_type_script_setup_true_lang-7002b171.js";import{_ as $e}from"./InputWithContacts.vue_vue_type_script_setup_true_lang-4ab9d7cb.js";import{_ as ee}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-6d140fe9.js";import{_ as Se,u as ke}from"./FormContactUpdate.vue_vue_type_script_setup_true_lang-8cd860b7.js";import{u as be}from"./useSortable-85e98846.js";import{v as we}from"./vTooltip-05cbcfb0.js";import{h as Ce}from"./longTouch-2a1e2d51.js";import{a as xe}from"./alert-cd6f2520.js";import{_ as Ie}from"./TagsCloud.vue_vue_type_script_setup_true_lang-11da5cd8.js";import"./FieldString-83da0a5f.js";import"./FieldCheckbox-eb6fe774.js";import"./validation-46e41ea1.js";import"./InputWithDropDown.vue_vue_type_script_setup_true_lang-71ea280f.js";import"./DropDown-d3d1a4c6.js";import"./index-c6ad4004.js";import"./fields-198fafc2.js";import"./FieldSelect-efa962b1.js";import"./InputWithUsers.vue_vue_type_script_setup_true_lang-d1c57d10.js";import"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-990cc429.js";import"./SortableList.vue_vue_type_script_setup_true_lang-e995921a.js";import"./ChipsList-c29e2863.js";import"./emit-60490a02.js";const Le={},Re={class:"heading"};function Ne(l,s){return e(),a("div",Re,[K(l.$slots,"default",{},void 0,!0)])}const Be=M(Le,[["render",Ne],["__scopeId","data-v-e4f563ea"]]),Ve={key:0,class:"caret tw-w-3 tw-flex-none"},He=t("i",{class:"fas fa-caret-right"},null,-1),Te=[He],te=I({__name:"AccordionSidebar",props:{showCaret:{type:Boolean},openOnInitial:{type:Boolean},disabled:{type:Boolean},storageKey:{}},setup(l){const s=l,d=s.storageKey?ie(`sidebar-accordions-${s.storageKey}`,s.openOnInitial):A(s.openOnInitial);return(_,n)=>(e(),g(q,{space:"2"},{default:m(()=>[p(Be,{class:R({open:c(d)}),onClick:n[0]||(n[0]=()=>{s.disabled||(d.value=!c(d))})},{default:m(()=>[s.showCaret?(e(),a("span",Ve,Te)):$("",!0),K(_.$slots,"header")]),_:3},8,["class"]),Q(t("div",null,[K(_.$slots,"default")],512),[[re,c(d)]])]),_:3}))}});const G=l=>(U("data-v-9a18827c"),l=l(),j(),l),Ae={class:"tw-px-4"},Fe={key:0,class:"skeleton"},ze={key:0,class:"tw-pl-4 small gray"},Me=["title"],Oe=["onClick"],De={key:0},Ee=G(()=>t("i",{class:"fas fa-spinner text-yellow tw-animate-spin"},null,-1)),Ke=[Ee],Pe={key:1},Ue=G(()=>t("i",{class:"fas fa-star text-yellow"},null,-1)),je=[Ue],qe={key:2},Ge=G(()=>t("i",{class:"far fa-star text-light-gray"},null,-1)),Je=[Ge],Qe=I({__name:"ContactsSidebarRecent",setup(l){const s=ge(),{pinned:d,recent:_,isFetching:n,error:i,fetchingIds:h,pin:S}=x(s);return s.refetch(),(o,b)=>{const w=O("RouterLink");return e(),g(te,{"show-caret":!0,"open-on-initial":!0,"storage-key":"recent"},{header:m(()=>[t("span",null,y(o.$t("recentContacts")),1)]),default:m(()=>[t("div",Ae,[c(n)?(e(),a("div",Fe,[(e(),a(v,null,V(8,r=>t("div",{ref_for:!0,ref:"lineRef",key:r,class:"skeleton-line"})),64))])):c(i)?(e(),a(v,{key:1},[F(y(c(i)),1)],64)):(e(),a(v,{key:2},[![...c(d),...c(_)].length&&!c(n)?(e(),a("div",ze,y(o.$t("emptyList")),1)):$("",!0),p(Y,null,{default:m(()=>[(e(!0),a(v,null,V([c(d),c(_)],(r,k)=>(e(),a(v,{key:k},[(e(!0),a(v,null,V(r,f=>(e(),g(Z,{key:f.id,class:"rounded selected"},{default:m(()=>[p(w,{to:{name:"contact",params:{id:f.id}},class:R(o.$constant.parentAppDisableRouterClass)},{default:m(()=>[p(T,{url:f.userpic,size:20},null,8,["url"]),t("div",{class:"tw-flex-auto tw-truncate",title:f.name},y(f.name),9,Me),t("span",{class:"count",onClick:z(L=>c(S)(f.id,!!k),["stop","prevent"])},[c(h).has(f.id)?(e(),a("span",De,Ke)):$("",!0),!c(h).has(f.id)&&k===0?(e(),a("span",Pe,je)):$("",!0),!c(h).has(f.id)&&k===1?(e(),a("span",qe,Je)):$("",!0)],8,Oe)]),_:2},1032,["to","class"])]),_:2},1024))),128))],64))),128))]),_:1})],64))])]),_:1})}}});const We=M(Qe,[["__scopeId","data-v-9a18827c"]]),Xe={class:"tw-px-4"},Ye={class:"tw-flex tw-space-x-2 tw-items-center tw-w-full"},Ze={class:"tw-flex-auto"},et=t("i",{class:"fas fa-filter gray"},null,-1),tt=[et],st={class:"tw-flex-none"},nt=["onClick","onVnodeMounted"],ot=t("i",{class:"fas fa-user-plus"},null,-1),at=[ot],it={class:"tw-flex-none md:tw-hidden"},rt=t("i",{class:"fas fa-sliders-h black"},null,-1),ct=[rt],lt=I({__name:"ContactsSidebarFilter",setup(l){const{showSidebar:s}=x(ye());function d(_,n){if(!n)return;n=ce(n);const i=n.includes("@")?"email":/^[+\-0-9() ]+$/.test(n)?"phone":"name.name";_.push({name:"search",params:{id:`contact_info.${i}*=${n}`}})}return(_,n)=>(e(),a("div",Xe,[t("div",Ye,[t("div",Ze,[p($e,{"on-enter":i=>d(_.$router,i),"on-item-select":i=>{_.$router.push({name:"contact",params:{id:i.id}})}},null,8,["on-enter","on-item-select"])]),t("div",{class:"tw-flex-none icon tw-cursor-pointer",onClick:n[0]||(n[0]=i=>_.$router.push({name:"detailedSearch"}))},tt),t("div",st,[p(ee,{component:Se},{default:m(({open:i})=>[t("button",{class:"circle",onClick:z(i,["prevent"]),onVnodeMounted:h=>_.$route.path==="/contact/new/"&&i()},at,8,nt)]),_:1})]),t("div",it,[t("button",{class:"circle transparent",onClick:n[1]||(n[1]=z(i=>s.value=!c(s),["prevent"]))},ct)])])]))}}),dt=l=>(U("data-v-12cf976d"),l=l(),j(),l),ut={class:"bricks"},_t=["onClick"],mt={class:"icon"},pt=["src","alt"],ht={class:"count"},ft=["onClick"],gt=dt(()=>t("span",{class:"icon"},[t("i",{class:"fas fa-users"})],-1)),yt={class:"count"},vt=I({__name:"ContactsSidebarBricks",setup(l){const{allContactsTotal:s}=x(le()),{responsibles:d}=x(W()),_=P(()=>{var n;return((n=d.value.find(i=>i.responsible.id===H.user.id))==null?void 0:n.count)??0});return(n,i)=>{const h=O("RouterLink");return e(),a("div",ut,[p(h,{to:{name:"myContacts"},custom:""},{default:m(({isExactActive:S,navigate:o})=>[t("div",{class:R(["brick",{selected:S}]),onClick:o},[t("span",mt,[t("img",{src:c(H).user.userpic,alt:c(H).user.name,class:"userpic"},null,8,pt)]),t("span",ht,y(_.value),1),F(" "+y(n.$t("myContacts")),1)],10,_t)]),_:1}),p(h,{to:{name:"contacts"},custom:""},{default:m(({isExactActive:S,navigate:o})=>[t("div",{class:R(["brick",{selected:S}]),onClick:o},[gt,t("span",yt,y(c(s)),1),F(" "+y(n.$t("allContacts")),1)],10,ft)]),_:1})])}}});const $t=M(vt,[["__scopeId","data-v-12cf976d"]]),se=l=>(U("data-v-a3053bb5"),l=l(),j(),l),St=["href","onClick"],kt={key:0,class:"icon size-20"},bt=se(()=>t("i",{class:"fas fa-spinner wa-animation-spin"},null,-1)),wt=[bt],Ct={class:"count"},xt={key:0,class:"icon handle tw-hidden group-hover/segment:tw-block"},It=se(()=>t("i",{class:"fas fa-grip-vertical"},null,-1)),Lt=[It],Rt={class:"tw-truncate"},Nt={class:"tw-inline-block tw-max-w-full tw-truncate"},Bt=I({__name:"ContactsSidebarSegmentList",props:{isSortList:{type:Boolean},id:{},routeName:{},items:{},hasHover:{type:Boolean}},setup(l){const s=l,d={mySegment:"my",sharedSegment:"shared"},{updateOrderInSegment:_}=X(),n=A(),i=A(null);let h;s.isSortList&&de(()=>{var o;return n.value&&((o=s.items)==null?void 0:o.length)},()=>{h=be(n.value,s.items,{handle:".handle",animation:150,delayOnTouchOnly:!0,delay:150,forceFallback:!0,fallbackOnBody:!1,onUpdate:async o=>{const{itemId:b}=o.item.dataset,{newIndex:w,oldIndex:r}=o,k=()=>{typeof w=="number"&&typeof r=="number"&&_e(o.from,o.item,w<r?r+1:r)},f=Array.from(o.from.children).map(B=>{const{itemId:D}=B.dataset;return S(D)}),L=s.id;i.value=S(b),h.option("disabled",!0);const{error:N}=await _(d[L],f);N.value&&(k(),xe(N.value)),setTimeout(()=>{h.option("disabled",!1),i.value=null},100)}})}),ue(()=>{h&&h.stop()});function S(o){if(!o||isNaN(Number(o)))throw new Error(`parse data-item-id="${o}"`);return Number(o)}return(o,b)=>{const w=O("RouterLink");return e(),g(Y,{ref_key:"ulRef",ref:n,"data-list-id":s.id},{default:m(()=>[(e(!0),a(v,null,V(s.items,r=>(e(),g(w,{key:r.id,to:{name:s.routeName,params:{id:r.id}},custom:""},{default:m(({isActive:k,href:f,navigate:L})=>[p(Z,{selected:k,"data-item-id":r.id,class:R(["tw-group/segment",{handle:!o.hasHover}])},{default:m(()=>[t("a",{href:f,class:R([o.$constant.parentAppDisableRouterClass,"segment-link"]),onClick:L,onContextmenu:b[0]||(b[0]=N=>c(Ce)()&&N.preventDefault())},[i.value===r.id?(e(),a("span",kt,wt)):(e(),a(v,{key:1},["responsible"in r?(e(),g(T,{key:0,size:20,url:r.responsible.userpic},null,8,["url"])):"icon"in r?(e(),g(T,{key:1,size:20,url:r.icon_path,"fa-icon":r.icon,"disable-rounded":!0},null,8,["url","fa-icon"])):"color"in r?(e(),g(T,{key:2,size:20,"fa-icon":"circle","icon-color":r.color},null,8,["icon-color"])):$("",!0)],64)),t("span",Ct,[t("span",{class:R(["count-value",{"group-hover/segment:tw-hidden":s.isSortList&&o.hasHover}])},y(r.count),3),s.isSortList&&o.hasHover&&!i.value?(e(),a("span",xt,Lt)):$("",!0)]),t("span",Rt,[Q((e(),a("span",Nt,[F(y(r.name),1)])),[[c(we),o.hasHover?r.name:null,void 0,{right:!0,700:!0}]])])],42,St)]),_:2},1032,["selected","data-item-id","class"])]),_:2},1032,["to"]))),128))]),_:1},8,["data-list-id"])}}});const Vt=M(Bt,[["__scopeId","data-v-a3053bb5"]]),Ht={key:0,class:"count"},Tt=["onClick"],At=t("i",{class:"fas fa-plus-circle"},null,-1),Ft=[At],zt={key:0,class:"tw-mx-4"},Mt={key:0,class:"tw-pl-4 small gray"},Ot={key:0,class:"tw-pl-8 small gray"},J=I({__name:"ContactsSidebarSegments",props:{only:{},except:{}},setup(l){const s=l,{t:d}=me(),_=pe("(hover: hover)"),n=X(),{sharedSegment:i,archivedSegment:h,mySegment:S,isFetching:o}=x(n);n.refetch();const b=ke(),{vaults:w}=x(b);b.refetch();const r=W(),{responsibles:k}=x(r);r.refetch();const f=P(()=>k.value.map(C=>({...C,...C.responsible}))),L=he(),{tags:N}=x(L);L.refetch();const B=A([{id:"mySegment",name:d("mySegments"),items:S,loading:"segments",routeName:"segment",showPlus:!0},{id:"sharedSegment",name:d("sharedSegments"),items:i,loading:"segments",routeName:"segment",showPlus:!0},{id:"archivedSegment",name:d("archivedSegments"),items:h,loading:"segments",routeName:"segment",showCounter:!0},{id:"tags",name:d("tags"),items:N,loading:"tags",routeName:"tag"},{id:"vaults",name:d("vaults"),items:w,loading:"vaults",routeName:"vault"},{id:"responsibles",name:d("responsibles"),items:f,loading:"responsibles",routeName:"responsible"}]),D=P(()=>C=>{var E;return C==="mySegment"||!!((E=H.rights)!=null&&E.is_admin)&&["sharedSegment"].includes(C)});return(C,E)=>(e(),g(q,{space:"4"},{default:m(()=>[(e(!0),a(v,null,V(s.only?B.value.filter(u=>u.id===s.only):s.except?B.value.filter(u=>u.id!==s.except):B.value,(u,ne)=>(e(),a(v,{key:u.id},[u.id!=="archivedSegment"||u.items.length?(e(),g(te,{key:0,"show-caret":!0,"open-on-initial":!!u.items.length&&ne===0,"storage-key":u.id},{header:m(()=>[t("span",null,y(u.name),1),u.showCounter?(e(),a("span",Ht,y(u.items.length||""),1)):$("",!0),u.showPlus?(e(),g(ee,{key:1,component:ve,"component-props":{initialShared:u.id==="mySegment"?"0":"1"}},{default:m(({open:oe})=>[t("span",{class:"icon",onClick:z(oe,["stop"])},Ft,8,Tt)]),_:2},1032,["component-props"])):$("",!0)]),default:m(()=>[u.id==="tags"?(e(),a("div",zt,[!u.items.length&&!c(o)?(e(),a("div",Mt,y(C.$t("emptyList")),1)):$("",!0),p(Ie,{"entity-type":"contact",tags:u.items},null,8,["tags"])])):(e(),a(v,{key:1},[!u.items.length&&!c(o)?(e(),a("div",Ot,y(C.$t("emptyList")),1)):(e(),g(Vt,{key:1,id:u.id,"route-name":u.routeName,items:u.items,"is-sort-list":D.value(u.id),"has-hover":c(_)},null,8,["id","route-name","items","is-sort-list","has-hover"]))],64))]),_:2},1032,["open-on-initial","storage-key"])):$("",!0)],64))),128))]),_:1}))}}),Dt=I({__name:"ContactsSidebar",setup(l){return(s,d)=>(e(),g(q,{space:"4",class:"tw-my-4"},{default:m(()=>[p(lt),p($t),p(J,{only:"mySegment"}),p(We),p(J,{except:"mySegment"})]),_:1}))}}),hs=I({__name:"ContactsView",setup(l){return(s,d)=>{const _=O("RouterView");return e(),g(ae,{slidable:!0,onVnodeMounted:d[0]||(d[0]=n=>{var i;return(i=c(fe))==null?void 0:i.setTitle(s.$t("contacts"))})},{sidebar:m(()=>[p(Dt)]),default:m(()=>[p(_)]),_:1},512)}}});export{hs as default};
