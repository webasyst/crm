import{v as ae}from"./index-0b315a89.js";import{S as de}from"./SkeletonList-675defe7.js";import{E as ue}from"./EmptyList-256bbb87.js";import{C as me,_ as _e}from"./ContactsListItems-27834ddd.js";import{D as Y}from"./DropDown-f7af334e.js";import{d as D,H as ce,C as W,j as G,o as d,b,w as s,m as A,k as i,i as e,g as t,p as g,e as o,f as I,n as E,t as R,x as T,I as V,z as B,c as k,G as pe,J as fe,L as he,A as q,a as J,B as ve,M as ne,N as ge,l as oe,F as Z,O as $e,P as we,h as le}from"./main-512a5cdd.js";import{_ as $,M as P}from"./MenuList-bac784e3.js";import{_ as H}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-b56346dd.js";import{_ as ie,a as ke,u as be}from"./FormSegmentUpdate.vue_vue_type_script_setup_true_lang-911844b1.js";import{W as K}from"./WaDialog-079c5577.js";import{_ as Ce,a as ye}from"./FormContactDelete.vue_vue_type_script_setup_true_lang-0460304a.js";import{_ as Se}from"./FormContactChangeResponsible.vue_vue_type_script_setup_true_lang-2f23e992.js";import{_ as Fe}from"./DropdownIncludeSegment.vue_vue_type_script_setup_true_lang-2c6bb1ae.js";import{_ as xe}from"./FormAddTag.vue_vue_type_script_setup_true_lang-7f103d1a.js";import{F as ee}from"./FieldCheckbox-a8d5da5b.js";import{u as Ie}from"./useSortable-bb0b2f8f.js";import{C as Pe}from"./CustomColumn-351ad915.js";const De=["disabled","onClick"],Ae=e("br",null,null,-1),Ve=e("br",null,null,-1),Re=D({__name:"FormSegmentDelete",props:{segment:{}},emits:["close"],setup(C,{emit:l}){const m=C,_=ce(),{isFetching:a,error:r,execute:h}=W().deleteSegment(m.segment.id);async function n(){await h()&&(_.push({name:"contacts"}),l("close"))}return(c,u)=>{const w=G("i18n-t");return d(),b(K,{onClose:u[0]||(u[0]=y=>l("close"))},{header:s(()=>[A(i(c.$t("deleteSegment")),1)]),submit:s(()=>[e("button",{class:"button",disabled:t(a),onClick:g(n,["prevent"])},i(c.$t("delete")),9,De)]),error:s(()=>[A(i(t(r)),1)]),default:s(()=>[o(w,{tag:"p",keypath:"segmentDeleteMessage"},{newline:s(()=>[Ae,Ve]),_:1})]),_:1})}}}),Le=["onClick"],Be=["onClick"],Te=["onClick"],Ue=D({__name:"DropdownSegment",props:{segment:{}},setup(C){const l=C,{isFetching:m,execute:_}=W().toggleSegmentArchive(l.segment.id);return(a,r)=>{const h=G("RouterLink");return d(),b(P,null,{default:s(()=>[o($,null,{default:s(()=>[o(H,{component:ie,"component-props":{segment:l.segment}},{default:s(({open:n})=>[e("a",{onClick:g(n,["prevent"])},i(a.$t("mainSettings")),9,Le)]),_:1},8,["component-props"])]),_:1}),a.segment.type==="category"?(d(),b($,{key:0},{default:s(()=>[o(H,{component:ke,"component-props":{segment:l.segment}},{default:s(({open:n})=>[e("a",{onClick:g(n,["prevent"])},i(a.$t("addContactsToSegment")),9,Be)]),_:1},8,["component-props"])]),_:1})):I("",!0),a.segment.type==="search"?(d(),b($,{key:1},{default:s(()=>{var n;return[o(h,{class:E(a.$constant.parentAppDisableRouterClass),to:{name:"updateSegmentFilter",params:{id:a.segment.id,searchHash:(n=a.segment.hash)==null?void 0:n.replace("crmSearch/","")}}},{default:s(()=>[A(i(a.$t("updateSegmentFilter")),1)]),_:1},8,["class","to"])]}),_:1})):I("",!0),o($,null,{default:s(()=>[e("a",{onClick:r[0]||(r[0]=g(()=>{t(m)||t(_)()},["prevent"]))},i(a.$t(a.segment.archived?"fromArchive":"toArchive")),1)]),_:1}),o($,null,{default:s(()=>[o(H,{component:Re,"component-props":{segment:l.segment}},{default:s(({open:n})=>[e("a",{onClick:g(n,["prevent"])},i(a.$t("deleteSegment")),9,Te)]),_:1},8,["component-props"])]),_:1})]),_:1})}}}),Me=D({__name:"DropdownSearch",setup(C){var _,a;const{previousFetchParams:l}=R(T()),{show:m}=V(ie,{initialType:"search",initialName:(_=l.value)==null?void 0:_.title,initialHash:(a=l.value)==null?void 0:a.hash});return(r,h)=>{const n=G("RouterLink");return d(),b(P,null,{default:s(()=>[o($,null,{default:s(()=>{var c,u;return[o(n,{to:{name:"detailedSearch",params:{searchHash:(u=(c=t(l))==null?void 0:c.hash)==null?void 0:u.replace("crmSearch/","")}},class:E(r.$constant.parentAppDisableRouterClass)},{default:s(()=>[A(i(r.$t("updateSearchConditions")),1)]),_:1},8,["to","class"])]}),_:1}),o($,null,{default:s(()=>[e("a",{onClick:h[0]||(h[0]=g((...c)=>t(m)&&t(m)(...c),["prevent"]))},i(r.$t("saveAsFilter")),1)]),_:1})]),_:1})}}}),Ne={class:"tw-flex tw-items-center tw-space-x-2 tw-flex-auto tw-w-1/2"},Oe=["title"],ze=e("button",{class:"circle light-gray"},[e("i",{class:"fas fa-pen"})],-1),je=D({__name:"ContactsListTitle",setup(C){const{getSegmentByHash:l}=W(),{previousFetchParams:m}=R(T()),_=B(()=>{var r;return(r=m.value)!=null&&r.hash?l(m.value.hash):null}),a=B(()=>{var r,h;return _.value?_.value.is_editable?Ue:null:(h=(r=m.value)==null?void 0:r.hash)!=null&&h.includes("crmSearch/")?Me:null});return(r,h)=>{var n,c,u,w;return d(),k("div",Ne,[e("div",{class:"tw-text-xl tw-font-bold tw-truncate",title:((n=_.value)==null?void 0:n.name)??((c=t(m))==null?void 0:c.title)},i(((u=_.value)==null?void 0:u.name)??((w=t(m))==null?void 0:w.title)),9,Oe),a.value?(d(),b(Y,{key:0},{body:s(()=>[(d(),b(pe(a.value),fe(he({segment:_.value})),null,16))]),default:s(()=>[ze]),_:1})):I("",!0)])}}}),He=["src"],re=D({__name:"FormContactsExportCSV",props:{contactIds:{},hash:{},checkedCount:{}},setup(C){const l=C;return(m,_)=>(d(),b(K,{"hide-buttons":!0},{default:s(()=>[e("iframe",{src:`${t(q).baseUrl}?module=contactOperation&action=export${l.contactIds?`&ids=${l.contactIds.join(",")}`:l.hash?`&hash=${encodeURIComponent(l.hash)}`:""}&checked_count=${l.checkedCount}`,frameborder:"0",class:"tw-w-full",style:{height:"400px"}},null,8,He)]),_:1}))}}),Ee=["disabled","onClick"],qe={style:{height:"320px","overflow-y":"auto"}},Je=D({__name:"FormContactAddToSegment",props:{contactIds:{}},emits:["close"],setup(C,{emit:l}){const m=C,_=W(),a=J(),r=J();async function h(){a.value&&(r.value=_.includeContactsToSegment(a.value,m.contactIds),await r.value.execute(),r.value.error||l("close"))}return(n,c)=>(d(),b(K,{"use-cancel-as-button-label":!0,onClose:c[1]||(c[1]=u=>l("close"))},{header:s(()=>[A(i(n.$t("addToSegment")),1)]),submit:s(()=>{var u;return[e("button",{disabled:!!((u=r.value)!=null&&u.isFetching)||!a.value,onClick:g(h,["prevent"])},i(n.$t("save")),9,Ee)]}),error:s(()=>{var u;return[A(i((u=r.value)==null?void 0:u.error),1)]}),default:s(()=>[e("div",qe,[o(Fe,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=u=>a.value=u)},null,8,["modelValue"])])]),_:1}))}}),We=["data-id"],Ge=e("div",{class:"handle tw-flex tw-justify-center tw-w-4"},[e("i",{class:"fas fa-grip-vertical gray"})],-1),Ke={class:"small"},Qe={class:"small"},Xe=D({__name:"FormContactsFields",emits:["close"],setup(C,{emit:l}){const{t:m}=ve(),_=["name","lastname","firstname","middlename"],a=[{id:"last_action",name:m("lastAction"),value:"",sort:0},{id:"create_datetime",name:m("createDate"),value:"",sort:0},{id:"tags",name:m("tags"),value:"",sort:0}],{data:r,isFetching:h,error:n}=ne("crm.field.list?scope=contact").get().json(),c=T(),{previousFetchParams:u}=R(c),w=J([]),y=B(()=>{var p;return(p=w.value)==null?void 0:p.filter(f=>f.value).sort((f,v)=>f.sort<0?1:f.sort-v.sort)}),Q=B(()=>{var p;return(p=w.value)==null?void 0:p.filter(f=>!f.value)}),U=J(null);ge(()=>{Array.isArray(r.value)&&(w.value=[...a,...r.value.filter(p=>!_.includes(p.id))].reduce((p,f)=>{var M,N;const{id:v,name:S}=f,x=((N=(M=u.value)==null?void 0:M.fields)==null?void 0:N.indexOf(v))??-1;if(p.push({id:v,name:S,value:x>-1?"1":"",sort:x}),"fields"in f){const z=f.fields.map(F=>{var te,se;const O=`${f.id}:${F.id}`,j=((se=(te=u.value)==null?void 0:te.fields)==null?void 0:se.indexOf(O))??-1;return{id:O,name:`${f.name} – ${F.name}`,value:j>-1?"1":"",sort:j}});p.push(...z)}return p},[]))});function L(){Ie(U,y,{animation:150,handle:".handle"})}function X(){var p;c.fields=Array.from(((p=U.value)==null?void 0:p.querySelectorAll("[data-id]"))||[]).map(f=>f.getAttribute("data-id")??""),c.updateFetchParams(),ne("crm.user.settings.save").patch({contact_list_columns:c.fields.map(f=>({field:f,width:"m"}))}),l("close")}return(p,f)=>(d(),b(K,{onClose:f[0]||(f[0]=v=>l("close"))},{header:s(()=>[A(i(p.$t("selectFields")),1)]),submit:s(()=>[w.value?(d(),k("button",{key:0,class:"button",onClick:X},i(p.$t("save")),1)):I("",!0)]),default:s(()=>[o(Ce,{"is-fetching":t(h),error:t(n)},{default:s(()=>[o(Pe,{space:"4",class:"fields-list"},{default:s(()=>[e("div",{ref_key:"sortableRef",ref:U,class:"tw-bg-waBlank tw-z-20 tw-pb-4 tw-border-0 tw-border-solid tw-border-b tw-border-b-waBorder",onVnodeMounted:L},[(d(!0),k(Z,null,oe(y.value,v=>(d(),k("div",{key:v.id,"data-id":v.id,class:"tw-flex tw-items-center tw-space-x-2 tw-mb-1"},[Ge,o(ee,{modelValue:v.value,"onUpdate:modelValue":S=>v.value=S},{default:s(()=>[e("span",Ke,i(v.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])],8,We))),128))],512),e("div",null,[(d(!0),k(Z,null,oe(Q.value,v=>(d(),k("div",{key:v.id,class:"tw-flex tw-items-center tw-space-x-2 tw-mb-1"},[o(ee,{modelValue:v.value,"onUpdate:modelValue":S=>v.value=S},{default:s(()=>[e("span",Qe,i(v.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1})]),_:1},8,["is-fetching","error"])]),_:1}))}}),Ye=["onClick"],Ze=e("div",{class:"icon"},[e("i",{class:"fas fa-table"})],-1),et=e("div",{class:"icon"},[e("i",{class:"fas fa-exchange-alt"})],-1),tt=["href"],st=e("div",{class:"icon"},[e("i",{class:"fas fa-upload"})],-1),at=e("div",{class:"icon"},[e("i",{class:"fas fa-download"})],-1),nt=D({__name:"DropdownSettings",setup(C){const{previousFetchParams:l}=R(T());return(m,_)=>{const a=G("RouterLink");return d(),b(P,null,{default:s(()=>{var r;return[o($,null,{default:s(()=>[o(H,{component:Xe},{default:s(({open:h})=>[e("a",{onClick:g(h,["prevent"])},[Ze,e("span",null,i(m.$t("customizeColumns")),1)],8,Ye)]),_:1})]),_:1}),(r=t(q).rights)!=null&&r.is_admin?(d(),k(Z,{key:0},[o($,null,{default:s(()=>[o(a,{to:{name:"mergeDuplicates"}},{default:s(()=>[et,e("span",null,i(m.$t("mergeDuplicates")),1)]),_:1})]),_:1}),o($,null,{default:s(()=>[e("a",{href:`${t(q).baseUrl}contact/import/`},[st,e("span",null,i(m.$t("importContacts")),1)],8,tt)]),_:1})],64)):I("",!0),o($,null,{default:s(()=>[e("a",{onClick:_[0]||(_[0]=g(h=>{var n,c;return t(V)(re,{hash:(n=t(l))==null?void 0:n.hash,checkedCount:((c=t(l))==null?void 0:c.total_count)??0}).show()},["prevent"]))},[at,e("span",null,i(m.$t("export")),1)])]),_:1})]}),_:1})}}}),ot={key:0,class:"tw-flex tw-space-x-2"},lt={class:"tw-relative"},ct={class:"light-gray small tw-flex tw-items-center tw-space-x-2"},it=e("i",{class:"fas fa-caret-down"},null,-1),rt=["onClick"],dt=e("hr",{class:"tw-m-0"},null,-1),ut=["onClick"],mt=e("span",{class:"icon"},[e("i",{class:"fas fa-folder-open"})],-1),_t=["onClick"],pt=e("span",{class:"icon"},[e("i",{class:"fas fa-hashtag"})],-1),ft=["disabled","onClick"],ht=e("span",{class:"icon"},[e("i",{class:"fas fa-users"})],-1),vt=["onClick"],gt=e("span",{class:"icon"},[e("i",{class:"fas fa-user-circle"})],-1),$t=["onClick"],wt=e("span",{class:"icon"},[e("i",{class:"fas fa-download"})],-1),kt=["onClick"],bt=e("span",{class:"icon"},[e("i",{class:"fas fa-trash-alt"})],-1),Ct=e("i",{class:"fas fa-times"},null,-1),yt=[Ct],St={key:1,class:"tw-flex tw-space-x-2"},Ft=e("i",{class:"fas fa-check-square"},null,-1),xt={class:"light-gray small"},It=e("i",{class:"fas fa-ellipsis-h"},null,-1),Pt=e("i",{class:"fas fa-caret-down"},null,-1),Dt=D({__name:"ContactsListControls",setup(C){const l=ce(),{contacts:m,bulkSelectMode:_,bulkSelectIds:a}=R(T()),r=B(()=>JSON.stringify(a.value)===JSON.stringify(m.value.map(n=>n.id)));$e(()=>{_.value=!1});function h(){const n=m.value.map(c=>c.id);a.value=r.value?[]:n}return(n,c)=>t(_)?(d(),k("div",ot,[e("div",lt,[o(Y,{right:!0,"disable-click-outside":!0},{body:s(({hide:u})=>{var w;return[o(P,null,{default:s(()=>[o($,null,{default:s(()=>[e("a",{onClick:g(h,["prevent"])},[o(ee,{"model-value":r.value?"1":""},{default:s(()=>[A(i(n.$t("selectAll")),1)]),_:1},8,["model-value"])],8,rt)]),_:1})]),_:1}),dt,e("div",{class:E({"tw-opacity-40 tw-pointer-events-none":!t(a).length})},[o(P,null,{default:s(()=>[o($,null,{default:s(()=>[e("a",{onClick:g(y=>{t(V)(Je,{contactIds:t(a)}).show(),u()},["prevent"])},[mt,e("span",null,i(n.$t("addToSegment")),1)],8,ut)]),_:2},1024)]),_:2},1024),o(P,null,{default:s(()=>[o($,null,{default:s(()=>[e("a",{onClick:g(y=>{t(V)(xe,{entityType:"contact",entityIds:t(a)}).show(),u()},["prevent"])},[pt,e("span",null,i(n.$t("tags")),1)],8,_t)]),_:2},1024)]),_:2},1024),(w=t(q).rights)!=null&&w.is_admin?(d(),b(P,{key:0},{default:s(()=>[o($,null,{default:s(()=>[e("a",{disabled:t(a).length<2,onClick:g(()=>{t(l).push({name:"merge",query:{ids:t(a).join(",")}}),u()},["prevent"])},[ht,e("span",null,i(n.$t("merge")),1)],8,ft)]),_:2},1024)]),_:2},1024)):I("",!0),o(P,null,{default:s(()=>[o($,null,{default:s(()=>[e("a",{onClick:g(y=>{t(V)(Se,{contactIds:t(a)}).show(),u()},["prevent"])},[gt,e("span",null,i(n.$t("addResponsible")),1)],8,vt)]),_:2},1024)]),_:2},1024),o(P,null,{default:s(()=>[o($,null,{default:s(()=>[e("a",{onClick:g(y=>{t(V)(re,{contactIds:t(a),checkedCount:t(a).length}).show(),u()},["prevent"])},[wt,e("span",null,i(n.$t("export")),1)],8,$t)]),_:2},1024)]),_:2},1024),o(P,null,{default:s(()=>[o($,null,{default:s(()=>[e("a",{onClick:g(y=>{t(V)(ye,{contactIds:t(a),disableContactsPageRedirect:!0}).show(),u()},["prevent"])},[bt,e("span",null,i(n.$t("delete")),1)],8,kt)]),_:2},1024)]),_:2},1024)],2)]}),default:s(()=>[e("button",ct,[e("span",null,i(n.$t("selected")),1),e("span",{class:E(["badge smaller",t(a).length?"tw-bg-waAccent":"gray"])},i(t(a).length),3),it])]),_:1})]),e("button",{class:"light-gray small",onClick:c[0]||(c[0]=g(u=>_.value=!1,["prevent"]))},yt)])):(d(),k("div",St,[e("button",{class:"light-gray small tw-flex tw-items-center tw-space-x-2",onClick:c[1]||(c[1]=g(u=>_.value=!0,["prevent"]))},[Ft,e("span",null,i(n.$t("select")),1)]),o(Y,{right:!0},{body:s(()=>[o(nt)]),default:s(()=>[e("button",xt,[It,A("  "+i(n.$t("settings"))+"  ",1),Pt])]),_:1})]))}}),At={key:0,class:"tw-p-4"},Vt={class:"tw-flex tw-items-center tw-space-x-4 tw-justify-between tw-h-8"},Rt={key:0,class:"skeleton tw-w-48"},Lt=e("div",{class:"skeleton-line",style:{height:"2.2rem"}},null,-1),Bt=[Lt],Tt={key:2,class:"tw-flex-none tw-ml-auto tw-hidden md:tw-flex"},Ut={class:"md:tw-hidden"},Mt=e("i",{class:"fas fa-sliders-h black"},null,-1),Nt=[Mt],Ot={key:1,class:"tw-p-4 tw-flex-auto tw-min-h-[80vh]"},zt={key:2},jt=e("div",{class:"icon size-80"},[e("i",{class:"fas fa-user-friends"})],-1),Ht={key:0,class:"tw-text-center tw-py-4"},Et=e("div",{class:"spinner custom-p-16"},null,-1),qt=[Et],Jt={key:0,class:"tw-text-center tw-py-4"},Wt=e("div",{class:"spinner custom-p-16"},null,-1),Gt=[Wt],ms=D({__name:"ContactsList",props:{fetchParams:{},hideHeader:{type:Boolean},activeContactId:{}},setup(C){const l=C,m=T(),{fetchNextPage:_,fetchPrevPage:a,updateFetchParams:r,bulkSelectToggle:h}=m,{contacts:n,prevOffset:c,nextOffset:u,fetchParams:w,previousFetchParams:y,bulkSelectMode:Q,bulkSelectIds:U,isFetching:L,isFinished:X,error:p}=R(m),{showSidebar:f}=R(be()),v=B(()=>{var S;return(((S=y.value)==null?void 0:S.columns)||[]).filter(x=>x.id!=="name")});return we(()=>l.fetchParams,r,{immediate:!0}),(S,x)=>(d(),b(_e,{breakpoint:["md","lg"],"trigger-class":["tw-group/md-contacts","tw-group/lg-contacts"],class:"tw-flex tw-flex-col tw-h-full tw-bg-waBlank"},{default:s(()=>{var M,N,z;return[S.hideHeader?I("",!0):(d(),k("div",At,[e("div",Vt,[t(L)&&!t(w).offset||((M=t(p))==null?void 0:M.code)===20?(d(),k("div",Rt,Bt)):(d(),b(je,{key:1})),t(n).length?(d(),k("div",Tt,[o(Dt)])):I("",!0),e("div",Ut,[e("button",{class:"circle transparent",onClick:x[0]||(x[0]=F=>f.value=!t(f))},Nt)])])])),t(L)&&!t(w).offset&&(!l.activeContactId||!t(c))||((N=t(p))==null?void 0:N.code)===20?(d(),k("div",Ot,[o(de)])):t(p)?(d(),k("div",zt,i(t(p)),1)):t(X)&&!t(n).length?(d(),b(ue,{key:3,message:S.$t("noContacts")},{default:s(()=>[jt]),_:1},8,["message"])):t(n).length&&t(y)?(d(),b(me,{key:4,contacts:t(n),"header-columns":v.value,"fetch-params":t(w),sort:t(y).sort,"active-contact-id":l.activeContactId,"context-contact-id":(z=S.fetchParams)==null?void 0:z.context_contact_id,"prev-offset":t(c),"bulk-select-mode":t(Q),"bulk-select-ids":t(U),onBulkSelectToggle:x[1]||(x[1]=F=>t(h)(...F)),onUpdateFetchParams:x[2]||(x[2]=F=>t(r)(F))},{lazyloadUp:s(()=>[t(c)>0?le((d(),k("div",Ht,qt)),[[t(ae),([{isIntersecting:F}])=>{F&&!t(L)&&t(a)()}]]):I("",!0)]),lazyloadDown:s(()=>{var F,O;return[t(u)+(((F=t(y))==null?void 0:F.limit)??0)<(((O=t(y))==null?void 0:O.total_count)??0)?le((d(),k("div",Jt,Gt)),[[t(ae),([{isIntersecting:j}])=>{j&&!t(L)&&t(_)()}]]):I("",!0)]}),_:1},8,["contacts","header-columns","fetch-params","sort","active-contact-id","context-contact-id","prev-offset","bulk-select-mode","bulk-select-ids"])):I("",!0)]}),_:1}))}});export{ms as _};
