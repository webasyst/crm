import{d as U,h as _,a$ as ie,b6 as ce,R as B,r as se,j as F,H as re,l as z,U as H,V as ue,o as u,c as h,a,p as E,e as Z,i as V,w as D,ap as de,u as S,P as fe,aQ as Q,ak as J,b7 as pe,$ as ve,aj as me,ao as _e,k as G,v as K,a9 as ee,s as ae,x as ne,_ as oe,I as he,ah as ye,b8 as be,ay as W,a4 as we,m as ge,F as q,q as j,b as ke,A as te,Z as Te,n as M}from"./main-2290994d.js";import{D as $e}from"./DropdownModal-7cbbc57e.js";import{u as Ce}from"./useSortable-a183a608.js";import{D as Se}from"./DropDown-9065f982.js";import{c as xe}from"./index-6e4a059f.js";const rt=U({__name:"ComponentActivator",setup(m){const o=_(!1),s=ie(ce()),d=B(s,v=>{v&&(o.value=!0,d())});return(v,l)=>o.value?se(v.$slots,"default",{key:0}):F("",!0)}}),Ie={class:"tw-flex tw-items-center tw-gap-x-2"},Ne={class:"mobile:tw-hidden"},Re=a("span",{class:"tw-hidden mobile:tw-inline-block"},[a("i",{class:"fas fa-receipt"})],-1),Ae=["onClick"],Ee={key:0},De=a("i",{class:"fas fa-spinner fa-spin"},null,-1),Be=[De],Le={key:1},Oe=a("i",{class:"fas fa-plus"},null,-1),ze=[Oe],ut=U({__name:"TabsAddEntityButton",props:{entityType:{},entityId:{},additionalActions:{}},setup(m,{expose:o}){const s=m,{t:d}=re();let v=null;const l=_([]),y=_([]),g=z(()=>l.value.concat(y.value));B(()=>s.entityId,r=>{$(),v=r},{immediate:v!==s.entityId}),B(()=>s.additionalActions,r=>{r&&l.value.push(...r)},{deep:!0,immediate:!!s.additionalActions&&!!s.additionalActions.length});const c=_(!1),k=_(!1),b=_(!1);B([()=>s.entityType,()=>s.entityId],()=>{l.value=l.value.filter(r=>!("html"in r)),c.value=!1,k.value=!1,b.value=!1});function $(){y.value=[],l.value=[{label:d("addNote"),classIcon:"fas fa-sticky-note",clickHandler:()=>{H.replace({name:`${s.entityType}NotesTab`,query:{focus:"1"}})}},{label:d("addFile"),classIcon:"fas fa-paperclip",clickHandler:()=>{H.replace({name:`${s.entityType}FilesTab`}).then(()=>{ue(de).emit()})}},{label:d("addReminder"),classIcon:"fas fa-check-circle",clickHandler:()=>{H.replace({name:`${s.entityType}RemindersTab`,query:{focus:"1"}})}}]}function L(){if(!b.value&&s.entityType==="contact"){k.value=!0;const r=z(()=>`crm.contact.ui.actions?id=${s.entityId}`),{data:w,error:x}=fe(r,{immediate:!0}).get().json(),O=()=>{k.value=!1,b.value=!0,c.value=!0};Q(w,async T=>{if(T.plus_dropdown){const I=[];if(!(T!=null&&T.plus_dropdown))return;T.plus_dropdown.forEach(N=>{I.push({html:N})}),y.value.push(...I)}await J(),O()}),Q(x,()=>{O()})}}return o({callAction:r=>{const w=l.value.find(x=>"id"in x&&x.id===r);w&&"clickHandler"in w&&w.clickHandler()}}),(r,w)=>(u(),h("div",Ie,[a("button",{type:"button",class:"button nowrap rounded mobile:tw-rounded-full mobile:tw-p-0 mobile:tw-w-[2.125em] mobile:tw-h-[2.125em]",onClick:w[0]||(w[0]=Z(()=>{S(H).replace({name:`${s.entityType}InvoicesTab`,query:{is_new:"1"}})},["prevent"]))},[a("span",Ne,E(r.$t("addInvoice")),1),Re]),(u(),V($e,{key:`${s.entityType}_${s.entityId}`,items:g.value,"fallback-on-open":!0,"prevent-open":s.entityType==="contact",open:c.value},{default:D(()=>[a("button",{class:"button circle light-gray !tw-text-waAccent",onClick:Z(L,["prevent"])},[k.value?(u(),h("span",Ee,Be)):(u(),h("span",Le,ze))],8,Ae)]),_:1},8,["items","prevent-open","open"]))]))}}),le=m=>(ae("data-v-8af80abb"),m=m(),ne(),m),He={class:"tw-sticky tw-left-0 tw-z-10"},Me=le(()=>a("span",{class:"icon size-16"},[a("i",{class:"fas fa-chevron-left"})],-1)),Fe=[Me],Ve=le(()=>a("span",{class:"icon size-16"},[a("i",{class:"fas fa-chevron-left"})],-1)),Ue=[Ve],We=U({__name:"HorizontalScrollContainer",props:{step:{default:90},fadeColor:{default:"var(--background-color-blank)"}},setup(m){const o=m;pe(g=>({ba883736:g.fadeColor}));const s=_(null),d=_(!1),v=_(0),{x:l,arrivedState:y}=ve(s,{behavior:"smooth"});return me(s,g=>{const c=g[0];v.value=c.target.clientHeight,d.value=c.target.scrollWidth>c.target.clientWidth}),_e(()=>{s.value&&(v.value=s.value.clientHeight,d.value=s.value.scrollWidth>s.value.clientWidth)}),B(d,()=>{y.right=!1}),(g,c)=>(u(),h("div",{ref_key:"scrollableRef",ref:s,class:"tw-relative tw-overflow-x-scroll tw-scrollbar-hide"},[a("div",He,[G(a("div",{class:"arr -tw-left-2",style:ee({height:`${v.value}px`}),onClick:c[0]||(c[0]=k=>l.value-=o.step)},Fe,4),[[K,d.value&&S(l)>0]]),G(a("div",{class:"arr tw-right-0 tw-rotate-180",style:ee({height:`${v.value}px`}),onClick:c[1]||(c[1]=k=>l.value+=o.step)},Ue,4),[[K,d.value&&!S(y).right]])]),se(g.$slots,"default")],512))}});const qe=oe(We,[["__scopeId","data-v-8af80abb"]]),P=m=>(ae("data-v-2b71c2aa"),m=m(),ne(),m),je=P(()=>a("div",{class:"skeleton-line"},null,-1)),Qe=[je],Je=["data-id"],Pe=["href","onClick"],Ye={key:0,class:"count"},Xe={key:0,class:"nowrap tw-ml-1 tw-py-3"},Ze=P(()=>a("span",{class:"icon size-16 text-light-gray"},[a("i",{class:"fas fa-chevron-down"})],-1)),Ge=["data-id"],Ke=["href","onClick"],et=["title"],tt={key:0,class:"count tw-flex-none"},st=P(()=>a("canvas",{id:"tabs-canvas",class:"hidden"},null,-1)),at=U({__name:"TabList",props:{entityType:{},value:{},isFetching:{type:Boolean},fadeColor:{}},setup(m){const o=m,s=he(xe),d=_(null),v=_(null),l=_(null),y=_(null),{width:g}=ye(y),{tabsOrder:c,tabsOrderMap:k}=be(o.entityType),b=_(new Map),$=z(()=>[...o.value].sort((e,f)=>k.value[e.routeName]-k.value[f.routeName])),L=z(()=>$.value.filter(e=>b.value.get(e.routeName))),r=z(()=>b.value.size>0?$.value.filter(e=>!b.value.get(e.routeName)):[]),w=()=>{for(const e of $.value)b.value.set(e.routeName,!0)},x=(e,f)=>{const p=document.getElementById("tabs-canvas");if(p){const t=p.getContext("2d");if(t)return t.font=f,t.measureText(e).width}return 0},O=e=>{const p="1rem sans-serif",t="0.75em sans-serif";let i=0;for(let n=0;n<e.length;n++)i+=24,i+=x(e[n].name,p),e[n].count&&(i+=x(String(e[n].count),t));return i-24};async function T(e=!1){if(!y.value)return;const f=[...$.value],p=()=>{var n;let i=l.value?80:0;return v.value&&(i=v.value.offsetWidth+20),e&&((n=l.value)==null?void 0:n.children.length)===1?0:i},t=p();if(!(O(f)<y.value.clientWidth-t))for(let i=0;i<$.value.length;i++){const n=f.pop();if(b.value.set(n==null?void 0:n.routeName,!1),await J(),O(f)<y.value.clientWidth-(e?t:p()))break}}B(()=>o.value,()=>{if(!o.value.length)return;Q(()=>o.isFetching,async()=>{c.value.length||o.value.forEach(f=>{c.value.push(f.routeName)}),w(),await J(),T()},{immediate:!o.isFetching})},{immediate:!!o.value,deep:!0});let I,N;W(L,e=>{d.value&&e.length&&(I=Y(d.value,e))},{immediate:!0,debounce:250}),W(r,e=>{l.value&&e.length&&(N=Y(l.value,e))},{immediate:!0,debounce:250}),W(g,(e,f)=>{e>f&&N&&w(),T(e>f)},{debounce:200}),we(()=>{I&&I.stop(),N&&N.stop()});function Y(e,f){return Ce(e,f,{handle:".handle",group:"tabs",animation:150,forceFallback:!0,fallbackOnBody:!0,fallbackTolerance:5,delay:150,delayOnTouchOnly:!0,onStart:()=>{document.querySelectorAll("iframe").forEach(p=>{p.classList.add("tw-pointer-events-none")})},onEnd:p=>{var R,A;document.querySelectorAll("iframe").forEach(C=>{C.classList.remove("tw-pointer-events-none")});const{id:t}=p.item.dataset;typeof t=="string"&&(p.to.classList.contains("tabs-dropdown-list")?b.value.set(t,!1):p.to.classList.contains("tabs-main-list")&&b.value.set(t,!0));const i=[...((R=d.value)==null?void 0:R.children)||[],...((A=l.value)==null?void 0:A.children)||[]].map(C=>C.dataset.id),n=[...c.value];for(let C=0;C<n.length;C++){const X=n[C];i.includes(X)||i.splice(C,0,X)}c.value=i,setTimeout(T)}})}return(e,f)=>{const p=ge("router-link");return u(),h("div",{ref_key:"tabsListRef",ref:y,class:"tabs-list tw-flex-auto tw-overflow-hidden tw-mx-2"},[(u(),V(Te(S(s)?qe:"div"),{"fade-color":o.fadeColor||"var(--background-color)",class:"tw-select-none md:tw-flex"},{default:D(()=>[(u(),h("ul",{key:JSON.stringify(L.value),ref_key:"mainUlRef",ref:d,class:"tabs tabs-main-list overflow-arrows tw-flex-none"},[o.isFetching?(u(),h(q,{key:0},j(7,t=>a("li",{key:t,class:"skeleton tw-w-16"},Qe)),64)):(u(!0),h(q,{key:1},j(S(s)?$.value:L.value,t=>(u(),V(p,{key:t.routeName,to:{name:t.routeName},replace:"",custom:""},{default:D(({isActive:i,href:n,navigate:R})=>[a("li",{class:M([{selected:i,handle:!S(s)},"tab-item"]),"data-id":t.routeName},[a("a",{href:n,class:M(e.$constant.parentAppDisableRouterClass),onClick:A=>R(A).then(()=>typeof t.onClick=="function"?t.onClick():null)},[a("span",null,[te(E(t.name)+" ",1),t.count?(u(),h("span",Ye,E(t.count),1)):F("",!0)])],10,Pe)],10,Je)]),_:2},1032,["to"]))),128))])),!S(s)&&r.value.length?(u(),h("div",Xe,[ke(Se,{"fallback-on-open":!0,hover:!0,fixed:!0},{body:D(()=>[(u(),h("ul",{key:JSON.stringify(r.value),ref_key:"dropdownUlRef",ref:l,class:"menu tabs-dropdown-list"},[(u(!0),h(q,null,j(r.value,t=>(u(),V(p,{key:t.routeName,to:{name:t.routeName},replace:"",custom:""},{default:D(({isActive:i,href:n,navigate:R})=>[a("li",{class:M([{selected:i,handle:!S(s)},"tab-item"]),"data-id":t.routeName},[a("a",{href:n,class:M([e.$constant.parentAppDisableRouterClass,"!tw-py-3"]),onClick:A=>R(A).then(()=>typeof t.onClick=="function"?t.onClick():null)},[a("span",{title:t.name,class:"tw-truncate"},E(t.name),9,et),t.count?(u(),h("span",tt,E(t.count),1)):F("",!0)],10,Ke)],10,Ge)]),_:2},1032,["to"]))),128))]))]),default:D(()=>[a("button",{ref_key:"dropdownButtonRef",ref:v,class:"button light-gray transparent rounded custom-px-4"},[Ze,te(" "+E(e.$t("more")),1)],512)]),_:1})])):F("",!0),st]),_:1},8,["fade-color"]))],512)}}});const dt=oe(at,[["__scopeId","data-v-2b71c2aa"]]);export{dt as T,ut as _,rt as a};
