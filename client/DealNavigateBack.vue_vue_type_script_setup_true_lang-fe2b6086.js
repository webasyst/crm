import{az as g,O as D,d as y,a1 as B,h as v,o as m,i as w,N as S,w as f,a as c,p as i,c as _,j as $,A as h,F as b,b as F,a2 as N,B as u,ax as C,D as P,e as E,bg as V}from"./main-d7f03521.js";import{B as M}from"./ButtonSubmit-bbd5ca4e.js";function R(r,n=!1){const{deleteDealsByIdsInList:e}=g();return D(`crm.deal.delete${n?"":`?id=${r[0]}`}`,{immediate:!1,afterFetch(d){return d.response.ok&&e(r),d}}).delete(n?{id:r}:null)}const T={class:"gray"},I={key:0,class:"tw-ml-2 small break-words"},U={class:"semibold"},z=c("i",{class:"state-caution fas fa-exclamation-triangle"},null,-1),A={class:"state-error"},q=y({__name:"FormDealDelete",props:{ids:{},isBulkMode:{type:Boolean},dealName:{},disableDealsPageRedirect:{type:Boolean},callbackSuccess:{type:Function}},emits:["close"],setup(r,{emit:n}){const e=r,d=B(),a=v(""),t=v(!1);async function l(){var k;a.value="",t.value=!0;const{error:s,response:o,execute:p}=R(e.ids,e.isBulkMode);await p(),t.value=!1,(k=o.value)!=null&&k.ok?(typeof e.callbackSuccess=="function"&&e.callbackSuccess(),e.disableDealsPageRedirect||d.replace(u.lastSectionFullPath??{name:"deals"}),n("close")):a.value=s.value?s.value:null}return(s,o)=>(m(),w(N,{"use-cancel-as-button-label":"","hide-close-icon":"",onClose:o[0]||(o[0]=p=>n("close"))},S({header:f(()=>[c("span",T,i(s.$t(e.isBulkMode?"confirmDeleteDeals":"delete",s.ids.length)),1),!e.isBulkMode&&e.dealName?(m(),_("span",I,i(e.dealName),1)):$("",!0)]),default:f(()=>[e.isBulkMode?(m(),_(b,{key:0},[c("p",null,i(s.$t("contactsWillNotBeDeleted")),1),c("p",U,[z,h(" "+i(s.$t("dealDeletionCannotBeUndone")),1)])],64)):(m(),_(b,{key:1},[h(i(s.$t("confirmDeleteDeal")),1)],64))]),submit:f(()=>[F(M,{bg:"red","is-fetching":t.value,onClick:l},{default:f(()=>[h(i(s.$t("delete")),1)]),_:1},8,["is-fetching"])]),_:2},[a.value?{name:"error",fn:f(()=>[c("span",A,i(a.value),1)]),key:"0"}:void 0]),1024))}}),L=c("span",{class:"icon size-20"},[c("i",{class:"fas fa-arrow-left"})],-1),O=[L],H=y({__name:"DealNavigateBack",setup(r){const n=C(),e={};P(()=>{var a;return(a=n.deal)==null?void 0:a.funnel_id},a=>{var t,l;e.funnel=a,e.all_funnels=(l=(t=u)==null?void 0:t.funnel_bricks)!=null&&l.includes(a)?void 0:"1",u.lastSectionFullPath||window.document.documentElement.dispatchEvent(new CustomEvent("spa:navigateType",{detail:{name:"deals",query:e}}))});async function d(a){if(u.webView){const{emitter:o}=await V(()=>import("./main-d7f03521.js").then(p=>p.bH),[],import.meta.url);o.emit("spa:navigateBack");return}const{back:t,content_uri:l}=window.history.state,s=o=>/\/deal\/\d+\/\w+/.test(o);typeof t=="string"&&!s(t)||typeof l=="string"&&!s(l)?a.back():u.lastSectionFullPath?a.push(u.lastSectionFullPath):a.push({name:"deals",query:e})}return(a,t)=>(m(),_("a",{style:{color:"var(--deal-color-gray-secondary)"},onClick:t[0]||(t[0]=E(l=>d(a.$router),["prevent"]))},O))}});export{H as _,q as a};
