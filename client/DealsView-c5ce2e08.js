import{d as w,J as te,t as F,ax as T,l as N,o as a,i as k,w as c,b,A as x,p as g,a as s,e as C,j as S,c as $,q as L,u as v,F as V,n as R,H as ae,ay as le,L as ie,az as re,Q as M,h as H,aA as ce,D as ue,k as A,aB as de,ar as _e,ao as pe,s as j,x as q,_ as W,aC as fe,v as K,B as Y,a0 as me,$ as J,I as ve,R as z,r as ne,aD as oe,aE as he,aF as $e,aG as ke,am as be,U as ge,m as ye,T as we,Y as Ce,aH as ee,aI as Se,aJ as Fe}from"./main-46836c41.js";import{U as I}from"./UserPic-951b6ea8.js";import{M as O,_ as B,D as U}from"./DropDown-2ad3ed01.js";import{D as P}from"./DropDownButton-49606824.js";import{C as De,a as Ie}from"./ChipsList-9ead41c5.js";import{v as Ve}from"./vTooltip-9ea5107e.js";import{Q as Be}from"./index-0f68ab4c.js";import{D as Re}from"./DropdownModal-8fb9742c.js";import{_ as Te,a as Ne}from"./FormAddTag.vue_vue_type_script_setup_true_lang-46537099.js";import{W as xe}from"./WaSpinner-f3419042.js";import{a as Pe,_ as Le}from"./DealNavigateBack.vue_vue_type_script_setup_true_lang-aeff0fd9.js";import{a as He}from"./FieldCheckbox-618a9e12.js";import{e as Ee}from"./emit-c388f0d7.js";import{_ as Ae}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-49fe8b50.js";import ze from"./FormDealAdd-7842b6de.js";import"./index-dbd22bf6.js";import"./object_hash-770ac6b3.js";import"./CustomColumn-c8c73188.js";import"./DropdownAddTags.vue_vue_type_script_setup_true_lang-02e057ea.js";import"./ButtonSubmit-c3bae343.js";import"./fields-e10d6cd3.js";import"./FieldSelect-19a80dbd.js";import"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-c3cfd939.js";import"./SortableList.vue_vue_type_script_setup_true_lang-f84f3915.js";import"./useSortable-69b2c6e6.js";import"./InputWithContacts.vue_vue_type_script_setup_true_lang-5a82d5a8.js";import"./InputWithPerformers.vue_vue_type_script_setup_true_lang-07dbcaf8.js";import"./recentContacts-3e5f8df1.js";import"./dayjs-a1477631.js";import"./TextAreaAutoresize-21a4dcce.js";const Me=["onClick"],Oe={class:"tw-p-2"},Ue=["onClick"],Qe=s("i",{class:"fas fa-hashtag"},null,-1),je={class:"tw-flex-auto tw-truncate"},qe={class:"count tw-mt-0.5"},We=w({__name:"DropdownTags",setup(m){const r=te(),{tags:t}=F(r),u=T(),{filterParams:l,firstDeal:p}=F(u),_=N(()=>{var f,d;if(typeof l.value.tag=="number"){const h=t.value.find(e=>e.id===l.value.tag);return!h&&((d=(f=p.value)==null?void 0:f.tags)!=null&&d.length)?p.value.tags.find(e=>e.id===l.value.tag):h}});return(f,d)=>(a(),k(U,{width:"270px"},{default:c(()=>[b(P,{small:!0,width:"9rem"},{icon:c(()=>[b(I,{size:14,"fa-icon":"hashtag"})]),title:c(()=>[x(g(_.value?_.value.name:f.$t("Tags")),1)]),_:1})]),body:c(({hide:h})=>[_.value?(a(),k(O,{key:0},{default:c(()=>[b(B,null,{default:c(()=>[s("a",{onClick:C(e=>{v(u).deleteFilterParam("tag"),h()},["prevent"])},[s("span",null,g(f.$t("showAll")),1)],8,Me)]),_:2},1024)]),_:2},1024)):S("",!0),s("div",Oe,[b(De,null,{default:c(()=>[(a(!0),$(V,null,L(v(t),e=>{var n;return a(),k(Ie,{key:e.id,class:R(["small",{selected:((n=_.value)==null?void 0:n.id)===e.id}])},{default:c(()=>[s("a",{onClick:C(o=>{v(u).updateFilterParams({tag:e.id}),h()},["prevent"])},[Qe,s("span",je,g(e.name),1),s("span",qe,g(e.count),1)],8,Ue)]),_:2},1032,["class"])}),128))]),_:2},1024)])]),_:1}))}}),Ke=["onClick"],Ye=["onClick"],Je={class:"icon small"},Ge={class:"count"},Xe=s("hr",{class:"tw-m-0"},null,-1),Ze=["onClick"],es={class:"icon small"},ss=w({__name:"DropdownStages",setup(m){const{t:r}=ae(),{selectedFunnel:t}=F(le()),u=T(),{filterParams:l,firstDeal:p}=F(u),_=N(()=>{var e;return t.value&&((e=t.value.stages)!=null&&e.length)?t.value.stages:[]}),f=N(()=>_.value.length),d=N(()=>{var e,n;return[{id:"won",name:r("wons"),color:((e=t.value)==null?void 0:e.color)||"",icon:"flag-checkered"},{id:"lost",name:r("losts"),color:((n=t.value)==null?void 0:n.color)||"",icon:"ban"}]}),h=N(()=>{var e,n,o;switch(typeof((e=l.value)==null?void 0:e.stage)){case"number":if(f.value)return _.value.find(i=>i.id===l.value.stage);if((n=p.value)!=null&&n.stage)return{...(o=p.value)==null?void 0:o.stage,icon:null};break;case"string":return d.value.find(i=>i.id===l.value.stage)}});return(e,n)=>(a(),k(U,{disabled:!f.value},ie({default:c(()=>[b(P,{small:!0,disabled:!f.value},{icon:c(()=>[h.value?(a(),$(V,{key:0},[h.value.icon?(a(),k(I,{key:h.value.color,size:10,"fa-icon":h.value.icon,"icon-color":h.value.color},null,8,["fa-icon","icon-color"])):(a(),k(I,{key:h.value.id,size:10,"disable-rounded":"","bg-color":h.value.color},null,8,["bg-color"]))],64)):S("",!0)]),title:c(()=>[x(g(h.value?h.value.name:e.$t("allStages")),1)]),_:1},8,["disabled"])]),_:2},[f.value?{name:"body",fn:c(({hide:o})=>[b(O,null,{default:c(()=>[(a(),k(B,{key:"all"},{default:c(()=>[s("a",{onClick:C(i=>{v(u).deleteFilterParam("stage"),o()},["prevent"])},[s("span",null,g(e.$t("allStages")),1)],8,Ke)]),_:2},1024)),(a(!0),$(V,null,L(_.value,i=>(a(),k(B,{key:i.id},{default:c(()=>[s("a",{onClick:C(y=>{v(u).updateFilterParams({stage:i.id}),o()},["prevent"])},[s("div",Je,[b(I,{size:10,"disable-rounded":"","bg-color":i.color},null,8,["bg-color"])]),s("span",null,g(i.name),1),s("span",Ge,g(i.deal_count),1)],8,Ye)]),_:2},1024))),128)),Xe,(a(!0),$(V,null,L(d.value,i=>(a(),k(B,{key:i.id},{default:c(()=>[s("a",{onClick:C(y=>{v(u).updateFilterParams({stage:i.id}),o()},["prevent"])},[s("div",es,[(a(),k(I,{key:i.color,size:10,"fa-icon":i.icon,"icon-color":i.color},null,8,["fa-icon","icon-color"]))]),s("span",null,g(i.name),1)],8,Ze)]),_:2},1024))),128))]),_:2},1024)]),key:"0"}:void 0]),1032,["disabled"]))}}),ts=s("i",{class:"fas fa-user-slash"},null,-1),as=s("i",{class:"fas fa-users"},null,-1),ls=["onClick"],ns=s("div",{class:"icon"},[s("i",{class:"fas fa-users"})],-1),os=["onClick"],is=s("div",{class:"icon"},[s("i",{class:"fas fa-user-slash"})],-1),rs=["onClick"],cs={class:"icon"},us={class:"count"},ds=w({__name:"DropdownResponsibles",setup(m){const r=re(),{responsibles:t}=F(r),u=T(),{filterParams:l}=F(u),p=N(()=>{if(typeof l.value.user_id=="number")return r.getResponsibleById(l.value.user_id)}),_=N(()=>{var d;return((d=l.value)==null?void 0:d.user_id)===0});function f(d){d==="all"?u.deleteFilterParam("user_id"):u.updateFilterParams({user_id:d})}return(d,h)=>(a(),k(U,null,{default:c(()=>[p.value?(a(),k(P,{key:0,small:!0},{icon:c(()=>[b(I,{size:16,url:p.value.responsible.userpic},null,8,["url"])]),title:c(()=>[x(g(p.value.responsible.name),1)]),_:1})):_.value?(a(),k(P,{key:1,small:!0},{icon:c(()=>[ts]),title:c(()=>[x(g(d.$t("noResponsible")),1)]),_:1})):(a(),k(P,{key:2,small:!0},{icon:c(()=>[as]),title:c(()=>[x(g(d.$t("allResponsibles")),1)]),_:1}))]),body:c(({hide:e})=>[b(O,null,{default:c(()=>[(a(),k(B,{key:"all"},{default:c(()=>[s("a",{onClick:C(n=>{f("all"),e()},["prevent"])},[ns,s("span",null,g(d.$t("allResponsibles")),1)],8,ls)]),_:2},1024)),(a(),k(B,{key:0},{default:c(()=>[s("a",{onClick:C(n=>{f(0),e()},["prevent"])},[is,s("span",null,g(d.$t("noResponsible")),1)],8,os)]),_:2},1024)),(a(!0),$(V,null,L(v(t),n=>(a(),k(B,{key:n.responsible.id},{default:c(()=>[s("a",{onClick:C(o=>{f(n.responsible.id),e()},["prevent"])},[s("div",cs,[b(I,{size:10,url:n.responsible.userpic},null,8,["url"])]),s("span",null,g(n.responsible.name),1),s("span",us,g(n.count),1)],8,rs)]),_:2},1024))),128))]),_:2},1024)]),_:1}))}}),_s=["onClick"],ps=["onClick"],fs={class:"icon"},ms={class:"count"},vs=w({__name:"DropdownFunnels",props:{hideOptionAll:{type:Boolean}},setup(m){const r=m,t=le();t.withCount();const{funnels:u,selectedFunnel:l,isFinished:p}=F(t),_=T(),{filterParams:f,firstDeal:d}=F(_);M(()=>[d.value,f.value.funnel,p.value],([,e,n])=>{var o;n&&(typeof e=="number"?(l.value=t.getFunnelById(e),!l.value&&((o=d.value)!=null&&o.funnel)&&(l.value={...d.value.funnel,stages:[d.value.stage]})):l.value=void 0)},{immediate:!0});function h(e,n){var o;e==="all"?_.updateFilterParams({funnel:void 0,stage:void 0}):_.updateFilterParams({funnel:e,...((o=f.value)==null?void 0:o.funnel)!==e?{stage:void 0}:{}}),typeof n=="function"&&n()}return(e,n)=>(a(),k(U,null,{default:c(()=>[b(P,{small:!0},{icon:c(()=>[v(l)?(a(),k(I,{key:v(l).id,size:12,"fa-icon":"filter","icon-color":v(l).color},null,8,["icon-color"])):S("",!0)]),title:c(()=>[x(g(v(l)?v(l).name:e.$t("allFunnels")),1)]),_:1})]),body:c(({hide:o})=>[b(O,null,{default:c(()=>[r.hideOptionAll?S("",!0):(a(),k(B,{key:"all"},{default:c(()=>[s("a",{onClick:C(i=>h("all",o),["prevent"])},[s("span",null,g(e.$t("allFunnels")),1)],8,_s)]),_:2},1024)),(a(!0),$(V,null,L(v(u),i=>(a(),k(B,{key:i.id},{default:c(()=>[s("a",{onClick:C(y=>h(i.id,o),["prevent"])},[s("div",fs,[b(I,{size:10,"fa-icon":"filter","icon-color":i.color},null,8,["icon-color"])]),s("span",null,g(i.name),1),s("span",ms,g(i.deal_count),1)],8,ps)]),_:2},1024))),128))]),_:2},1024)]),_:1}))}}),Q=m=>(j("data-v-b18d977a"),m=m(),q(),m),hs={key:0,class:"state-with-inner-icon left"},$s=["placeholder"],ks={key:0,class:"icon icon-spinner"},bs=Q(()=>s("i",{class:"fas fa-spinner wa-animation-spin"},null,-1)),gs=[bs],ys={key:1,class:"icon icon-search"},ws=Q(()=>s("i",{class:"fas fa-search"},null,-1)),Cs=[ws],Ss=Q(()=>s("i",{class:"fas fa-times"},null,-1)),Fs=[Ss],Ds=Q(()=>s("span",{class:"icon"},[s("i",{class:"fas fa-search"})],-1)),Is=[Ds],Vs=w({__name:"InputSearch",props:{modelValue:{},isFetching:{type:Boolean}},emits:["update:modelValue","close"],setup(m,{emit:r}){const t=m,u=H(),l=ce(t,"modelValue"),p=H(!1);return ue(u,_=>{_.focus()}),(_,f)=>(a(),$("div",null,[p.value?(a(),$("div",hs,[A(s("input",_e({ref_key:"inputEl",ref:u,"onUpdate:modelValue":f[0]||(f[0]=d=>pe(l)?l.value=d:null),type:"search",class:"small",placeholder:_.$t("search")},_.$attrs),null,16,$s),[[de,v(l)]]),_.isFetching?(a(),$("span",ks,gs)):(a(),$("span",ys,Cs)),s("span",{class:"icon icon-close",onClick:f[1]||(f[1]=d=>{p.value=!1,r("close")})},Fs)])):(a(),$("button",{key:1,class:"button square light-gray",onClick:f[2]||(f[2]=C(d=>p.value=!0,["prevent"]))},Is))]))}});const Bs=W(Vs,[["__scopeId","data-v-b18d977a"]]),Rs=w({__name:"DealsHeaderSearch",setup(m){const{updateOrDeleteSearchParam:r,onBeforeClearFilters:t,filterParams:u}=T(),l=H(""),p=fe(f=>{r(f.trim())},550);t(_);function _(){l.value="",r("","search"in u&&Object.keys(u).length>1)}return(f,d)=>(a(),k(Bs,{modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=h=>l.value=h),onInput:d[1]||(d[1]=h=>v(p)(h.target.value)),onClose:_},null,8,["modelValue"]))}}),Ts=["onClick"],Ns=s("i",{class:"fas fa-star"},null,-1),xs=[Ns],Ps=w({__name:"DealsHeaderFavorites",setup(m){const r=T(),t=N(()=>!!r.filterParams.pinned_only);function u(){r.updateFilterParams({pinned_only:t.value?void 0:1})}return(l,p)=>(a(),$("div",null,[A((a(),$("button",{class:R(["button square",[t.value?"yellow":"light-gray"]]),onClick:C(u,["prevent"])},[s("span",{class:R(["icon size-14",{"!tw-text-waBlank":t.value}])},xs,2)],10,Ts)),[[v(Ve),l.$t("showFavorites"),void 0,{bottom:!0}]])]))}}),Ls=m=>(j("data-v-cac879f0"),m=m(),q(),m),Hs={class:"deals-header__filters-wrapper"},Es={class:"deals-header__filters"},As=Ls(()=>s("i",{class:"fas fa-times-circle text-gray"},null,-1)),zs=[As],Ms={key:0,class:"skeleton deals-header__filters"},Os=w({__name:"DealsHeaderFilters",props:{hideStages:{type:Boolean},hasFilters:{type:Boolean},showSkeleton:{type:Boolean},isKanban:{type:Boolean}},emits:["clear"],setup(m,{emit:r}){const t=m;return(u,l)=>(a(),$("div",Hs,[A(s("div",Es,[b(vs,{"hide-option-all":t.isKanban},null,8,["hide-option-all"]),t.hideStages?S("",!0):(a(),k(ss,{key:0})),b(ds),b(We),b(Ps),b(Rs),t.hasFilters?(a(),$("button",{key:1,class:"deals-header__filters-clear button small nobutton light-gray",onClick:l[0]||(l[0]=p=>r("clear"))},zs)):S("",!0)],512),[[K,!t.showSkeleton]]),t.showSkeleton?(a(),$("div",Ms,[(a(!0),$(V,null,L(t.hideStages?3:4,p=>(a(),$("span",{key:p,class:"skeleton-line deals-header__filters-skeleton"}))),128))])):S("",!0)]))}});const Us=W(Os,[["__scopeId","data-v-cac879f0"]]),Qs=["disabled","onClick"],js={class:"tw-flex tw-items-center tw-gap-2"},qs={class:"icon"},Ws=w({__name:"ActionButtonList",props:{items:{},space:{}},setup(m){const r=m;return(t,u)=>(a(),$("div",{class:R(`tw-flex tw-gap-${r.space||0}`)},[(a(!0),$(V,null,L(r.items,(l,p)=>(a(),$(V,{key:p},[l.hide?S("",!0):(a(),$("button",{key:0,disabled:l.disableClick,class:"light-gray",onClick:_=>!l.disableClick&&l.clickHandler()},[s("div",js,[s("span",qs,[s("i",{class:R(["fas",l.classIcon])},null,2)]),s("span",null,g(l.label),1)])],8,Qs))],64))),128))],2))}}),Ks=["src"],Ys=w({__name:"FormDealExportCSV",props:{ids:{}},setup(m){const r=m,t=H(!0),u={height:"400px",width:"100%"};return(l,p)=>(a(),k(me,{"hide-buttons":!0},{default:c(()=>[t.value?(a(),k(xe,{key:0,style:u})):S("",!0),A(s("iframe",{src:`${v(Y).baseUrl}?module=deal&action=export&ids=${r.ids.join(",")}`,style:u,frameborder:"0",onLoad:p[0]||(p[0]=_=>t.value=!1)},null,40,Ks),[[K,!t.value]])]),_:1}))}}),Js={class:"deals-header__edit small"},Gs={class:"deals-header__edit-selected-deals"},Xs={class:"tw-hidden xl:tw-inline-block tw-mr-2"},Zs={class:"badge user tw-bg-waAccent tw-min-w-[0.5rem] tw-justify-center"},et={class:"deals-header__edit-buttons"},st=s("span",{class:"icon"},[s("i",{class:"fas fa-times-circle"})],-1),tt={class:"tw-hidden xl:tw-inline-block tw-ml-2"},at=w({__name:"DealsHeaderBulkEdit",setup(m){var n;const r=J(),{t}=ae(),u=T(),{countChecked:l,isAllChecked:p,bulkSelectIds:_}=F(u),f=ve(Be),d=H(p.value?"1":""),h=H([...(n=Y.rights)!=null&&n.export?[{label:t("export"),classIcon:"fas fa-download",clickHandler:()=>{z(Ys,{ids:_.value}).show()}}]:[],{label:t("merge"),classIcon:"fas fa-users",hide:!0,clickHandler:()=>r.push({name:"dealMerge",query:{ids:_.value.join(",")}})},{label:t("changeResponsible"),classIcon:"fas fa-user-check",hide:!0,clickHandler:()=>({})},{label:t("changeFunnelOrStage"),classIcon:"fas fa-exchange-alt",hide:!0,clickHandler:()=>({})},{label:t("addTags"),classIcon:"fas fa-hashtag",clickHandler:()=>z(Te,{entityType:"deal",entityIds:_.value}).show()},{label:t("removeTags"),classIcon:"fas fa-hashtag",clickHandler:()=>z(Ne,{entityType:"deal",entityIds:_.value}).show()},{label:t("close"),classIcon:"fas fa-flag-checkered",hide:!0,clickHandler:()=>({})},{label:t("delete"),classIcon:"fas fa-trash-alt text-red",clickHandler:()=>z(Pe,{ids:_.value,isBulkMode:!0}).show()}]);M(l,o=>{h.value[1].hide=o<2},{immediate:!0}),M(p,o=>{o?d.value="1":d.value="",(l.value===0||o)&&e(o)});function e(o){u.toggleChecked(o)}return(o,i)=>(a(),$("div",Js,[s("div",Gs,[b(He,{modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=y=>d.value=y),size:16,onChange:i[1]||(i[1]=y=>e(!!y))},{default:c(()=>[s("span",Xs,g(o.$t("selected")),1),s("span",Zs,g(v(l)),1)]),_:1},8,["modelValue"])]),s("div",et,[v(f)?(a(),k(Re,{key:0,items:h.value},{default:c(()=>[b(P,{width:"8rem"},{title:c(()=>[x(g(o.$t("actions")),1)]),_:1})]),_:1},8,["items"])):(a(),k(Ws,{key:1,class:"deals-header__edit-actions",items:h.value,space:"2"},null,8,["items"])),s("button",{type:"button",class:"button outlined gray small",onClick:i[2]||(i[2]=C(y=>e(!1),["prevent"]))},[st,s("span",tt,g(o.$t("cancel")),1)])])]))}});const G=m=>(j("data-v-c3b60b56"),m=m(),q(),m),lt={class:"filters-button"},nt={key:0,class:"tw-p-2"},ot=G(()=>s("i",{class:"fas fa-spinner wa-animation-spin"},null,-1)),it=[ot],rt=G(()=>s("i",{class:"fas fa-filter"},null,-1)),ct=[rt],ut={key:2,class:"icon size-8 rounded filters-button__has"},dt=G(()=>s("i",{class:"fas fa-circle text-red circle"},null,-1)),_t=[dt],pt=w({__name:"DealsFiltersControlButton",props:{modelValue:{type:Boolean},hasFilters:{type:Boolean},loading:{type:Boolean}},emits:["update:modelValue"],setup(m,{emit:r}){const t=m;return(u,l)=>(a(),$("span",lt,[t.loading?(a(),$("div",nt,it)):(a(),$("button",{key:1,class:R(["button circle blank !tw-shadow-none",{"filters-button--active":t.modelValue}]),onClick:l[0]||(l[0]=C(p=>r("update:modelValue",!t.modelValue),["prevent"]))},ct,2)),!t.loading&&t.hasFilters?(a(),$("span",ut,_t)):S("",!0)]))}});const ft=W(pt,[["__scopeId","data-v-c3b60b56"]]),se=w({__name:"ToggleListItem",props:{modelValue:{},value:{}},emits:["update:modelValue"],setup(m,{emit:r}){return(t,u)=>(a(),$("span",{class:R({selected:t.modelValue===t.value}),onClick:u[0]||(u[0]=l=>r("update:modelValue",t.value))},[ne(t.$slots,"default")],2))}}),mt=w({__name:"ToggleList",props:{size:{},rounded:{type:Boolean}},setup(m){const r=m;return(t,u)=>(a(),$("div",{class:R(["toggle",r.size,r.rounded?"rounded":""])},[ne(t.$slots,"default")],2))}}),vt={class:"deals-header"},ht={class:"deals-header__inner"},$t={key:0,class:"deals-header__heading--native"},kt={key:1,class:"deals-header__heading--web tw-flex tw-space-x-4 tw-items-center"},bt={class:"tw-mb-2"},gt=["title","onClick","onVnodeMounted"],yt=s("i",{class:"fas fa-plus"},null,-1),wt=[yt],Ct=s("i",{class:"fas fa-columns"},null,-1),St=s("i",{class:"fas fa-list-ul"},null,-1),Ft=w({__name:"DealsHeader",setup(m){const r=T(),{hasFilters:t,countChecked:u}=F(r),{currentView:l,isKanban:p}=F(oe()),_=J(),f=H(!1),d=_.currentRoute.value.path==="/deal/new/";function h(e){l.value!==e&&(l.value=e,_.push({name:he[e],query:_.currentRoute.value.query}).then(()=>r.changeTabView()))}return(e,n)=>(a(),$("div",vt,[v(u)?(a(),k(at,{key:0})):S("",!0),A(s("div",ht,[v(Y).webView?(a(),$("div",$t,[b(Le)])):(a(),$("div",kt,[s("div",bt,[s("h1",null,g(e.$t("Deals")),1)]),b(Ae,{component:ze,"component-props":{funnelId:v(r).filterParams.funnel,...d&&e.$route.query.contact?{contactId:e.$route.query.contact}:{},onAdded:v(Ee)}},{default:c(({open:o})=>[s("button",{title:e.$t("newDeal"),class:"circle",onClick:C(o,["prevent"]),onVnodeMounted:i=>d&&o()},wt,8,gt)]),_:1},8,["component-props"]),v(l)?(a(),k(mt,{key:0,rounded:""},{default:c(()=>[b(se,{"model-value":v(l),value:"kanban","onUpdate:modelValue":n[0]||(n[0]=o=>h(o))},{default:c(()=>[Ct]),_:1},8,["model-value"]),b(se,{"model-value":v(l),value:"list","onUpdate:modelValue":n[1]||(n[1]=o=>h(o))},{default:c(()=>[St]),_:1},8,["model-value"])]),_:1})):S("",!0)])),b(ft,{modelValue:f.value,"onUpdate:modelValue":n[2]||(n[2]=o=>f.value=o),class:"deals-header__filters-button tw-hidden","has-filters":v(t),loading:!v(r).filtersIsLoaded},null,8,["modelValue","has-filters","loading"]),s("div",{class:R(["deals-header__filters-container",{"deals-header__filters-container--hide":!f.value}])},[b(Us,{"has-filters":v(t),"hide-stages":v(p),"show-skeleton":!v(r).filtersIsLoaded,"is-kanban":v(p),onClear:v(r).clearFilters},null,8,["has-filters","hide-stages","show-skeleton","is-kanban","onClear"])],2)],512),[[K,!v(u)]])]))}});const Dt={class:"deals blank box contentbox"},la=w({__name:"DealsView",props:{routeName:{},routeQuery:{}},setup(m){const r=m,t=J(),u=oe(),l=T(),p=$e(),_=te();if(t.currentRoute.value.path!=="/deal/new/"&&(f(r.routeName,r.routeQuery),r.routeName!=="deals")){const e=h(r.routeQuery).filters();l.updateOrClearFilterParams(e);const n=h(r.routeQuery).sortList();p.updateSort(n)}M([()=>l.filterParams,()=>p.sort],([e,n])=>{d({...e,...n.sort===ee.sort&&n.asc===ee.asc?{}:n})},{immediate:!0,deep:!0}),ke((e,n)=>{e.name==="deals"&&n.meta.menuItemType==="deals"?setTimeout(()=>f(n.name,n.query,!0)):e.name!==n.name&&(u.changeRouteTab(e.name),l.$resetDeals())}),be(()=>{_.refetch()}),ge(Se).on(l.reinitView);function f(e,n,o){const i=o?t.replace:t.push,y=u.changeRouteTab(e);i({name:y,query:n})}function d(e){const n={};for(const[o,i]of Object.entries(e))Fe.includes(o)&&i!==null&&(n[o]=i);t.push({name:t.currentRoute.value.name&&t.currentRoute.value.name!=="deals"?t.currentRoute.value.name:u.lastRouteNameTab,query:n})}function h(e){const n=(y,D)=>{if(y=String(y),D!=null&&D.includes(y))return y;const E=Number(y);return isNaN(E)?null:E},o=y=>typeof y=="string"?y:null,i={};return{filters(){if(!Object.keys(e).length)return i;const y=o(e.funnel);y&&(i.funnel=n(y));const D=o(e.stage);D&&(i.stage=n(D,["won","lost"]));const E=o(e.tag);E&&(i.tag=n(E));const X=o(e.user_id);X&&(i.user_id=n(X));const Z=o(e.pinned_only);return Z&&(i.pinned_only=n(Z)),i},sortList(){if(!Object.keys(e).length)return i;const y=o(e.sort);y&&(i.sort=y);const D=o(e.asc);return D&&(i.asc=n(D)?1:0),i}}}return(e,n)=>{const o=ye("router-view");return a(),$("div",Dt,[b(Ft),b(o,null,{default:c(({Component:i})=>[b(we,{name:"fade",mode:"out-in"},{default:c(()=>[(a(),k(Ce(i)))]),_:2},1024)]),_:1})])}}});export{la as default};
