import{U as C}from"./UserPic-2094e1a0.js";import{d as D,a as _,z,P as B,aO as b,o as c,b as w,w as p,c as h,e as y,F as $,l as I,f as S,i as u,a8 as k,n as L,p as x,r as F,a3 as E,Q as U,M as N,N as A,t as K,k as M,A as R}from"./main-512a5cdd.js";import{M as O,_ as P}from"./MenuList-bac784e3.js";import{D as W}from"./DropDown-f7af334e.js";import{C as V}from"./CustomColumn-351ad915.js";const j=["placeholder","value"],Q=["onClick"],q={class:"tw-flex-auto tw-overflow-hidden"},G=["onClick"],H=u("i",{class:"fas fa-trash-alt gray"},null,-1),J=[H],T=D({__name:"InputWithDropDown",props:{items:{},value:{},textValue:{},isMultiple:{type:Boolean},placeholder:{},onEnter:{type:Function},onItemSelect:{type:Function}},emits:["input","update","focus"],setup(v,{emit:i}){const t=v,d=_(),l=_(!1),s=_(new Set(t.value)),r=z(()=>E([null,...t.items]));B(s,n=>{i("update",[...n])},{deep:!0}),b(d,()=>{l.value=!1});function m(n){i("input",n.target.value),l.value=!0}function f(n){i("focus",n.target.value),l.value=!0}function e(n,a){if(n){if(t.onItemSelect){t.onItemSelect(n),l.value=!1;return}t.isMultiple||s.value.clear(),s.value.add(n),l.value=!1,a&&a.target.blur()}else t.onEnter&&a&&a.target.value&&(t.onEnter(a.target.value),a.target.blur(),l.value=!1)}return(n,a)=>(c(),w(V,{space:"4"},{default:p(()=>[t.isMultiple||!s.value.size?(c(),h("div",{key:0,ref_key:"inputRef",ref:d,class:"tw-w-full"},[y(W,{open:l.value,"disable-click-outside":!0,"prevent-toggler":!0,"max-height":"400px"},{body:p(()=>[t.items.length?(c(),w(O,{key:0},{default:p(()=>[(c(!0),h($,null,I(t.items,(o,g)=>(c(),w(P,{key:g},{default:p(()=>[u("a",{class:L({"tw-bg-waBackground":r.value.index.value===g+1}),onClick:x(ae=>e(o),["prevent"])},[F(n.$slots,"item",{item:o})],10,Q)]),_:2},1024))),128))]),_:3})):S("",!0)]),default:p(()=>[u("input",{type:"text",placeholder:t.placeholder,value:t.textValue,class:"tw-w-full",onInput:m,onKeyup:a[0]||(a[0]=k(o=>{e(r.value.state.value,o)},["enter"])),onKeydown:[a[1]||(a[1]=k(x(o=>r.value.prev(),["prevent"]),["up"])),a[2]||(a[2]=k(x(o=>r.value.next(),["prevent"]),["down"]))],onFocus:f},null,40,j)]),_:3},8,["open"])],512)):S("",!0),y(V,{space:"2"},{default:p(()=>[(c(!0),h($,null,I(s.value,o=>(c(),h("div",{key:o.id,class:"tw-flex tw-items-center tw-space-x-2"},[u("div",q,[F(n.$slots,"listItem",{item:o})]),u("a",{onClick:g=>s.value.delete(o)},J,8,G)]))),128))]),_:3})]),_:3}))}}),X=U("users",()=>{const v=_([]),{data:i,isFetching:t,error:d,isFinished:l,execute:s}=N("crm.user.list").get().json();A(()=>{Array.isArray(i.value)&&(v.value=i.value)});function r(){l.value&&s()}return{users:v,isFetching:t,error:d,refetch:r}}),Y={class:"icon size-20"},Z=["title"],ee={class:"tw-flex tw-items-center tw-space-x-2"},te={class:"icon size-20"},se=["title"],ie=D({__name:"InputWithUsers",props:{modelValue:{},isMultiple:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(v,{emit:i}){const t=v,d=X(),{users:l}=K(d);d.refetch();const s=_([]);function r(m){s.value=m.length?l.value.filter(e=>e.name.toLowerCase().includes(m.toLowerCase())):l.value;const f=s.value.findIndex(e=>e.id===R.user.id);if(f>-1){const e=s.value.splice(f,1)[0];s.value.splice(0,0,e)}}return(m,f)=>(c(),w(T,{items:s.value,value:t.modelValue,"is-multiple":t.isMultiple,placeholder:m.$t("search"),onInput:r,onFocus:r,onUpdate:f[0]||(f[0]=e=>{i("update:modelValue",e)})},{item:p(({item:e})=>[u("div",Y,[y(C,{url:e.userpic,size:20},null,8,["url"])]),u("span",{class:"tw-truncate",title:e.name},M(e.name),9,Z)]),listItem:p(({item:e})=>[u("div",ee,[u("div",te,[y(C,{url:e.userpic,size:20},null,8,["url"])]),u("span",{class:"tw-truncate small",title:e.name},M(e.name),9,se)])]),_:1},8,["items","value","is-multiple","placeholder"]))}});export{ie as _,T as a};
