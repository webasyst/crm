import{d as y,a as n,M as x,z as F,P as S,Y as _,o as i,c as f,i as s,k as d,e as A,w as v,m as B,p as T,b as h,h as N,v as b,g as w,ag as E,ah as L,q as O,s as $,$ as M,_ as P}from"./main-ad3d4b2a.js";import{v as R}from"./index-f0757591.js";import{_ as V}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-55644d30.js";import Y from"./FormDealAdd-07de8d3e.js";import{a as z}from"./tags-66e0142b.js";import{S as j}from"./SkeletonList-22bbddc4.js";import{_ as q}from"./DealsListTable.vue_vue_type_style_index_0_lang-09148be3.js";import"./WaDialog-48ef549a.js";import"./InputWithPerformers.vue_vue_type_script_setup_true_lang-c5140a20.js";import"./MenuList-d27c7173.js";import"./DropDown-6640089d.js";import"./helpers-c0c14d27.js";import"./recentContacts-6dcec390.js";import"./FieldSelect-fbb8732d.js";import"./UserPic-e76d468d.js";import"./CustomColumn-d0d2dfb9.js";import"./index-38eb481c.js";import"./fields-00e92370.js";import"./FieldString-77b19497.js";import"./FieldCheckbox-ea76a60e.js";import"./dialog-55612c15.js";import"./dayjs-e01b34a2.js";import"./WaSpinner-8364792b.js";import"./funnels-5e77cb0b.js";import"./ButtonSubmit-66512fc6.js";import"./DealsItemAmount.vue_vue_type_style_index_0_lang-6d1612e4.js";import"./vTooltip-c8fe82a0.js";import"./ChipsList-007889bd.js";import"./currency-format-ea9c59e9.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-70395f49.js";import"./date-5bb5c85b.js";import"./EmptyList-a90c3660.js";const D=a=>(O("data-v-821c9240"),a=a(),$(),a),U={class:"form-deals-contact tw-p-4"},G=["onClick"],H=D(()=>s("span",{class:"icon tw-mr-1"},[s("i",{class:"fas fa-plus-circle"})],-1)),J={class:"tw-mt-3 tw-h-full"},K={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},Q=D(()=>s("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1)),W=[Q],l=20,X=y({__name:"FormDealsContact",props:{contactId:{}},setup(a){const p=a,C=["stage_id","name","states","create_datetime","amount","user_name"],e=n(null),r=n(0),o=n({contact_id:p.contactId,limit:l,offset:0}),{data:g,isFetching:I,execute:m}=x(F(()=>`crm.deal.list?${M.stringify(o.value)}`),{refetch:!0}).get().json();m(),S(g,t=>{t&&(t.params.offset>0?e.value=[...e.value||[],...t.data]:e.value=t.data,r.value=t.params.total_count,o.value.offset=t.params.offset)}),_(E).on(t=>{e.value&&z(t,e.value)}),_(L).on(()=>{u()});function k(){o.value.offset+l>=r.value||(o.value.offset+=l)}function u(){e.value=null,o.value.offset===0?m():o.value.offset=0}return(t,Z)=>(i(),f("div",U,[s("h3",null,d(t.$t("Deals")),1),A(V,{component:Y,"component-props":{contactId:p.contactId,disableNavigateToDeal:!0,onAdded:u}},{default:v(({open:c})=>[s("button",{class:"button",onClick:T(c,["prevent"])},[H,B(" "+d(t.$t("newDeal")),1)],8,G)]),_:1},8,["component-props"]),s("div",J,[e.value?(i(),h(q,{key:0,deals:e.value,"use-columns-ids":C,"navigate-route-name":"dealByContactFrame"},{lazy:v(()=>[N((i(),f("div",K,W)),[[b,e.value.length<r.value],[w(R),([{isIntersecting:c}])=>{c&&!w(I)&&k()}]])]),_:1},8,["deals"])):(i(),h(j,{key:1,"row-height":"100px"}))])]))}});const bt=P(X,[["__scopeId","data-v-821c9240"]]);export{bt as default};
