import{d as X,o as t,c as o,n as C,a as s,H as ae,h as x,M as P,l as U,ak as oe,am as le,Q as ne,U as ce,b as d,w as c,F as z,q as D,u,A as J,p as i,i as v,e as h,a9 as W,j as f,an as ie,B as re,s as ue,x as de,R as _e,_ as pe}from"./main-46836c41.js";import{U as q}from"./UserPic-951b6ea8.js";import{S as me}from"./SkeletonList-3dd02ff1.js";import{E as ve}from"./EmptyList-5f0d3ac0.js";import{_ as he}from"./ConfirmDialog.vue_vue_type_script_setup_true_lang-b631bdf0.js";import{f as ye}from"./imageUrlToBase64-bf4bcddf.js";import{d as G}from"./dayjs-a1477631.js";import{d as S}from"./downloadFile-02bf5e36.js";import{M as j,D as M,_ as g}from"./DropDown-2ad3ed01.js";import{D as H}from"./DropDownButton-49606824.js";import"./CustomColumn-c8c73188.js";import"./index-dbd22bf6.js";const we={key:0},ke=s("i",{class:"fas fa-file-pdf"},null,-1),xe=[ke],$e={key:1},be=s("i",{class:"fas fa-file-word"},null,-1),fe=[be],ge={key:2},Ce=s("i",{class:"fas fa-file-excel"},null,-1),Fe=[Ce],ze={key:3},Le=s("i",{class:"fas fa-file-powerpoint"},null,-1),Ee=[Le],Te={key:4},De=s("i",{class:"fas fa-file-csv"},null,-1),Ae=[De],Ie={key:5},Se=s("i",{class:"fas fa-file-archive"},null,-1),je=[Se],Me={key:6},Be=s("i",{class:"fas fa-file-code"},null,-1),Ne=[Be],Ve={key:7},Pe=s("i",{class:"fas fa-file-image"},null,-1),Ue=[Pe],qe={key:8},Ge=s("i",{class:"fas fa-file-video"},null,-1),He=[Ge],Ke={key:9},Oe=s("i",{class:"fas fa-file-audio"},null,-1),Qe=[Oe],Re={key:10},Ye=s("i",{class:"fas fa-file-alt"},null,-1),Je=[Ye],We=X({__name:"FileIcon",props:{ext:{},class:{}},setup($){const r=$;return(B,b)=>(t(),o("span",{class:C(r==null?void 0:r.class)},[r.ext==="pdf"?(t(),o("span",we,xe)):["doc","docx","odt"].includes(r.ext)?(t(),o("span",$e,fe)):r.ext==="xls"||r.ext==="xlsx"?(t(),o("span",ge,Fe)):r.ext==="ppt"||r.ext==="pptx"?(t(),o("span",ze,Ee)):r.ext==="csv"?(t(),o("span",Te,Ae)):["gz","zip","arj","rar","tar","7z","bz"].includes(r.ext)?(t(),o("span",Ie,je)):["htm","html","php","js","css","style","vue","cpp","java","kt","conf","sh"].includes(r.ext)?(t(),o("span",Me,Ne)):["bmp","tiff","gif","png","jpg","webp","jpeg"].includes(r.ext)?(t(),o("span",Ve,Ue)):["mp4","avi","mkv"].includes(r.ext)?(t(),o("span",qe,He)):["mp3","ogg"].includes(r.ext)?(t(),o("span",Ke,Qe)):(t(),o("span",Re,Je))],2))}}),y=$=>(ue("data-v-2b4410c7"),$=$(),de(),$),Xe={class:"article wider"},Ze={class:"article-body custom-pt-0"},es={class:"flexbox middle wrap space-16"},ss=["onClick"],ts={class:"tw-align-top"},as=["onClick"],os=["onClick"],ls=y(()=>s("hr",{class:"custom-mb-0"},null,-1)),ns=["onClick"],cs=["title"],is={key:1},rs=y(()=>s("i",{class:"fas fa-users"},null,-1)),us=[rs],ds=["onClick"],_s=y(()=>s("div",{class:"icon"},[s("i",{class:"fas fa-users"})],-1)),ps=["onClick"],ms={class:"icon"},vs=["disabled"],hs={key:0},ys=y(()=>s("i",{class:"fas fa-plus"},null,-1)),ws=[ys],ks={key:1,class:"spinner"},xs={key:0},$s={key:1,class:"tw-mt-0 tw-p-4"},bs={key:0},fs={key:0,class:"flexbox wrap space-16 js-wa-gallery"},gs=["onClick"],Cs={class:"align-center wide"},Fs=["href","data-preview","onClick"],zs=["src"],Ls={key:1,class:"largest"},Es={class:"details custom-pt-0"},Ts={class:"flexbox space-8 middle full-width"},Ds=["title"],As=["href","onClick"],Is={class:"text-ellipsis semibold opacity-90"},Ss={class:"black"},js=y(()=>s("a",{class:"tw-text-waText hover:tw-text-waText tw-opacity-50 custom-pl-12"},[s("i",{class:"fas fa-ellipsis-v"})],-1)),Ms={class:"box",style:{"overflow-wrap":"break-word"}},Bs=y(()=>s("hr",{class:"custom-mb-8"},null,-1)),Ns={key:0,class:"small flexbox space-8 custom-mb-4 custom-mx-12"},Vs=["title"],Ps={class:"small flexbox space-8 custom-mb-4 custom-mx-12"},Us=y(()=>s("div",{class:"icon size-16"},null,-1)),qs={class:"small"},Gs=["href","onClick"],Hs=y(()=>s("div",{class:"icon size-16"},[s("i",{class:"fas fa-file-download"})],-1)),Ks={class:"small"},Os=["onClick"],Qs=y(()=>s("div",{class:"icon size-16"},[s("i",{class:"fas fa-trash-alt"})],-1)),Rs={class:"small"},Ys={key:0,class:"small"},Js={class:"smaller flexbox full-width wrap space-16 custom-mb-8"},Ws={key:0},Xs={key:1},Zs={key:2},et=y(()=>s("div",{class:"icon size-80"},[s("i",{class:"fas fa-file"})],-1)),st=X({__name:"FilesTab",props:{entityType:{},entityId:{}},setup($){const r=$,B=`${r.entityType}_id`,{t:b}=ae(),p=x("ALL"),K=new Map([["ALL",b("allSources")],["FILE",b("fromFiles")],["MESSAGE",b("fromMessages")],["NOTE",b("fromNotes")]]),m=x(0),_=x(0),L=x([]),A=x(new Map),E=x(new Map),O=x([]),T=x(!1),w=P(`crm.file.list?${B}=${r.entityId}&thumb_size=256&preview_size=512`).get().json(),Z=U(()=>T.value),N=U(()=>L.value.filter(a=>(p.value==="ALL"||a.source_type===p.value)&&R(a,m.value)&&Y(a,_.value))),{open:Q,onChange:ee}=oe(),R=(a,n)=>{var e;return n===0||n===-1&&!(a!=null&&a.deal)||((e=a==null?void 0:a.deal)==null?void 0:e.id)===n},Y=(a,n)=>{var e;return n===0||((e=a==null?void 0:a.creator)==null?void 0:e.id)===n},k=(a,n=m.value,e=_.value)=>!!L.value.find(l=>(a==="ALL"||l.source_type===a)&&R(l,n)&&Y(l,e)),V=U(()=>A.value.get(m.value));le(()=>{window.document.documentElement.dispatchEvent(new Event("wa-gallery-load"))}),ne(w.data,()=>{Array.isArray(w.data.value)&&(L.value=w.data.value,A.value=L.value.reduce((a,n)=>!(n!=null&&n.deal)||a.has(n.deal.id)?a:a.set(n.deal.id,n.deal),new Map),E.value=L.value.reduce((a,n)=>!(n!=null&&n.creator)||a.has(n.creator.id)?a:a.set(n.creator.id,n.creator),new Map))}),ee(a=>{a&&se(Array.from(a))}),ce(ie).on(()=>{Q()});async function se(a){a&&(T.value=!0,await Promise.all(Array.from(a).map(async n=>{const e=await ye(n);if(e){const{error:l}=await P("crm.file.add").post({file:e,file_name:n.name,[B]:r.entityId});if(l.value)return Promise.reject(l.value)}})),await w.execute(),T.value=!1,window.document.documentElement.dispatchEvent(new CustomEvent("wa-gallery-load",{detail:{timeout:500}})))}async function te(a){const{show:n,hide:e}=_e(he,{message:b("confirmDeleteFile"),buttonText:b("delete"),onSubmit:async()=>{const{error:l}=await P(`crm.file.delete?id=${a}`).delete();l.value||(w.execute(),window.document.documentElement.dispatchEvent(new CustomEvent("wa-gallery-load",{detail:{timeout:500}}))),e()}});n()}return(a,n)=>(t(),o("div",Xe,[s("div",Ze,[s("div",{class:C(["tw-sticky tw-bg-waBlank tw-z-20 tw-p-4",{"files-tab__panel":r.entityType==="contact"}])},[s("div",es,[d(M,null,{body:c(({hide:e})=>[d(j,null,{default:c(()=>[(t(!0),o(z,null,D(u(K),([l,F])=>(t(),v(g,{key:l},{default:c(()=>[s("a",{onClick:h(I=>{k(l)&&(p.value=l,e())},["prevent"])},[s("span",{class:C({gray:!k(l)})},i(F),3)],8,ss)]),_:2},1024))),128))]),_:2},1024)]),default:c(()=>[d(H,{small:!0},{title:c(()=>[J(i(u(K).get(p.value)),1)]),_:1})]),_:1}),A.value.size>0?(t(),v(M,{key:0},{body:c(({hide:e})=>[d(j,null,{default:c(()=>[(t(),v(g,{key:0},{default:c(()=>[s("a",{onClick:h(l=>{m.value=0,e()},["prevent"])},[s("span",null,i(a.$t("allDeals")),1)],8,as)]),_:2},1024)),(t(),v(g,{key:-1},{default:c(()=>[s("a",{onClick:h(l=>{k(p.value,-1,_.value)&&(m.value=-1,e())},["prevent"])},[s("span",{class:C({gray:!k(p.value,-1,_.value)})},i(a.$t("withoutDeal")),3)],8,os)]),_:2},1024)),ls,(t(!0),o(z,null,D(A.value,([l,{name:F,stage:I}])=>(t(),v(g,{key:l},{default:c(()=>[s("a",{class:"!tw-items-start",onClick:h(tt=>{k(p.value,l,_.value)&&(m.value=l,e())},["prevent"])},[s("span",{class:"icon rounded",title:I.name,style:W({background:I.color})},null,12,cs),s("span",{class:C({gray:!k(p.value,l,_.value)})},i(F),3)],8,ns)]),_:2},1024))),128))]),_:2},1024)]),default:c(()=>[d(H,{small:!0},{title:c(()=>{var e;return[V.value?(t(),o("span",{key:0,class:"icon rounded tw-mr-1",style:W({background:V.value.stage.color})},null,4)):f("",!0),s("span",ts,i(m.value===0?a.$t("allDeals"):m.value===-1?a.$t("withoutDeal"):(e=V.value)==null?void 0:e.name),1)]}),_:1})]),_:1})):f("",!0),E.value.size>1?(t(),v(M,{key:1},{body:c(({hide:e})=>[d(j,null,{default:c(()=>[(t(),v(g,{key:0},{default:c(()=>[s("a",{onClick:h(l=>{_.value=0,e()},["prevent"])},[_s,s("span",null,i(a.$t("allAuthors")),1)],8,ds)]),_:2},1024)),(t(!0),o(z,null,D(E.value,([l,F])=>(t(),v(g,{key:l},{default:c(()=>[s("a",{onClick:h(I=>{k(p.value,m.value,l)&&(_.value=l,e())},["prevent"])},[s("div",ms,[d(q,{size:10,url:F.userpic},null,8,["url"])]),s("span",{class:C({gray:!k(p.value,m.value,l)})},i(F.name),3)],8,ps)]),_:2},1024))),128))]),_:2},1024)]),default:c(()=>[d(H,{small:!0},{icon:c(()=>{var e;return[_.value>0?(t(),v(q,{key:0,size:16,url:(e=E.value.get(_.value))==null?void 0:e.userpic},null,8,["url"])):(t(),o("span",is,us))]}),title:c(()=>{var e;return[J(i(_.value===0?a.$t("allAuthors"):(e=E.value.get(_.value))==null?void 0:e.name),1)]}),_:1})]),_:1})):f("",!0),["ALL","FILES"].includes(p.value)&&[0,-1].includes(m.value)?(t(),o("button",{key:2,class:"tw-flex-none circle nobutton",disabled:Z.value,onClick:n[0]||(n[0]=()=>{T.value||u(Q)()})},[T.value?(t(),o("div",ks)):(t(),o("span",hs,ws))],8,vs)):f("",!0)]),O.value.length?(t(),o("div",xs,[(t(!0),o(z,null,D(O.value,(e,l)=>(t(),o("div",{key:l},i(e),1))),128))])):f("",!0)],2),!N.value.length&&u(w).isFetching.value?(t(),v(me,{key:0,class:"tw-max-w-3xl tw-px-4"})):(t(),o("div",$s,[u(w).error.value?(t(),o("div",bs,i(u(w).error.value),1)):(t(),o(z,{key:1},[N.value.length?(t(),o("div",fs,[(t(!0),o(z,null,D(N.value,e=>(t(),o("figure",{key:e.id,class:"card"},[s("div",{class:"image flexbox middle full-width cursor-pointer",onClick:h(l=>!(e!=null&&e.thumb_url)&&u(S)(e.url,e.id,e.name),["prevent"])},[s("div",Cs,[s("a",{class:C({"js-wa-gallery-image":!!(e!=null&&e.thumb_url),"js-disable-router":!0}),href:e.url,"data-preview":e==null?void 0:e.preview_url,onClick:h(l=>!(e!=null&&e.thumb_url)&&u(S)(e.url,e.id,e.name),["prevent"])},[e!=null&&e.thumb_url&&!u(re).webView?(t(),o("img",{key:0,src:e.thumb_url},null,8,zs)):(t(),o("span",Ls,[d(We,{ext:e.ext,class:"large"},null,8,["ext"])]))],10,Fs)])],8,gs),s("div",Es,[s("div",Ts,[s("h5",{class:"small text-ellipsis wide custom-mt-16",title:e.name},[s("a",{class:"flexbox js-disable-router",href:e.url,style:{color:"var(--text-color)"},onClick:h(l=>u(S)(e.url,e.id,e.name),["prevent"])},[s("span",Is,i(e.name.replace(/\.[^/.]+$/,"")),1),s("span",Ss,"."+i(e.ext),1)],8,As)],8,Ds),d(M,{right:!0,"enable-correct-top":!0,width:"250px"},{body:c(({hide:l})=>[s("div",Ms,i(e.name),1),Bs,e.creator?(t(),o("div",Ns,[d(q,{size:16,url:e.creator.userpic},null,8,["url"]),s("span",{class:"small tw-truncate",title:e.creator.name},i(e.creator.name),9,Vs)])):f("",!0),s("div",Ps,[Us,s("div",qs,i(u(G)(e.create_datetime).format("LLL")),1)]),d(j,null,{default:c(()=>[d(g,null,{default:c(()=>[s("a",{class:"js-disable-router",href:e.url,onClick:h(()=>{u(S)(e.url,e.id,e.name),l()},["prevent"])},[Hs,s("span",Ks,i(a.$t("downloadFile")),1)],8,Gs),s("a",{onClick:h(()=>{te(e.id),l()},["prevent"])},[Qs,s("span",Rs,i(a.$t("deleteFile")),1)],8,Os)]),_:2},1024)]),_:2},1024)]),default:c(()=>[js]),_:2},1024)]),e!=null&&e.comment?(t(),o("p",Ys,i(e.comment),1)):f("",!0),s("div",Js,[e.size>1048576?(t(),o("span",Ws,i((e.size/1048576).toFixed(1))+" MB",1)):e.size>1024?(t(),o("span",Xs,i((e.size/1024).toFixed(1))+" KB",1)):(t(),o("span",Zs,i(e.size)+" B",1)),s("span",null,i(u(G)(e.create_datetime).format(u(G)(e.create_datetime).isToday()?"LT":"L")),1)])])]))),128))])):(t(),v(ve,{key:1,message:a.$t("notFoundFiles")},{default:c(()=>[et]),_:1},8,["message"]))],64))]))])]))}});const vt=pe(st,[["__scopeId","data-v-2b4410c7"]]);export{vt as default};
