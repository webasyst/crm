import{U as $}from"./UserPic-e76d468d.js";import{d as B,a as _,z as I,P as b,aO as L,o as c,b as w,w as p,c as h,e as y,F as S,l as V,f as F,i as u,J as E,a8 as x,n as N,p as k,r as M,a3 as U,Q as A,M as K,N as P,t as R,k as z,A as O}from"./main-ad3d4b2a.js";import{M as W,_ as j}from"./MenuList-d27c7173.js";import{D as J}from"./DropDown-6640089d.js";import{C as D}from"./CustomColumn-d0d2dfb9.js";const Q=["placeholder"],T=["onClick"],q={class:"tw-flex-auto tw-overflow-hidden"},G=["onClick"],H=u("i",{class:"fas fa-trash-alt gray"},null,-1),X=[H],Y=B({__name:"InputWithDropDown",props:{items:{},value:{},textValue:{},isMultiple:{type:Boolean},placeholder:{},onEnter:{type:Function},onItemSelect:{type:Function}},emits:["input","update","focus"],setup(v,{emit:i}){const e=v,d=_(),l=_(!1),s=_(new Set(e.value)),r=I(()=>U([null,...e.items])),m=I(()=>e.textValue?"value":"");b(s,n=>{i("update",[...n])},{deep:!0}),L(d,()=>{l.value=!1});function f(n){i("input",n.target.value),l.value=!0}function t(n){i("focus",n.target.value),l.value=!0}function C(n,a){if(n){if(e.onItemSelect){e.onItemSelect(n),l.value=!1;return}e.isMultiple||s.value.clear(),s.value.add(n),l.value=!1,a&&a.target.blur()}else e.onEnter&&a&&a.target.value&&(e.onEnter(a.target.value),a.target.blur(),l.value=!1)}return(n,a)=>(c(),w(D,{space:"4"},{default:p(()=>[e.isMultiple||!s.value.size?(c(),h("div",{key:0,ref_key:"inputRef",ref:d,class:"tw-w-full"},[y(J,{open:l.value,"disable-click-outside":!0,"prevent-toggler":!0,"max-height":"350px"},{body:p(()=>[e.items.length?(c(),w(W,{key:0},{default:p(()=>[(c(!0),h(S,null,V(e.items,(o,g)=>(c(),w(j,{key:g},{default:p(()=>[u("a",{class:N({"tw-bg-waBackground":r.value.index.value===g+1}),onClick:k(ne=>C(o),["prevent"])},[M(n.$slots,"item",{item:o})],10,T)]),_:2},1024))),128))]),_:3})):F("",!0)]),default:p(()=>[u("input",E({type:"text",placeholder:e.placeholder,[m.value||""]:e.textValue,class:"tw-w-full",onInput:f,onKeyup:a[0]||(a[0]=x(o=>{C(r.value.state.value,o)},["enter"])),onKeydown:[a[1]||(a[1]=x(k(o=>r.value.prev(),["prevent"]),["up"])),a[2]||(a[2]=x(k(o=>r.value.next(),["prevent"]),["down"]))],onFocus:t}),null,16,Q)]),_:3},8,["open"])],512)):F("",!0),y(D,{space:"2"},{default:p(()=>[(c(!0),h(S,null,V(s.value,o=>(c(),h("div",{key:o.id,class:"tw-flex tw-items-center tw-space-x-2"},[u("div",q,[M(n.$slots,"listItem",{item:o})]),u("a",{onClick:g=>s.value.delete(o)},X,8,G)]))),128))]),_:3})]),_:3}))}}),Z=A("users",()=>{const v=_([]),{data:i,isFetching:e,error:d,isFinished:l,execute:s}=K("crm.user.list").get().json();P(()=>{Array.isArray(i.value)&&(v.value=i.value)});function r(){l.value&&s()}return{users:v,isFetching:e,error:d,refetch:r}}),ee={class:"icon size-20"},te=["title"],se={class:"tw-flex tw-items-center tw-space-x-2"},ae={class:"icon size-20"},le=["title"],pe=B({__name:"InputWithUsers",props:{modelValue:{},isMultiple:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(v,{emit:i}){const e=v,d=Z(),{users:l}=R(d);d.refetch();const s=_([]);function r(m){s.value=m.length?l.value.filter(t=>t.name.toLowerCase().includes(m.toLowerCase())):l.value;const f=s.value.findIndex(t=>t.id===O.user.id);if(f>-1){const t=s.value.splice(f,1)[0];s.value.splice(0,0,t)}}return(m,f)=>(c(),w(Y,{items:s.value,value:e.modelValue,"is-multiple":e.isMultiple,placeholder:m.$t("search"),onInput:r,onFocus:r,onUpdate:f[0]||(f[0]=t=>{i("update:modelValue",t)})},{item:p(({item:t})=>[u("div",ee,[y($,{url:t.userpic,size:20},null,8,["url"])]),u("span",{class:"tw-truncate",title:t.name},z(t.name),9,te)]),listItem:p(({item:t})=>[u("div",se,[u("div",ae,[y($,{url:t.userpic,size:20},null,8,["url"])]),u("span",{class:"tw-truncate small",title:t.name},z(t.name),9,le)])]),_:1},8,["items","value","is-multiple","placeholder"]))}});export{pe as _,Y as a};
