import{d as L,o as l,c as y,a as c,r as Q,k as q,v as G,i as g,j as M,n as A,_ as P,H as X,l as D,F as Y,q as Z,w as h,A as J,p as ee,az as se,aG as te,t as w,ag as oe,h as F,B as H,I as ae,b as B,u as e,Z as ne,e as ie}from"./main-d7f03521.js";import{_ as le,a as re,b as ce}from"./DealsListTable.vue_vue_type_style_index_0_lang-e29cdb4c.js";import{U as E}from"./UserPic-c11efadd.js";import{u as de}from"./dealFields-1f50ecbd.js";import{c as ue}from"./index-884c82be.js";import{h as me,u as _e}from"./longTouch-2a1e2d51.js";import{_ as pe}from"./LazyLoadingWithProgress.vue_vue_type_script_setup_true_lang-37f08611.js";import{E as fe}from"./EmptyList-ca1e10b8.js";import"./DealsItemResponsible.vue_vue_type_style_index_0_lang-e6f98522.js";import"./vTooltip-95186f83.js";import"./ChipsList-ee14164a.js";import"./dayjs-8b9f8f59.js";import"./currency-format-a8df1195.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-d7adf9ef.js";import"./date-fb01f223.js";import"./SkeletonList-27785815.js";import"./index-dc17eb5d.js";import"./CustomColumn-83646d88.js";const he=["data-id"],ge={class:"tw-truncate"},ve={key:0,class:"deal-head__icon"},be=L({__name:"DealsListHeaderCell",props:{id:{},sortable:{type:Boolean},sort:{}},emits:["toggleSort","changeWidth"],setup(v,{emit:u}){const o=v;return(s,m)=>{var d,i;return l(),y("div",{"data-id":s.id,class:"deal-list__head"},[c("div",{class:A(["deal-head__inner",[o.sortable?"tw-cursor-pointer":"tw-cursor-default"]]),onClick:m[0]||(m[0]=t=>o.sortable&&u("toggleSort",o.id))},[c("span",ge,[Q(s.$slots,"default",{},void 0,!0)]),o.sortable?q((l(),y("span",ve,[((d=o.sort)==null?void 0:d.asc)===0?(l(),g(E,{key:0,size:14,"fa-icon":"sort-down"})):(l(),g(E,{key:1,size:14,"fa-icon":"sort-up"}))],512)),[[G,((i=o.sort)==null?void 0:i.sort)===s.id]]):M("",!0)],2)],8,he)}}});const Se=P(be,[["__scopeId","data-v-abce3d16"]]),ye={class:"deals-list__header"},Ce=L({__name:"DealsListHeaders",props:{useColumnsIds:{},customColumns:{},sort:{}},emits:["toggleSort","changeWidth"],setup(v,{emit:u}){const o=v,{t:s}=X(),m=[{id:"checkbox",name:"",sortable:!1},{id:"stage_id",name:s("stage"),sortable:!0},{id:"name",name:s("deal"),sortable:!0},{id:"states",name:"",sortable:!1},{id:"create_datetime",name:s("createDatetime"),sortable:!0},{id:"amount",name:s("amount"),sortable:!0},{id:"user",name:s("responsible"),sortKey:"user_name",sortable:!0},{id:"tags",name:s("tags"),sortable:!1},{id:"last_action",name:s("lastAction"),sortable:!0},{id:"id",name:"ID",sortable:!1}],d=D(()=>{const i=o.useColumnsIds.reduce((t,a,_)=>(t[a]=_,t),{});return m.concat(o.customColumns||[]).filter(t=>i[t.id]!==void 0).sort((t,a)=>i[t.id]-i[a.id])});return(i,t)=>(l(),y("div",ye,[(l(!0),y(Y,null,Z(d.value,a=>(l(),g(Se,{id:a.sortKey??a.id,key:a.sortKey??a.id,sortable:!!a.sortable,sort:o.sort,onToggleSort:t[0]||(t[0]=_=>u("toggleSort",_)),onChangeWidth:t[1]||(t[1]=_=>u("changeWidth",_))},{default:h(()=>[J(ee(a.name),1)]),_:2},1032,["id","sortable","sort"]))),128))]))}});const ke=P(Ce,[["__scopeId","data-v-2c653527"]]),we=["onClick"],De=["checked"],Le=c("span",{class:"!tw-h-[1rem] !tw-w-[1rem]"},[c("span",{class:"icon"},[c("i",{class:"fas fa-check"})])],-1),$e={class:"icon size-80"},je=L({__name:"DealsList",setup(v){const u=["checkbox","stage_id","name","states","create_datetime"],o=u.concat(["amount","user"]),s=se(),m=te(),{bulkSelectToggle:d}=m,{deals:i,isFetching:t,isRefreshPage:a,fetchNextPage:_,previousFetchParams:b,bulkSelectIds:C}=w(m),{fields:V}=w(de()),{isFetching:$,funnels:I,selectedFunnel:z}=w(oe()),T=F(!1),k=D(()=>{var r;if(!((r=H.rights)!=null&&r.is_admin)||$.value)return T.value;const p=Object.values(s.filterParams).filter(S=>S!==void 0);return I.value.length===1&&(p.length===0||p.length===1&&p[0]===I.value[0].id)}),{onTouchstart:O,onTouchend:N}=_e(),K=H.webView?F(!0):ae(ue),U=D(()=>K.value?o:u.concat(s.fields));return(p,r)=>{var S;return l(),g(le,{deals:e(i),"use-columns-ids":U.value,"custom-columns-ids":e(s).fields,"is-first-fetching":!((S=e(b))!=null&&S.offset),"is-fetching":e(a)||e($),class:"tw-mt-4 mobile:-tw-ml-2 mobile:-tw-mr-2"},{headers:h(({useColumnsIds:n})=>[B(ke,{"use-columns-ids":n,"custom-columns":e(V),sort:e(s).sort,onToggleSort:e(s).toggleSort},null,8,["use-columns-ids","custom-columns","sort","onToggleSort"])]),listItem:h(({deal:n,useColumnsIds:R,isMobile:x,isTile:W,navigate:j})=>[(l(),g(ne(x||W?re:ce),{deal:n,"is-mobile":x,"use-columns-ids":R,"is-selected":e(C).includes(n.id),onClick:f=>{e(C).length?e(d)(n.id,f.shiftKey):j()},onTouchstart:f=>e(O)(f,()=>e(d)(n.id,!1)),onTouchend:e(N),onTouchmove:e(N),onContextmenu:r[0]||(r[0]=f=>e(me)()&&f.preventDefault())},{checkbox:h(()=>[c("span",{class:"wa-checkbox tw-mr-2",onClick:ie(f=>e(d)(n.id,f.shiftKey),["stop"])},[c("input",{type:"checkbox",checked:e(C).includes(n.id)},null,8,De),Le],8,we)]),_:2},1064,["deal","is-mobile","use-columns-ids","is-selected","onClick","onTouchstart","onTouchend","onTouchmove"]))]),lazy:h(()=>[e(b)?(l(),g(pe,{key:0,"entity-type":"deals","count-loaded":e(i).length,"limit-load":e(b).limit,total:e(b).total_count,class:"tw-my-4",onVIntersectionObserver:r[1]||(r[1]=()=>{e(t)||e(_)()})},null,8,["count-loaded","limit-load","total"])):M("",!0)]),emptyList:h(()=>[B(fe,{title:k.value?p.$t("soonManyProfitableDeals"):void 0,message:k.value?p.$t("infoHowAddDeal"):p.$t("noDeals"),"notice-id":k.value?"deals/infoHowAddDeal":void 0,onCloseNotice:r[2]||(r[2]=n=>T.value=!0)},{default:h(()=>{var n;return[c("div",$e,[c("i",{class:A(((n=e(z))==null?void 0:n.icon)||"fas fa-briefcase")},null,2)])]}),_:1},8,["title","message","notice-id"])]),_:1},8,["deals","use-columns-ids","custom-columns-ids","is-first-fetching","is-fetching"])}}});export{je as default};
