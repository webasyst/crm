import{$ as X,a as w,X as L,N as H,d as M,t as q,o as f,b as V,w as u,e as y,c as S,l as G,g as x,F as J,i as e,k as c,p as F,A as P,m as U,h as B,v as D,S as K,M as O,ab as Q,n as W,f as Y,W as Z,B as z,a2 as ee}from"./main-e63d6b61.js";import{C as te}from"./fields-d5743e8f.js";import{U as I}from"./UserPic-e63dca94.js";import{M as ae,D as oe,_ as le}from"./DropDown-b752b133.js";import{_ as se}from"./InputWithUsers.vue_vue_type_script_setup_true_lang-32066fbd.js";import{C as j}from"./CustomColumn-72664405.js";import{u as ne,_ as ie}from"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-bbb2cba4.js";const ce=X("vaults",()=>{const b=w([]),{data:v,isFetching:a,error:p,isFinished:d,execute:o}=L("crm.vault.list").get().json();H(()=>{Array.isArray(v.value)&&(b.value=v.value)});function s(){d.value&&o()}return{vaults:b,isFetching:a,error:p,refetch:s}}),re=["disabled"],ue={key:0,class:"tw-flex tw-items-center tw-space-x-2"},de=["title"],me=e("div",null,[e("i",{class:"fas fa-caret-down"})],-1),fe={key:1},ve=["onClick"],pe=["title"],we=M({__name:"SelectWithVaults",props:{modelValue:{}},emits:["update:modelValue"],setup(b,{emit:v}){const a=b,p=ce(),{vaults:d,isFetching:o,error:s}=q(p);return p.refetch(),a.modelValue||H(()=>{Array.isArray(d.value)&&v("update:modelValue",d.value[0])}),(C,h)=>(f(),V(oe,{disabled:!!(x(o)||x(s))},{body:u(({hide:k})=>[y(ae,null,{default:u(()=>[(f(!0),S(J,null,G(x(d),i=>(f(),V(le,{key:i.id},{default:u(()=>[e("a",{onClick:F(()=>{v("update:modelValue",i),k()},["prevent"])},[y(I,{size:20,"fa-icon":"circle","icon-color":i.color},null,8,["icon-color"]),e("span",{class:"tw-truncate",title:i.name},c(i.name),9,pe)],8,ve)]),_:2},1024))),128))]),_:2},1024)]),default:u(()=>[e("button",{class:"button light-gray",disabled:x(o)},[a.modelValue?(f(),S("div",ue,[(f(),V(I,{key:a.modelValue.color,size:20,"fa-icon":"circle","icon-color":a.modelValue.color},null,8,["icon-color"])),e("span",{class:"tw-truncate",title:a.modelValue.name},c(a.modelValue.name),9,de),me])):(f(),S("div",fe," error "))],8,re)]),_:1},8,["disabled"]))}}),_e={class:"wa-radio"},be=["checked"],he=e("span",null,null,-1),ke={class:"wa-radio"},$e=["checked"],ye=e("span",null,null,-1),Ce={class:"wa-radio"},Ve=["checked"],ge=e("span",null,null,-1),Se={class:"tw-ml-6 tw-mt-4"},E=M({__name:"FormContactUpdateScope",props:{contact:{}},setup(b,{expose:v}){var k,i,g,_;const a=b,p=w((k=a.contact)==null?void 0:k.vault),d=w(((i=a.contact)==null?void 0:i.owners)||[]),o=w((g=a.contact)!=null&&g.vault?"vault":(_=a.contact)!=null&&_.owners?"owners":"all"),s=P(()=>{var m;return o.value==="owners"?{owner_id:d.value.map(n=>n.id)}:o.value==="vault"?{vault_id:(m=p.value)==null?void 0:m.id}:{vault_id:0}}),{modified:C}=ne(s);v({modified:C,submit:h});function h(m){return L(`crm.contact.access.update?id=${m}`).post(s.value)}return(m,n)=>(f(),V(j,{space:"4"},{default:u(()=>[e("div",null,c(m.$t("scopeMessage")),1),y(j,{space:"2"},{default:u(()=>[e("div",null,[e("label",{onClick:n[0]||(n[0]=t=>o.value="all")},[e("span",_e,[e("input",{type:"radio",checked:o.value==="all"},null,8,be),he]),U(" "+c(m.$t("allUsers")),1)])]),e("div",null,[e("label",{class:"tw-flex tw-flex-col tw-space-y-2 md:tw-space-y-0 md:tw-flex-row md:tw-space-x-2 md:tw-items-center",onClick:n[2]||(n[2]=t=>o.value="vault")},[e("div",null,[e("span",ke,[e("input",{type:"radio",checked:o.value==="vault"},null,8,$e),ye]),U(" "+c(m.$t("onlyUsersWithVault")),1)]),y(we,{modelValue:p.value,"onUpdate:modelValue":n[1]||(n[1]=t=>p.value=t)},null,8,["modelValue"])])]),e("div",null,[e("label",{onClick:n[3]||(n[3]=t=>o.value="owners")},[e("span",Ce,[e("input",{type:"radio",checked:o.value==="owners"},null,8,Ve),ge]),U(" "+c(m.$t("onlyUsers")),1)]),B(e("div",Se,[y(se,{modelValue:d.value,"onUpdate:modelValue":n[4]||(n[4]=t=>d.value=t)},null,8,["modelValue"])],512),[[D,o.value==="owners"]])])]),_:1})]),_:1}))}}),Ue=["disabled","onClick"],xe={class:"text-red"},Fe={key:0,class:"tabs bordered-bottom tw-sticky tw-left-0 tw-top-0 tw-bg-waBlank tw-z-10 !tw-mb-4"},Be=e("div",{class:"hr tw-mx-0 tw-mt-4 tw-mb-8"},null,-1),De={key:2},Ie=M({__name:"FormContactUpdate",props:{contact:{default:void 0},initialTab:{default:"info"}},emits:["close"],setup(b,{emit:v}){const a=b,p=K(),d=O(),o=!!a.contact,s=w(a.initialTab),C=w(null),h=w(null),k=w(null),i=w(!1),g=P(()=>{var t,l;return i.value||!((t=C.value)!=null&&t.modified||o&&((l=h.value)!=null&&l.modified))}),_=w("");async function m(){var l,$,R,A,N,T;i.value=!0,_.value="";let t;if((l=C.value)!=null&&l.modified){const r=await(($=C.value)==null?void 0:$.submit());if((R=r==null?void 0:r.response.value)!=null&&R.ok)t=r.data.value;else{s.value="info",i.value=!1,_.value=r==null?void 0:r.error.value;return}}if((A=h.value)!=null&&A.modified&&!_.value){const r=await((T=h.value)==null?void 0:T.submit(t||((N=a.contact)==null?void 0:N.id)));if(r!=null&&r.error.value){i.value=!1,_.value=r.error.value;return}}_.value||(t?p.push({name:"contact",params:{id:t},...z.webView?{replace:!0}:{}}):z.webView?ee.emit("spa:navigateBack"):d.refetch()),v("close")}const n=()=>{var t,l;(t=k.value)!=null&&t.toggle()&&((l=k.value)==null?void 0:l.$el).scrollIntoView({behavior:"smooth"})};return(t,l)=>(f(),V(Z,{"vertical-stretch":!0,"use-cancel-as-button-label":!0,onClose:l[2]||(l[2]=$=>v("close"))},Q({submit:u(()=>[e("button",{class:"button",disabled:g.value,onClick:F(m,["prevent"])},c(t.$t("save")),9,Ue)]),error:u(()=>[e("span",xe,c(_.value),1)]),default:u(()=>[e("div",null,[o?(f(),S("ul",Fe,[e("li",{class:W({selected:s.value==="info"})},[e("a",{onClick:l[0]||(l[0]=F($=>s.value="info",["prevent"]))},c(t.$t("contactData")),1)],2),e("li",{class:W({selected:s.value==="scope","tw-pointer-events-none tw-opacity-50":!o&&g.value})},[e("a",{onClick:l[1]||(l[1]=F($=>s.value="scope",["prevent"]))},c(t.$t("scope")),1)],2)])):(f(),V(te,{key:1,ref_key:"collapsibleContainerRef",ref:k,"fallback-on-show":"","hide-toggler":""},{default:u(()=>[y(E,{ref_key:"formContactUpdateScopeRef",ref:h,contact:a.contact},null,8,["contact"]),Be]),_:1},512)),B(e("div",null,[y(ie,{ref_key:"formContactUpdateInfoRef",ref:C,contact:a.contact},null,8,["contact"])],512),[[D,s.value==="info"]]),o?B((f(),S("div",De,[y(E,{ref_key:"formContactUpdateScopeRef",ref:h,contact:a.contact},null,8,["contact"])],512)),[[D,s.value==="scope"]]):Y("",!0)])]),_:2},[o?{name:"header",fn:u(()=>{var $;return[U(c(`${t.$t("editContact")} ${($=a.contact)==null?void 0:$.main.name}`),1)]}),key:"0"}:{name:"headerWrapper",fn:u(()=>[e("div",{class:"tw-flex tw-justify-between"},[e("h1",{class:"tw-m-0"},c(t.$t("addContact")),1),e("a",{class:"small underline gray tw-mt-2.5 tw-mr-16 hover:tw-text-gray-400",onClick:n},[e("i",{class:"fas fa-low-vision"}),U(" "+c(t.$t("limitVisibility")),1)])])]),key:"1"}]),1024))}});export{Ie as _,ce as u};
