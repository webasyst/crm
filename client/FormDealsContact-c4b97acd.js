import{d as y,a as n,J as x,z as F,W as S,N as A,X as _,ae as B,af as N,o as i,c as f,i as s,k as d,e as T,w as v,m as b,p as E,b as h,h as L,v as O,g as w,q as $,s as M,_ as P}from"./main-ec0df6a4.js";import{v as R}from"./index-8d873219.js";import{_ as V}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-e3cb498b.js";import z from"./FormDealAdd-d701f7a5.js";import{a as Y}from"./tags-11dad524.js";import{S as j}from"./SkeletonList-192ed29f.js";import{_ as q}from"./DealsListTable.vue_vue_type_style_index_0_lang-3e54e011.js";import"./WaDialog-c7c19903.js";import"./InputWithPerformers.vue_vue_type_script_setup_true_lang-3cf71b4b.js";import"./MenuList-466c4134.js";import"./DropDown-5d25a522.js";import"./helpers-a2ed4cd9.js";import"./recentContacts-b91545dc.js";import"./FieldSelect-df2e3574.js";import"./UserPic-87c13a4a.js";import"./CustomColumn-959e6ffe.js";import"./index-4793d891.js";import"./fields-5ca407fb.js";import"./FieldString-0827de0f.js";import"./FieldCheckbox-be3e2148.js";import"./dialog-efb0af25.js";import"./dayjs-44a66bd3.js";import"./WaSpinner-13137cd2.js";import"./ButtonSubmit-edad645b.js";import"./DealsItemAmount.vue_vue_type_style_index_0_lang-d3817178.js";import"./vTooltip-c8fe82a0.js";import"./ChipsList-64240846.js";import"./currency-format-0c135c5b.js";import"./ContactsListItemAction.vue_vue_type_script_setup_true_lang-37a8a184.js";import"./date-8ac6c57c.js";import"./EmptyList-9d13a159.js";const D=a=>($("data-v-821c9240"),a=a(),M(),a),J={class:"form-deals-contact tw-p-4"},U=["onClick"],W=D(()=>s("span",{class:"icon tw-mr-1"},[s("i",{class:"fas fa-plus-circle"})],-1)),X={class:"tw-mt-3 tw-h-full"},G={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},H=D(()=>s("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1)),K=[H],l=20,Q=y({__name:"FormDealsContact",props:{contactId:{}},setup(a){const p=a,C=["stage_id","name","states","create_datetime","amount","user_name"],e=n(null),r=n(0),o=n({contact_id:p.contactId,limit:l,offset:0}),{data:I,isFetching:g,execute:m}=x(F(()=>`crm.deal.list?${S.stringify(o.value)}`),{refetch:!0}).get().json();m(),A(I,t=>{t&&(t.params.offset>0?e.value=[...e.value||[],...t.data]:e.value=t.data,r.value=t.params.total_count,o.value.offset=t.params.offset)}),_(B).on(t=>{e.value&&Y(t,e.value)}),_(N).on(()=>{u()});function k(){o.value.offset+l>=r.value||(o.value.offset+=l)}function u(){e.value=null,o.value.offset===0?m():o.value.offset=0}return(t,Z)=>(i(),f("div",J,[s("h3",null,d(t.$t("Deals")),1),T(V,{component:z,"component-props":{contactId:p.contactId,disableNavigateToDeal:!0,onAdded:u}},{default:v(({open:c})=>[s("button",{class:"button",onClick:E(c,["prevent"])},[W,b(" "+d(t.$t("newDeal")),1)],8,U)]),_:1},8,["component-props"]),s("div",X,[e.value?(i(),h(q,{key:0,deals:e.value,"use-columns-ids":C,"navigate-route-name":"dealByContactFrame"},{lazy:v(()=>[L((i(),f("div",G,K)),[[O,e.value.length<r.value],[w(R),([{isIntersecting:c}])=>{c&&!w(g)&&k()}]])]),_:1},8,["deals"])):(i(),h(j,{key:1,"row-height":"100px"}))])]))}});const Tt=P(Q,[["__scopeId","data-v-821c9240"]]);export{Tt as default};
