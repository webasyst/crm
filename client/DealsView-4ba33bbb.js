import{d as w,t as D,z as B,o as l,b as m,w as c,e as h,m as R,k,i as s,p as y,f as S,c as g,l as N,g as p,F as I,n as L,B as Y,$ as ae,ai as le,N as E,h as Q,v as U,q as X,s as G,_ as J,a as z,A as Z,E as M,Q as ne,G as W,r as ee,aj as oe,X as ie,ak as re,j as ce,al as ue,D as de}from"./main-ec0df6a4.js";import{u as _e,c as x,d as se,T as pe,e as fe,L as K,Q as me}from"./tags-11dad524.js";import{U as F}from"./UserPic-87c13a4a.js";import{M as A,_ as V}from"./MenuList-466c4134.js";import{D as T}from"./InputWithPerformers.vue_vue_type_script_setup_true_lang-3cf71b4b.js";import{D as H}from"./DropDown-5d25a522.js";import{C as ve,a as he}from"./ChipsList-64240846.js";import{u as te}from"./helpers-a2ed4cd9.js";import{Q as be}from"./index-4793d891.js";import{D as ke}from"./DropdownModal-0f31f39b.js";import{W as ge}from"./WaSpinner-13137cd2.js";import{W as $e}from"./WaDialog-c7c19903.js";import{_ as ye}from"./FormAddTag.vue_vue_type_script_setup_true_lang-d09f746e.js";import{F as we}from"./FieldCheckbox-be3e2148.js";import{e as Ce}from"./emit-727b9eb7.js";import{_ as Se}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-e3cb498b.js";import De from"./FormDealAdd-d701f7a5.js";import{_ as Fe}from"./DealNavigateBack.vue_vue_type_script_setup_true_lang-94fb821d.js";import"./recentContacts-b91545dc.js";import"./FieldSelect-df2e3574.js";import"./index-8d873219.js";import"./CustomColumn-959e6ffe.js";import"./DropdownAddTags.vue_vue_type_script_setup_true_lang-87b6a8e2.js";import"./FieldString-0827de0f.js";import"./fields-5ca407fb.js";import"./dialog-efb0af25.js";import"./dayjs-44a66bd3.js";import"./ButtonSubmit-edad645b.js";const Ie=["onClick"],Ve={class:"tw-p-2"},Be=["onClick"],Re=s("i",{class:"fas fa-hashtag"},null,-1),Te={class:"tw-flex-auto tw-truncate"},Ne={class:"count tw-mt-0.5"},Le=w({__name:"DropdownTags",setup(v){const u=_e(),{tags:t}=D(u),_=x(),{filterParams:n,firstDeal:f}=D(_),b=B(()=>{var $,d;if(typeof n.value.tag=="number"){const i=t.value.find(e=>e.id===n.value.tag);return!i&&((d=($=f.value)==null?void 0:$.tags)!=null&&d.length)?f.value.tags.find(e=>e.id===n.value.tag):i}});return($,d)=>(l(),m(H,{width:"270px"},{default:c(()=>[h(T,{width:"9rem"},{icon:c(()=>[h(F,{size:14,"fa-icon":"hashtag"})]),title:c(()=>[R(k(b.value?b.value.name:$.$t("Tags")),1)]),_:1})]),body:c(({hide:i})=>[b.value?(l(),m(A,{key:0},{default:c(()=>[h(V,null,{default:c(()=>[s("a",{onClick:y(e=>{p(_).deleteFilterParam("tag"),i()},["prevent"])},[s("span",null,k($.$t("showAll")),1)],8,Ie)]),_:2},1024)]),_:2},1024)):S("",!0),s("div",Ve,[h(ve,null,{default:c(()=>[(l(!0),g(I,null,N(p(t),e=>{var a;return l(),m(he,{key:e.id,class:L(["small",{selected:((a=b.value)==null?void 0:a.id)===e.id}])},{default:c(()=>[s("a",{onClick:y(o=>{p(_).updateFilterParams({tag:e.id}),i()},["prevent"])},[Re,s("span",Te,k(e.name),1),s("span",Ne,k(e.count),1)],8,Be)]),_:2},1032,["class"])}),128))]),_:2},1024)])]),_:1}))}}),xe=["onClick"],Pe=["onClick"],Ee={class:"icon small"},ze={class:"count"},Ae=s("hr",{class:"tw-m-0"},null,-1),He=["onClick"],Qe={class:"icon small"},Ue=w({__name:"DropdownStages",setup(v){const{t:u}=Y(),{selectedFunnel:t}=D(te()),_=x(),{filterParams:n,firstDeal:f}=D(_),b=B(()=>{var e;return t.value&&((e=t.value.stages)!=null&&e.length)?t.value.stages:[]}),$=B(()=>b.value.length),d=B(()=>{var e,a;return[{id:"won",name:u("wons"),color:((e=t.value)==null?void 0:e.color)||"",icon:"flag-checkered"},{id:"lost",name:u("losts"),color:((a=t.value)==null?void 0:a.color)||"",icon:"ban"}]}),i=B(()=>{var e,a,o;switch(typeof((e=n.value)==null?void 0:e.stage)){case"number":if($.value)return b.value.find(r=>r.id===n.value.stage);if((a=f.value)!=null&&a.stage)return{...(o=f.value)==null?void 0:o.stage,icon:null};break;case"string":return d.value.find(r=>r.id===n.value.stage)}});return(e,a)=>(l(),m(H,{disabled:!$.value},ae({default:c(()=>[h(T,{disabled:!$.value},{icon:c(()=>[i.value?(l(),g(I,{key:0},[i.value.icon?(l(),m(F,{key:i.value.color,size:10,"fa-icon":i.value.icon,"icon-color":i.value.color},null,8,["fa-icon","icon-color"])):(l(),m(F,{key:i.value.id,size:10,"disable-rounded":"","bg-color":i.value.color},null,8,["bg-color"]))],64)):S("",!0)]),title:c(()=>[R(k(i.value?i.value.name:e.$t("allStages")),1)]),_:1},8,["disabled"])]),_:2},[$.value?{name:"body",fn:c(({hide:o})=>[h(A,null,{default:c(()=>[(l(),m(V,{key:"all"},{default:c(()=>[s("a",{onClick:y(r=>{p(_).deleteFilterParam("stage"),o()},["prevent"])},[s("span",null,k(e.$t("allStages")),1)],8,xe)]),_:2},1024)),(l(!0),g(I,null,N(b.value,r=>(l(),m(V,{key:r.id},{default:c(()=>[s("a",{onClick:y(C=>{p(_).updateFilterParams({stage:r.id}),o()},["prevent"])},[s("div",Ee,[h(F,{size:10,"disable-rounded":"","bg-color":r.color},null,8,["bg-color"])]),s("span",null,k(r.name),1),s("span",ze,k(r.deal_count),1)],8,Pe)]),_:2},1024))),128)),Ae,(l(!0),g(I,null,N(d.value,r=>(l(),m(V,{key:r.id},{default:c(()=>[s("a",{onClick:y(C=>{p(_).updateFilterParams({stage:r.id}),o()},["prevent"])},[s("div",Qe,[(l(),m(F,{key:r.color,size:10,"fa-icon":r.icon,"icon-color":r.color},null,8,["fa-icon","icon-color"]))]),s("span",null,k(r.name),1)],8,He)]),_:2},1024))),128))]),_:2},1024)]),key:"0"}:void 0]),1032,["disabled"]))}}),Me=s("i",{class:"fas fa-user-slash"},null,-1),Oe=s("i",{class:"fas fa-users"},null,-1),je=["onClick"],We=s("div",{class:"icon"},[s("i",{class:"fas fa-users"})],-1),Ke=["onClick"],qe=s("div",{class:"icon"},[s("i",{class:"fas fa-user-slash"})],-1),Ye=["onClick"],Xe={class:"icon"},Ge={class:"count"},Je=w({__name:"DropdownResponsibles",setup(v){const u=le(),{responsibles:t}=D(u),_=x(),{filterParams:n}=D(_),f=B(()=>{if(typeof n.value.user_id=="number")return u.getResponsibleById(n.value.user_id)}),b=B(()=>{var d;return((d=n.value)==null?void 0:d.user_id)===0});function $(d){d==="all"?_.deleteFilterParam("user_id"):_.updateFilterParams({user_id:d})}return(d,i)=>(l(),m(H,null,{default:c(()=>[f.value?(l(),m(T,{key:0},{icon:c(()=>[h(F,{size:16,url:f.value.responsible.userpic},null,8,["url"])]),title:c(()=>[R(k(f.value.responsible.name),1)]),_:1})):b.value?(l(),m(T,{key:1},{icon:c(()=>[Me]),title:c(()=>[R(k(d.$t("noResponsible")),1)]),_:1})):(l(),m(T,{key:2},{icon:c(()=>[Oe]),title:c(()=>[R(k(d.$t("allResponsibles")),1)]),_:1}))]),body:c(({hide:e})=>[h(A,null,{default:c(()=>[(l(),m(V,{key:"all"},{default:c(()=>[s("a",{onClick:y(a=>{$("all"),e()},["prevent"])},[We,s("span",null,k(d.$t("allResponsibles")),1)],8,je)]),_:2},1024)),(l(),m(V,{key:0},{default:c(()=>[s("a",{onClick:y(a=>{$(0),e()},["prevent"])},[qe,s("span",null,k(d.$t("noResponsible")),1)],8,Ke)]),_:2},1024)),(l(!0),g(I,null,N(p(t),a=>(l(),m(V,{key:a.responsible.id},{default:c(()=>[s("a",{onClick:y(o=>{$(a.responsible.id),e()},["prevent"])},[s("div",Xe,[h(F,{size:10,url:a.responsible.userpic},null,8,["url"])]),s("span",null,k(a.responsible.name),1),s("span",Ge,k(a.count),1)],8,Ye)]),_:2},1024))),128))]),_:2},1024)]),_:1}))}}),Ze=["onClick"],es=["onClick"],ss={class:"icon"},ts={class:"count"},as=w({__name:"DropdownFunnels",props:{hideOptionAll:{type:Boolean}},setup(v){const u=v,t=te();t.withCount();const{funnels:_,selectedFunnel:n,isFinished:f}=D(t),b=x(),{filterParams:$,firstDeal:d}=D(b);E(()=>[d.value,$.value.funnel,f.value],([,e,a])=>{var o;a&&(typeof e=="number"?(n.value=t.getFunnelById(e),!n.value&&((o=d.value)!=null&&o.funnel)&&(n.value={...d.value.funnel,stages:[d.value.stage]})):n.value=void 0)},{immediate:!0});function i(e,a){var o;e==="all"?b.updateFilterParams({funnel:void 0,stage:void 0}):b.updateFilterParams({funnel:e,...((o=$.value)==null?void 0:o.funnel)!==e?{stage:void 0}:{}}),typeof a=="function"&&a()}return(e,a)=>(l(),m(H,null,{default:c(()=>[h(T,null,{icon:c(()=>[p(n)?(l(),m(F,{key:p(n).id,size:12,"fa-icon":"filter","icon-color":p(n).color},null,8,["icon-color"])):S("",!0)]),title:c(()=>[R(k(p(n)?p(n).name:e.$t("allFunnels")),1)]),_:1})]),body:c(({hide:o})=>[h(A,null,{default:c(()=>[u.hideOptionAll?S("",!0):(l(),m(V,{key:"all"},{default:c(()=>[s("a",{onClick:y(r=>i("all",o),["prevent"])},[s("span",null,k(e.$t("allFunnels")),1)],8,Ze)]),_:2},1024)),(l(!0),g(I,null,N(p(_),r=>(l(),m(V,{key:r.id},{default:c(()=>[s("a",{onClick:y(C=>i(r.id,o),["prevent"])},[s("div",ss,[h(F,{size:10,"fa-icon":"filter","icon-color":r.color},null,8,["icon-color"])]),s("span",null,k(r.name),1),s("span",ts,k(r.deal_count),1)],8,es)]),_:2},1024))),128))]),_:2},1024)]),_:1}))}}),ls=v=>(X("data-v-7dd41873"),v=v(),G(),v),ns={class:"deals-header__filters-wrapper"},os={class:"deals-header__filters"},is=ls(()=>s("i",{class:"fas fa-times-circle text-gray"},null,-1)),rs=[is],cs={key:0,class:"skeleton deals-header__filters"},us=w({__name:"DealsHeaderFilters",props:{hideStages:{type:Boolean},hasFilters:{type:Boolean},showSkeleton:{type:Boolean},isKanban:{type:Boolean}},emits:["clear"],setup(v,{emit:u}){const t=v;return(_,n)=>(l(),g("div",ns,[Q(s("div",os,[h(as,{"hide-option-all":t.isKanban},null,8,["hide-option-all"]),t.hideStages?S("",!0):(l(),m(Ue,{key:0})),h(Je),h(Le),t.hasFilters?(l(),g("button",{key:1,class:"deals-header__filters-clear button nobutton light-gray",onClick:n[0]||(n[0]=f=>u("clear"))},rs)):S("",!0)],512),[[U,!t.showSkeleton]]),t.showSkeleton?(l(),g("div",cs,[(l(!0),g(I,null,N(t.hideStages?3:4,f=>(l(),g("span",{key:f,class:"skeleton-line deals-header__filters-skeleton"}))),128))])):S("",!0)]))}});const ds=J(us,[["__scopeId","data-v-7dd41873"]]),_s=["disabled","onClick"],ps={class:"tw-flex tw-items-center tw-gap-2"},fs={class:"icon"},ms=w({__name:"ActionButtonList",props:{items:{},space:{}},setup(v){const u=v;return(t,_)=>(l(),g("div",{class:L(`tw-flex tw-gap-${u.space||0}`)},[(l(!0),g(I,null,N(u.items,(n,f)=>(l(),g(I,{key:f},[n.hide?S("",!0):(l(),g("button",{key:0,disabled:n.disableClick,class:"light-gray",onClick:b=>!n.disableClick&&n.clickHandler()},[s("div",ps,[s("span",fs,[s("i",{class:L(["fas",n.classIcon])},null,2)]),s("span",null,k(n.label),1)])],8,_s))],64))),128))],2))}}),vs=["src"],hs=w({__name:"FormDealExportCSV",props:{ids:{}},setup(v){const u=v,t=z(!0),_={height:"400px",width:"100%"};return(n,f)=>(l(),m($e,{"hide-buttons":!0},{default:c(()=>[t.value?(l(),m(ge,{key:0,style:_})):S("",!0),Q(s("iframe",{src:`${p(Z).baseUrl}?module=deal&action=export&ids=${u.ids.join(",")}`,style:_,frameborder:"0",onLoad:f[0]||(f[0]=b=>t.value=!1)},null,40,vs),[[U,!t.value]])]),_:1}))}}),bs={class:"deals-header__edit small"},ks={class:"deals-header__edit-selected-deals"},gs={class:"tw-hidden xl:tw-inline-block tw-mr-2"},$s={class:"badge user blue tw-min-w-[0.5rem] tw-justify-center"},ys={class:"deals-header__edit-buttons"},ws=s("span",{class:"icon"},[s("i",{class:"fas fa-times-circle"})],-1),Cs={class:"tw-hidden xl:tw-inline-block tw-ml-2"},Ss=w({__name:"DealsHeaderBulkEdit",setup(v){const u=M(),{t}=Y(),_=x(),{countChecked:n,isAllChecked:f,bulkSelectIds:b}=D(_),$=ne(be),d=z(f.value?"1":""),i=z([{label:t("export"),classIcon:"fas fa-download",clickHandler:()=>{W(hs,{ids:b.value}).show()}},{label:t("merge"),classIcon:"fas fa-users",hide:!0,clickHandler:()=>u.push({name:"dealMerge",query:{ids:b.value.join(",")}})},{label:t("changeResponsible"),classIcon:"fas fa-user-check",hide:!0,clickHandler:()=>({})},{label:t("changeFunnelOrStage"),classIcon:"fas fa-exchange-alt",hide:!0,clickHandler:()=>({})},{label:t("Tags"),classIcon:"fas fa-hashtag",clickHandler:()=>W(ye,{entityType:"deal",entityIds:b.value}).show()},{label:t("close"),classIcon:"fas fa-flag-checkered",hide:!0,clickHandler:()=>({})}]);E(n,a=>{i.value[1].hide=a<2},{immediate:!0}),E(f,a=>{a?d.value="1":d.value="",(n.value===0||a)&&e(a)});function e(a){_.toggleChecked(a)}return(a,o)=>(l(),g("div",bs,[s("div",ks,[h(we,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=r=>d.value=r),size:16,onChange:o[1]||(o[1]=r=>e(!!r))},{default:c(()=>[s("span",gs,k(a.$t("selected")),1),s("span",$s,k(p(n)),1)]),_:1},8,["modelValue"])]),s("div",ys,[p($)?(l(),m(ke,{key:0,items:i.value},{default:c(()=>[h(T,{"color-class":"blue",width:"8rem"},{title:c(()=>[R(k(a.$t("actions")),1)]),_:1})]),_:1},8,["items"])):(l(),m(ms,{key:1,class:"deals-header__edit-actions",items:i.value,space:"2"},null,8,["items"])),s("button",{type:"button",class:"button outlined gray",onClick:o[2]||(o[2]=y(r=>e(!1),["prevent"]))},[ws,s("span",Cs,k(a.$t("cancel")),1)])])]))}});const O=v=>(X("data-v-c3b60b56"),v=v(),G(),v),Ds={class:"filters-button"},Fs={key:0,class:"tw-p-2"},Is=O(()=>s("i",{class:"fas fa-spinner wa-animation-spin"},null,-1)),Vs=[Is],Bs=O(()=>s("i",{class:"fas fa-filter"},null,-1)),Rs=[Bs],Ts={key:2,class:"icon size-8 rounded filters-button__has"},Ns=O(()=>s("i",{class:"fas fa-circle text-red circle"},null,-1)),Ls=[Ns],xs=w({__name:"DealsFiltersControlButton",props:{modelValue:{type:Boolean},hasFilters:{type:Boolean},loading:{type:Boolean}},emits:["update:modelValue"],setup(v,{emit:u}){const t=v;return(_,n)=>(l(),g("span",Ds,[t.loading?(l(),g("div",Fs,Vs)):(l(),g("button",{key:1,class:L(["button circle blank !tw-shadow-none",{"filters-button--active":t.modelValue}]),onClick:n[0]||(n[0]=y(f=>u("update:modelValue",!t.modelValue),["prevent"]))},Rs,2)),!t.loading&&t.hasFilters?(l(),g("span",Ts,Ls)):S("",!0)]))}});const Ps=J(xs,[["__scopeId","data-v-c3b60b56"]]),q=w({__name:"ToggleListItem",props:{modelValue:{},value:{}},emits:["update:modelValue"],setup(v,{emit:u}){return(t,_)=>(l(),g("span",{class:L({selected:t.modelValue===t.value}),onClick:_[0]||(_[0]=n=>u("update:modelValue",t.value))},[ee(t.$slots,"default")],2))}}),Es=w({__name:"ToggleList",props:{size:{},rounded:{type:Boolean}},setup(v){const u=v;return(t,_)=>(l(),g("div",{class:L(["toggle",u.size,u.rounded?"rounded":""])},[ee(t.$slots,"default")],2))}}),zs={class:"deals-header"},As={class:"deals-header__inner"},Hs={key:0,class:"deals-header__heading--native"},Qs={key:1,class:"deals-header__heading--web tw-flex tw-space-x-4 tw-items-center"},Us={class:"tw-mb-2"},Ms=["title","onClick"],Os=s("i",{class:"fas fa-plus"},null,-1),js=[Os],Ws=s("i",{class:"fas fa-columns"},null,-1),Ks=s("i",{class:"fas fa-list-ul"},null,-1),qs=w({__name:"DealsHeader",setup(v){const u=x(),{hasFilters:t,countChecked:_}=D(u),{currentView:n,isKanban:f}=D(se()),b=M(),$=!!Z.webView,d=z(!1);function i(e){n.value!==e&&(n.value=e,b.push({name:pe[e],query:b.currentRoute.value.query}).then(()=>u.changeTabView()))}return(e,a)=>(l(),g("div",zs,[p(_)?(l(),m(Ss,{key:0})):S("",!0),Q(s("div",As,[$?(l(),g("div",Hs,[h(Fe)])):(l(),g("div",Qs,[s("div",Us,[s("h1",null,k(e.$t("Deals")),1)]),h(Se,{component:De,"component-props":{funnelId:p(u).filterParams.funnel,onAdded:p(Ce)}},{default:c(({open:o})=>[s("button",{title:e.$t("newDeal"),class:"circle",onClick:y(o,["prevent"])},js,8,Ms)]),_:1},8,["component-props"]),p(n)?(l(),m(Es,{key:0,rounded:""},{default:c(()=>[h(q,{"model-value":p(n),value:"kanban","onUpdate:modelValue":a[0]||(a[0]=o=>i(o))},{default:c(()=>[Ws]),_:1},8,["model-value"]),h(q,{"model-value":p(n),value:"list","onUpdate:modelValue":a[1]||(a[1]=o=>i(o))},{default:c(()=>[Ks]),_:1},8,["model-value"])]),_:1})):S("",!0)])),h(Ps,{modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=o=>d.value=o),class:"deals-header__filters-button tw-hidden","has-filters":p(t),loading:!p(u).filtersIsLoaded},null,8,["modelValue","has-filters","loading"]),s("div",{class:L(["deals-header__filters-container",{"deals-header__filters-container--hide":!d.value}])},[h(ds,{"has-filters":p(t),"hide-stages":p(f),"show-skeleton":!p(u).filtersIsLoaded,"is-kanban":p(f),onClear:p(u).clearFilters},null,8,["has-filters","hide-stages","show-skeleton","is-kanban","onClear"])],2)],512),[[U,!p(_)]])]))}});const Ys={class:"deals blank box contentbox"},Ct=w({__name:"DealsView",props:{routeName:{},routeQuery:{}},setup(v){const u=v,t=M(),_=se(),n=x(),f=fe();if(b(u.routeName,u.routeQuery),u.routeName!=="deals"){const i=d(u.routeQuery).filters();n.updateOrClearFilterParams(i);const e=d(u.routeQuery).sortList();f.updateSort(e)}E([()=>n.filterParams,()=>f.sort],([i,e])=>{$({...i,...e.sort===K.sort&&e.asc===K.asc?{}:e})},{immediate:!0,deep:!0}),oe((i,e)=>{i.name==="deals"&&e.meta.menuItemType==="deals"?setTimeout(()=>b(e.name,e.query,!0)):i.name!==e.name&&(_.changeRouteTab(i.name),n.$resetDeals())}),ie(re).on(n.reinitView);function b(i,e,a){const o=a?t.replace:t.push,r=_.changeRouteTab(i);o({name:r,query:e})}function $(i){const e={};for(const[a,o]of Object.entries(i))me.includes(a)&&o!==null&&(e[a]=o);t.replace({name:t.currentRoute.value.name&&t.currentRoute.value.name!=="deals"?t.currentRoute.value.name:_.lastRouteNameTab,query:e})}function d(i){const e=(r,C)=>{if(r=String(r),C!=null&&C.includes(r))return r;const P=Number(r);return isNaN(P)?null:P},a=r=>typeof r=="string"?r:null,o={};return{filters(){if(!Object.keys(i).length)return o;const r=a(i.funnel);r&&(o.funnel=e(r));const C=a(i.stage);C&&(o.stage=e(C,["won","lost"]));const P=a(i.tag);P&&(o.tag=e(P));const j=a(i.user_id);return j&&(o.user_id=e(j)),o},sortList(){if(!Object.keys(i).length)return o;const r=a(i.sort);r&&(o.sort=r);const C=a(i.asc);return C&&(o.asc=e(C)?1:0),o}}}return(i,e)=>{const a=ce("router-view");return l(),g("div",Ys,[h(qs),h(a,null,{default:c(({Component:o})=>[h(ue,{name:"fade",mode:"out-in"},{default:c(()=>[(l(),m(de(o)))]),_:2},1024)]),_:1})])}}});export{Ct as default};
