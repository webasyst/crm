import{d as q,h,a$ as de,b6 as fe,R as E,r as W,j as F,ao as ie,o as u,i as U,w as R,a,n as M,u as $,_ as Y,H as pe,Q as ve,l as V,U as z,V as _e,B as ee,c as b,e as te,p as L,ap as me,O as he,aQ as J,ak as X,b7 as ye,a0 as be,aj as we,k as se,v as ae,a9 as oe,s as re,x as ce,I as ge,ah as ke,b8 as Te,ay as P,a5 as $e,m as Ce,F as Q,q as j,b as Ie,A as ne,Z as Se}from"./main-d7f03521.js";import{U as xe}from"./index-dc17eb5d.js";import{D as Re}from"./DropdownModal-9b06143e.js";import{u as Ee}from"./useSortable-eb883c7d.js";import{D as Ne}from"./DropDown-7a0f8902.js";import{c as Ae}from"./index-884c82be.js";const bt=q({__name:"ComponentActivator",setup(v){const n=h(!1),e=de(fe()),o=E(e,y=>{y&&(n.value=!0,o())});return(y,d)=>n.value?W(y.$slots,"default",{key:0}):F("",!0)}}),Be={class:"toolbar-profile__back"},De={class:"toolbar-profile__meta"},Le={class:"toolbar-profile__actions"},Me=q({__name:"ToolbarProfile",props:{disableAnimation:{type:Boolean}},setup(v){const n=v,e=h(!0);return ie(()=>{setTimeout(()=>{e.value=!1},50)}),(o,y)=>(u(),U($(xe),{class:M(["toolbar-profile__wrapper",{"tw-invisible":e.value}])},{default:R(({isVisible:d})=>[a("div",{class:M(["toolbar-profile",d?"tw-relative":"tw-fixed shadowed",{"slide-up":!d&&!n.disableAnimation}])},[a("div",Be,[W(o.$slots,"back",{},void 0,!0)]),a("div",De,[W(o.$slots,"default",{},void 0,!0)]),a("div",Le,[W(o.$slots,"buttons",{},void 0,!0)])],2)]),_:3},8,["class"]))}});const wt=Y(Me,[["__scopeId","data-v-f828e502"]]),Oe={class:"tw-flex tw-items-center tw-gap-x-2"},He={class:"mobile:tw-hidden"},ze=a("span",{class:"tw-hidden mobile:tw-inline-block"},[a("i",{class:"fas fa-receipt"})],-1),We=["onClick"],Fe={key:0},Ue=a("i",{class:"fas fa-spinner fa-spin"},null,-1),Ve=[Ue],qe={key:1},Pe=a("i",{class:"fas fa-plus"},null,-1),Qe=[Pe],gt=q({__name:"TabsAddEntityButton",props:{entityType:{},entityId:{},additionalActions:{}},setup(v,{expose:n}){const e=v,{t:o}=pe(),y=ve();let d=null;const _=h([]),x=h([]),m=V(()=>_.value.concat(x.value));E(()=>e.entityId,l=>{I(),d=l},{immediate:d!==e.entityId}),E(()=>e.additionalActions,l=>{l&&_.value.push(...l)},{deep:!0,immediate:!!e.additionalActions&&!!e.additionalActions.length});const r=h(!1),g=h(!1),w=h(!1);E([()=>e.entityType,()=>e.entityId],()=>{_.value=_.value.filter(l=>!("html"in l)),r.value=!1,g.value=!1,w.value=!1});function I(){var l;x.value=[],_.value=[{label:o("addNote"),classIcon:"fas fa-sticky-note",clickHandler:()=>{z.replace({name:`${e.entityType}NotesTab`,query:{focus:"1"}})}},{label:o("addFile"),classIcon:"fas fa-paperclip",clickHandler:()=>{z.replace({name:`${e.entityType}FilesTab`}).then(()=>{_e(me).emit()})}},{label:o("addReminder"),classIcon:"fas fa-check-circle",clickHandler:()=>{z.replace({name:`${e.entityType}RemindersTab`,query:{focus:"1"}})}}],(l=ee.rights)!=null&&l.invoice&&y.meta.isWidgetMode&&_.value.push({label:o("addInvoice"),classIcon:"fas fa-file-invoice-dollar",clickHandler:()=>{z.replace({name:`${e.entityType}InvoicesTab`,query:{is_new:"1"}})}})}function O(){if(!w.value&&e.entityType==="contact"){g.value=!0;const l=V(()=>`crm.contact.ui.actions?id=${e.entityId}`),{data:k,error:T}=he(l,{immediate:!0}).get().json(),H=()=>{g.value=!1,w.value=!0,r.value=!0};J(k,async C=>{if(C.plus_dropdown){const N=[];if(!(C!=null&&C.plus_dropdown))return;C.plus_dropdown.forEach(A=>{N.push({html:A})}),x.value.push(...N)}await X(),H()}),J(T,()=>{H()})}}return n({callAction:l=>{const k=_.value.find(T=>"id"in T&&T.id===l);k&&"clickHandler"in k&&k.clickHandler()}}),(l,k)=>{var T;return u(),b("div",Oe,[(T=$(ee).rights)!=null&&T.invoice&&!l.$route.meta.isWidgetMode?(u(),b("button",{key:0,type:"button",class:"button nowrap rounded mobile:tw-rounded-full mobile:tw-p-0 mobile:tw-w-[2.125em] mobile:tw-h-[2.125em] mobile:tw-text-sm",onClick:k[0]||(k[0]=te(()=>{$(z).replace({name:`${e.entityType}InvoicesTab`,query:{is_new:"1"}})},["prevent"]))},[a("span",He,L(l.$t("addInvoice")),1),ze])):F("",!0),(u(),U(Re,{key:`${e.entityType}_${e.entityId}`,items:m.value,"fallback-on-open":!0,"prevent-open":e.entityType==="contact",open:r.value},{default:R(()=>[a("button",{class:"button circle light-gray !tw-text-waAccent mobile:tw-text-sm",onClick:te(O,["prevent"])},[g.value?(u(),b("span",Fe,Ve)):(u(),b("span",qe,Qe))],8,We)]),_:1},8,["items","prevent-open","open"]))])}}}),ue=v=>(re("data-v-1f330ed0"),v=v(),ce(),v),je={class:"tw-sticky tw-left-0 tw-z-10"},Je=ue(()=>a("span",{class:"icon size-16"},[a("i",{class:"fas fa-chevron-left"})],-1)),Xe=[Je],Ye=ue(()=>a("span",{class:"icon size-16"},[a("i",{class:"fas fa-chevron-right"})],-1)),Ze=[Ye],le=32,Ge=q({__name:"HorizontalScrollContainer",props:{step:{default:90},fadeColor:{default:"var(--background-color-blank)"},scrollToElement:{default:void 0}},setup(v){const n=v;ye(m=>({"181cef9b":m.fadeColor}));const e=h(null),o=h(!1),y=h(0),{x:d,arrivedState:_}=be(e,{behavior:"smooth"});we(e,m=>{const r=m[0];y.value=r.target.clientHeight,o.value=r.target.scrollWidth>r.target.clientWidth}),ie(()=>{e.value&&(y.value=e.value.clientHeight,o.value=e.value.scrollWidth>e.value.clientWidth)}),E(o,()=>{_.right=!1}),E(()=>n.scrollToElement,m=>{m&&x(m.getBoundingClientRect().x)});function x(m){if(!e.value)return;const{x:r,right:g,width:w}=e.value.getBoundingClientRect();g-le<m&&(d.value=Math.min(m-r-le,Math.floor(e.value.scrollWidth-w)))}return(m,r)=>(u(),b("div",{ref_key:"scrollableRef",ref:e,class:"tw-relative tw-overflow-x-scroll tw-scrollbar-hide"},[a("div",je,[se(a("div",{class:"arr -tw-left-2",style:oe({height:`${y.value}px`}),onClick:r[0]||(r[0]=g=>d.value-=n.step)},Xe,4),[[ae,o.value&&$(d)>0]]),se(a("div",{class:"arr right tw-right-0",style:oe({height:`${y.value}px`}),onClick:r[1]||(r[1]=g=>d.value+=n.step)},Ze,4),[[ae,o.value&&!$(_).right]])]),W(m.$slots,"default")],512))}});const Ke=Y(Ge,[["__scopeId","data-v-1f330ed0"]]),Z=v=>(re("data-v-759aefd5"),v=v(),ce(),v),et=Z(()=>a("div",{class:"skeleton-line"},null,-1)),tt=[et],st=["data-id"],at=["href","onClick"],ot={key:0,class:"count"},nt={key:0,class:"nowrap tw-ml-1 tw-py-3"},lt=Z(()=>a("span",{class:"icon size-16 text-light-gray"},[a("i",{class:"fas fa-chevron-down"})],-1)),it=["data-id"],rt=["href","onClick"],ct=["title"],ut={key:0,class:"count tw-flex-none"},dt=Z(()=>a("canvas",{id:"tabs-canvas",class:"hidden"},null,-1)),ft=q({__name:"TabList",props:{entityType:{},value:{},isFetching:{type:Boolean},fadeColor:{}},setup(v){const n=v,e=ge(Ae),o=h(null),y=h(null),d=h(null),_=h(null),{width:x}=ke(_),m=h(),{tabsOrder:r,tabsOrderMap:g}=Te(n.entityType),w=h(new Map),I=V(()=>[...n.value].sort((t,p)=>g.value[t.routeName]-g.value[p.routeName])),O=V(()=>I.value.filter(t=>w.value.get(t.routeName))),l=V(()=>w.value.size>0?I.value.filter(t=>!w.value.get(t.routeName)):[]),k=()=>{for(const t of I.value)w.value.set(t.routeName,!0)},T=(t,p)=>{const i=document.getElementById("tabs-canvas");if(i){const s=i.getContext("2d");if(s)return s.font=p,s.measureText(t).width}return 0},H=t=>{const i="1rem sans-serif",s="0.75em sans-serif";let f=0;for(let c=0;c<t.length;c++)f+=24,f+=T(t[c].name,i),t[c].count&&(f+=T(String(t[c].count),s));return f-24};async function C(t=!1){if(!_.value)return;const p=[...I.value],i=()=>{var c;let f=d.value?80:0;return y.value&&(f=y.value.offsetWidth+20),t&&((c=d.value)==null?void 0:c.children.length)===1?0:f},s=i();if(!(H(p)<_.value.clientWidth-s))for(let f=0;f<I.value.length;f++){const c=p.pop();if(w.value.set(c==null?void 0:c.routeName,!1),await X(),H(p)<_.value.clientWidth-(t?s:i()))break}}E(()=>n.value,()=>{if(!n.value.length)return;J(()=>n.isFetching,async()=>{var p;if(r.value.length||n.value.forEach(i=>{r.value.push(i.routeName)}),k(),await X(),C(),e.value){const i=(p=o.value)==null?void 0:p.querySelector("li[data-id].selected");i&&(m.value=i)}},{immediate:!n.isFetching})},{immediate:!!n.value,deep:!0});let N,A;P(O,t=>{o.value&&t.length&&(N=G(o.value,t))},{immediate:!0,debounce:250}),P(l,t=>{d.value&&t.length&&(A=G(d.value,t))},{immediate:!0,debounce:250}),P(x,(t,p)=>{t>p&&A&&k(),C(t>p)},{debounce:200}),$e(()=>{N&&N.stop(),A&&A.stop()});function G(t,p){return Ee(t,p,{handle:".handle",group:"tabs",animation:150,forceFallback:!0,fallbackOnBody:!0,fallbackTolerance:5,delay:150,delayOnTouchOnly:!0,onStart:()=>{document.querySelectorAll("iframe").forEach(i=>{i.classList.add("tw-pointer-events-none")})},onEnd:i=>{var B,D;document.querySelectorAll("iframe").forEach(S=>{S.classList.remove("tw-pointer-events-none")});const{id:s}=i.item.dataset;typeof s=="string"&&(i.to.classList.contains("tabs-dropdown-list")?w.value.set(s,!1):i.to.classList.contains("tabs-main-list")&&w.value.set(s,!0));const f=[...((B=o.value)==null?void 0:B.children)||[],...((D=d.value)==null?void 0:D.children)||[]].map(S=>S.dataset.id),c=[...r.value];for(let S=0;S<c.length;S++){const K=c[S];f.includes(K)||f.splice(S,0,K)}r.value=f,setTimeout(C)}})}return(t,p)=>{const i=Ce("router-link");return u(),b("div",{ref_key:"tabsListRef",ref:_,class:"tabs-list tw-flex-auto tw-overflow-hidden tw-mx-2"},[(u(),U(Se($(e)?Ke:"div"),{"fade-color":n.fadeColor||"var(--background-color)","scroll-to-element":m.value,class:"tw-select-none md:tw-flex"},{default:R(()=>[(u(),b("ul",{key:JSON.stringify(O.value),ref_key:"mainUlRef",ref:o,class:"tabs tabs-main-list overflow-arrows tw-flex-none"},[n.isFetching?(u(),b(Q,{key:0},j(7,s=>a("li",{key:s,class:"skeleton tw-w-16"},tt)),64)):(u(!0),b(Q,{key:1},j($(e)?I.value:O.value,s=>(u(),U(i,{key:s.routeName,to:{name:s.routeName},replace:"",custom:""},{default:R(({isActive:f,href:c,navigate:B})=>[a("li",{class:M([{selected:f,handle:!$(e)},"tab-item"]),"data-id":s.routeName},[a("a",{href:c,class:M(t.$constant.parentAppDisableRouterClass),onClick:D=>B(D).then(()=>typeof s.onClick=="function"?s.onClick():null)},[a("span",null,[ne(L(s.name)+" ",1),s.count?(u(),b("span",ot,L(s.count),1)):F("",!0)])],10,at)],10,st)]),_:2},1032,["to"]))),128))])),!$(e)&&l.value.length?(u(),b("div",nt,[Ie(Ne,{"fallback-on-open":!0,hover:!0,fixed:!0},{body:R(()=>[(u(),b("ul",{key:JSON.stringify(l.value),ref_key:"dropdownUlRef",ref:d,class:"menu tabs-dropdown-list"},[(u(!0),b(Q,null,j(l.value,s=>(u(),U(i,{key:s.routeName,to:{name:s.routeName},replace:"",custom:""},{default:R(({isActive:f,href:c,navigate:B})=>[a("li",{class:M([{selected:f,handle:!$(e)},"tab-item"]),"data-id":s.routeName},[a("a",{href:c,class:M([t.$constant.parentAppDisableRouterClass,"!tw-py-3"]),onClick:D=>B(D).then(()=>typeof s.onClick=="function"?s.onClick():null)},[a("span",{title:s.name,class:"tw-truncate"},L(s.name),9,ct),s.count?(u(),b("span",ut,L(s.count),1)):F("",!0)],10,rt)],10,it)]),_:2},1032,["to"]))),128))]))]),default:R(()=>[a("button",{ref_key:"dropdownButtonRef",ref:y,class:"button light-gray transparent rounded custom-px-4"},[lt,ne(" "+L(t.$t("more")),1)],512)]),_:1})])):F("",!0),dt]),_:1},8,["fade-color","scroll-to-element"]))],512)}}});const kt=Y(ft,[["__scopeId","data-v-759aefd5"]]);export{wt as T,gt as _,kt as a,bt as b};
