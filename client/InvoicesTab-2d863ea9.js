import{d as L,a as m,U as S,A as g,B as n,a5 as T,P as D,g as o,o as t,b as c,c as a,k as C,w as d,F as f,l as q,e as b,m as A,p as j,f as $,h as z,i as v,a7 as H}from"./main-49799bbb.js";import{v as M}from"./index-824b3191.js";import{S as P}from"./SkeletonList-7258d9b0.js";import U from"./IframeView-7c903c8b.js";import{I as O}from"./IconButton-5346b581.js";import{_ as G}from"./ErrorDummy.vue_vue_type_script_setup_true_lang-8b0b14f2.js";import{E as J}from"./EmptyList-c3da84c8.js";import{C as K}from"./CustomColumn-69543086.js";import{H as Q}from"./HistoryTabLogInvoiceSummary-cbab6be7.js";import"./iframeObserver-aae39d6d.js";import"./index-55296fc3.js";import"./dayjs-16abfa33.js";const R={key:1,class:"state-error-hint"},W={key:2,class:"tw-max-w-3xl tw-mx-auto"},X=v("div",{class:"icon size-80"},[v("i",{class:"fa fa-file-invoice-dollar"})],-1),Y={key:0,class:"tw-flex tw-justify-center tw-mt-4"},Z={class:"tw-h-20"},ee={key:0,class:"tw-text-center tw-py-4"},te=v("div",{class:"spinner custom-p-16"},null,-1),ie=[te],p=30,ve=L({__name:"InvoicesTab",props:{entityType:{},entityId:{},isNew:{type:Boolean},invoiceId:{}},setup(B){var I;const s=B,u=m({[`${s.entityType}_id`]:s.entityId,sort:"create_datetime",asc:0,offset:0,limit:p}),y=m(0),r=m(null),{data:x,isFetching:_,statusCode:N,error:w,execute:h}=S(g(()=>`crm.invoice.list?${H.stringify(u.value)}`),{immediate:!1,refetch:!0}).get().json();((I=n.rights)!=null&&I.invoice||n.webView)&&!s.isNew&&!s.invoiceId&&(h(),T("InvoicesTab:refresh").on(()=>{r.value&&(r.value=null,h())}));const V=g(()=>`${n.baseUrl}invoice/`+(s.invoiceId?`${s.invoiceId}/?iframe=1`:`new/?iframe=1&${s.entityType==="deal"?"deal_id":"contact"}=${s.entityId}`));D(x,e=>{e&&("params"in e&&(y.value=e.params.total_count),"data"in e&&Array.isArray(e.data)&&(r.value=[...r.value||[],...e.data]))});function E(){u.value.offset+p>=y.value||(u.value.offset+=p)}function F(e){typeof(e==null?void 0:e.detail)=="string"&&T(`InvoicesTab:${e.detail}`).emit()}return(e,l)=>o(n).rights&&!o(n).rights.invoice||o(N)===403?(t(),c(G,{key:0,code:403})):s.isNew||s.invoiceId?(t(),c(U,{id:"iframe-invoice",key:Date.now(),src:V.value,"force-resize":!0,"static-position":!0,onClose:l[0]||(l[0]=i=>{var k;return e.$router.push({query:{...(k=i==null?void 0:i.detail)!=null&&k.id?{id:i.detail.id}:{}}}).then(()=>F(i))})},null,8,["src"])):(t(),a(f,{key:2},[r.value?o(w)?(t(),a("div",R,C(o(w)),1)):(t(),a("div",W,[r.value.length?(t(),c(K,{key:0,space:"8"},{default:d(()=>[(t(!0),a(f,null,q(r.value,i=>(t(),c(Q,{key:i.id,invoice:i,"route-location":{query:{id:i.id}},class:"invoice-wrapper"},null,8,["invoice","route-location"]))),128))]),_:1})):(t(),a(f,{key:1},[b(J,{message:e.$t(`noInvoicesBy${e.$filters.toTitleCase(s.entityType)}`)},{default:d(()=>[X]),_:1},8,["message"]),e.$route.meta.menuItemType!=="frame"?(t(),a("div",Y,[b(O,{icon:"plus",onClick:l[1]||(l[1]=j(i=>e.$router.push({query:{is_new:"1"}}),["prevent"]))},{default:d(()=>[A(C(e.$t("addInvoice")),1)]),_:1})])):$("",!0)],64)),z((t(),a("div",Z,[o(_)?(t(),a("div",ee,ie)):$("",!0)])),[[o(M),([{isIntersecting:i}])=>{i&&!o(_)&&E()}]])])):(t(),c(P,{key:0,class:"tw-max-w-3xl tw-mx-auto"}))],64))}});export{ve as default};
