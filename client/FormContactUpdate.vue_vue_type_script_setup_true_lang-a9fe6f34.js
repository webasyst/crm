import{a5 as J,h as w,M as q,P as H,d as A,t as K,o as d,i as V,w as c,b as k,c as g,q as Q,u as F,F as O,a as e,p as r,e as D,l as G,A as U,k as M,v as R,$ as X,O as Y,L as Z,r as B,n as j,j as I,a0 as ee,B as L,a8 as te}from"./main-46836c41.js";import{C as ae}from"./fields-e10d6cd3.js";import{U as x}from"./UserPic-951b6ea8.js";import{M as oe,D as se,_ as le}from"./DropDown-2ad3ed01.js";import{_ as ne}from"./InputWithUsers.vue_vue_type_script_setup_true_lang-609436aa.js";import{C as E}from"./CustomColumn-c8c73188.js";import{u as ie,_ as ce}from"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-c3cfd939.js";const re=J("vaults",()=>{const h=w([]),{data:m,isFetching:a,error:v,isFinished:p,execute:o}=q("crm.vault.list").get().json();H(()=>{Array.isArray(m.value)&&(h.value=m.value)});function l(){p.value&&o()}return{vaults:h,isFetching:a,error:v,refetch:l}}),ue=["disabled"],de={key:0,class:"tw-flex tw-items-center tw-space-x-2"},me=["title"],pe=e("div",null,[e("i",{class:"fas fa-caret-down"})],-1),fe={key:1},ve=["onClick"],we=["title"],_e=A({__name:"SelectWithVaults",props:{modelValue:{}},emits:["update:modelValue"],setup(h,{emit:m}){const a=h,v=re(),{vaults:p,isFetching:o,error:l}=K(v);return v.refetch(),a.modelValue||H(()=>{Array.isArray(p.value)&&m("update:modelValue",p.value[0])}),(C,y)=>(d(),V(se,{disabled:!!(F(o)||F(l))},{body:c(({hide:$})=>[k(oe,null,{default:c(()=>[(d(!0),g(O,null,Q(F(p),i=>(d(),V(le,{key:i.id},{default:c(()=>[e("a",{onClick:D(()=>{m("update:modelValue",i),$()},["prevent"])},[k(x,{size:20,"fa-icon":"circle","icon-color":i.color},null,8,["icon-color"]),e("span",{class:"tw-truncate",title:i.name},r(i.name),9,we)],8,ve)]),_:2},1024))),128))]),_:2},1024)]),default:c(()=>[e("button",{class:"button light-gray",disabled:F(o)},[a.modelValue?(d(),g("div",de,[(d(),V(x,{key:a.modelValue.color,size:20,"fa-icon":"circle","icon-color":a.modelValue.color},null,8,["icon-color"])),e("span",{class:"tw-truncate",title:a.modelValue.name},r(a.modelValue.name),9,me),pe])):(d(),g("div",fe," error "))],8,ue)]),_:1},8,["disabled"]))}}),he={class:"wa-radio"},ye=["checked"],$e=e("span",null,null,-1),be={class:"wa-radio"},ke=["checked"],Ce=e("span",null,null,-1),Ve={class:"wa-radio"},ge=["checked"],Se=e("span",null,null,-1),Ue={class:"tw-ml-6 tw-mt-4"},P=A({__name:"FormContactUpdateScope",props:{contact:{}},setup(h,{expose:m}){var $,i,S,_;const a=h,v=w(($=a.contact)==null?void 0:$.vault),p=w(((i=a.contact)==null?void 0:i.owners)||[]),o=w((S=a.contact)!=null&&S.vault?"vault":(_=a.contact)!=null&&_.owners?"owners":"all"),l=G(()=>{var f;return o.value==="owners"?{owner_id:p.value.map(n=>n.id)}:o.value==="vault"?{vault_id:(f=v.value)==null?void 0:f.id}:{vault_id:0}}),{modified:C}=ie(l);m({modified:C,submit:y});function y(f){return q(`crm.contact.access.update?id=${f}`).post(l.value)}return(f,n)=>(d(),V(E,{space:"4"},{default:c(()=>[e("div",null,r(f.$t("scopeMessage")),1),k(E,{space:"2"},{default:c(()=>[e("div",null,[e("label",{onClick:n[0]||(n[0]=t=>o.value="all")},[e("span",he,[e("input",{type:"radio",checked:o.value==="all"},null,8,ye),$e]),U(" "+r(f.$t("allUsers")),1)])]),e("div",null,[e("label",{class:"tw-flex tw-flex-col tw-space-y-2 md:tw-space-y-0 md:tw-flex-row md:tw-space-x-2 md:tw-items-center",onClick:n[2]||(n[2]=t=>o.value="vault")},[e("div",null,[e("span",be,[e("input",{type:"radio",checked:o.value==="vault"},null,8,ke),Ce]),U(" "+r(f.$t("onlyUsersWithVault")),1)]),k(_e,{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=t=>v.value=t)},null,8,["modelValue"])])]),e("div",null,[e("label",{onClick:n[3]||(n[3]=t=>o.value="owners")},[e("span",Ve,[e("input",{type:"radio",checked:o.value==="owners"},null,8,ge),Se]),U(" "+r(f.$t("onlyUsers")),1)]),M(e("div",Ue,[k(ne,{modelValue:p.value,"onUpdate:modelValue":n[4]||(n[4]=t=>p.value=t)},null,8,["modelValue"])],512),[[R,o.value==="owners"]])])]),_:1})]),_:1}))}}),Fe=["disabled","onClick"],Be={class:"text-red"},De={key:0,class:"tabs bordered-bottom tw-sticky tw-left-0 tw-top-[-1px] tw-bg-waBlank tw-z-10 !tw-mb-4"},Me=e("div",{class:"hr tw-mx-0 tw-mt-4 tw-mb-8"},null,-1),Re={key:2},Le=A({__name:"FormContactUpdate",props:{contact:{default:void 0},initialTab:{default:"info"},toCompany:{default:void 0},hideForm:{type:Boolean,default:!1}},emits:["close","success"],setup(h,{emit:m}){const a=h,v=X(),p=Y(),o=!!a.contact,l=w(a.initialTab),C=w(null),y=w(null),$=w(null),i=w(!1),S=G(()=>{var t,s;return i.value||!((t=C.value)!=null&&t.modified||o&&((s=y.value)!=null&&s.modified))}),_=w("");async function f(){var s,b,T,z,N,W;i.value=!0,_.value="";let t;if((s=C.value)!=null&&s.modified){const u=await((b=C.value)==null?void 0:b.submit());if((T=u==null?void 0:u.response.value)!=null&&T.ok)t=u.data.value;else{l.value="info",i.value=!1,_.value=u==null?void 0:u.error.value;return}}if((z=y.value)!=null&&z.modified&&!_.value){const u=await((W=y.value)==null?void 0:W.submit(t||((N=a.contact)==null?void 0:N.id)));if(u!=null&&u.error.value){i.value=!1,_.value=u.error.value;return}}_.value||(m("success"),t?v.push({name:"contact",params:{id:t},...L.webView?{replace:!0}:{}}):L.webView?te.emit("spa:navigateBack"):p.refetch()),m("close")}const n=()=>{var t,s;(t=$.value)!=null&&t.toggle()&&((s=$.value)==null?void 0:s.$el).scrollIntoView({behavior:"smooth"})};return(t,s)=>(d(),V(ee,{"vertical-stretch":!0,"use-cancel-as-button-label":!0,onClose:s[2]||(s[2]=b=>m("close"))},Z({submit:c(()=>[B(t.$slots,"submit",{},()=>[e("button",{class:"button",disabled:S.value,onClick:D(f,["prevent"])},r(t.$t("save")),9,Fe)])]),error:c(()=>[B(t.$slots,"error",{},()=>[e("span",Be,r(_.value),1)])]),default:c(()=>[e("div",null,[B(t.$slots,"topBody"),a.hideForm?I("",!0):(d(),g(O,{key:0},[o||a.toCompany?(d(),g("ul",De,[e("li",{class:j({selected:l.value==="info"})},[e("a",{onClick:s[0]||(s[0]=D(b=>l.value="info",["prevent"]))},r(t.$t("contactData")),1)],2),e("li",{class:j({selected:l.value==="scope","tw-pointer-events-none tw-opacity-50":!o&&S.value&&!t.toCompany})},[e("a",{onClick:s[1]||(s[1]=D(b=>l.value="scope",["prevent"]))},r(t.$t("scope")),1)],2)])):(d(),V(ae,{key:1,ref_key:"collapsibleContainerRef",ref:$,"fallback-on-show":"","hide-toggler":""},{default:c(()=>[k(P,{ref_key:"formContactUpdateScopeRef",ref:y,contact:a.contact},null,8,["contact"]),Me]),_:1},512)),M(e("div",null,[k(ce,{ref_key:"formContactUpdateInfoRef",ref:C,contact:a.contact,"to-company":a.toCompany},null,8,["contact","to-company"])],512),[[R,l.value==="info"]]),o||t.toCompany?M((d(),g("div",Re,[k(P,{ref_key:"formContactUpdateScopeRef",ref:y,contact:a.contact},null,8,["contact"])],512)),[[R,l.value==="scope"]]):I("",!0)],64))])]),_:2},[t.$slots.header?{name:"header",fn:c(()=>[B(t.$slots,"header")]),key:"0"}:o?{name:"header",fn:c(()=>{var b;return[U(r(`${t.$t("editContact")} ${(b=a.contact)==null?void 0:b.main.name}`),1)]}),key:"1"}:{name:"headerWrapper",fn:c(()=>[e("div",{class:"tw-flex tw-justify-between"},[e("h1",{class:"tw-m-0"},r(t.$t("addContact")),1),e("a",{class:"small underline gray tw-mt-2.5 tw-mr-16 hover:tw-text-gray-400",onClick:n},[e("i",{class:"fas fa-low-vision"}),U(" "+r(t.$t("limitVisibility")),1)])])]),key:"2"}]),1024))}});export{Le as _,re as u};
