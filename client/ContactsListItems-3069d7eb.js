import{d as $,a as S,a1 as Q,z as D,o as n,c as d,r as g,n as h,f as W,i as a,F as R,l as T,_ as F,j as V,b,a2 as q,w as p,k as A,e as I,h as z,m as H,g as v,a3 as X,P as E,A as L,M as U,a4 as Y,a5 as Z,p as O,a6 as tt,q as et,s as st}from"./main-ad3d4b2a.js";import{S as ot,a as at}from"./index-38eb481c.js";import{U as ct}from"./UserPic-e76d468d.js";import{C as nt,a as lt}from"./ChipsList-007889bd.js";import{_ as it}from"./ContactsListItemAction.vue_vue_type_style_index_0_lang-70395f49.js";import{v as P}from"./vTooltip-c8fe82a0.js";const Jt=$({__name:"ContainerSize",props:{breakpoint:{},triggerClass:{}},setup(s){const e=s,t={md:ot,lg:at},i=S(),{width:o}=Q(i),r=D(()=>{const m=[];for(const[c,w]of e.breakpoint.entries())o.value>=t[w]&&m.push(e.triggerClass[c]);return m});return(m,c)=>(n(),d("div",{ref_key:"containerRef",ref:i,class:h(r.value)},[g(m.$slots,"default")],2))}}),rt={key:0,class:"tw-flex tw-items-center tw-w-4 !tw-pr-0"},dt={class:"item__userpic"},ut={class:"item__username"},mt=$({__name:"ContactsListRow",props:{columns:{},columnsWidths:{},isHeader:{type:Boolean},isSelected:{type:Boolean},isHighlighted:{type:Boolean},isBulkSelectMode:{type:Boolean},withLastAction:{type:Boolean}},setup(s){const e=s;return(t,i)=>(n(),d("div",{class:h(["item",{header:e.isHeader,selected:e.isSelected,"with-last-action":e.withLastAction,highlighted:e.isHighlighted}])},[e.isBulkSelectMode?(n(),d("div",rt,[g(t.$slots,"checkbox",{},void 0,!0)])):W("",!0),a("div",dt,[g(t.$slots,"userpic",{},void 0,!0)]),a("div",ut,[g(t.$slots,"name",{},void 0,!0)]),(n(!0),d(R,null,T(e.columns||[],o=>(n(),d("div",{key:o.id,class:h([`width-${e.columnsWidths[o.id]??"m"}`,{"item__last-action":o.id==="last_action",item__secondary:o.id!=="last_action"}])},[g(t.$slots,o.id,{},void 0,!0)],2))),128))],2))}});const K=F(mt,[["__scopeId","data-v-ad1aeabe"]]),_t={class:"wa-checkbox"},ht=["checked"],pt=a("span",null,[a("span",{class:"icon"},[a("i",{class:"fas fa-check"})])],-1),ft={class:"tw-truncate tw-leading-none tw-py-2 semibold"},wt={key:0,class:"fas fa-eye-slash gray"},vt=["title"],gt=$({__name:"ContactsListItem",props:{contact:{},columns:{},columnsWidths:{},bulkSelectIds:{},isBulkSelectMode:{type:Boolean},selected:{type:Boolean}},setup(s){const e=s,t=S(),i=D(()=>{var o;return(o=e.contact.tags)!=null&&o.length&&t.value?t.value.innerHTML:""});return(o,r)=>{const m=V("RouterLink");return n(),b(K,{columns:e.columns,"columns-widths":e.columnsWidths,"is-bulk-select-mode":e.isBulkSelectMode,"is-selected":e.selected,"is-highlighted":(e.bulkSelectIds||[]).includes(e.contact.id),"with-last-action":!!e.contact.last_action},q({checkbox:p(()=>[a("span",_t,[a("input",{type:"checkbox",checked:(e.bulkSelectIds||[]).includes(e.contact.id)},null,8,ht),pt])]),userpic:p(()=>[I(ct,{url:e.contact.userpic,size:32},null,8,["url"])]),name:p(()=>[z((n(),d("div",ft,[H(A(e.contact.name),1)])),[[v(P),e.contact.name,void 0,{right:!0,500:!0}]]),e.contact.acl==="own"?(n(),d("i",wt)):W("",!0)]),last_action:p(()=>[e.contact.last_action?(n(),b(it,{key:0,"contact-id":e.contact.id,action:e.contact.last_action},null,8,["contact-id","action"])):W("",!0)]),tags:p(()=>[a("div",{ref_key:"tagsRef",ref:t},[z((n(),b(nt,{nowrap:!0,class:"tw-gap-2"},{default:p(()=>[(n(!0),d(R,null,T(e.contact.tags,c=>(n(),b(lt,{key:c.id,class:"custom-m-0 small"},{default:p(()=>[I(m,{to:{name:"tag",params:{id:c.id}},class:h(o.$constant.parentAppDisableRouterClass)},{default:p(()=>[H(A(c.name),1)]),_:2},1032,["to","class"])]),_:2},1024))),128))]),_:1})),[[v(P),{allowHTML:!0,placement:"top-start",content:i.value},void 0,{500:!0,updated:!0}]])],512)]),_:2},[T(e.contact.fields.filter(c=>!["name","last_action","tags"].includes(c.id)),c=>({name:c.id,fn:p(()=>[a("div",{title:Array.isArray(c.value)?c.value.filter(w=>w).join(", "):c.value,class:"tw-truncate"},A(Array.isArray(c.value)?c.value.filter(w=>w).join(", "):c.value),9,vt)])}))]),1032,["columns","columns-widths","is-bulk-select-mode","is-selected","is-highlighted","with-last-action"])}}}),kt={class:"tw-group/cell tw-flex tw-items-center tw-space-x-2 tw-justify-between tw-w-full"},yt=["title"],Ct={key:0,class:"icon"},bt=a("i",{class:"fas fa-sort-amount-down-alt"},null,-1),St=[bt],$t={key:1,class:"icon"},xt=a("i",{class:"fas fa-sort-amount-down"},null,-1),It=[xt],Lt={key:1,class:"tw-flex tw-items-center tw-space-x-2"},Wt=a("i",{class:"fas fa-arrow-left"},null,-1),Tt=[Wt],At=a("i",{class:"fas fa-arrow-right"},null,-1),Bt=[At],Rt=$({__name:"ContactsListHeaderCell",props:{id:{},name:{},sort:{},width:{}},emits:["changeWidth","toggleAsc"],setup(s,{emit:e}){const t=s;return(i,o)=>(n(),d("div",kt,[a("div",{class:h(["tw-truncate semibold tw-uppercase tw-text-sm tw-h-6 tw-leading-7",{gray:t.id!==t.sort.field}]),title:t.name},A(t.name),11,yt),a("div",{class:h(["tw-flex group-hover/cell:tw-flex tw-flex-auto tw-items-center tw-space-x-2",{"tw-hidden":t.id!==t.sort.field}])},[t.id!=="tags"?(n(),d("div",{key:0,class:h(["tw-cursor-pointer hover:tw-opacity-100",{"tw-opacity-30":t.id!==t.sort.field}]),onClick:o[0]||(o[0]=r=>e("toggleAsc",t.sort.field===t.id?t.sort.asc?0:1:0))},[t.sort.field!==t.id||t.sort.asc||0?(n(),d("span",Ct,St)):(n(),d("span",$t,It))],2)):W("",!0),["name","last_action"].includes(t.id)?W("",!0):(n(),d("div",Lt,[a("div",{class:h(["tw-cursor-pointer",{"tw-opacity-30":t.width==="s"}]),onClick:o[1]||(o[1]=()=>{t.width!=="s"&&e("changeWidth","prev")})},Tt,2),a("div",{class:h(["tw-cursor-pointer",{"tw-opacity-30":t.width==="l"}]),onClick:o[2]||(o[2]=()=>{t.width!=="l"&&e("changeWidth","next")})},Bt,2)]))],2)]))}}),Et=$({__name:"ContactsListHeader",props:{columns:{},columnsWidths:{}},setup(s){const e=s;return(t,i)=>(n(),b(K,{columns:e.columns,"columns-widths":e.columnsWidths,"is-header":!0},q({_:2},[T([{id:"name",name:t.$t("name")},...e.columns||[]],o=>({name:o.id,fn:p(()=>[g(t.$slots,"default",{colId:o.id,colName:o.name,colWidth:e.columnsWidths[o.id]})])}))]),1032,["columns","columns-widths"]))}}),j=X(["s","m","l"]),B=S(),k=S({});let M=!1;E(()=>{var s;return(s=B.value)==null?void 0:s.fields},s=>{s&&(k.value=Object.fromEntries(s.map(e=>{var t,i;return[e,k.value[e]??((i=(t=L.contact_list_columns)==null?void 0:t.find(o=>o.field===e))==null?void 0:i.width)??"m"]})))},{immediate:!0});E([()=>{var s;return(s=B.value)==null?void 0:s.sort},()=>{var s;return(s=B.value)==null?void 0:s.asc}],async([s,e])=>{var t;if(!M){const{response:i}=await U("crm.user.settings.save").patch({contact_list_sort:{field:s,asc:e}});(t=i.value)!=null&&t.ok&&typeof s=="string"&&(L.contact_list_sort={field:s,asc:!!e})}});async function Mt(s,e){var t,i;if(j.state.value=k.value[s],k.value[s]=j[e](),!M){const{response:o}=await U("crm.user.settings.save").patch({contact_list_columns:Object.entries(k.value).map(([r,m])=>({field:r,width:m}))});(t=o.value)!=null&&t.ok&&((i=L.contact_list_columns)==null||i.forEach((r,m)=>{r.field===s&&L.contact_list_columns&&(L.contact_list_columns[m].width=k.value[s])}))}}function Nt(s,e=!1){return B.value=s,M=e,{columnsWidths:k,changeWidth:Mt}}const G=s=>(et("data-v-ef047bc6"),s=s(),st(),s),zt=G(()=>a("i",{class:"fas fa-chevron-left"},null,-1)),Ht=[zt],Ot=G(()=>a("i",{class:"fas fa-chevron-right"},null,-1)),Pt=[Ot],jt={class:"tw-sticky tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 tw-w-fit"},Dt=$({__name:"ContactsListItems",props:{contacts:{},headerColumns:{},sort:{},fetchParams:{},disableSyncSettings:{type:Boolean},bulkSelectIds:{},activeContactId:{},contextContactId:{},prevOffset:{},bulkSelectMode:{type:Boolean}},emits:["updateFetchParams","bulkSelectToggle"],setup(s,{emit:e}){const t=s,{columnsWidths:i,changeWidth:o}=Nt(t.fetchParams,t.disableSyncSettings),r=S(null),m=S(!1),{x:c,arrivedState:w}=Y(r,{throttle:200});Z(r,u=>{const l=u[0];m.value=l.target.scrollWidth>l.target.clientWidth}),E(()=>t.prevOffset,async()=>{var l;const u=(l=r.value)==null?void 0:l.querySelector("[data-id]");if(u){const y=u.offsetTop;await tt(),r.value&&(r.value.scrollTop=u.offsetTop-y)}});async function J(){var l;const u=t.contextContactId||t.activeContactId;u&&r.value&&(r.value.scrollTop=((l=r.value.querySelector(`[data-id="${u}"]`))==null?void 0:l.offsetTop)??0)}function N(u){var C;const l=Array.from(((C=r.value)==null?void 0:C.querySelectorAll(".header > div"))||[]).map(f=>f.offsetLeft),y=l.splice(3),_=u==="next"?y.find(f=>f>c.value+l[2]):y.reverse().find(f=>f<c.value+l[2]);c.value=(_??l[2])-l[2]}return(u,l)=>{const y=V("router-link");return n(),d("div",{ref_key:"scrollableContainerRef",ref:r,class:h(["tw-overflow-x-auto tw-scrollbar-hide tw-relative",{isStuck:v(c)>1}]),onVnodeMounted:J},[a("div",{class:h([{"tw-hidden":!m.value},"tw-sticky tw-top-1 tw-left-0 tw-w-full tw-z-30"])},[a("div",{class:h([{"tw-opacity-30":v(w).left},"col-nav tw-left-0"]),onClick:l[0]||(l[0]=O(_=>N("prev"),["prevent"]))},Ht,2),a("div",{class:h([{"tw-opacity-30":v(w).right},"col-nav tw-right-0"]),onClick:l[1]||(l[1]=O(_=>N("next"),["prevent"]))},Pt,2)],2),I(Et,{columns:u.headerColumns,"columns-widths":v(i)},{default:p(({colId:_,colName:C,colWidth:f})=>[I(Rt,{id:_,name:C,width:f,sort:t.sort,onChangeWidth:x=>v(o)(_,x),onToggleAsc:x=>e("updateFetchParams",{sort:_,asc:x})},null,8,["id","name","width","sort","onChangeWidth","onToggleAsc"])]),_:1},8,["columns","columns-widths"]),g(u.$slots,"lazyloadUp",{},void 0,!0),(n(!0),d(R,null,T(t.contacts,_=>(n(),b(y,{key:_.id,to:{name:"contact",params:{id:_.id}},custom:""},{default:p(({isActive:C,navigate:f})=>[I(gt,{contact:_,columns:t.headerColumns,"columns-widths":v(i),"bulk-select-ids":t.bulkSelectIds,"is-bulk-select-mode":t.bulkSelectMode,selected:C,"data-id":_.id,onClick:x=>{t.bulkSelectMode?e("bulkSelectToggle",[_.id,x.shiftKey]):f()}},null,8,["contact","columns","columns-widths","bulk-select-ids","is-bulk-select-mode","selected","data-id","onClick"])]),_:2},1032,["to"]))),128)),a("div",jt,[g(u.$slots,"lazyloadDown",{},void 0,!0)])],2)}}});const Qt=F(Dt,[["__scopeId","data-v-ef047bc6"]]);export{Qt as C,Jt as _};
