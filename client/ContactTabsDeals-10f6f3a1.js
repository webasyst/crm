import{d as v,a as o,J as h,z as w,W as g,N as x,g as i,o as c,b as l,w as y,h as b,v as k,c as C,i as I}from"./main-ec0df6a4.js";import{v as B}from"./index-8d873219.js";import{_ as D}from"./DealsListTable.vue_vue_type_style_index_0_lang-3e54e011.js";import{S as N}from"./SkeletonList-192ed29f.js";import"./DealsItemAmount.vue_vue_type_style_index_0_lang-d3817178.js";import"./tags-11dad524.js";import"./helpers-a2ed4cd9.js";import"./vTooltip-c8fe82a0.js";import"./ChipsList-64240846.js";import"./UserPic-87c13a4a.js";import"./index-4793d891.js";import"./dayjs-44a66bd3.js";import"./currency-format-0c135c5b.js";import"./ContactsListItemAction.vue_vue_type_script_setup_true_lang-37a8a184.js";import"./date-8ac6c57c.js";import"./EmptyList-9d13a159.js";import"./CustomColumn-959e6ffe.js";const S={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},T=I("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1),z=[T],n=20,U=v({__name:"ContactTabsDeals",props:{contactId:{}},setup(m){const u=m,f=["stage_id","name","states","create_datetime","amount","user_name","tags","last_action"],e=o({contact_id:u.contactId,fields:["last_action"],limit:n,offset:0}),a=o(0),s=o([]),{data:p,isFetching:r}=h(w(()=>`crm.deal.list?${g.stringify(e.value)}`),{immediate:!0,refetch:!0}).get().json();x(p,t=>{t&&(t.params.offset>0?s.value=[...s.value||[],...t.data]:s.value=t.data,a.value=t.params.total_count,e.value.offset=t.params.offset)});function _(){e.value.offset+n>=a.value||(e.value.offset+=n)}return(t,F)=>i(r)&&e.value.offset===0?(c(),l(N,{key:0,class:"contact-tabs-deals__container","row-height":"130px"})):(c(),l(D,{key:1,class:"contact-tabs-deals__container","tile-view":!0,deals:s.value,"use-columns-ids":f},{lazy:y(()=>[b((c(),C("div",S,z)),[[k,s.value.length<a.value],[i(B),([{isIntersecting:d}])=>{d&&!i(r)&&_()}]])]),_:1},8,["deals"]))}});export{U as default};
