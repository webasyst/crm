import{U as g}from"./UserPic-88a434b2.js";import{d as M,a as f,A as k,R as E,aP as U,o as r,b as v,w as c,c as m,e as _,F as I,l as V,f as S,i as u,U as L,af as x,n as N,p as $,r as F,ac as R,ax as K,k as D,g as b,X as P,x as W}from"./main-14ee4927.js";import{M as j,D as A,_ as O}from"./DropDown-3d660bad.js";import{C as B}from"./CustomColumn-9af7d856.js";const T=["placeholder"],X=["onClick"],q={class:"tw-flex-auto tw-overflow-hidden"},G=["onClick"],H=u("i",{class:"fas fa-trash-alt gray"},null,-1),J=[H],Q=M({__name:"InputWithDropDown",props:{items:{},value:{},textValue:{},isMultiple:{type:Boolean},placeholder:{},onEnter:{type:Function},onItemSelect:{type:Function}},emits:["input","update","focus"],setup(h,{emit:p}){const e=h,d=f(),n=f(!1),s=f(new Set(e.value)),i=k(()=>R([null,...e.items])),t=k(()=>e.textValue?"value":"");E(s,l=>{p("update",[...l])},{deep:!0}),U(d,()=>{n.value=!1});function w(l){p("input",l.target.value),n.value=!0}function z(l){p("focus",l.target.value),n.value=!0}function C(l,a){if(l){if(e.onItemSelect){e.onItemSelect(l),n.value=!1;return}e.isMultiple||s.value.clear(),s.value.add(l),n.value=!1,a&&a.target.blur()}else e.onEnter&&a&&a.target.value&&(e.onEnter(a.target.value),a.target.blur(),n.value=!1)}return(l,a)=>(r(),v(B,{space:"4"},{default:c(()=>[e.isMultiple||!s.value.size?(r(),m("div",{key:0,ref_key:"inputRef",ref:d,class:"tw-w-full"},[_(A,{open:n.value,"disable-click-outside":!0,"prevent-toggler":!0,"max-height":"350px"},{body:c(()=>[e.items.length?(r(),v(j,{key:0},{default:c(()=>[(r(!0),m(I,null,V(e.items,(o,y)=>(r(),v(O,{key:y},{default:c(()=>[u("a",{class:N({"tw-bg-waBackground":i.value.index.value===y+1}),onClick:$(se=>C(o),["prevent"])},[F(l.$slots,"item",{item:o})],10,X)]),_:2},1024))),128))]),_:3})):S("",!0)]),default:c(()=>[u("input",L({type:"text",placeholder:e.placeholder,[t.value||""]:e.textValue,class:"tw-w-full",onInput:w,onKeyup:a[0]||(a[0]=x(o=>{C(i.value.state.value,o)},["enter"])),onKeydown:[a[1]||(a[1]=x($(o=>i.value.prev(),["prevent"]),["up"])),a[2]||(a[2]=x($(o=>i.value.next(),["prevent"]),["down"]))],onFocus:z}),null,16,T)]),_:3},8,["open"])],512)):S("",!0),_(B,{space:"2"},{default:c(()=>[(r(!0),m(I,null,V(s.value,o=>(r(),m("div",{key:o.id,class:"tw-flex tw-items-center tw-space-x-2"},[u("div",q,[F(l.$slots,"listItem",{item:o})]),u("a",{onClick:y=>s.value.delete(o)},J,8,G)]))),128))]),_:3})]),_:3}))}}),Y={class:"icon size-20"},Z=["title"],ee={class:"tw-flex tw-items-center tw-space-x-2"},te={class:"icon size-20"},ae=["title"],ie=M({__name:"InputWithContacts",props:{modelValue:{default:()=>[]},isMultiple:{type:Boolean,default:!0},isCompany:{type:Boolean},textValue:{},onEnter:{},onItemSelect:{}},emits:["update:modelValue"],setup(h,{emit:p}){const e=h,d=f([]),n=K(async s=>{const i=s.includes("@")?"email":/^[+\-0-9() ]+$/.test(s)?"phone":"name.name",{data:t}=await P(`crm.contact.list?hash=crmSearch/contact_info.${i}*=${encodeURIComponent(`${W(s)}${e.isCompany?"&contact_info.contact_type.company=1":""}`)}&limit=10`).get().json();t.value&&(d.value=t.value.data)},300);return(s,i)=>(r(),v(Q,{items:d.value.filter(t=>!e.modelValue.map(w=>w.id).includes(t.id)),value:e.modelValue,"text-value":e.textValue,"is-multiple":e.isMultiple,placeholder:s.$t("search"),"on-enter":e.onEnter,"on-item-select":e.onItemSelect,onInput:b(n),onFocus:b(n),onUpdate:i[0]||(i[0]=t=>{p("update:modelValue",t)})},{item:c(({item:t})=>[u("div",Y,[_(g,{url:t.userpic,size:20},null,8,["url"])]),u("span",{class:"tw-truncate",title:t.name},D(t.name),9,Z)]),listItem:c(({item:t})=>[u("div",ee,[u("div",te,[_(g,{url:t.userpic,size:20},null,8,["url"])]),u("span",{class:"tw-truncate small",title:t.name},D(t.name),9,ae)])]),_:1},8,["items","value","text-value","is-multiple","placeholder","on-enter","on-item-select","onInput","onFocus"]))}});export{ie as _,Q as a};
