import{d as y,a as n,U as x,A,P as F,a5 as _,ak as S,o as i,c as d,i as s,k as f,e as B,w as v,m as T,p as N,b as h,h as b,v as E,g as w,al as L,am as O,q as $,s as M,a7 as P,_ as R}from"./main-07d84941.js";import{v as V}from"./index-c6ad4004.js";import{_ as U}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-6d140fe9.js";import Y from"./FormDealAdd-c6643b32.js";import{S as j}from"./SkeletonList-6c298ef0.js";import{_ as q}from"./DealsListTable.vue_vue_type_style_index_0_lang-cf7971ad.js";import"./fields-198fafc2.js";import"./FieldString-83da0a5f.js";import"./FieldSelect-efa962b1.js";import"./FieldCheckbox-eb6fe774.js";import"./CustomColumn-36c752a1.js";import"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-990cc429.js";import"./SortableList.vue_vue_type_script_setup_true_lang-e995921a.js";import"./useSortable-85e98846.js";import"./InputWithContacts.vue_vue_type_script_setup_true_lang-4ab9d7cb.js";import"./UserPic-6b99ec27.js";import"./InputWithDropDown.vue_vue_type_script_setup_true_lang-71ea280f.js";import"./MenuList-1948b71a.js";import"./DropDown-d3d1a4c6.js";import"./InputWithPerformers.vue_vue_type_script_setup_true_lang-cca5371f.js";import"./recentContacts-f5cbf16b.js";import"./dayjs-ec756e3b.js";import"./index-00e882cb.js";import"./WaSpinner-40f3d131.js";import"./TextAreaAutoresize-4cf6468e.js";import"./ButtonSubmit-7647b2fd.js";import"./DealsItemAmount.vue_vue_type_style_index_0_lang-3bd2ae6b.js";import"./vTooltip-05cbcfb0.js";import"./ChipsList-c29e2863.js";import"./currency-format-3aa2cf22.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-ab9b3926.js";import"./date-36998e6d.js";import"./EmptyList-3dbbfbca.js";const D=a=>($("data-v-821c9240"),a=a(),M(),a),z={class:"form-deals-contact tw-p-4"},G=["onClick"],H=D(()=>s("span",{class:"icon tw-mr-1"},[s("i",{class:"fas fa-plus-circle"})],-1)),J={class:"tw-mt-3 tw-h-full"},K={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},Q=D(()=>s("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1)),W=[Q],l=20,X=y({__name:"FormDealsContact",props:{contactId:{}},setup(a){const p=a,C=["stage_id","name","states","create_datetime","amount","user_name"],e=n(null),r=n(0),o=n({contact_id:p.contactId,limit:l,offset:0}),{data:I,isFetching:g,execute:m}=x(A(()=>`crm.deal.list?${P.stringify(o.value)}`),{refetch:!0}).get().json();m(),F(I,t=>{t&&(t.params.offset>0?e.value=[...e.value||[],...t.data]:e.value=t.data,r.value=t.params.total_count,o.value.offset=t.params.offset)}),_(L).on(t=>{e.value&&S(t,e.value)}),_(O).on(()=>{u()});function k(){o.value.offset+l>=r.value||(o.value.offset+=l)}function u(){e.value=null,o.value.offset===0?m():o.value.offset=0}return(t,Z)=>(i(),d("div",z,[s("h3",null,f(t.$t("Deals")),1),B(U,{component:Y,"component-props":{contactId:p.contactId,disableNavigateToDeal:!0,onAdded:u}},{default:v(({open:c})=>[s("button",{class:"button",onClick:N(c,["prevent"])},[H,T(" "+f(t.$t("newDeal")),1)],8,G)]),_:1},8,["component-props"]),s("div",J,[e.value?(i(),h(q,{key:0,deals:e.value,"use-columns-ids":C,"navigate-route-name":"dealByContactFrame"},{lazy:v(()=>[b((i(),d("div",K,W)),[[E,e.value.length<r.value],[w(V),([{isIntersecting:c}])=>{c&&!w(g)&&k()}]])]),_:1},8,["deals"])):(i(),h(j,{key:1,"row-height":"100px"}))])]))}});const Et=R(X,[["__scopeId","data-v-821c9240"]]);export{Et as default};
