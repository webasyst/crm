import{_ as ie}from"./ViewWithSidebar.vue_vue_type_style_index_0_lang-ddb54da3.js";import{_ as z,o as e,c as a,r as K,d as I,u as re,a as A,b as g,w as m,e as p,f as $,g as c,n as R,h as Q,v as ce,i as t,t as x,j as M,k as y,F as v,l as V,m as F,p as O,q as U,s as j,x as le,y as de,z as W,A as P,B as H,C as X,D as ue,E as _e,G as me,H as pe,I as he,J as fe,K as ge}from"./main-49799bbb.js";import{u as ye}from"./recentContacts-0e0dbd30.js";import{U as T}from"./UserPic-0ac47e38.js";import{M as Y,_ as Z}from"./MenuList-7aba2312.js";import{C as q}from"./CustomColumn-69543086.js";import{u as ve,_ as $e}from"./FormSegmentUpdate.vue_vue_type_script_setup_true_lang-377ab6f1.js";import{_ as Se}from"./InputWithContacts.vue_vue_type_script_setup_true_lang-d19d385b.js";import{_ as ee}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-2cbf507f.js";import{_ as ke,u as be}from"./FormContactUpdate.vue_vue_type_script_setup_true_lang-94d75ad0.js";import{u as we}from"./useSortable-2cae4f7d.js";import{v as Ce}from"./vTooltip-05cbcfb0.js";import{h as xe}from"./longTouch-2a1e2d51.js";import{a as Ie}from"./alert-54b0613f.js";import{_ as Le}from"./TagsCloud.vue_vue_type_script_setup_true_lang-1b1fc392.js";import"./FieldString-194c706e.js";import"./FieldCheckbox-3d76d976.js";import"./validation-0b7609dc.js";import"./InputWithDropDown.vue_vue_type_script_setup_true_lang-6c69cc73.js";import"./DropDown-a179a782.js";import"./index-824b3191.js";import"./fields-c0b43be5.js";import"./FieldSelect-ba9fc41b.js";import"./InputWithUsers.vue_vue_type_script_setup_true_lang-2d28a965.js";import"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-7b625765.js";import"./SortableList.vue_vue_type_script_setup_true_lang-eb182ea4.js";import"./ChipsList-2cf36f72.js";import"./emit-3c4bd418.js";const Re={},Ne={class:"heading"};function Be(d,s){return e(),a("div",Ne,[K(d.$slots,"default",{},void 0,!0)])}const Ve=z(Re,[["render",Be],["__scopeId","data-v-4abea35f"]]),He={key:0,class:"caret tw-w-3 tw-flex-none"},Te=t("i",{class:"fas fa-caret-right"},null,-1),Ae=[Te],te=I({__name:"AccordionSidebar",props:{showCaret:{type:Boolean},openOnInitial:{type:Boolean},disabled:{type:Boolean},storageKey:{}},setup(d){const s=d,l=s.storageKey?re(`sidebar-accordions-${s.storageKey}`,s.openOnInitial):A(s.openOnInitial);return(_,n)=>(e(),g(q,{space:"2"},{default:m(()=>[p(Ve,{class:R({open:c(l)}),onClick:n[0]||(n[0]=()=>{s.disabled||(l.value=!c(l))})},{default:m(()=>[s.showCaret?(e(),a("span",He,Ae)):$("",!0),K(_.$slots,"header",{isOpen:c(l)})]),_:3},8,["class"]),Q(t("div",null,[K(_.$slots,"default")],512),[[ce,c(l)]])]),_:3}))}});const G=d=>(U("data-v-9a18827c"),d=d(),j(),d),Fe={class:"tw-px-4"},Oe={key:0,class:"skeleton"},ze={key:0,class:"tw-pl-4 small gray"},Me=["title"],De=["onClick"],Ee={key:0},Ke=G(()=>t("i",{class:"fas fa-spinner text-yellow tw-animate-spin"},null,-1)),Pe=[Ke],Ue={key:1},je=G(()=>t("i",{class:"fas fa-star text-yellow"},null,-1)),qe=[je],Ge={key:2},Je=G(()=>t("i",{class:"far fa-star text-light-gray"},null,-1)),Qe=[Je],We=I({__name:"ContactsSidebarRecent",setup(d){const s=ye(),{pinned:l,recent:_,isFetching:n,error:i,fetchingIds:h,pin:S}=x(s);return s.refetch(),(o,b)=>{const w=M("RouterLink");return e(),g(te,{"show-caret":!0,"open-on-initial":!0,"storage-key":"recent"},{header:m(()=>[t("span",null,y(o.$t("recentContacts")),1)]),default:m(()=>[t("div",Fe,[c(n)?(e(),a("div",Oe,[(e(),a(v,null,V(8,r=>t("div",{ref_for:!0,ref:"lineRef",key:r,class:"skeleton-line"})),64))])):c(i)?(e(),a(v,{key:1},[F(y(c(i)),1)],64)):(e(),a(v,{key:2},[![...c(l),...c(_)].length&&!c(n)?(e(),a("div",ze,y(o.$t("emptyList")),1)):$("",!0),p(Y,null,{default:m(()=>[(e(!0),a(v,null,V([c(l),c(_)],(r,k)=>(e(),a(v,{key:k},[(e(!0),a(v,null,V(r,f=>(e(),g(Z,{key:f.id,class:"rounded selected"},{default:m(()=>[p(w,{to:{name:"contact",params:{id:f.id}},class:R(o.$constant.parentAppDisableRouterClass)},{default:m(()=>[p(T,{url:f.userpic,size:20},null,8,["url"]),t("div",{class:"tw-flex-auto tw-truncate",title:f.name},y(f.name),9,Me),t("span",{class:"count",onClick:O(L=>c(S)(f.id,!!k),["stop","prevent"])},[c(h).has(f.id)?(e(),a("span",Ee,Pe)):$("",!0),!c(h).has(f.id)&&k===0?(e(),a("span",Ue,qe)):$("",!0),!c(h).has(f.id)&&k===1?(e(),a("span",Ge,Qe)):$("",!0)],8,De)]),_:2},1032,["to","class"])]),_:2},1024))),128))],64))),128))]),_:1})],64))])]),_:1})}}});const Xe=z(We,[["__scopeId","data-v-9a18827c"]]),Ye={class:"tw-px-4"},Ze={class:"tw-flex tw-space-x-2 tw-items-center tw-w-full"},et={class:"tw-flex-auto"},tt=t("i",{class:"fas fa-filter gray"},null,-1),st=[tt],nt={class:"tw-flex-none"},ot=["onClick","onVnodeMounted"],at=t("i",{class:"fas fa-user-plus"},null,-1),it=[at],rt={class:"tw-flex-none md:tw-hidden"},ct=t("i",{class:"fas fa-sliders-h black"},null,-1),lt=[ct],dt=I({__name:"ContactsSidebarFilter",setup(d){const{showSidebar:s}=x(ve());function l(_,n){if(!n)return;n=le(n);const i=n.includes("@")?"email":/^[+\-0-9() ]+$/.test(n)?"phone":"name.name";_.push({name:"search",params:{id:`contact_info.${i}*=${n}`}})}return(_,n)=>(e(),a("div",Ye,[t("div",Ze,[t("div",et,[p(Se,{"on-enter":i=>l(_.$router,i),"on-item-select":i=>{_.$router.push({name:"contact",params:{id:i.id}})}},null,8,["on-enter","on-item-select"])]),t("div",{class:"tw-flex-none icon tw-cursor-pointer",onClick:n[0]||(n[0]=i=>_.$router.push({name:"detailedSearch"}))},st),t("div",nt,[p(ee,{component:ke},{default:m(({open:i})=>[t("button",{class:"circle",onClick:O(i,["prevent"]),onVnodeMounted:h=>_.$route.path==="/contact/new/"&&i()},it,8,ot)]),_:1})]),t("div",rt,[t("button",{class:"circle transparent",onClick:n[1]||(n[1]=O(i=>s.value=!c(s),["prevent"]))},lt)])])]))}}),ut=d=>(U("data-v-12cf976d"),d=d(),j(),d),_t={class:"bricks"},mt=["onClick"],pt={class:"icon"},ht=["src","alt"],ft={class:"count"},gt=["onClick"],yt=ut(()=>t("span",{class:"icon"},[t("i",{class:"fas fa-users"})],-1)),vt={class:"count"},$t=I({__name:"ContactsSidebarBricks",setup(d){const{allContactsTotal:s}=x(de()),{responsibles:l}=x(W()),_=P(()=>{var n;return((n=l.value.find(i=>i.responsible.id===H.user.id))==null?void 0:n.count)??0});return(n,i)=>{const h=M("RouterLink");return e(),a("div",_t,[p(h,{to:{name:"myContacts"},custom:""},{default:m(({isExactActive:S,navigate:o})=>[t("div",{class:R(["brick",{selected:S}]),onClick:o},[t("span",pt,[t("img",{src:c(H).user.userpic,alt:c(H).user.name,class:"userpic"},null,8,ht)]),t("span",ft,y(_.value),1),F(" "+y(n.$t("myContacts")),1)],10,mt)]),_:1}),p(h,{to:{name:"contacts"},custom:""},{default:m(({isExactActive:S,navigate:o})=>[t("div",{class:R(["brick",{selected:S}]),onClick:o},[yt,t("span",vt,y(c(s)),1),F(" "+y(n.$t("allContacts")),1)],10,gt)]),_:1})])}}});const St=z($t,[["__scopeId","data-v-12cf976d"]]),se=d=>(U("data-v-a3053bb5"),d=d(),j(),d),kt=["href","onClick"],bt={key:0,class:"icon size-20"},wt=se(()=>t("i",{class:"fas fa-spinner wa-animation-spin"},null,-1)),Ct=[wt],xt={class:"count"},It={key:0,class:"icon handle tw-hidden group-hover/segment:tw-block"},Lt=se(()=>t("i",{class:"fas fa-grip-vertical"},null,-1)),Rt=[Lt],Nt={class:"tw-truncate"},Bt={class:"tw-inline-block tw-max-w-full tw-truncate"},Vt=I({__name:"ContactsSidebarSegmentList",props:{isSortList:{type:Boolean},id:{},routeName:{},items:{},hasHover:{type:Boolean}},setup(d){const s=d,l={mySegment:"my",sharedSegment:"shared"},{updateOrderInSegment:_}=X(),n=A(),i=A(null);let h;s.isSortList&&ue(()=>{var o;return n.value&&((o=s.items)==null?void 0:o.length)},()=>{h=we(n.value,s.items,{handle:".handle",animation:150,delayOnTouchOnly:!0,delay:150,forceFallback:!0,fallbackOnBody:!1,onUpdate:async o=>{const{itemId:b}=o.item.dataset,{newIndex:w,oldIndex:r}=o,k=()=>{typeof w=="number"&&typeof r=="number"&&me(o.from,o.item,w<r?r+1:r)},f=Array.from(o.from.children).map(B=>{const{itemId:D}=B.dataset;return S(D)}),L=s.id;i.value=S(b),h.option("disabled",!0);const{error:N}=await _(l[L],f);N.value&&(k(),Ie(N.value)),setTimeout(()=>{h.option("disabled",!1),i.value=null},100)}})}),_e(()=>{h&&h.stop()});function S(o){if(!o||isNaN(Number(o)))throw new Error(`parse data-item-id="${o}"`);return Number(o)}return(o,b)=>{const w=M("RouterLink");return e(),g(Y,{ref_key:"ulRef",ref:n,"data-list-id":s.id},{default:m(()=>[(e(!0),a(v,null,V(s.items,r=>(e(),g(w,{key:r.id,to:{name:s.routeName,params:{id:r.id}},custom:""},{default:m(({isActive:k,href:f,navigate:L})=>[p(Z,{selected:k,"data-item-id":r.id,class:R(["tw-group/segment",{handle:!o.hasHover}])},{default:m(()=>[t("a",{href:f,class:R([o.$constant.parentAppDisableRouterClass,"segment-link"]),onClick:L,onContextmenu:b[0]||(b[0]=N=>c(xe)()&&N.preventDefault())},[i.value===r.id?(e(),a("span",bt,Ct)):(e(),a(v,{key:1},["responsible"in r?(e(),g(T,{key:0,size:20,url:r.responsible.userpic},null,8,["url"])):"icon"in r?(e(),g(T,{key:1,size:20,url:r.icon_path,"fa-icon":r.icon,"disable-rounded":!0},null,8,["url","fa-icon"])):"color"in r?(e(),g(T,{key:2,size:20,"fa-icon":"circle","icon-color":r.color},null,8,["icon-color"])):$("",!0)],64)),t("span",xt,[t("span",{class:R(["count-value",{"group-hover/segment:tw-hidden":s.isSortList&&o.hasHover}])},y(r.count),3),s.isSortList&&o.hasHover&&!i.value?(e(),a("span",It,Rt)):$("",!0)]),t("span",Nt,[Q((e(),a("span",Bt,[F(y(r.name),1)])),[[c(Ce),o.hasHover?r.name:null,void 0,{right:!0,700:!0}]])])],42,kt)]),_:2},1032,["selected","data-item-id","class"])]),_:2},1032,["to"]))),128))]),_:1},8,["data-list-id"])}}});const Ht=z(Vt,[["__scopeId","data-v-a3053bb5"]]),Tt={key:0,class:"count"},At=["onClick"],Ft=t("i",{class:"fas fa-plus-circle"},null,-1),Ot=[Ft],zt={key:0,class:"tw-mx-4"},Mt={key:0,class:"tw-pl-4 small gray"},Dt={key:0,class:"tw-pl-8 small gray"},J=I({__name:"ContactsSidebarSegments",props:{only:{},except:{}},setup(d){const s=d,{t:l}=pe(),_=he("(hover: hover)"),n=X(),{sharedSegment:i,archivedSegment:h,mySegment:S,isFetching:o}=x(n);n.refetch();const b=be(),{vaults:w}=x(b);b.refetch();const r=W(),{responsibles:k}=x(r);r.refetch();const f=P(()=>k.value.map(C=>({...C,...C.responsible}))),L=fe(),{tags:N}=x(L);L.refetch();const B=A([{id:"mySegment",name:l("mySegments"),items:S,loading:"segments",routeName:"segment",showPlus:!0},{id:"sharedSegment",name:l("sharedSegments"),items:i,loading:"segments",routeName:"segment",showPlus:!0},{id:"archivedSegment",name:l("archivedSegments"),items:h,loading:"segments",routeName:"segment",showCounter:!0},{id:"tags",name:l("tags"),items:N,loading:"tags",routeName:"tag"},{id:"vaults",name:l("vaults"),items:w,loading:"vaults",routeName:"vault"},{id:"responsibles",name:l("responsibles"),items:f,loading:"responsibles",routeName:"responsible"}]),D=P(()=>C=>{var E;return C==="mySegment"||!!((E=H.rights)!=null&&E.is_admin)&&["sharedSegment"].includes(C)});return(C,E)=>(e(),g(q,{space:"4"},{default:m(()=>[(e(!0),a(v,null,V(s.only?B.value.filter(u=>u.id===s.only):s.except?B.value.filter(u=>u.id!==s.except):B.value,(u,ne)=>(e(),a(v,{key:u.id},[u.id!=="archivedSegment"||u.items.length?(e(),g(te,{key:0,"show-caret":!0,"open-on-initial":!!u.items.length&&ne===0,"storage-key":u.id},{header:m(({isOpen:oe})=>[t("span",null,y(u.name),1),u.showCounter&&!oe?(e(),a("span",Tt,y(u.items.length||""),1)):$("",!0),u.showPlus?(e(),g(ee,{key:1,component:$e,"component-props":{initialShared:u.id==="mySegment"?"0":"1"}},{default:m(({open:ae})=>[t("span",{class:"icon",onClick:O(ae,["stop"])},Ot,8,At)]),_:2},1032,["component-props"])):$("",!0)]),default:m(()=>[u.id==="tags"?(e(),a("div",zt,[!u.items.length&&!c(o)?(e(),a("div",Mt,y(C.$t("emptyList")),1)):$("",!0),p(Le,{"entity-type":"contact",tags:u.items},null,8,["tags"])])):(e(),a(v,{key:1},[!u.items.length&&!c(o)?(e(),a("div",Dt,y(C.$t("emptyList")),1)):(e(),g(Ht,{key:1,id:u.id,"route-name":u.routeName,items:u.items,"is-sort-list":D.value(u.id),"has-hover":c(_)},null,8,["id","route-name","items","is-sort-list","has-hover"]))],64))]),_:2},1032,["open-on-initial","storage-key"])):$("",!0)],64))),128))]),_:1}))}}),Et=I({__name:"ContactsSidebar",setup(d){return(s,l)=>(e(),g(q,{space:"4",class:"tw-my-4"},{default:m(()=>[p(dt),p(St),p(J,{only:"mySegment"}),p(Xe),p(J,{except:"mySegment"})]),_:1}))}}),fs=I({__name:"ContactsView",setup(d){return(s,l)=>{const _=M("RouterView");return e(),g(ie,{slidable:!0,onVnodeMounted:l[0]||(l[0]=n=>{var i;return(i=c(ge))==null?void 0:i.setTitle(s.$t("contacts"))})},{sidebar:m(()=>[p(Et)]),default:m(()=>[p(_)]),_:1},512)}}});export{fs as default};
