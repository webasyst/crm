import{d as F,a0 as E,C as M,m as N,o as r,i as h,w as s,A as P,p as u,a as e,u as t,e as v,b as l,a1 as j,j as C,n as V,t as A,y as T,S as I,l as z,c as b,Z as ae,a2 as ne,a3 as oe,B as D,h as Q,H as le,F as X,a4 as ce,a5 as ie,R as re,k as ue}from"./main-2290994d.js";import{v as de}from"./index-0b6b9def.js";import{S as me}from"./SkeletonList-1c6858f7.js";import{_ as _e}from"./LazyLoadingWithProgress.vue_vue_type_script_setup_true_lang-cce79730.js";import{E as O}from"./EmptyList-239f0622.js";import{C as pe,_ as fe}from"./ContactsListItems-dcfdb99b.js";import{_ as g,M as y,D as U}from"./DropDown-9065f982.js";import{_ as H}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-41c5f744.js";import{_ as Y,a as he,u as ve}from"./FormSegmentUpdate.vue_vue_type_script_setup_true_lang-d064bdfb.js";import{_ as ge,a as $e,b as ke}from"./FormFields.vue_vue_type_script_setup_true_lang-71659d6e.js";import{_ as we,a as Ce,b as ye}from"./DropdownIncludeSegment.vue_vue_type_script_setup_true_lang-50dc170a.js";import{a as be}from"./FieldCheckbox-4d368f68.js";const Se=["disabled","onClick"],Fe=e("br",null,null,-1),Ie=e("br",null,null,-1),De=F({__name:"FormSegmentDelete",props:{segment:{}},emits:["close"],setup(k,{emit:c}){const m=k,_=E(),{isFetching:a,error:d,execute:p}=M().deleteSegment(m.segment.id);async function i(){await p()&&(_.push({name:"contacts"}),c("close"))}return(n,o)=>{const f=N("i18n-t");return r(),h(j,{onClose:o[0]||(o[0]=L=>c("close"))},{header:s(()=>[P(u(n.$t("deleteSegment")),1)]),submit:s(()=>[e("button",{class:"button",disabled:t(a),onClick:v(i,["prevent"])},u(n.$t("delete")),9,Se)]),error:s(()=>[P(u(t(d)),1)]),default:s(()=>[l(f,{tag:"p",keypath:"segmentDeleteMessage"},{newline:s(()=>[Fe,Ie]),_:1})]),_:1})}}}),Pe=["onClick"],Re=["onClick"],Ae=["onClick"],Le=F({__name:"DropdownSegment",props:{segment:{}},setup(k){const c=k,{isFetching:m,execute:_}=M().toggleSegmentArchive(c.segment.id);return(a,d)=>{const p=N("RouterLink");return r(),h(y,null,{default:s(()=>[l(g,null,{default:s(()=>[l(H,{component:Y,"component-props":{segment:c.segment}},{default:s(({open:i})=>[e("a",{onClick:v(i,["prevent"])},u(a.$t("mainSettings")),9,Pe)]),_:1},8,["component-props"])]),_:1}),a.segment.type==="category"?(r(),h(g,{key:0},{default:s(()=>[l(H,{component:he,"component-props":{segment:c.segment}},{default:s(({open:i})=>[e("a",{onClick:v(i,["prevent"])},u(a.$t("addContactsToSegment")),9,Re)]),_:1},8,["component-props"])]),_:1})):C("",!0),a.segment.type==="search"?(r(),h(g,{key:1},{default:s(()=>{var i;return[l(p,{class:V(a.$constant.parentAppDisableRouterClass),to:{name:"updateSegmentFilter",params:{id:a.segment.id,searchHash:(i=a.segment.hash)==null?void 0:i.replace("crmSearch/","")}}},{default:s(()=>[P(u(a.$t("updateSegmentFilter")),1)]),_:1},8,["class","to"])]}),_:1})):C("",!0),l(g,null,{default:s(()=>[e("a",{onClick:d[0]||(d[0]=v(()=>{t(m)||t(_)()},["prevent"]))},u(a.$t(a.segment.archived?"fromArchive":"toArchive")),1)]),_:1}),l(g,null,{default:s(()=>[l(H,{component:De,"component-props":{segment:c.segment}},{default:s(({open:i})=>[e("a",{onClick:v(i,["prevent"])},u(a.$t("deleteSegment")),9,Ae)]),_:1},8,["component-props"])]),_:1})]),_:1})}}}),Te=F({__name:"DropdownSearch",setup(k){var _,a;const{previousFetchParams:c}=A(T()),{show:m}=I(Y,{initialType:"search",initialName:(_=c.value)==null?void 0:_.title,initialHash:(a=c.value)==null?void 0:a.hash});return(d,p)=>{const i=N("RouterLink");return r(),h(y,null,{default:s(()=>[l(g,null,{default:s(()=>{var n,o;return[l(i,{to:{name:"detailedSearch",params:{searchHash:(o=(n=t(c))==null?void 0:n.hash)==null?void 0:o.replace("crmSearch/","")}},class:V(d.$constant.parentAppDisableRouterClass)},{default:s(()=>[P(u(d.$t("updateSearchConditions")),1)]),_:1},8,["to","class"])]}),_:1}),l(g,null,{default:s(()=>[e("a",{onClick:p[0]||(p[0]=v((...n)=>t(m)&&t(m)(...n),["prevent"]))},u(d.$t("saveAsFilter")),1)]),_:1})]),_:1})}}}),xe={class:"tw-flex tw-items-center tw-space-x-2 tw-flex-auto tw-w-1/2"},Be=["title"],He=e("button",{class:"circle light-gray"},[e("i",{class:"fas fa-pen"})],-1),Ve=F({__name:"ContactsListTitle",setup(k){const{getSegmentByHash:c}=M(),{previousFetchParams:m}=A(T()),_=z(()=>{var d;return(d=m.value)!=null&&d.hash?c(m.value.hash):null}),a=z(()=>{var d,p;return _.value?_.value.is_editable?Le:null:(p=(d=m.value)==null?void 0:d.hash)!=null&&p.includes("crmSearch/")?Te:null});return(d,p)=>{var i,n,o,f;return r(),b("div",xe,[e("div",{class:"tw-text-xl tw-font-bold tw-truncate",title:((i=_.value)==null?void 0:i.name)??((n=t(m))==null?void 0:n.title)},u(((o=_.value)==null?void 0:o.name)??((f=t(m))==null?void 0:f.title)),9,Be),a.value?(r(),h(U,{key:0},{body:s(()=>[(r(),h(ae(a.value),ne(oe({segment:_.value})),null,16))]),default:s(()=>[He]),_:1})):C("",!0)])}}}),ze=["src"],ee=F({__name:"FormContactsExportCSV",props:{contactIds:{},hash:{},checkedCount:{}},setup(k){const c=k;return(m,_)=>(r(),h(j,{"hide-buttons":!0},{default:s(()=>[e("iframe",{src:`${t(D).baseUrl}?module=contactOperation&action=export${c.contactIds?`&ids=${c.contactIds.join(",")}`:c.hash?`&hash=${encodeURIComponent(c.hash)}`:""}&checked_count=${c.checkedCount}`,frameborder:"0",class:"tw-w-full",style:{height:"400px"}},null,8,ze)]),_:1}))}}),Me=["disabled","onClick"],Ne={style:{height:"320px","overflow-y":"auto"}},Oe=F({__name:"FormContactAddToSegment",props:{contactIds:{}},emits:["close"],setup(k,{emit:c}){const m=k,_=M(),a=Q(),d=Q();async function p(){a.value&&(d.value=_.includeContactsToSegment(a.value,m.contactIds),await d.value.execute(),d.value.error||c("close"))}return(i,n)=>(r(),h(j,{"use-cancel-as-button-label":!0,onClose:n[1]||(n[1]=o=>c("close"))},{header:s(()=>[P(u(i.$t("addToSegment")),1)]),submit:s(()=>{var o;return[e("button",{disabled:!!((o=d.value)!=null&&o.isFetching)||!a.value,onClick:v(p,["prevent"])},u(i.$t("save")),9,Me)]}),error:s(()=>{var o;return[P(u((o=d.value)==null?void 0:o.error),1)]}),default:s(()=>[e("div",Ne,[l(we,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=o=>a.value=o)},null,8,["modelValue"])])]),_:1}))}}),Ue=F({__name:"FormContactFields",setup(k){const{t:c}=le(),m=["name","lastname","firstname","middlename"],_=[{id:"last_action",name:c("lastAction"),value:"",sort:0},{id:"create_datetime",name:c("createDate"),value:"",sort:0},{id:"tags",name:c("tags"),value:"",sort:0}];return(a,d)=>(r(),h(ge,{scope:"contact","except-fields":m,"static-fields":_,"prepare-fetch-params":p=>({contact_list_columns:p.map(i=>({field:i,width:"m"}))}),"sort-params-if-field-removed":{sort:"name",asc:1}},null,8,["prepare-fetch-params"]))}}),Ee=["onClick"],je=e("div",{class:"icon"},[e("i",{class:"fas fa-table"})],-1),qe=e("div",{class:"icon"},[e("i",{class:"fas fa-exchange-alt"})],-1),Je=["href"],We=e("div",{class:"icon"},[e("i",{class:"fas fa-upload"})],-1),Ze=e("div",{class:"icon"},[e("i",{class:"fas fa-download"})],-1),Ge=F({__name:"DropdownSettings",setup(k){const{previousFetchParams:c}=A(T());return(m,_)=>{const a=N("RouterLink");return r(),h(y,null,{default:s(()=>{var d,p;return[l(g,null,{default:s(()=>[l(H,{component:Ue},{default:s(({open:i})=>[e("a",{onClick:v(i,["prevent"])},[je,e("span",null,u(m.$t("customizeColumns")),1)],8,Ee)]),_:1})]),_:1}),(d=t(D).rights)!=null&&d.is_admin?(r(),b(X,{key:0},[l(g,null,{default:s(()=>[l(a,{to:{name:"mergeDuplicates"}},{default:s(()=>[qe,e("span",null,u(m.$t("mergeDuplicates")),1)]),_:1})]),_:1}),l(g,null,{default:s(()=>[e("a",{href:`${t(D).baseUrl}contact/import/`},[We,e("span",null,u(m.$t("importContacts")),1)],8,Je)]),_:1})],64)):C("",!0),(p=t(D).rights)!=null&&p.export?(r(),h(g,{key:1},{default:s(()=>[e("a",{onClick:_[0]||(_[0]=v(i=>{var n,o;return t(I)(ee,{hash:(n=t(c))==null?void 0:n.hash,checkedCount:((o=t(c))==null?void 0:o.total_count)??0}).show()},["prevent"]))},[Ze,e("span",null,u(m.$t("export")),1)])]),_:1})):C("",!0)]}),_:1})}}}),Ke={key:0,class:"tw-flex tw-space-x-2"},Qe={class:"tw-relative"},Xe={class:"light-gray small tw-flex tw-items-center tw-space-x-2"},Ye=e("i",{class:"fas fa-caret-down"},null,-1),et=["onClick"],tt=e("hr",{class:"tw-m-0"},null,-1),st=["onClick"],at=e("span",{class:"icon"},[e("i",{class:"fas fa-folder-open"})],-1),nt=["onClick"],ot=e("span",{class:"icon"},[e("i",{class:"fas fa-hashtag"})],-1),lt=["onClick"],ct=e("span",{class:"icon"},[e("i",{class:"fas fa-hashtag"})],-1),it=["disabled","onClick"],rt=e("span",{class:"icon"},[e("i",{class:"fas fa-users"})],-1),ut=["onClick"],dt=e("span",{class:"icon"},[e("i",{class:"fas fa-user-circle"})],-1),mt=["onClick"],_t=e("span",{class:"icon"},[e("i",{class:"fas fa-download"})],-1),pt=["onClick"],ft=e("span",{class:"icon"},[e("i",{class:"fas fa-trash-alt"})],-1),ht=e("i",{class:"fas fa-times"},null,-1),vt=[ht],gt={key:1,class:"tw-flex tw-space-x-2"},$t=e("i",{class:"fas fa-check-square"},null,-1),kt={class:"light-gray small"},wt=e("i",{class:"fas fa-ellipsis-h"},null,-1),Ct=e("i",{class:"fas fa-caret-down"},null,-1),yt=F({__name:"ContactsListControls",setup(k){const c=E(),{contacts:m,bulkSelectMode:_,bulkSelectIds:a,lastRouteLocation:d}=A(T()),p=z(()=>JSON.stringify(a.value)===JSON.stringify(m.value.map(n=>n.id)));ce(()=>{_.value=!1}),ie((n,o)=>{d.value=o!=null&&o.name?{name:o.name,params:o.params,query:o.query}:null});function i(){const n=m.value.map(o=>o.id);a.value=p.value?[]:n}return(n,o)=>t(_)?(r(),b("div",Ke,[e("div",Qe,[l(U,{right:!0,"disable-click-outside":!0},{body:s(({hide:f})=>{var L,x;return[l(y,null,{default:s(()=>[l(g,null,{default:s(()=>[e("a",{onClick:v(i,["prevent"])},[l(be,{"model-value":p.value?"1":""},{default:s(()=>[P(u(n.$t("selectAll")),1)]),_:1},8,["model-value"])],8,et)]),_:1})]),_:1}),tt,e("div",{class:V({"tw-opacity-40 tw-pointer-events-none":!t(a).length})},[l(y,null,{default:s(()=>[l(g,null,{default:s(()=>[e("a",{onClick:v(S=>{t(I)(Oe,{contactIds:t(a)}).show(),f()},["prevent"])},[at,e("span",null,u(n.$t("addToSegment")),1)],8,st)]),_:2},1024)]),_:2},1024),l(y,null,{default:s(()=>[l(g,null,{default:s(()=>[e("a",{onClick:v(S=>{t(I)($e,{entityType:"contact",entityIds:t(a)}).show(),f()},["prevent"])},[ot,e("span",null,u(n.$t("addTags")),1)],8,nt)]),_:2},1024)]),_:2},1024),l(y,null,{default:s(()=>[l(g,null,{default:s(()=>[e("a",{onClick:v(S=>{t(I)(ke,{entityType:"contact",entityIds:t(a)}).show(),f()},["prevent"])},[ct,e("span",null,u(n.$t("removeTags")),1)],8,lt)]),_:2},1024)]),_:2},1024),(L=t(D).rights)!=null&&L.is_admin?(r(),h(y,{key:0},{default:s(()=>[l(g,null,{default:s(()=>[e("a",{disabled:t(a).length<2,onClick:v(()=>{t(c).push({name:"merge",query:{ids:t(a).join(",")}}),f()},["prevent"])},[rt,e("span",null,u(n.$t("merge")),1)],8,it)]),_:2},1024)]),_:2},1024)):C("",!0),l(y,null,{default:s(()=>[l(g,null,{default:s(()=>[e("a",{onClick:v(S=>{t(I)(Ce,{contactIds:t(a)}).show(),f()},["prevent"])},[dt,e("span",null,u(n.$t("addResponsible")),1)],8,ut)]),_:2},1024)]),_:2},1024),(x=t(D).rights)!=null&&x.export?(r(),h(y,{key:1},{default:s(()=>[l(g,null,{default:s(()=>[e("a",{onClick:v(S=>{t(I)(ee,{contactIds:t(a),checkedCount:t(a).length}).show(),f()},["prevent"])},[_t,e("span",null,u(n.$t("export")),1)],8,mt)]),_:2},1024)]),_:2},1024)):C("",!0),l(y,null,{default:s(()=>[l(g,null,{default:s(()=>[e("a",{onClick:v(S=>{t(I)(ye,{contactIds:t(a),disableContactsPageRedirect:!0}).show(),f()},["prevent"])},[ft,e("span",null,u(n.$t("delete")),1)],8,pt)]),_:2},1024)]),_:2},1024)],2)]}),default:s(()=>[e("button",Xe,[e("span",null,u(n.$t("selected")),1),e("span",{class:V(["badge smaller",t(a).length?"tw-bg-waAccent":"gray"])},u(t(a).length),3),Ye])]),_:1})]),e("button",{class:"light-gray small",onClick:o[0]||(o[0]=v(f=>_.value=!1,["prevent"]))},vt)])):(r(),b("div",gt,[e("button",{class:"light-gray small tw-flex tw-items-center tw-space-x-2",onClick:o[1]||(o[1]=v(f=>_.value=!0,["prevent"]))},[$t,e("span",null,u(n.$t("select")),1)]),l(U,{right:!0},{body:s(()=>[l(Ge)]),default:s(()=>[e("button",kt,[wt,P("  "+u(n.$t("actions"))+"  ",1),Ct])]),_:1})]))}}),bt={key:0,class:"tw-p-4"},St={class:"tw-flex tw-items-center tw-space-x-4 tw-justify-between tw-h-8"},Ft={key:0,class:"skeleton tw-w-48"},It=e("div",{class:"skeleton-line",style:{height:"2.2rem"}},null,-1),Dt=[It],Pt={key:2,class:"tw-flex-none tw-ml-auto tw-hidden md:tw-flex"},Rt={class:"md:tw-hidden"},At=e("i",{class:"fas fa-sliders-h black"},null,-1),Lt=[At],Tt={key:1,class:"tw-p-4 tw-flex-auto tw-min-h-[80vh]"},xt={key:2},Bt=e("div",{class:"icon size-80"},[e("i",{class:"fas fa-user-friends"})],-1),Ht=e("div",{class:"icon size-80"},[e("i",{class:"fas fa-user-friends"})],-1),Vt={key:0,class:"tw-text-center tw-py-4"},zt=e("div",{class:"spinner custom-p-16"},null,-1),Mt=[zt],Nt=e("div",{class:"icon size-80"},[e("i",{class:"fas fa-user-friends"})],-1),es=F({__name:"ContactsList",props:{fetchParams:{},hideHeader:{type:Boolean},activeContactId:{}},setup(k){const c=k,m=T(),{fetchNextPage:_,fetchPrevPage:a,updateFetchParams:d,bulkSelectToggle:p}=m,{contacts:i,prevOffset:n,fetchParams:o,previousFetchParams:f,bulkSelectMode:L,bulkSelectIds:x,isFetching:S,isFinished:q,error:B}=A(m),{showSidebar:J}=A(ve()),te=z(()=>{var $;return((($=f.value)==null?void 0:$.columns)||[]).filter(w=>w.id!=="name")});re(()=>c.fetchParams,d,{immediate:!0});const se=E().afterEach(($,w)=>{console.log("ContactsList:afterEach",{to:$,from:w}),$.name==="contacts"&&$.name===w.name?m.updateFetchParams():se()});return($,w)=>(r(),h(fe,{breakpoint:["md","lg"],"trigger-class":["tw-group/md-contacts","tw-group/lg-contacts"],class:"tw-flex tw-flex-col tw-h-full tw-bg-waBlank"},{default:s(()=>{var W,Z,G,K;return[$.hideHeader?C("",!0):(r(),b("div",bt,[e("div",St,[t(S)&&!t(o).offset||((W=t(B))==null?void 0:W.code)===20?(r(),b("div",Ft,Dt)):(r(),h(Ve,{key:1})),t(i).length?(r(),b("div",Pt,[l(yt)])):C("",!0),e("div",Rt,[e("button",{class:"circle transparent",onClick:w[0]||(w[0]=R=>J.value=!t(J))},Lt)])])])),t(S)&&!t(o).offset&&(!c.activeContactId||!t(n))||((Z=t(B))==null?void 0:Z.code)===20?(r(),b("div",Tt,[l(me)])):t(B)?(r(),b("div",xt,u(t(B)),1)):t(q)&&!t(i).length?(r(),b(X,{key:3},[$.$route.name==="myContacts"?(r(),h(O,{key:0,title:$.$t("hereMyContacts"),message:$.$t("infoHowAssignResponsible")},{default:s(()=>[Bt]),_:1},8,["title","message"])):(r(),h(O,{key:1,message:$.$t("noContacts")},{default:s(()=>[Ht]),_:1},8,["message"]))],64)):t(i).length&&t(f)?(r(),h(pe,{key:4,contacts:t(i),"header-columns":te.value,"fetch-params":t(o),sort:t(f).sort,"active-contact-id":c.activeContactId,"context-contact-id":(G=$.fetchParams)==null?void 0:G.context_contact_id,"prev-offset":t(n),"bulk-select-mode":t(L),"bulk-select-ids":t(x),onBulkSelectToggle:w[2]||(w[2]=R=>t(p)(...R)),onUpdateFetchParams:w[3]||(w[3]=R=>t(d)(R))},{lazyloadUp:s(()=>[t(n)>0?ue((r(),b("div",Vt,Mt)),[[t(de),([{isIntersecting:R}])=>{R&&!t(S)&&t(a)()}]]):C("",!0)]),lazyloadDown:s(()=>[l(_e,{"entity-type":"contacts","count-loaded":t(i).length,"limit-load":t(f).limit,total:t(f).total_count,class:"tw-my-4",onVIntersectionObserver:w[1]||(w[1]=()=>{t(S)||t(_)()})},null,8,["count-loaded","limit-load","total"])]),_:1},8,["contacts","header-columns","fetch-params","sort","active-contact-id","context-contact-id","prev-offset","bulk-select-mode","bulk-select-ids"])):C("",!0),t(q)&&((K=t(D).rights)!=null&&K.is_admin)&&$.$route.name==="contacts"&&t(i).length===1&&t(i)[0].id===t(D).user.id?(r(),h(O,{key:5,title:$.$t("hereContactsFromApps"),message:$.$t("infoHowAddContactOrImportContacts"),"notice-id":"contacts/infoHowAddContactOrImportContacts"},{default:s(()=>[Nt]),_:1},8,["title","message"])):C("",!0)]}),_:1}))}});export{es as _};
