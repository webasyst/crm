import{d as v,h as o,X as h,l as w,R as g,u as c,o as i,i as l,w as k,k as x,v as y,c as b,a8 as C,a as I}from"./main-82f77a11.js";import{v as B}from"./index-0a4f4028.js";import{_ as D}from"./DealsListTable.vue_vue_type_style_index_0_lang-395456ff.js";import{S}from"./SkeletonList-40d3d5be.js";import"./DealsItemAmount.vue_vue_type_style_index_0_lang-6271bcaf.js";import"./ChipsList-bf475e53.js";import"./UserPic-92d000dd.js";import"./index-ca686fb1.js";import"./dayjs-82f63efd.js";import"./currency-format-ed440928.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-7dcd1cab.js";import"./date-7b551a1d.js";import"./EmptyList-1155962a.js";import"./CustomColumn-096f9d5b.js";const T={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},F=I("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1),L=[F],n=20,J=v({__name:"ContactTabsDeals",props:{contactId:{}},setup(m){const u=m,f=["stage_id","name","states","create_datetime","amount","user_name","tags","last_action"],e=o({contact_id:u.contactId,fields:["last_action"],limit:n,offset:0}),a=o(0),s=o([]),{data:_,isFetching:r}=h(w(()=>`crm.deal.list?${C.stringify(e.value)}`),{immediate:!0,refetch:!0}).get().json();g(_,t=>{t&&(t.params.offset>0?s.value=[...s.value||[],...t.data]:s.value=t.data,a.value=t.params.total_count,e.value.offset=t.params.offset)});function p(){e.value.offset+n>=a.value||(e.value.offset+=n)}return(t,N)=>c(r)&&e.value.offset===0?(i(),l(S,{key:0,class:"contact-tabs-deals__container","row-height":"130px"})):(i(),l(D,{key:1,class:"contact-tabs-deals__container","tile-view":!0,deals:s.value,"use-columns-ids":f},{lazy:k(()=>[x((i(),b("div",T,L)),[[y,s.value.length<a.value],[c(B),([{isIntersecting:d}])=>{d&&!c(r)&&p()}]])]),_:1},8,["deals"]))}});export{J as default};
