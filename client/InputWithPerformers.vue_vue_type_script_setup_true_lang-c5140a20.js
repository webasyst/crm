import{d as P,a as w,o as f,c as g,i as _,r as D,n as M,p as W,e as A,w as I,f as V,am as _e,_ as O,Q as ee,S as we,ac as ye,z as L,$ as te,M as K,P as J,A as ge,ao as oe,a3 as X,ai as $e,aO as ie,b as R,F as N,l as ue,h as Y,ar as be,g as C,at as re,a8 as U,k as E,av as G,J as ce,a6 as Ce,v as ne,t as q,ap as de,af as pe,as as se,N as ke,V as le,q as Ie,s as Se,a2 as Fe,L as De}from"./main-ad3d4b2a.js";import{M as Z,_ as fe}from"./MenuList-d27c7173.js";import{D as ve}from"./DropDown-6640089d.js";import{u as ae,e as xe}from"./helpers-c0c14d27.js";import{u as Be}from"./recentContacts-6dcec390.js";import{F as Le}from"./FieldSelect-fbb8732d.js";import{v as Ve}from"./index-f0757591.js";import{U as We}from"./UserPic-e76d468d.js";import{C as Me}from"./CustomColumn-d0d2dfb9.js";import{b as Re}from"./index-38eb481c.js";const Pe={class:"collapsable-wrapper"},Ae={class:"collapsable-handler-caret"},Ue={key:0,class:"fas fa-caret-down"},je={key:1,class:"fas fa-caret-right"},ze={key:0,class:"collapsable-content"},Ne=P({__name:"CollapsibleSection",props:{colorCaret:{}},setup(d){const t=d,a=w(!1);return(e,m)=>(f(),g("div",Pe,[_("a",{class:"collapsable-handler",onClick:m[0]||(m[0]=W(c=>a.value=!a.value,["prevent"]))},[_("span",null,[D(e.$slots,"name",{},void 0,!0)]),_("span",Ae,[(f(),g("span",{key:a.value?1:0,class:M(["icon",t.colorCaret||""])},[a.value?(f(),g("i",Ue)):(f(),g("i",je))],2))])]),A(_e,{name:"fade",mode:"out-in"},{default:I(()=>[a.value?(f(),g("div",ze,[D(e.$slots,"default",{},void 0,!0)])):V("",!0)]),_:3})]))}});const Mt=O(Ne,[["__scopeId","data-v-4832961f"]]),Ee=ee("inputWithPreformers",()=>{const d=w(!0),t=w([]),a=we(Re),e=ye({dealId:null}),m=L(()=>`crm.user.list?${te.stringify({...e.dealId?{can_own_deal:e.dealId}:{}})}`),{error:c,data:p}=K(m,{immediate:!1,refetch:!0}).get().json();J(p,async()=>{if(Array.isArray(p.value)){const o=ae(p.value).map(l=>l.id).join(",");if(o){const{id:l}=ge.user,u=["email"];a.value&&u.push("phone");const r=await me(`id/${o}`,u),y=r.find(n=>n.id===l);t.value=[...y?[y]:[],...r.filter(n=>n.id!==l)]}}h(e.currrentUser),d.value=!1});function i(o,l){e.currrentUser=l,t.value.length&&h(e.currrentUser),e.dealId=o}function h(o){if(o!=null&&o.id){const l=t.value.findIndex(u=>u.id===o.id);if(l!==-1){const u=t.value[l];t.value.splice(l,1),t.value.unshift(u)}else o.id&&t.value.unshift(o)}}return{setupProps:i,isFetching:d,error:c,$contacts:t}});async function me(d,t){const a=te.stringify({hash:d,fields:t}),{data:e}=await K(`crm.contact.list?${a}`).get().json();if(e.value){const{data:m}=e.value;return m}return[]}const Ke=["placeholder"],Te=["onClick"],Rt=P({__name:"InputWithRole",props:{scope:{},modelValue:{},inputClass:{default:""},right:{type:Boolean},width:{default:"200px"}},setup(d){const t=d,a=oe(t,"modelValue"),e=w([]),m=w(),c=w(!1),p=L(()=>e.value.filter(o=>{var l;return(l=a.value)!=null&&l.trim()?o.toLocaleLowerCase().includes(a.value.toLocaleLowerCase()):!0})),i=X(p);$e(async()=>{const{data:o}=await K(`crm.deal.role.list?scope=${t.scope}`).get().json();Array.isArray(o.value)&&(e.value=o.value)}),ie(m,()=>{c.value=!1});function h(o){o&&(a.value=o,c.value=!1)}return(o,l)=>(f(),g("div",{ref_key:"wrapperRef",ref:m},[A(ve,{open:c.value,"disable-click-outside":!0,right:t.right,width:t.width,disabled:!0,"max-height":"195px"},{body:I(()=>[p.value.length?(f(),R(Z,{key:0},{default:I(()=>[(f(!0),g(N,null,ue(p.value,(u,r)=>(f(),R(fe,{key:r},{default:I(()=>[_("a",{class:M({"tw-bg-waBackground":C(i).index.value===r}),onClick:W(y=>h(u),["prevent"])},E(u),11,Te)]),_:2},1024))),128))]),_:1})):V("",!0)]),default:I(()=>[Y(_("input",{"onUpdate:modelValue":l[0]||(l[0]=u=>re(a)?a.value=u:null),type:"text",class:M(["tw-w-full",t.inputClass]),placeholder:o.$t("role"),onKeyup:l[1]||(l[1]=U(u=>{h(C(i).state.value),u.target.blur()},["enter"])),onKeydown:[l[2]||(l[2]=U(W(u=>C(i).prev(),["prevent"]),["up"])),l[3]||(l[3]=U(W(u=>C(i).next(),["prevent"]),["down"]))],onFocusin:l[4]||(l[4]=u=>c.value=!0)},null,42,Ke),[[be,C(a)]])]),_:1},8,["open","right","width"])],512))}}),qe={key:0,class:"icon size-20 !tw-left-2"},Qe={key:1,class:"icon text-gray"},He=_("i",{class:"fas fa-search"},null,-1),Je=[He],Xe=_("i",{class:"fas fa-times-circle"},null,-1),Ye=[Xe],Ge=["placeholder","disabled"],Ze={key:2,class:"smaller text-red tw-mt-1"},Oe=["data-index","onClick"],et=["src"],tt={class:"name"},st={class:"email"},at={key:2,class:"tw-text-center tw-py-3 gray"},nt={class:"tw-h-[5px]"},lt={class:"tw-text-center tw-py-3"},ot=_("i",{class:"spinner custom-p-12"},null,-1),it=[ot],ut=_("hr",{class:"tw-m-0"},null,-1),rt={class:"!tw-my-1"},he=P({__name:"InputWithDropDown",props:{items:{},item:{},initItemId:{},placeholder:{},isFetching:{type:Boolean},hideClear:{type:Boolean},hideIcon:{type:Boolean},inputClass:{},width:{},right:{type:Boolean},disabled:{type:Boolean},errorMessage:{}},emits:["input","update","clear","interseption-observer","focus","close-dropdown"],setup(d,{expose:t,emit:a}){const e=d,m=w(),c=w(),p=w(!1),i=w(e.item);let h=X(e.items);J(()=>e.items,n=>{h=X(n),J(h.index,s=>{var $,b;(b=($=m.value)==null?void 0:$.querySelector(`[data-index="${s}"]`))==null||b.scrollIntoView({behavior:"smooth",block:"nearest"})})}),G(()=>e.initItemId&&e.items.length,()=>{const n=e.items.find(s=>s.id===e.initItemId);n&&l(n)},{immediate:!0}),G(()=>!p.value,()=>{a("close-dropdown")}),ie(m,()=>{p.value=!1});function o(n){a("focus"),a("input",n.target.value),p.value=!0,Ce(()=>{var s;(s=c.value)==null||s.focus()})}function l(n){n&&(i.value={...n},a("update",i.value),p.value=!1)}function u(){i.value={id:0,name:""},a("clear")}const r=L(()=>{var n;return p.value&&((n=i.value)==null?void 0:n.name)||e.placeholder}),y=L(()=>p.value?"default-value":"value");return t({clearValue:u}),(n,s)=>(f(),R(Me,{space:"4"},{default:I(()=>{var $,b,x,j;return[_("div",{ref_key:"wrapperRef",ref:m,class:"tw-w-full"},[!n.$slots.preview||p.value?(f(),g("div",{key:0,class:M(["state-with-inner-icon width-100",{left:!e.hideIcon}])},[e.hideIcon?V("",!0):(f(),g(N,{key:0},[($=i.value)!=null&&$.userpic?(f(),g("div",qe,[A(We,{url:(b=i.value)==null?void 0:b.userpic,size:20},null,8,["url"])])):(f(),g("div",Qe,Je))],64)),!e.disabled&&!e.hideClear&&((x=i.value)!=null&&x.name)?(f(),g("a",{key:1,class:"icon !tw-left-auto tw-right-3 text-red hover:!tw-text-red-600 tw-rounded-full tw-bg-waBlank",onClick:s[0]||(s[0]=W(S=>u(),["prevent"]))},Ye)):V("",!0),_("input",ce({ref_key:"inputRef",ref:c,type:"search",class:["tw-w-full",e.inputClass,{"state-error":e.errorMessage}],[y.value||""]:((j=i.value)==null?void 0:j.name)||"",placeholder:r.value,disabled:e.disabled,onInput:s[1]||(s[1]=S=>a("input",S.target.value)),onKeyup:s[2]||(s[2]=U(S=>{l(C(h).state.value),S.target.blur()},["enter"])),onKeydown:[s[3]||(s[3]=U(W(S=>C(h).prev(),["prevent"]),["up"])),s[4]||(s[4]=U(W(S=>C(h).next(),["prevent"]),["down"]))],onFocus:o}),null,16,Ge)],2)):D(n.$slots,"preview",{key:1,model:i.value,showInput:o}),e.errorMessage?(f(),g("div",Ze,E(e.errorMessage),1)):V("",!0),D(n.$slots,"items",{items:e.items,onSelectItem:l,isFocus:p.value},()=>[A(ve,{"max-height":"255px",open:p.value,"disable-click-outside":!0,width:e.width||"250px",right:e.right,"disable-floating":!0},{body:I(()=>[A(Z,{class:"thin-scrollbar"},{default:I(()=>{var S;return[(S=e.items)!=null&&S.length?(f(!0),g(N,{key:0},ue(e.items,(B,z)=>(f(),R(fe,{key:B.id},{default:I(()=>[_("a",{class:M(["item",{"tw-bg-waBackground":C(h).index.value===z}]),"data-index":z,onClick:W(Q=>l(B),["prevent"])},[n.$slots.item?D(n.$slots,"item",{key:0,item:B}):(f(),g(N,{key:1},[_("img",{class:"userpic userpic32",src:B.userpic},null,8,et),_("div",null,[_("div",tt,E(B.name),1),_("div",st,E(B.email),1)])],64))],10,Oe)]),_:2},1024))),128)):!e.isFetching&&n.$slots.empty?D(n.$slots,"empty",{key:1}):e.isFetching?V("",!0):(f(),g("div",at,E(n.$t("notFound")),1)),Y(_("div",nt,null,512),[[ne,!n.isFetching],[C(Ve),([{isIntersecting:B}])=>{B&&a("interseption-observer")}]]),Y(_("div",lt,it,512),[[ne,n.isFetching]])]}),_:3}),n.$slots.bottomItems?(f(),g(N,{key:0},[ut,_("div",rt,[A(Z,null,{default:I(()=>[D(n.$slots,"bottomItems",{hideDropDown:()=>p.value=!1})]),_:3})])],64)):V("",!0)]),_:3},8,["open","width","right"])])],512)]}),_:3}))}});const ct=ee("inputWithCustomers",()=>{const d=w(!0),t=w([]),a=w(null),e=Be(),{recent:m,pinned:c,error:p,isFinished:i}=q(e);e.refetch();function h(r,y,n){a.value!==r?(a.value&&e.refetch(),G(()=>i.value,()=>{o(y,n)},{immediate:!0})):(t.value.length||m.value.length||c.value.length)&&l(n),a.value=r}async function o(r,y){const n=[...c.value,...m.value].map(b=>b.id),s=u(y);s&&n.unshift(s);const $=ae(n).join(",");$&&(t.value=await me(`id/${$}`,r),l(y)),d.value=!1}function l(r){if(!r)return;const y=t.value.findIndex(n=>n.id===u(r));if(y!==-1){const n=t.value[y];return t.value.splice(y,1),t.value.unshift(n),!0}else typeof r=="object"&&r.id&&t.value.unshift(r)}function u(r){return typeof r=="number"?r:typeof(r==null?void 0:r.id)=="number"?r.id:null}return{isFetching:d,error:p,$contacts:t,fetchData:h}}),dt=P({__name:"InputWithCustomers",props:{dealId:{default:0},initContactId:{default:void 0},contact:{default:()=>({id:0,name:"",userpic:"",jobtitle:"",company:"",company_contact_id:null})},withFields:{default:()=>["email"]},excludeIds:{default:()=>[]},disabled:{type:Boolean}},emits:["update"],setup(d,{expose:t,emit:a}){var z,Q;const e=d,m=w(),c=w({id:e.contact.id,name:e.contact.name,userpic:e.contact.userpic,company:e.contact.company||"",email:(Q=(z=e.contact)==null?void 0:z.email)!=null&&Q.length?e.contact.email[0].value:""}),p=ct();p.fetchData(e.dealId,e.withFields,e.initContactId||{id:c.value.id,name:c.value.name,userpic:c.value.userpic,company:c.value.company,fields:[{id:"email",value:c.value.email?[c.value.email]:[]}]});const{$contacts:i,isFetching:h}=q(p),o=w([]),l=w(!1),u=w(""),r=w(0),y=w(0),n=w(10);x(),de(i,()=>{x()}),t({isFetchingContacts:h,clearValue:()=>{var v;return(v=m.value)==null?void 0:v.clearValue()}});const s=pe(async v=>{var k;if(r.value=0,y.value=0,!v||((k=c.value)==null?void 0:k.name)===v)x();else{let F="name.name";v.includes("@")?F="email":/^[+\-0-9() ]+$/.test(v)&&(F="phone");const T=`crmSearch/contact_info.${F}*=${xe(v)}`;u.value!==T&&(o.value=[],o.value=await j(T))}},300),$=e.excludeIds.filter(v=>v!==e.contact.id).reduce((v,k)=>({...v,[k]:!0}),{}),b=L(()=>o.value.filter(v=>!$[v.id]).map(v=>{const k=v.fields.find(F=>F.id==="email");return{id:v.id,name:v.name,userpic:v.userpic,email:k==null?void 0:k.value[0],company:v.company}}));function x(){r.value=0,y.value=0,u.value="",o.value=[...i.value]}async function j(v){l.value=!0;const k=te.stringify({hash:v,fields:e.withFields,limit:n.value,offset:r.value}),{data:F}=await K(`crm.contact.list?${k}`).get().json();if(l.value=!1,F.value){const{data:T,params:H}=F.value;return r.value+=H.limit||0,y.value=H.total_count||0,u.value=H.hash||"",T}return[]}async function S(){r.value<y.value&&(o.value=[...o.value,...await j(u.value)])}function B(v){c.value=v;const k=o.value.find(F=>F.id===v.id);k&&(a("update",k),i.value.unshift(k),o.value=i.value=ae(i.value))}return(v,k)=>(f(),R(he,{ref_key:"inputWithDropDownRef",ref:m,items:b.value,item:c.value,"init-item-id":e.initContactId,placeholder:v.$t("name"),"is-fetching":C(h)||l.value,disabled:e.disabled,onInput:C(s),onUpdate:B,onInterseptionObserver:S,onCloseDropdown:x},{items:I(F=>[D(v.$slots,"items",se({isFetching:C(h)||l.value,interseptionObserver:S},F),void 0,!0)]),_:3},8,["items","item","init-item-id","placeholder","is-fetching","disabled","onInput"]))}});const Pt=O(dt,[["__scopeId","data-v-7fadbf69"]]),pt=ee("currencies",()=>{const d=w([]),{data:t,isFetching:a,error:e,execute:m,isFinished:c}=K("crm.currency.list").get().json(),p=L(()=>d.value.find(l=>l.is_primary)),i=L(()=>l=>d.value.find(u=>u.id===l)),h=L(()=>c.value&&!d.value.length);ke(()=>{Array.isArray(t.value)&&(d.value=t.value)});function o(){c.value&&m()}return{currencies:d,primaryCurrency:p,isFetching:a,error:e,isFinished:c,isEmptyCurrencies:h,getCurrencyById:i,refetch:o}}),ft={key:1,class:"skeleton tw-w-full"},vt=_("button",{class:"button light-gray !tw-w-full tw-h-full"},null,-1),mt=[vt],At=P({__name:"SelectWithCurrencies",props:{modelValue:{}},emits:["update:modelValue"],setup(d,{emit:t}){const e=oe(d,"modelValue",t),{currencies:m,isFinished:c}=q(pt()),p=L(()=>m.value.map(i=>({id:i.id,value:i.name})));return(i,h)=>C(c)?(f(),R(Le,se({key:0,modelValue:C(e),"onUpdate:modelValue":h[0]||(h[0]=o=>re(e)?e.value=o:null)},i.$attrs,{options:p.value,class:"tw-w-full"}),null,16,["modelValue","options"])):(f(),g("div",ft,mt))}}),ht=d=>(Ie("data-v-3f104d80"),d=d(),Se(),d),_t={key:0,class:"skeleton"},wt={class:"dropdown-button-content"},yt={key:0,class:"tw-mr-1"},gt={key:0},$t=ht(()=>_("i",{class:"fas fa-caret-down"},null,-1)),bt=[$t],Ct=P({__name:"DropDownButton",props:{width:{default:"13.5rem"},colorClass:{default:"light-gray"},rounded:{type:Boolean},isSkeleton:{type:Boolean},mobileWFull:{type:Boolean},disabled:{type:Boolean},small:{type:Boolean}},setup(d){const t=d;return(a,e)=>t.isSkeleton?(f(),g("div",_t,[_("button",{class:M(["button light-gray",{rounded:t.rounded,"mobile:!tw-w-full":t.mobileWFull,small:t.small}]),style:le({width:t.width,height:"2.125rem"})},null,6)])):(f(),g("button",{key:1,class:M(["button dropdown-button",t.colorClass,{rounded:t.rounded,"mobile:!tw-w-full":t.mobileWFull,"tw-cursor-default":t.disabled,small:t.small}]),style:le({width:t.width})},[_("div",wt,[a.$slots.icon?(f(),g("span",yt,[D(a.$slots,"icon",{},void 0,!0)])):V("",!0),_("span",{class:M(["tw-truncate tw-text-left",{"tw-opacity-50":t.disabled}])},[D(a.$slots,"title",{},void 0,!0)],2)]),t.disabled?V("",!0):(f(),g("div",gt,bt))],6))}});const Ut=O(Ct,[["__scopeId","data-v-3f104d80"]]),jt=P({__name:"InputWithPerformers",props:{dealId:{default:0},excludeIds:{default:()=>[]},contact:{}},emits:["update"],setup(d,{emit:t}){var y,n;const a=d,e=w({id:a.contact.id,name:a.contact.name,userpic:a.contact.userpic,email:(n=(y=a.contact)==null?void 0:y.email)!=null&&n.length?a.contact.email[0].value:""}),m=w([]),c=Ee();c.setupProps(a.dealId,{id:e.value.id,name:e.value.name,userpic:e.value.userpic,fields:[{id:"email",value:e.value.email?[e.value.email]:[]}]});const{isFetching:p,$contacts:i}=q(c);u(),de(i,()=>u());const h=pe(async s=>{var $;!s||(($=e.value)==null?void 0:$.name)===s?u():m.value=[...i.value].filter(b=>b.name.toLocaleLowerCase().includes(s.toLocaleLowerCase()))},300),o=a.excludeIds.filter(s=>s!==a.contact.id).reduce((s,$)=>({...s,[$]:!0}),{}),l=L(()=>m.value.filter(s=>!o[s.id]).map(s=>{const $=s.fields.find(x=>x.id==="email"),b=s.fields.find(x=>x.id==="phone");return{id:s.id,name:s.name,userpic:s.userpic,email:$==null?void 0:$.value[0],phone:b==null?void 0:b.value[0]}}));function u(){m.value=[...i.value]}function r(s){e.value=s,t("update",{id:s.id,name:s.name,userpic:s.userpic})}return(s,$)=>(f(),R(he,{items:l.value,item:e.value,placeholder:s.$t("name"),"is-fetching":C(p),onInput:C(h),onUpdate:r,onCloseDropdown:u},Fe({items:I(b=>[D(s.$slots,"items",se({isFetching:C(p),interseptionObserver:()=>null},b))]),_:2},[s.$slots.preview?{name:"preview",fn:I(b=>[D(s.$slots,"preview",ce(De(b)))]),key:"0"}:void 0]),1032,["items","item","placeholder","is-fetching","onInput"]))}});export{Mt as C,Ut as D,Pt as I,Rt as _,jt as a,At as b,pt as u};
