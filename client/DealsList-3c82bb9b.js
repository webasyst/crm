import{d as w,o as n,c as h,i as d,r as F,b as f,f as x,n as P,_ as S,B as V,F as M,l as K,g as e,w as p,m as O,k as R,t as U,z as A,ai as E,e as C,p as j,h as q}from"./main-ad3d4b2a.js";import{v as G}from"./index-f0757591.js";import{a as J,_ as Q}from"./DealsListTable.vue_vue_type_style_index_0_lang-09148be3.js";import{U as y}from"./UserPic-e76d468d.js";import{e as W}from"./tags-66e0142b.js";import"./DealsItemAmount.vue_vue_type_style_index_0_lang-6d1612e4.js";import"./vTooltip-c8fe82a0.js";import"./ChipsList-007889bd.js";import"./index-38eb481c.js";import"./dayjs-e01b34a2.js";import"./currency-format-ea9c59e9.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-70395f49.js";import"./date-5bb5c85b.js";import"./SkeletonList-22bbddc4.js";import"./EmptyList-a90c3660.js";import"./CustomColumn-d0d2dfb9.js";import"./funnels-5e77cb0b.js";import"./helpers-c0c14d27.js";const X=["data-id"],Y={key:0},Z=w({__name:"DealsListHeaderCell",props:{id:{},sortable:{type:Boolean},sort:{}},emits:["toggleSort"],setup(u,{emit:s}){const o=u;return(t,m)=>{var i,r;return n(),h("div",{"data-id":t.id,class:"deal-list__head"},[d("div",{class:P(["deal-head__inner",[o.sortable?"tw-cursor-pointer":"tw-cursor-default"]]),onClick:m[0]||(m[0]=g=>o.sortable&&s("toggleSort"))},[F(t.$slots,"default",{},void 0,!0),o.sortable&&((i=o.sort)==null?void 0:i.sort)===t.id?(n(),h("span",Y,[((r=o.sort)==null?void 0:r.asc)===0?(n(),f(y,{key:0,size:14,"fa-icon":"sort-down"})):(n(),f(y,{key:1,size:14,"fa-icon":"sort-up"}))])):x("",!0)],2)],8,X)}}});const ee=S(Z,[["__scopeId","data-v-721af1f4"]]),te={class:"deals-list__header"},se=w({__name:"DealsListHeaders",props:{useColumnsIds:{},sort:{}},emits:["toggleSort"],setup(u,{emit:s}){const o=u,{t}=V(),i=[{id:"checkbox",name:"",sortable:!1},{id:"stage_id",name:t("stage"),sortable:!0},{id:"name",name:t("deal"),sortable:!0},{id:"states",name:"",sortable:!1},{id:"create_datetime",name:t("createDatetime"),sortable:!0},{id:"amount",name:t("amount"),sortable:!0},{id:"user_name",name:t("responsible"),sortable:!0},{id:"tags",name:t("tags"),sortable:!1},{id:"last_action",name:t("lastAction"),sortable:!0}].filter(r=>o.useColumnsIds.includes(r.id));return(r,g)=>(n(),h("div",te,[(n(!0),h(M,null,K(e(i),l=>(n(),f(ee,{id:l.id,key:l.id,sortable:l.sortable,sort:o.sort,onToggleSort:b=>s("toggleSort",l.id)},{default:p(()=>[O(R(l.name),1)]),_:2},1032,["id","sortable","sort","onToggleSort"]))),128))]))}});const oe=S(se,[["__scopeId","data-v-67293c18"]]),ae=()=>"ontouchstart"in window;function ne(u=800){let s=null;function o(m,i){s||(s=setTimeout(()=>{s&&(i(),s=null)},u))}function t(){s&&(clearTimeout(s),s=null)}return{onTouchstart:o,onTouchend:t}}const ie=["onClick"],re=["checked"],le=d("span",{class:"!tw-h-[1rem] !tw-w-[1rem]"},[d("span",{class:"icon"},[d("i",{class:"fas fa-check"})])],-1),ce={key:0,class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},de=d("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1),ue=[de],Ie=w({__name:"DealsList",setup(u){const s=W(),{init:o,bulkSelectToggle:t}=s,{deals:m,isFetching:i,isRefreshPage:r,nextOffset:g,fetchNextPage:l,previousFetchParams:b,toggleSort:D,sort:L,bulkSelectIds:v}=U(s),{onTouchstart:$,onTouchend:T}=ne(),I=A(()=>{var k,_;return g.value+(((k=b.value)==null?void 0:k.limit)??0)<(((_=b.value)==null?void 0:_.total_count)??0)}),B=["checkbox","stage_id","name","states","create_datetime","amount","user_name","tags","last_action"];return E(o),(k,_)=>(n(),f(Q,{deals:e(m),"use-columns-ids":B,"is-fetching":e(r),class:"tw-mt-6 mobile:-tw-ml-2 mobile:-tw-mr-2"},{headers:p(({useColumnsIds:a})=>[C(oe,{"use-columns-ids":a,sort:e(L),onToggleSort:e(D)},null,8,["use-columns-ids","sort","onToggleSort"])]),listItem:p(({deal:a,useColumnsIds:H,isMobile:z,navigate:N})=>[C(J,{deal:a,"use-columns-ids":H,"is-selected":e(v).includes(a.id),"is-mobile":z,onClick:c=>{e(v).length?e(t)(a.id,c.shiftKey):N()},onTouchstart:c=>e($)(c,()=>e(t)(a.id,!1)),onTouchend:e(T),onTouchmove:e(T),onContextmenu:_[0]||(_[0]=c=>e(ae)()&&c.preventDefault())},{checkbox:p(()=>[d("span",{class:"wa-checkbox tw-mr-2",onClick:j(c=>e(t)(a.id,c.shiftKey),["stop"])},[d("input",{type:"checkbox",checked:e(v).includes(a.id)},null,8,re),le],8,ie)]),_:2},1032,["deal","use-columns-ids","is-selected","is-mobile","onClick","onTouchstart","onTouchend","onTouchmove"])]),lazy:p(()=>[I.value?q((n(),h("div",ce,ue)),[[e(G),([{isIntersecting:a}])=>{a&&!e(i)&&e(l)()}]]):x("",!0)]),_:1},8,["deals","is-fetching"]))}});export{Ie as default};
