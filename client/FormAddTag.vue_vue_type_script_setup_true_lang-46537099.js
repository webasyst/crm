import{d as I,h,J as N,l as S,M as j,o,i as v,w as l,A as C,p as u,a as n,e as g,c as y,F as A,b as _,n as V,j as $,q as x,a0 as B,aK as q}from"./main-46836c41.js";import{W as E}from"./WaSpinner-f3419042.js";import{C as L}from"./CustomColumn-c8c73188.js";import{C as D,a as M}from"./ChipsList-9ead41c5.js";import{a as F}from"./FieldCheckbox-618a9e12.js";import{_ as z}from"./DropdownAddTags.vue_vue_type_script_setup_true_lang-02e057ea.js";const J=["disabled","onClick"],K=["disabled","onClick"],U={class:"flexbox middle space-4"},G={key:0,class:"hint"},H=["onClick"],O=n("i",{class:"fas fa-hashtag"},null,-1),P={class:"tw-flex-auto tw-truncate"},oe=I({__name:"FormDeleteTag",props:{entityIds:{},entityType:{}},emits:["close"],setup(T,{emit:f}){const c=T,s=h([]),t=h(!0),i=h(""),b=N();a();const m=S(()=>!!s.value.length&&s.value.every(e=>e.selected)),p=S(()=>!!s.value.length&&s.value.some(e=>e.selected));async function a(){t.value=!0;const{data:e,error:d}=await j(S(()=>`crm.tag.list?${q.stringify({[`${c.entityType}_id`]:c.entityIds})}`),{refetch:!0,immediate:!0}).get().json();t.value=!1,i.value=d.value,e.value&&(s.value=e.value.map(r=>({...r,selected:!1})))}function w(){const e=m.value;s.value.forEach(d=>d.selected=!e)}async function W(){i.value="";const e=s.value.filter(k=>k.selected).map(k=>k.name);if(!e.length)return;const{error:d,execute:r}=b.removeTags(c.entityType,c.entityIds,e);await r(),i.value=d.value,d.value||(b.refetch(),f("close"))}return(e,d)=>(o(),v(B,{"use-cancel-as-button-label":!0,onClose:d[0]||(d[0]=r=>f("close"))},{header:l(()=>[C(u(e.$t("removeTags")),1)]),submit:l(()=>[n("button",{disabled:t.value||!p.value,onClick:g(W,["prevent"])},u(e.$t("removeTags")),9,J)]),error:l(()=>[C(u(i.value),1)]),default:l(()=>[t.value?(o(),v(E,{key:0})):(o(),y(A,{key:1},[n("button",{type:"button",class:"button light-gray small",disabled:!s.value.length,onClick:g(w,["prevent"])},[n("div",U,[_(F,{"model-value":m.value?"1":""},null,8,["model-value"]),n("span",null,u(e.$t("selectAll")),1)])],8,K),_(L,{space:"6",class:"custom-mt-16"},{default:l(()=>[n("div",{class:V({"tw-pb-2":s.value.length})},[s.value.length?$("",!0):(o(),y("div",G,u(e.$t("emptyList")),1)),s.value.length?(o(),v(D,{key:1},{default:l(()=>[(o(!0),y(A,null,x(s.value,r=>(o(),v(M,{key:r.id,class:"small"},{default:l(()=>[n("a",{onClick:g(k=>r.selected=!r.selected,["prevent"])},[O,n("span",P,u(r.name),1),_(F,{"model-value":r.selected?"1":"","fit-content":""},null,8,["model-value"])],8,H)]),_:2},1024))),128))]),_:1})):$("",!0)],2)]),_:1})],64))]),_:1}))}}),Q=["disabled","onClick"],R={key:0,class:"hint"},X=["onClick"],Y=n("i",{class:"fas fa-hashtag"},null,-1),Z={class:"tw-flex-auto tw-truncate"},ue=I({__name:"FormAddTag",props:{entityIds:{},entityType:{}},emits:["close"],setup(T,{emit:f}){const c=T,s=N(),t=h([]),i=h();async function b(){i.value=s.tagAssign(c.entityType,c.entityIds,t.value,!0),await i.value.execute(),i.value.error||f("close")}return(m,p)=>(o(),v(B,{"use-cancel-as-button-label":!0,onClose:p[1]||(p[1]=a=>f("close"))},{header:l(()=>[C(u(m.$t("addTags")),1)]),submit:l(()=>{var a;return[n("button",{disabled:!t.value.length||!!((a=i.value)!=null&&a.isFetching),onClick:g(b,["prevent"])},u(m.$t("save")),9,Q)]}),error:l(()=>{var a;return[C(u((a=i.value)==null?void 0:a.error),1)]}),default:l(()=>[_(L,{space:"6"},{default:l(()=>[n("div",{class:V(["tw-p-4 tw-rounded-md tw-bg-waBackground",{"tw-pb-2":t.value.length}])},[t.value.length?$("",!0):(o(),y("div",R,u(m.$t("tagsToAssign")),1)),t.value.length?(o(),v(D,{key:1},{default:l(()=>[(o(!0),y(A,null,x(t.value,a=>(o(),v(M,{key:a,class:"smaller"},{default:l(()=>[n("a",{onClick:g(()=>{t.value=t.value.filter(w=>w!==a)},["prevent"])},[Y,n("span",Z,u(a),1)],8,X)]),_:2},1024))),128))]),_:1})):$("",!0)],2),_(z,{modelValue:t.value,"onUpdate:modelValue":p[0]||(p[0]=a=>t.value=a),"entity-ids":c.entityIds,"entity-type":c.entityType},null,8,["modelValue","entity-ids","entity-type"])]),_:1})]),_:1}))}});export{ue as _,oe as a};
