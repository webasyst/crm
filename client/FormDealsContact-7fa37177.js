import{d as x,h as n,M as y,l as A,Q as F,U as _,as as S,o as i,c as d,a as s,p as f,b as B,w as v,A as T,e as N,i as h,k as b,v as E,u as w,at as L,au as O,s as M,x as $,ad as P,_ as R}from"./main-46836c41.js";import{v as V}from"./index-dbd22bf6.js";import{_ as U}from"./WaDialogOpener.vue_vue_type_script_setup_true_lang-49fe8b50.js";import Y from"./FormDealAdd-7842b6de.js";import{S as j}from"./SkeletonList-3dd02ff1.js";import{_ as z}from"./DealsListTable.vue_vue_type_style_index_0_lang-ee727015.js";import"./fields-e10d6cd3.js";import"./FieldCheckbox-618a9e12.js";import"./FieldSelect-19a80dbd.js";import"./CustomColumn-c8c73188.js";import"./FormContactUpdateInfo.vue_vue_type_script_setup_true_lang-c3cfd939.js";import"./SortableList.vue_vue_type_script_setup_true_lang-f84f3915.js";import"./useSortable-69b2c6e6.js";import"./InputWithContacts.vue_vue_type_script_setup_true_lang-5a82d5a8.js";import"./UserPic-951b6ea8.js";import"./DropDown-2ad3ed01.js";import"./InputWithPerformers.vue_vue_type_script_setup_true_lang-07dbcaf8.js";import"./recentContacts-3e5f8df1.js";import"./vTooltip-9ea5107e.js";import"./dayjs-a1477631.js";import"./index-0f68ab4c.js";import"./WaSpinner-f3419042.js";import"./TextAreaAutoresize-21a4dcce.js";import"./DropDownButton-49606824.js";import"./ButtonSubmit-c3bae343.js";import"./DealsItemAmount.vue_vue_type_style_index_0_lang-af495230.js";import"./ChipsList-9ead41c5.js";import"./currency-format-52cd88d5.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-6989a3b9.js";import"./date-54fb6a54.js";import"./EmptyList-5f0d3ac0.js";const D=a=>(M("data-v-821c9240"),a=a(),$(),a),Q={class:"form-deals-contact tw-p-4"},q=["onClick"],G=D(()=>s("span",{class:"icon tw-mr-1"},[s("i",{class:"fas fa-plus-circle"})],-1)),H={class:"tw-mt-3 tw-h-full"},J={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},K=D(()=>s("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1)),W=[K],l=20,X=x({__name:"FormDealsContact",props:{contactId:{}},setup(a){const p=a,C=["stage_id","name","states","create_datetime","amount","user_name"],e=n(null),c=n(0),o=n({contact_id:p.contactId,limit:l,offset:0}),{data:I,isFetching:g,execute:m}=y(A(()=>`crm.deal.list?${P.stringify(o.value)}`),{refetch:!0}).get().json();m(),F(I,t=>{t&&(t.params.offset>0?e.value=[...e.value||[],...t.data]:e.value=t.data,c.value=t.params.total_count,o.value.offset=t.params.offset)}),_(L).on(t=>{e.value&&S(t,e.value)}),_(O).on(()=>{u()});function k(){o.value.offset+l>=c.value||(o.value.offset+=l)}function u(){e.value=null,o.value.offset===0?m():o.value.offset=0}return(t,Z)=>(i(),d("div",Q,[s("h3",null,f(t.$t("Deals")),1),B(U,{component:Y,"component-props":{contactId:p.contactId,disableNavigateToDeal:!0,onAdded:u}},{default:v(({open:r})=>[s("button",{class:"button",onClick:N(r,["prevent"])},[G,T(" "+f(t.$t("newDeal")),1)],8,q)]),_:1},8,["component-props"]),s("div",H,[e.value?(i(),h(z,{key:0,deals:e.value,"use-columns-ids":C,"navigate-route-name":"dealByContactFrame"},{lazy:v(()=>[b((i(),d("div",J,W)),[[E,e.value.length<c.value],[w(V),([{isIntersecting:r}])=>{r&&!w(g)&&k()}]])]),_:1},8,["deals"])):(i(),h(j,{key:1,"row-height":"100px"}))])]))}});const Nt=R(X,[["__scopeId","data-v-821c9240"]]);export{Nt as default};
