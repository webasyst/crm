import{d as A,h as l,B as f,l as g,N as D,M,Q as O,U,u as E,o as r,i as C,c as k,p,b as n,w as c,a as u,A as b,e as B,j,W as z,ad as Q}from"./main-46836c41.js";import{_ as R}from"./LazyLoadingWithProgress.vue_vue_type_script_setup_true_lang-ee6b87e3.js";import{I as T}from"./IconButton-2ca5e7da.js";import{E as W}from"./EmptyList-5f0d3ac0.js";import{C as Y,_ as q}from"./ContactsListItems-f8df4621.js";import{S as G}from"./SkeletonList-3dd02ff1.js";import"./index-dbd22bf6.js";import"./CustomColumn-c8c73188.js";import"./index-0f68ab4c.js";import"./UserPic-951b6ea8.js";import"./ChipsList-9ead41c5.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-6989a3b9.js";import"./dayjs-a1477631.js";import"./vTooltip-9ea5107e.js";const H={key:1,class:"state-error tw-p-4"},J={key:2},K=u("div",{class:"icon size-80"},[u("i",{class:"fas fa-user-friends"})],-1),X={class:"align-center"},Z={class:"tw-py-1 tw-pl-2"},$=30,pt=A({__name:"ContactTabsEmployees",props:{contactId:{}},emits:["add-entity"],setup(I,{emit:v}){var h,y,w;const N=I,e=l([]),s=l(null),m=l(null),i=l(0),o=l({fields:(h=f.contact_list_columns)==null?void 0:h.map(t=>t.field),hash:`crmSearch/contact_info.company_contact_id=${N.contactId}`,sort:(y=f.contact_list_sort)==null?void 0:y.field,asc:(w=f.contact_list_sort)!=null&&w.asc?1:0,limit:$}),x=g(()=>`crm.contact.list?${Q.stringify(o.value)}`),P=g(()=>{var t;return(((t=s.value)==null?void 0:t.columns)||[]).filter(a=>a.id!=="name")}),{updateCounterByRouteName:S}=D(),{data:F,isFetching:_}=M(x,{immediate:!0,refetch:!0}).get().json();O(F,async t=>{m.value=null,t&&(s.value&&t.params.offset>i.value?(e.value=[...e.value,...t.data],i.value=t.params.offset):(e.value=t.data,i.value=t.params.offset),s.value=t.params,S("contactEmployeesTab",t.params.total_count))}),U(z).on(()=>{d()});function d(t){s.value&&(o.value={...o.value,offset:0,...t,_:Date.now()})}function L(){d({offset:i.value+$})}return(t,a)=>E(_)&&!o.value.offset?(r(),C(G,{key:0,class:"box","row-height":"32px"})):m.value?(r(),k("div",H,p(m.value),1)):e.value.length?e.value.length&&s.value?(r(),C(q,{key:3,breakpoint:["md"],"trigger-class":["tw-group/md-contacts"],class:"tw-absolute tw-w-full tw-h-full tw-flex tw-flex-col tw-bg-waBlank"},{default:c(()=>[u("div",Z,[n(T,{icon:"plus",onClick:a[1]||(a[1]=B(V=>v("add-entity","addEmployee"),["prevent"]))},{default:c(()=>[b(p(t.$t("addEmployee")),1)]),_:1})]),n(Y,{contacts:e.value,"header-columns":P.value,"fetch-params":o.value,sort:s.value.sort,"disable-sync-settings":!0,onUpdateFetchParams:d},{lazyloadDown:c(()=>[n(R,{"entity-type":"contacts","count-loaded":e.value.length,"limit-load":o.value.limit,total:s.value.total_count,class:"tw-my-4",onVIntersectionObserver:a[2]||(a[2]=()=>{E(_)||L()})},null,8,["count-loaded","limit-load","total"])]),_:1},8,["contacts","header-columns","fetch-params","sort"])]),_:1})):j("",!0):(r(),k("div",J,[n(W,{message:t.$t("noEmployees")},{default:c(()=>[K]),_:1},8,["message"]),u("div",X,[n(T,{icon:"plus",onClick:a[0]||(a[0]=B(V=>v("add-entity","addEmployee"),["prevent"]))},{default:c(()=>[b(p(t.$t("addEmployee")),1)]),_:1})])]))}});export{pt as default};
