import{d as T,h as r,N as S,M as x,l as B,Q as N,U as $,u as d,o as i,i as A,c as u,a9 as E,b as p,w as c,A as v,p as w,e as h,j as V,k as L,v as z,a as b,V as M,ad as P,s as j,x as F,_ as O}from"./main-46836c41.js";import{v as U}from"./index-dbd22bf6.js";import{I as y}from"./IconButton-2ca5e7da.js";import{_ as Q}from"./DealsListTable.vue_vue_type_style_index_0_lang-ee727015.js";import{S as R}from"./SkeletonList-3dd02ff1.js";import"./DealsItemAmount.vue_vue_type_style_index_0_lang-af495230.js";import"./vTooltip-9ea5107e.js";import"./ChipsList-9ead41c5.js";import"./UserPic-951b6ea8.js";import"./index-0f68ab4c.js";import"./dayjs-a1477631.js";import"./currency-format-52cd88d5.js";import"./ContactsListItemAction.vue_vue_type_style_index_0_lang-6989a3b9.js";import"./date-54fb6a54.js";import"./EmptyList-5f0d3ac0.js";import"./CustomColumn-c8c73188.js";const q=s=>(j("data-v-ac1dc42f"),s=s(),F(),s),G={key:1,class:"tab-body__container !tw-pt-0"},H={class:"tw-sticky tw-left-0 tw-text-center tw-py-4"},J=q(()=>b("div",{class:"spinner tw-p-5 tw-mx-auto"},null,-1)),K=[J],W={class:"align-center"},m=20,X=T({__name:"ContactTabsDeals",props:{contactId:{}},emits:["add-entity"],setup(s,{emit:_}){const g=s,C=["stage_id","name","states","create_datetime","amount","user_name","tags","last_action"],e=r({contact_id:g.contactId,fields:["last_action"],limit:m,offset:0,_:Date.now()}),o=r(0),a=r([]),{updateCounterByRouteName:D}=S(),{data:k,isFetching:f}=x(B(()=>`crm.deal.list?${P.stringify(e.value)}`),{immediate:!0,refetch:!0}).get().json();N(k,t=>{t&&(t.params.offset>0?a.value=[...a.value||[],...t.data]:a.value=t.data,o.value=t.params.total_count,e.value.offset=t.params.offset,D("contactDealsTab",o.value))}),$(M).on(()=>{e.value._=Date.now()});function I(){e.value.offset+m>=o.value||(e.value.offset+=m)}return(t,n)=>d(f)&&e.value.offset===0?(i(),A(R,{key:0,class:"tab-body__container","row-height":"130px"})):(i(),u("div",G,[a.value.length?(i(),u("div",{key:0,class:"tw-sticky tw-py-1 tw-bg-waBlank tw-z-10",style:E({top:"calc(var(--header-height))"})},[p(y,{icon:"plus",onClick:n[0]||(n[0]=h(l=>_("add-entity","addDeal"),["prevent"]))},{default:c(()=>[v(w(t.$t("addDeal")),1)]),_:1})],4)):V("",!0),p(Q,{"tile-view":!0,deals:a.value,"use-columns-ids":C},{lazy:c(()=>[L((i(),u("div",H,K)),[[z,a.value.length<o.value],[d(U),([{isIntersecting:l}])=>{l&&!d(f)&&I()}]])]),bottomEmptyList:c(()=>[b("div",W,[p(y,{icon:"plus",onClick:n[1]||(n[1]=h(l=>_("add-entity","addDeal"),["prevent"]))},{default:c(()=>[v(w(t.$t("addDeal")),1)]),_:1})])]),_:1},8,["deals"])]))}});const _t=O(X,[["__scopeId","data-v-ac1dc42f"]]);export{_t as default};
