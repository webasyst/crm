import{d as L,a0 as P,y as j,P as x,ae as O,o as t,i as R,O as A,u as d,w as v,A as b,p as e,a as l,c as o,F as f,e as M,b as I,j as z,q as F,a1 as D,z as T,h as N,l as $,C as J,t as B,M as q,n as V}from"./main-2290994d.js";import{U}from"./UserPic-f44f080b.js";import{_ as E}from"./WaDialogLoading.vue_vue_type_script_setup_true_lang-9395703c.js";import{_ as W}from"./InputWithUsers.vue_vue_type_script_setup_true_lang-7cb75028.js";import{M as G,_ as H}from"./DropDown-9065f982.js";const K=["disabled","onClick"],Q={key:0},X={class:"text-orange"},Y={class:"tw-flex tw-flex-auto tw-w-1/2 tw-space-x-2 tw-items-center"},Z={class:"tw-truncate"},ee={class:"tw-flex-none"},te={class:"tw-whitespace-nowrap"},we=L({__name:"FormContactDelete",props:{contactIds:{},disableContactsPageRedirect:{type:Boolean}},emits:["close"],setup(C,{emit:g}){const n=C,y=P(),r=j(),p=r.deleteContacts(n.contactIds),i=x(`crm.contact.links?${O.stringify({id:n.contactIds})}`).get().json();async function k(){if(i.error.value){i.execute();return}await p.execute()&&(g("close"),n.disableContactsPageRedirect||y.push(r.lastRouteLocation?r.lastRouteLocation:{name:"contacts"}))}return(s,h)=>(t(),R(D,{onClose:h[0]||(h[0]=u=>g("close"))},A({header:v(()=>[b(e(s.$t("deleteContacts",n.contactIds.length)),1)]),submit:v(()=>[l("button",{disabled:d(i).isFetching.value||d(p).isFetching.value,onClick:M(k,["prevent"])},[d(i).isFetching.value?(t(),o(f,{key:0},[b(e(s.$t("checkingLinks")),1)],64)):d(i).error.value?(t(),o(f,{key:1},[b(e(s.$t("recheckLinks")),1)],64)):d(p).isFetching.value?(t(),o(f,{key:2},[b(e(s.$t("deleting")),1)],64)):(t(),o(f,{key:3},[b(e(s.$t("deleteAnyway")),1)],64))],8,K)]),default:v(()=>[I(E,{"is-fetching":d(i).isFetching.value,error:d(i).error.value},A({_:2},[d(i).data.value&&"linked_contacts"in d(i).data.value?{name:"default",fn:v(()=>[l("p",null,e(s.$t("deleteContactsMessage1")),1),d(i).data.value.linked_contacts.length?(t(),o("p",Q,[l("strong",X,e(s.$t("importantNote")),1),b(" "+e(s.$t("deleteContactsMessage2"))+" "+e(s.$t("deleteContactsMessage3")),1)])):z("",!0),(t(!0),o(f,null,F(d(i).data.value.linked_contacts,u=>(t(),o("div",{key:u.id},[(t(!0),o(f,null,F(u.links,(_,w)=>(t(),o("div",{key:w},[(t(!0),o(f,null,F(_.roles,(S,a)=>(t(),o("div",{key:a,class:"tw-flex tw-space-x-2 tw-justify-between tw-py-1 bordered-bottom tw-text-sm"},[l("div",Y,[I(U,{url:u.userpic,size:16},null,8,["url"]),l("div",Z,e(u.name),1),l("div",ee,e(_.app)+"/"+e(S.role),1)]),l("div",te,e(s.$t("links",S.count)),1)]))),128))]))),128))]))),128))]),key:"0"}:void 0]),1032,["is-fetching","error"])]),_:2},[d(p).isFetching.value?void 0:{name:"error",fn:v(()=>[b(e(d(p).error.value),1)]),key:"0"}]),1024))}}),se=["disabled","onClick"],ae={key:0},ne={class:"hint tw-mb-2"},$e=L({__name:"FormContactChangeResponsible",props:{contactIds:{},currentResponsible:{},contactName:{}},emits:["close"],setup(C,{emit:g}){const n=C,y=T(),r=N(n.currentResponsible??null),p=$(()=>y.responsibleAssign(n.contactIds,r.value)),i=$(()=>n.currentResponsible?JSON.stringify(n.currentResponsible)===JSON.stringify(r.value):!1),k=$(()=>n.currentResponsible&&!r.value),s=$({get(){return r.value?[r.value]:[]},set(u){r.value=u[0]}});async function h(){await p.value.execute(),p.value.error.value||g("close")}return(u,_)=>(t(),R(D,{"use-cancel-as-button-label":!0,onClose:_[1]||(_[1]=w=>g("close"))},{header:v(()=>[b(e(u.$t(n.currentResponsible?"changeResponsible":"addResponsible")),1)]),submit:v(()=>[l("button",{disabled:i.value||p.value.isFetching.value||!k.value&&!r.value,onClick:M(h,["prevent"])},e(u.$t(k.value?"clearResponsible":"save")),9,se)]),error:v(()=>[b(e(p.value.error.value),1)]),default:v(()=>[n.contactName?(t(),o("p",ae,e(`${u.$t("addResponsibleMessage")} ${n.contactName}`),1)):z("",!0),l("div",ne,e(u.$t(r.value?i.value?"currentResponsible":"newResponsible":"selectResponsible")),1),I(W,{modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=w=>s.value=w),"is-multiple":!1},null,8,["modelValue"])]),_:1}))}}),oe={class:"tw-sticky tw-top-0 tw-p-2 tw-bg-waBlank tw-z-10"},le={class:"toggle rounded smallest"},ie={key:0,class:"tw-p-2"},ce=l("div",{class:"spinner"},null,-1),re=[ce],ue=["disabled","onClick"],de={key:0,class:"icon"},pe=l("i",{class:"fas fa-spinner text-yellow tw-animate-spin"},null,-1),ve=[pe],me=["title"],fe={key:1,class:"small tw-px-4 tw-pb-4"},Ce=L({__name:"DropdownIncludeSegment",props:{modelValue:{},contactIds:{}},emits:["update:modelValue"],setup(C,{emit:g}){const n=C,y=J(),{sharedSegment:r,mySegment:p,isFetching:i}=B(y);y.refetch();const{contact:k}=B(q()),s=N(!1),h=N(new Set),u=$(()=>p.value.filter(a=>a.type==="category").filter(a=>{var m;return!((m=k.value)!=null&&m.segments.map(c=>c.id).includes(a.id))})),_=$(()=>r.value.filter(a=>a.type==="category").filter(a=>{var m;return!((m=k.value)!=null&&m.segments.map(c=>c.id).includes(a.id))})),w=$(()=>s.value?_.value:u.value);async function S(a){Array.isArray(n.contactIds)&&(h.value.has(a)||(h.value.add(a),await y.includeContactsToSegment(a,n.contactIds).execute(),h.value.delete(a))),"modelValue"in n&&g("update:modelValue",a)}return(a,m)=>(t(),o(f,null,[l("div",oe,[l("div",le,[l("span",{class:V({selected:!s.value}),onClick:m[0]||(m[0]=c=>s.value=!1)},e(a.$t("my",2)),3),l("span",{class:V({selected:s.value}),onClick:m[1]||(m[1]=c=>s.value=!0)},e(a.$t("shared",2)),3)])]),d(i)?(t(),o("div",ie,re)):(t(),o(f,{key:1},[w.value.length?(t(),R(G,{key:0},{default:v(()=>[(t(!0),o(f,null,F(w.value,c=>(t(),R(H,{key:c.id,class:V({selected:n.modelValue===c.id})},{default:v(()=>[l("a",{disabled:!c.is_editable,onClick:M(he=>S(c.id),["prevent"])},[h.value.has(c.id)?(t(),o("span",de,ve)):(t(),R(U,{key:1,size:16,"fa-icon":c.icon,url:c.icon_path},null,8,["fa-icon","url"])),l("span",{title:c.name,class:"tw-truncate"},e(c.name),9,me)],8,ue)]),_:2},1032,["class"]))),128))]),_:1})):(t(),o("div",fe,e(a.$t("notFound")),1))],64))],64))}});export{Ce as _,$e as a,we as b};
