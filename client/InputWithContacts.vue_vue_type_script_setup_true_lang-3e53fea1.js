import{U as g}from"./UserPic-f44f080b.js";import{d as M,h as f,l as k,R as E,aW as L,o as r,i as v,w as c,c as m,b as _,F as I,q as V,j as F,a as u,a2 as N,al as x,n as R,e as $,r as S,ai as U,aF as K,p as D,u as b,P,f as W}from"./main-2290994d.js";import{M as j,D as q,_ as O}from"./DropDown-9065f982.js";import{C as B}from"./CustomColumn-c63128eb.js";const T=["placeholder"],A=["onClick"],G={class:"tw-flex-auto tw-overflow-hidden"},H=["onClick"],J=u("i",{class:"fas fa-trash-alt gray"},null,-1),Q=[J],X=M({__name:"InputWithDropDown",props:{items:{},value:{},textValue:{},isMultiple:{type:Boolean},placeholder:{},onEnter:{type:Function},onItemSelect:{type:Function}},emits:["input","update","focus"],setup(h,{emit:p}){const e=h,d=f(),n=f(!1),s=f(new Set(e.value)),i=k(()=>U([null,...e.items])),t=k(()=>e.textValue?"value":"");E(s,l=>{p("update",[...l])},{deep:!0}),L(d,()=>{n.value=!1});function w(l){p("input",l.target.value),n.value=!0}function z(l){p("focus",l.target.value),n.value=!0}function C(l,a){if(l){if(e.onItemSelect){e.onItemSelect(l),n.value=!1;return}e.isMultiple||s.value.clear(),s.value.add(l),n.value=!1,a&&a.target.blur()}else e.onEnter&&a&&a.target.value&&(e.onEnter(a.target.value),a.target.blur(),n.value=!1)}return(l,a)=>(r(),v(B,{space:"4"},{default:c(()=>[e.isMultiple||!s.value.size?(r(),m("div",{key:0,ref_key:"inputRef",ref:d,class:"tw-w-full"},[_(q,{open:n.value,"disable-click-outside":!0,"prevent-toggler":!0,"max-height":"350px"},{body:c(()=>[e.items.length?(r(),v(j,{key:0},{default:c(()=>[(r(!0),m(I,null,V(e.items,(o,y)=>(r(),v(O,{key:y},{default:c(()=>[u("a",{class:R({"tw-bg-waBackground":i.value.index.value===y+1}),onClick:$(se=>C(o),["prevent"])},[S(l.$slots,"item",{item:o})],10,A)]),_:2},1024))),128))]),_:3})):F("",!0)]),default:c(()=>[u("input",N({type:"text",placeholder:e.placeholder,[t.value||""]:e.textValue,class:"tw-w-full",onInput:w,onKeyup:a[0]||(a[0]=x(o=>{C(i.value.state.value,o)},["enter"])),onKeydown:[a[1]||(a[1]=x($(o=>i.value.prev(),["prevent"]),["up"])),a[2]||(a[2]=x($(o=>i.value.next(),["prevent"]),["down"]))],onFocus:z}),null,16,T)]),_:3},8,["open"])],512)):F("",!0),_(B,{space:"2"},{default:c(()=>[(r(!0),m(I,null,V(s.value,o=>(r(),m("div",{key:o.id,class:"tw-flex tw-items-center tw-space-x-2"},[u("div",G,[S(l.$slots,"listItem",{item:o})]),u("a",{onClick:y=>s.value.delete(o)},Q,8,H)]))),128))]),_:3})]),_:3}))}}),Y={class:"icon size-20"},Z=["title"],ee={class:"tw-flex tw-items-center tw-space-x-2"},te={class:"icon size-20"},ae=["title"],ie=M({__name:"InputWithContacts",props:{modelValue:{default:()=>[]},isMultiple:{type:Boolean,default:!0},isCompany:{type:Boolean},textValue:{},onEnter:{},onItemSelect:{}},emits:["update:modelValue"],setup(h,{emit:p}){const e=h,d=f([]),n=K(async s=>{const i=s.includes("@")?"email":/^[+\-0-9() ]+$/.test(s)?"phone":"name.name",{data:t}=await P(`crm.contact.list?hash=crmSearch/contact_info.${i}*=${encodeURIComponent(`${W(s)}${e.isCompany?"&contact_info.contact_type.company=1":""}`)}&limit=10`).get().json();t.value&&(d.value=t.value.data)},300);return(s,i)=>(r(),v(X,{items:d.value.filter(t=>!e.modelValue.map(w=>w.id).includes(t.id)),value:e.modelValue,"text-value":e.textValue,"is-multiple":e.isMultiple,placeholder:s.$t("search"),"on-enter":e.onEnter,"on-item-select":e.onItemSelect,onInput:b(n),onFocus:b(n),onUpdate:i[0]||(i[0]=t=>{p("update:modelValue",t)})},{item:c(({item:t})=>[u("div",Y,[_(g,{url:t.userpic,size:20},null,8,["url"])]),u("span",{class:"tw-truncate",title:t.name},D(t.name),9,Z)]),listItem:c(({item:t})=>[u("div",ee,[u("div",te,[_(g,{url:t.userpic,size:20},null,8,["url"])]),u("span",{class:"tw-truncate small",title:t.name},D(t.name),9,ae)])]),_:1},8,["items","value","text-value","is-multiple","placeholder","on-enter","on-item-select","onInput","onFocus"]))}});export{ie as _,X as a};
